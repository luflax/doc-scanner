var _t=Object.defineProperty;var Ct=(w,s,e)=>s in w?_t(w,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):w[s]=e;var pe=(w,s,e)=>Ct(w,typeof s!="symbol"?s+"":s,e);import{r as te,a as kt,c as Ae,g as St,R as Et}from"./react-vendor-CVDnmApk.js";import{c as jt}from"./zustand-vendor-D0NwXheU.js";import{c as Te,s as It}from"./tesseract-vendor-D34z6xNp.js";import{E as Dt}from"./pdf-vendor-CzmxGYVW.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const t of r)if(t.type==="childList")for(const a of t.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(r){const t={};return r.integrity&&(t.integrity=r.integrity),r.referrerPolicy&&(t.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?t.credentials="include":r.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function n(r){if(r.ep)return;r.ep=!0;const t=e(r);fetch(r.href,t)}})();var ft={exports:{}},We={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zt=te,Rt=Symbol.for("react.element"),Nt=Symbol.for("react.fragment"),Ot=Object.prototype.hasOwnProperty,At=zt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Tt={key:!0,ref:!0,__self:!0,__source:!0};function mt(w,s,e){var n,r={},t=null,a=null;e!==void 0&&(t=""+e),s.key!==void 0&&(t=""+s.key),s.ref!==void 0&&(a=s.ref);for(n in s)Ot.call(s,n)&&!Tt.hasOwnProperty(n)&&(r[n]=s[n]);if(w&&w.defaultProps)for(n in s=w.defaultProps,s)r[n]===void 0&&(r[n]=s[n]);return{$$typeof:Rt,type:w,key:t,ref:a,props:r,_owner:At.current}}We.Fragment=Nt;We.jsx=mt;We.jsxs=mt;ft.exports=We;var p=ft.exports,Xe={},it=kt;Xe.createRoot=it.createRoot,Xe.hydrateRoot=it.hydrateRoot;const Le={brightness:0,contrast:0,saturation:0,sharpness:0,gamma:1,shadows:0,highlights:0,temperature:0},Bt=[{id:"original",name:"Original",description:"No filter applied",icon:"ðŸ“„"},{id:"document",name:"Document",description:"High contrast B&W",icon:"ðŸ“ƒ"},{id:"grayscale",name:"Grayscale",description:"Black and white",icon:"â¬œ"},{id:"magic",name:"Magic",description:"Auto-enhanced",icon:"âœ¨"},{id:"whiteboard",name:"Whiteboard",description:"For whiteboards",icon:"ðŸ–Šï¸"},{id:"book",name:"Book",description:"For book pages",icon:"ðŸ“–"},{id:"receipt",name:"Receipt",description:"High contrast",icon:"ðŸ§¾"},{id:"photo",name:"Photo",description:"Color preserved",icon:"ðŸ–¼ï¸"},{id:"blueprint",name:"Blueprint",description:"Inverted colors",icon:"ðŸ“"}],be=jt(w=>({camera:{isInitialized:!1,isCapturing:!1,stream:null,capabilities:null,error:null},scanSession:{isActive:!1,currentImage:null,detectedEdges:null,adjustedCorners:null,processedImage:null,selectedFilter:"original",enhancementOptions:Le},ocr:{isInitialized:!1,isProcessing:!1,progress:0,result:null,selectedLanguages:["eng"]},documents:{list:[],currentDocument:null,isLoading:!1,selectedDocumentIds:[]},ui:{currentView:"camera",isProcessing:!1,toasts:[],modalOpen:null},setCameraInitialized:s=>w(e=>({camera:{...e.camera,isInitialized:s}})),setCameraStream:s=>w(e=>({camera:{...e.camera,stream:s}})),setCameraCapabilities:s=>w(e=>({camera:{...e.camera,capabilities:s}})),setCameraError:s=>w(e=>({camera:{...e.camera,error:s}})),setCapturing:s=>w(e=>({camera:{...e.camera,isCapturing:s}})),startScanSession:s=>w({scanSession:{isActive:!0,currentImage:s,detectedEdges:null,adjustedCorners:null,processedImage:null,selectedFilter:"original",enhancementOptions:Le}}),setDetectedEdges:s=>w(e=>({scanSession:{...e.scanSession,detectedEdges:s}})),setAdjustedCorners:s=>w(e=>({scanSession:{...e.scanSession,adjustedCorners:s}})),setProcessedImage:s=>w(e=>({scanSession:{...e.scanSession,processedImage:s}})),setSelectedFilter:s=>w(e=>({scanSession:{...e.scanSession,selectedFilter:s}})),setEnhancementOptions:s=>w(e=>({scanSession:{...e.scanSession,enhancementOptions:s}})),resetScanSession:()=>w({scanSession:{isActive:!1,currentImage:null,detectedEdges:null,adjustedCorners:null,processedImage:null,selectedFilter:"original",enhancementOptions:Le}}),setOCRInitialized:s=>w(e=>({ocr:{...e.ocr,isInitialized:s}})),setOCRProcessing:s=>w(e=>({ocr:{...e.ocr,isProcessing:s}})),setOCRProgress:s=>w(e=>({ocr:{...e.ocr,progress:s}})),setOCRResult:s=>w(e=>({ocr:{...e.ocr,result:s}})),setSelectedLanguages:s=>w(e=>({ocr:{...e.ocr,selectedLanguages:s}})),setDocuments:s=>w(e=>({documents:{...e.documents,list:s}})),setCurrentDocument:s=>w(e=>({documents:{...e.documents,currentDocument:s}})),setDocumentsLoading:s=>w(e=>({documents:{...e.documents,isLoading:s}})),addDocument:s=>w(e=>({documents:{...e.documents,list:[s,...e.documents.list]}})),removeDocument:s=>w(e=>({documents:{...e.documents,list:e.documents.list.filter(n=>n.id!==s),selectedDocumentIds:e.documents.selectedDocumentIds.filter(n=>n!==s)}})),toggleDocumentSelection:s=>w(e=>{const n=e.documents.selectedDocumentIds.includes(s);return{documents:{...e.documents,selectedDocumentIds:n?e.documents.selectedDocumentIds.filter(r=>r!==s):[...e.documents.selectedDocumentIds,s]}}}),clearDocumentSelection:()=>w(s=>({documents:{...s.documents,selectedDocumentIds:[]}})),selectAllDocuments:()=>w(s=>({documents:{...s.documents,selectedDocumentIds:s.documents.list.map(e=>e.id)}})),setCurrentView:s=>w(e=>({ui:{...e.ui,currentView:s}})),setProcessing:s=>w(e=>({ui:{...e.ui,isProcessing:s}})),addToast:s=>w(e=>({ui:{...e.ui,toasts:[...e.ui.toasts,{...s,id:Math.random().toString(36).substr(2,9)}]}})),removeToast:s=>w(e=>({ui:{...e.ui,toasts:e.ui.toasts.filter(n=>n.id!==s)}})),setModalOpen:s=>w(e=>({ui:{...e.ui,modalOpen:s}}))})),Ft=()=>{const w=be(e=>e.ui.currentView),s=()=>{switch(w){case"camera":return"Document Scanner";case"crop":return"Crop Document";case"enhance":return"Enhance";case"ocr":return"Extract Text";case"documents":return"My Documents";case"export":return"Export";default:return"Document Scanner"}};return p.jsx("header",{className:"fixed top-0 left-0 right-0 z-30 bg-white border-b border-gray-200 pt-safe",children:p.jsxs("div",{className:"flex items-center justify-between px-4 h-14",children:[p.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:s()}),p.jsx("div",{className:"flex items-center gap-2"})]})})},Pt=()=>{const w=be(n=>n.ui.currentView),s=be(n=>n.setCurrentView),e=[{view:"camera",label:"Camera",icon:"ðŸ“·"},{view:"documents",label:"Documents",icon:"ðŸ“„"}];return p.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-30 bg-white border-t border-gray-200 pb-safe",children:p.jsx("div",{className:"flex items-center justify-around h-16",children:e.map(n=>p.jsxs("button",{onClick:()=>s(n.view),className:`flex flex-col items-center justify-center flex-1 h-full transition-colors ${w===n.view?"text-primary-600":"text-gray-500 hover:text-gray-700"}`,children:[p.jsx("span",{className:"text-2xl mb-1",children:n.icon}),p.jsx("span",{className:"text-xs font-medium",children:n.label})]},n.view))})})},Lt=({toast:w})=>{const s=be(n=>n.removeToast);te.useEffect(()=>{const n=w.duration||3e3,r=setTimeout(()=>{s(w.id)},n);return()=>clearTimeout(r)},[w.id,w.duration,s]);const e={success:"toast-success",error:"toast-error",warning:"toast-warning",info:"toast-info"};return p.jsx("div",{className:`toast ${e[w.type]} mb-2`,children:p.jsx("p",{className:"text-sm font-medium",children:w.message})})},Mt=()=>{const w=be(s=>s.ui.toasts);return w.length===0?null:p.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:w.map(s=>p.jsx(Lt,{toast:s},s.id))})};class Ut{constructor(){pe(this,"stream",null);pe(this,"videoTrack",null);pe(this,"currentFacingMode","environment")}async initialize(s){const n={...{facingMode:"environment",resolution:{ideal:{width:3840,height:2160},min:{width:1920,height:1080}},focusMode:"continuous",torch:!1},...s};this.currentFacingMode=n.facingMode;try{const r={video:{facingMode:{ideal:n.facingMode},width:{ideal:n.resolution.ideal.width},height:{ideal:n.resolution.ideal.height}},audio:!1};return this.stream=await navigator.mediaDevices.getUserMedia(r),this.videoTrack=this.stream.getVideoTracks()[0],this.stream}catch(r){console.warn("Failed with ideal constraints, falling back to basic",r);const t={video:{facingMode:n.facingMode,width:{ideal:1920},height:{ideal:1080}},audio:!1};return this.stream=await navigator.mediaDevices.getUserMedia(t),this.videoTrack=this.stream.getVideoTracks()[0],this.stream}}getCapabilities(){if(!this.videoTrack)return null;try{const s=this.videoTrack.getCapabilities();return{hasFlash:"torch"in s,hasFocus:"focusMode"in s,hasZoom:"zoom"in s,maxZoom:s.zoom?.max||1,supportedResolutions:this.getSupportedResolutions(s)}}catch(s){return console.error("Failed to get camera capabilities",s),{hasFlash:!1,hasFocus:!1,hasZoom:!1,maxZoom:1,supportedResolutions:[]}}}getSupportedResolutions(s){const e=[],n=[{width:3840,height:2160},{width:1920,height:1080},{width:1280,height:720},{width:640,height:480}],r=s.width?.max||1920,t=s.height?.max||1080;for(const a of n)a.width<=r&&a.height<=t&&e.push(a);return e}async switchCamera(){const s=this.currentFacingMode==="environment"?"user":"environment";return this.dispose(),this.initialize({facingMode:s})}async capturePhoto(s){if(!this.stream)throw new Error("Camera not initialized");const e=document.createElement("canvas");e.width=s.videoWidth,e.height=s.videoHeight;const n=e.getContext("2d");if(!n)throw new Error("Failed to get canvas context");return n.drawImage(s,0,0),n.getImageData(0,0,e.width,e.height)}getVideoFrame(s){if(!this.stream)return null;try{const e=document.createElement("canvas"),n=Math.min(640,s.videoWidth),r=Math.min(480,s.videoHeight);e.width=n,e.height=r;const t=e.getContext("2d");return t?(t.drawImage(s,0,0,n,r),t.getImageData(0,0,n,r)):null}catch(e){return console.error("Failed to get video frame",e),null}}async setZoom(s){if(!this.videoTrack)throw new Error("Camera not initialized");if(!("zoom"in this.videoTrack.getCapabilities()))throw new Error("Zoom not supported");const n={advanced:[{zoom:s}]};try{await this.videoTrack.applyConstraints(n)}catch(r){throw console.error("Failed to set zoom",r),r}}async toggleFlash(s){if(!this.videoTrack)throw new Error("Camera not initialized");if(!("torch"in this.videoTrack.getCapabilities()))throw new Error("Flash not supported");const n={advanced:[{torch:s}]};try{await this.videoTrack.applyConstraints(n)}catch(r){throw console.error("Failed to toggle flash",r),r}}async setFocusPoint(s,e){if(!this.videoTrack)throw new Error("Camera not initialized");if(!("focusMode"in this.videoTrack.getCapabilities())){console.warn("Focus control not supported");return}console.log("Focus point requested:",s,e)}getStream(){return this.stream}getCurrentFacingMode(){return this.currentFacingMode}isInitialized(){return this.stream!==null&&this.videoTrack!==null}dispose(){this.stream&&(this.stream.getTracks().forEach(s=>s.stop()),this.stream=null),this.videoTrack=null}}const Ee=new Ut,Wt=(w={})=>{const{autoStart:s=!1,facingMode:e="environment",onError:n,onInitialized:r}=w,[t,a]=te.useState(null),[o,l]=te.useState(!1),[m,_]=te.useState(!1),[b,C]=te.useState(null),[u,x]=te.useState(null),d=te.useRef(null),f=async()=>{_(!0),C(null);try{const z=await Ee.initialize({facingMode:e});a(z),l(!0);const R=Ee.getCapabilities();x(R),r?.(z)}catch(z){const R=z instanceof Error?z:new Error("Failed to initialize camera");C(R),n?.(R)}finally{_(!1)}},h=async()=>{_(!0),C(null);try{const z=await Ee.switchCamera();a(z);const R=Ee.getCapabilities();x(R),r?.(z)}catch(z){const R=z instanceof Error?z:new Error("Failed to switch camera");C(R),n?.(R)}finally{_(!1)}},v=async()=>{if(!d.current||!t)return C(new Error("Camera not ready")),null;try{return await Ee.capturePhoto(d.current)}catch(z){const R=z instanceof Error?z:new Error("Failed to capture photo");return C(R),n?.(R),null}},j=async z=>{try{await Ee.setZoom(z)}catch(R){console.error("Zoom failed:",R)}},E=async z=>{try{await Ee.toggleFlash(z)}catch(R){console.error("Flash toggle failed:",R)}},S=()=>{Ee.dispose(),a(null),l(!1),x(null)};return te.useEffect(()=>{t&&d.current&&(d.current.srcObject=t)},[t]),te.useEffect(()=>(s&&f(),()=>{S()}),[]),{stream:t,isInitialized:o,isLoading:m,error:b,capabilities:u,videoRef:d,initialize:f,switchCamera:h,capturePhoto:v,setZoom:j,toggleFlash:E,dispose:S,facingMode:Ee.getCurrentFacingMode()}},ue=({variant:w="primary",size:s="md",fullWidth:e=!1,className:n="",children:r,...t})=>{const a="btn font-medium transition-all duration-200 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",o={primary:"btn-primary",secondary:"btn-secondary",outline:"border-2 border-primary-600 text-primary-600 hover:bg-primary-50 active:bg-primary-100"},l={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"},m=e?"w-full":"";return p.jsx("button",{className:`${a} ${o[w]} ${l[s]} ${m} ${n}`,...t,children:r})},Je=({icon:w,label:s,size:e="md",className:n="",...r})=>{const t={sm:"p-2",md:"p-3",lg:"p-4"};return p.jsx("button",{className:`btn-icon ${t[e]} ${n}`,"aria-label":s,title:s,...r,children:w})},Ie=({size:w="md",className:s=""})=>{const e={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"};return p.jsx("div",{className:`flex items-center justify-center ${s}`,children:p.jsx("div",{className:`${e[w]} border-4 border-gray-200 border-t-primary-600 rounded-full animate-spin`})})},at=()=>{const{addToast:w,setCameraCapabilities:s,setCurrentView:e,startScanSession:n}=be(d=>({addToast:d.addToast,setCameraCapabilities:d.setCameraCapabilities,setCurrentView:d.setCurrentView,startScanSession:d.startScanSession})),{videoRef:r,isInitialized:t,isLoading:a,error:o,capabilities:l,facingMode:m,initialize:_,switchCamera:b,capturePhoto:C}=Wt({onError:d=>{w({type:"error",message:d.message||"Failed to access camera"})},onInitialized:()=>{w({type:"success",message:"Camera initialized successfully"})}});te.useEffect(()=>{l&&s(l)},[l,s]);const u=async()=>{const d=await C();d&&(n(d),e("crop"),w({type:"success",message:"Image captured successfully"}))},x=async()=>{try{await b(),w({type:"success",message:`Switched to ${m==="environment"?"front":"back"} camera`})}catch{w({type:"error",message:"Failed to switch camera"})}};return a?p.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-black",children:[p.jsx(Ie,{size:"lg",className:"mb-4"}),p.jsx("p",{className:"text-white text-sm",children:"Initializing camera..."})]}):o||!t&&!a?p.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-100 p-6",children:[p.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“·"}),p.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Camera Access Required"}),o&&p.jsx("p",{className:"text-sm text-red-600 mb-4 text-center max-w-md",children:o.message}),p.jsx("p",{className:"text-sm text-gray-600 mb-6 text-center max-w-md",children:"This app needs access to your camera to scan documents. Click the button below to grant permission."}),p.jsx(ue,{onClick:_,variant:"primary",size:"lg",children:"Enable Camera"})]}):p.jsxs("div",{className:"relative w-full h-full bg-black",children:[p.jsx("video",{ref:r,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),p.jsx("div",{className:"absolute top-0 left-0 right-0 p-4",children:p.jsx("div",{className:"flex justify-end",children:p.jsx(Je,{icon:p.jsx("span",{className:"text-xl",children:"ðŸ”„"}),onClick:x,className:"bg-black/50 text-white hover:bg-black/70",label:"Switch camera"})})}),p.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/80 to-transparent",children:p.jsx("div",{className:"flex items-center justify-center",children:p.jsx(ue,{onClick:u,variant:"primary",size:"lg",className:"rounded-full w-16 h-16 p-0",children:p.jsx("span",{className:"text-2xl",children:"ðŸ“¸"})})})}),p.jsx("div",{className:"absolute inset-0 pointer-events-none",children:p.jsx("div",{className:"w-full h-full flex items-center justify-center p-8",children:p.jsx("div",{className:"border-2 border-white border-dashed rounded-lg w-full max-w-md aspect-document opacity-50"})})})]})},Zt=({corners:w,imageSize:s,containerSize:e,onChange:n,onCommit:r,className:t=""})=>{const[a,o]=te.useState(null),[l,m]=te.useState(w),_=te.useRef(null);te.useEffect(()=>{m(w)},[w]);const b=()=>{const E=s.width/s.height,S=e.width/e.height;let z,R,L=0,I=0;return E>S?(z=e.width/s.width,R=z,I=(e.height-s.height*R)/2):(R=e.height/s.height,z=R,L=(e.width-s.width*z)/2),{scaleX:z,scaleY:R,offsetX:L,offsetY:I}},C=E=>{const{scaleX:S,scaleY:z,offsetX:R,offsetY:L}=b();return{x:E.x*S+R,y:E.y*z+L}},u=E=>{const{scaleX:S,scaleY:z,offsetX:R,offsetY:L}=b();return{x:(E.x-R)/S,y:(E.y-L)/z}},x=E=>{if(!_.current)return{x:0,y:0};const z=_.current.getBoundingClientRect();let R,L;if("touches"in E){const I=E.touches[0];R=I.clientX,L=I.clientY}else R=E.clientX,L=E.clientY;return{x:R-z.left,y:L-z.top}},d=E=>S=>{S.preventDefault(),S.stopPropagation(),o(E)},f=E=>{if(a===null)return;E.preventDefault();const S=x(E),z=u(S),R={x:Math.max(0,Math.min(s.width,z.x)),y:Math.max(0,Math.min(s.height,z.y))},L=[...l];L[a]=R,m(L),n(L)},h=()=>{a!==null&&(o(null),r?.())},v=l.map(C),j=v.length===4?`M ${v[0].x} ${v[0].y} L ${v[1].x} ${v[1].y} L ${v[2].x} ${v[2].y} L ${v[3].x} ${v[3].y} Z`:"";return p.jsxs("svg",{ref:_,className:`absolute inset-0 w-full h-full ${t}`,style:{touchAction:"none"},onMouseMove:f,onMouseUp:h,onMouseLeave:h,onTouchMove:f,onTouchEnd:h,onTouchCancel:h,children:[j&&p.jsxs(p.Fragment,{children:[p.jsx("path",{d:j,fill:"rgba(59, 130, 246, 0.2)",stroke:"none"}),p.jsx("path",{d:j,fill:"none",stroke:"#3b82f6",strokeWidth:"2"})]}),v.map((E,S)=>p.jsxs("g",{children:[p.jsx("circle",{cx:E.x,cy:E.y,r:"20",fill:"transparent",style:{cursor:"grab"},onMouseDown:d(S),onTouchStart:d(S)}),p.jsx("circle",{cx:E.x,cy:E.y,r:"8",fill:"white",stroke:"#3b82f6",strokeWidth:"3",style:{cursor:"grab",pointerEvents:"none"}}),p.jsx("circle",{cx:E.x,cy:E.y,r:"3",fill:"#3b82f6",style:{pointerEvents:"none"}})]},S)),v.length===4&&v.map((E,S)=>{const z=v[(S+1)%4];return p.jsx("line",{x1:E.x,y1:E.y,x2:z.x,y2:z.y,stroke:"#3b82f6",strokeWidth:"2",strokeDasharray:"5,5",style:{pointerEvents:"none"}},`line-${S}`)})]})};function tt(){return!!window.cv}function Me(){if(!window.cv)throw new Error("OpenCV not loaded. Call loadOpenCV() first.");return window.cv}function ve(w){return Me().matFromImageData(w)}function ke(w){const s=Me(),e=document.createElement("canvas");e.width=w.cols,e.height=w.rows;const n=e.getContext("2d");if(!n)throw new Error("Failed to get canvas context");return s.imshow(e,w),n.getImageData(0,0,e.width,e.height)}function we(...w){for(const s of w)s&&s.delete&&s.delete()}class Gt{constructor(){pe(this,"cv",null);pe(this,"isInitialized",!1)}async initialize(){if(console.log("[EdgeDetectionService] initialize() called, isInitialized:",this.isInitialized),!this.isInitialized)try{console.log("[EdgeDetectionService] Calling loadOpenCV()"),this.cv=window.cv instanceof Promise?await window.cv:window.cv,console.log("[EdgeDetectionService] loadOpenCV() completed, cv:",this.cv),this.isInitialized=!0,console.log("[EdgeDetectionService] EdgeDetectionService initialized")}catch(s){throw console.error("[EdgeDetectionService] Failed to initialize EdgeDetectionService:",s),s}}async detectDocument(s,e){console.log("[EdgeDetectionService] detectDocument() called, image size:",s.width,"x",s.height),this.isInitialized||(console.log("[EdgeDetectionService] Not initialized, calling initialize()"),await this.initialize());const r={...{cannyThreshold1:50,cannyThreshold2:150,blurKernelSize:5,dilationIterations:2,minAreaRatio:.1,maxAreaRatio:.95},...e};let t=null,a=null,o=null,l=null,m=null,_=null,b=null;try{console.log("[EdgeDetectionService] Starting edge detection pipeline"),console.log("[EdgeDetectionService] Converting ImageData to Mat"),t=ve(s),console.log("[EdgeDetectionService] ImageData converted, Mat size:",t.rows,"x",t.cols),console.log("[EdgeDetectionService] Converting to grayscale"),a=new this.cv.Mat,this.cv.cvtColor(t,a,this.cv.COLOR_RGBA2GRAY),console.log("[EdgeDetectionService] Grayscale conversion complete"),console.log("[EdgeDetectionService] Applying Gaussian blur"),o=new this.cv.Mat;const C=new this.cv.Size(r.blurKernelSize,r.blurKernelSize);this.cv.GaussianBlur(a,o,C,0),console.log("[EdgeDetectionService] Gaussian blur complete"),console.log("[EdgeDetectionService] Applying Canny edge detection"),l=new this.cv.Mat,this.cv.Canny(o,l,r.cannyThreshold1,r.cannyThreshold2),console.log("[EdgeDetectionService] Canny edge detection complete"),console.log("[EdgeDetectionService] Dilating edges"),m=new this.cv.Mat;const u=this.cv.Mat.ones(3,3,this.cv.CV_8U);this.cv.dilate(l,m,u,new this.cv.Point(-1,-1),r.dilationIterations),u.delete(),console.log("[EdgeDetectionService] Edge dilation complete"),console.log("[EdgeDetectionService] Finding contours"),_=new this.cv.MatVector,b=new this.cv.Mat,this.cv.findContours(m,_,b,this.cv.RETR_EXTERNAL,this.cv.CHAIN_APPROX_SIMPLE),console.log("[EdgeDetectionService] Found",_.size(),"contours"),console.log("[EdgeDetectionService] Finding best quadrilateral");const x=this.findBestQuadrilateral(_,s.width,s.height,r);return console.log("[EdgeDetectionService] Best quadrilateral result:",x),x}catch(C){return console.error("[EdgeDetectionService] Edge detection failed:",C),null}finally{console.log("[EdgeDetectionService] Cleaning up resources"),we(t,a,o,l,m,b),_&&_.delete(),console.log("[EdgeDetectionService] Cleanup complete")}}findBestQuadrilateral(s,e,n,r){const t=e*n,a=t*r.minAreaRatio,o=t*r.maxAreaRatio;let l=null,m=0;for(let _=0;_<s.size();_++){const b=s.get(_),C=this.cv.contourArea(b);if(C<a||C>o)continue;const u=this.cv.arcLength(b,!0),x=new this.cv.Mat;if(this.cv.approxPolyDP(b,x,.02*u,!0),x.rows===4){const d=this.matToPoints(x),f=this.getBoundingRect(d),h=f.width/f.height,v=this.scoreQuadrilateral(d,C,h,t);v>m&&(m=v,l={contour:this.orderCorners(d),confidence:Math.min(v/100,1),area:C,aspectRatio:h,boundingRect:f})}x.delete()}return l}scoreQuadrilateral(s,e,n,r){let t=0;const a=e/r;t+=a*50;const l=[1,1.29,1.41,1.5].reduce((_,b)=>{const C=Math.abs(n-b),u=Math.max(0,25-C*20);return Math.max(_,u)},0);t+=l;const m=this.isRoughlyConvex(s)?25:0;return t+=m,t}isRoughlyConvex(s){if(s.length!==4)return!1;const e=[];for(let t=0;t<4;t++){const a=s[t],o=s[(t+1)%4],l=s[(t+2)%4],m=(o.x-a.x)*(l.y-o.y)-(o.y-a.y)*(l.x-o.x);e.push(m)}const n=e.every(t=>t>0),r=e.every(t=>t<0);return n||r}matToPoints(s){const e=[];for(let n=0;n<s.rows;n++){const r=s.data32S[n*2],t=s.data32S[n*2+1];e.push({x:r,y:t})}return e}getBoundingRect(s){const e=s.map(l=>l.x),n=s.map(l=>l.y),r=Math.min(...e),t=Math.max(...e),a=Math.min(...n),o=Math.max(...n);return{x:r,y:a,width:t-r,height:o-a}}orderCorners(s){if(s.length!==4)return s;const e=[...s].sort((t,a)=>t.y-a.y),n=e.slice(0,2).sort((t,a)=>t.x-a.x),r=e.slice(2,4).sort((t,a)=>t.x-a.x);return[n[0],n[1],r[1],r[0]]}isReady(){return this.isInitialized&&tt()}}const Vt=new Gt;class Ht{async correctPerspective(s,e,n){if(!tt())throw new Error("OpenCV not loaded");if(e.length!==4)throw new Error("Exactly 4 corners required");const t={...{outputWidth:0,outputHeight:0,preserveAspectRatio:!0,interpolation:"linear"},...n};let a=null,o=null,l=null;try{const m=Me();a=ve(s);const _=t.outputWidth&&t.outputHeight?{width:t.outputWidth,height:t.outputHeight}:this.calculateOutputDimensions(e),b=this.ensureCornerOrder(e),C=m.matFromArray(4,1,m.CV_32FC2,[b[0].x,b[0].y,b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y]),u=m.matFromArray(4,1,m.CV_32FC2,[0,0,_.width,0,_.width,_.height,0,_.height]);l=m.getPerspectiveTransform(C,u),o=new m.Mat;const x=new m.Size(_.width,_.height),d=this.getInterpolationFlag(t.interpolation);m.warpPerspective(a,o,l,x,d,m.BORDER_CONSTANT,new m.Scalar(255,255,255,255));const f=ke(o),h=this.matrixToArray(l);return C.delete(),u.delete(),{correctedImage:f,transformMatrix:h,originalCorners:b,outputDimensions:_}}catch(m){return console.error("Perspective correction failed:",m),null}finally{we(a,o,l)}}calculateOutputDimensions(s){if(s.length!==4)throw new Error("Exactly 4 corners required");const e=this.ensureCornerOrder(s),n=this.distance(e[0],e[1]),r=this.distance(e[3],e[2]),t=this.distance(e[0],e[3]),a=this.distance(e[1],e[2]),o=Math.max(n,r),l=Math.max(t,a);return{width:Math.round(o),height:Math.round(l)}}distance(s,e){const n=e.x-s.x,r=e.y-s.y;return Math.sqrt(n*n+r*r)}ensureCornerOrder(s){if(s.length!==4)return s;const e={x:s.reduce((o,l)=>o+l.x,0)/4,y:s.reduce((o,l)=>o+l.y,0)/4},n=[...s].sort((o,l)=>{const m=Math.atan2(o.y-e.y,o.x-e.x),_=Math.atan2(l.y-e.y,l.x-e.x);return m-_}),r=n.map(o=>o.x+o.y),t=r.indexOf(Math.min(...r));return[n[t],n[(t+1)%4],n[(t+2)%4],n[(t+3)%4]]}getInterpolationFlag(s){const e=Me();switch(s){case"nearest":return e.INTER_NEAREST;case"linear":return e.INTER_LINEAR;case"cubic":return e.INTER_CUBIC;case"lanczos":return e.INTER_LANCZOS4;default:return e.INTER_LINEAR}}matrixToArray(s){const e=[];for(let n=0;n<s.rows;n++){const r=[];for(let t=0;t<s.cols;t++)r.push(s.data64F[n*s.cols+t]);e.push(r)}return e}}const $t=new Ht,Yt=()=>{const w=te.useRef(null),s=te.useRef(null),[e,n]=te.useState(!1),[r,t]=te.useState(!1),[a,o]=te.useState({width:0,height:0}),{currentImage:l,detectedEdges:m,adjustedCorners:_,setCurrentView:b,resetScanSession:C,setDetectedEdges:u,setAdjustedCorners:x,setProcessedImage:d,addToast:f}=be(S=>({currentImage:S.scanSession.currentImage,detectedEdges:S.scanSession.detectedEdges,adjustedCorners:S.scanSession.adjustedCorners,setCurrentView:S.setCurrentView,resetScanSession:S.resetScanSession,setDetectedEdges:S.setDetectedEdges,setAdjustedCorners:S.setAdjustedCorners,setProcessedImage:S.setProcessedImage,addToast:S.addToast}));te.useEffect(()=>{if(l&&w.current){const S=w.current,z=S.getContext("2d");if(!z)return;S.width=l.width,S.height=l.height,z.putImageData(l,0,0)}},[l]),te.useEffect(()=>{l&&!m&&!e&&h()},[l]),te.useEffect(()=>{const S=()=>{if(s.current){const z=s.current.getBoundingClientRect();o({width:z.width,height:z.height})}};return S(),window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)},[]);const h=async()=>{if(console.log("[CropView] detectEdges() called"),!!l){console.log("[CropView] Setting isDetecting to true"),n(!0);try{console.log("[CropView] Calling edgeDetectionService.detectDocument()");const S=await Vt.detectDocument(l);if(console.log("[CropView] detectDocument() returned:",S),S)u(S),x(S.contour),f({type:"success",message:"Document detected!"});else{const z=[{x:0,y:0},{x:l.width,y:0},{x:l.width,y:l.height},{x:0,y:l.height}];x(z),f({type:"warning",message:"Could not detect document. Using full image."})}}catch(S){console.error("[CropView] Edge detection failed:",S),f({type:"error",message:"Edge detection failed"})}finally{console.log("[CropView] Setting isDetecting to false"),n(!1)}}},v=S=>{x(S)},j=()=>{C(),b("camera")},E=async()=>{if(!(!l||!_)){t(!0);try{const S=await $t.correctPerspective(l,_);if(S)d(S.correctedImage),b("enhance"),f({type:"success",message:"Image cropped successfully!"});else throw new Error("Perspective correction failed")}catch(S){console.error("Perspective correction failed:",S),f({type:"error",message:"Failed to crop image"})}finally{t(!1)}}};return l?e?p.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-900",children:[p.jsx(Ie,{size:"lg",className:"mb-4"}),p.jsx("p",{className:"text-white text-sm",children:"Detecting document edges..."})]}):p.jsxs("div",{className:"flex flex-col h-full bg-gray-900",children:[p.jsxs("div",{ref:s,className:"flex-1 overflow-hidden flex items-center justify-center p-4 relative",children:[p.jsx("canvas",{ref:w,className:"max-w-full max-h-full object-contain"}),_&&l&&a.width>0&&p.jsx(Zt,{corners:_,imageSize:{width:l.width,height:l.height},containerSize:a,onChange:v})]}),p.jsx("div",{className:"p-4 bg-white border-t border-gray-200",children:p.jsxs("div",{className:"flex gap-3",children:[p.jsx(ue,{onClick:j,variant:"secondary",fullWidth:!0,disabled:r,children:"Retake"}),p.jsx(ue,{onClick:h,variant:"secondary",fullWidth:!0,disabled:r,children:"Auto-Detect"}),p.jsx(ue,{onClick:E,variant:"primary",fullWidth:!0,disabled:r,children:r?"Processing...":"Continue"})]})})]}):p.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-50 p-6",children:[p.jsx("p",{className:"text-gray-600",children:"No image captured"}),p.jsx(ue,{onClick:()=>b("camera"),className:"mt-4",children:"Back to Camera"})]})};let Be;const Kt=new Uint8Array(16);function qt(){if(!Be&&(Be=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Be))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Be(Kt)}const fe=[];for(let w=0;w<256;++w)fe.push((w+256).toString(16).slice(1));function Xt(w,s=0){return fe[w[s+0]]+fe[w[s+1]]+fe[w[s+2]]+fe[w[s+3]]+"-"+fe[w[s+4]]+fe[w[s+5]]+"-"+fe[w[s+6]]+fe[w[s+7]]+"-"+fe[w[s+8]]+fe[w[s+9]]+"-"+fe[w[s+10]]+fe[w[s+11]]+fe[w[s+12]]+fe[w[s+13]]+fe[w[s+14]]+fe[w[s+15]]}const Jt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ot={randomUUID:Jt};function ct(w,s,e){if(ot.randomUUID&&!w)return ot.randomUUID();w=w||{};const n=w.random||(w.rng||qt)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Xt(n)}const Qt=({selectedFilter:w,onSelect:s,disabled:e=!1})=>{const n=te.useRef(null),r=te.useRef(null);return te.useEffect(()=>{r.current&&n.current&&r.current.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},[w]),p.jsx("div",{className:"w-full bg-white border-b border-gray-200",children:p.jsx("div",{ref:n,className:"flex gap-2 px-4 py-3 overflow-x-auto scrollbar-hide",style:{scrollSnapType:"x mandatory",WebkitOverflowScrolling:"touch"},children:Bt.map(t=>{const a=t.id===w;return p.jsxs("button",{ref:a?r:null,onClick:()=>!e&&s(t.id),disabled:e,className:`
                flex-shrink-0 flex flex-col items-center justify-center
                min-w-[80px] px-3 py-2 rounded-lg
                transition-all duration-200
                ${a?"bg-blue-500 text-white shadow-md scale-105":"bg-gray-100 text-gray-700 hover:bg-gray-200"}
                ${e?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                scroll-snap-align-center
              `,style:{scrollSnapAlign:"center"},children:[p.jsx("span",{className:"text-2xl mb-1",children:t.icon}),p.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:t.name})]},t.id)})})})},Fe=({label:w,value:s,min:e,max:n,step:r,onChange:t,disabled:a=!1,unit:o=""})=>{const l=(s-e)/(n-e)*100;return p.jsxs("div",{className:"mb-4",children:[p.jsxs("div",{className:"flex justify-between items-center mb-2",children:[p.jsx("label",{className:"text-sm font-medium text-gray-700",children:w}),p.jsxs("span",{className:"text-sm text-gray-500",children:[s.toFixed(r<1?1:0),o]})]}),p.jsx("div",{className:"relative",children:p.jsx("input",{type:"range",min:e,max:n,step:r,value:s,onChange:m=>t(parseFloat(m.target.value)),disabled:a,className:`
            w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer
            ${a?"opacity-50 cursor-not-allowed":""}
          `,style:{background:`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${l}%, #e5e7eb ${l}%, #e5e7eb 100%)`}})})]})},er=({options:w,onChange:s,disabled:e=!1})=>{const n=(r,t)=>{s({...w,[r]:t})};return p.jsxs("div",{className:"bg-white p-4 rounded-lg",children:[p.jsx("h3",{className:"text-sm font-semibold text-gray-800 mb-4",children:"Manual Adjustments"}),p.jsx(Fe,{label:"Brightness",value:w.brightness,min:-100,max:100,step:1,onChange:r=>n("brightness",r),disabled:e}),p.jsx(Fe,{label:"Contrast",value:w.contrast,min:-100,max:100,step:1,onChange:r=>n("contrast",r),disabled:e}),p.jsx(Fe,{label:"Saturation",value:w.saturation,min:-100,max:100,step:1,onChange:r=>n("saturation",r),disabled:e}),p.jsx(Fe,{label:"Gamma",value:w.gamma,min:.1,max:3,step:.1,onChange:r=>n("gamma",r),disabled:e}),p.jsx("button",{onClick:()=>s({brightness:0,contrast:0,saturation:0,sharpness:0,gamma:1,shadows:0,highlights:0,temperature:0}),disabled:e,className:"w-full mt-2 px-4 py-2 text-sm text-blue-600 bg-blue-50 rounded-lg hover:bg-blue-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Reset Adjustments"})]})};class tr{constructor(){pe(this,"cv",null);pe(this,"isInitialized",!1)}async initialize(){if(!this.isInitialized)try{this.cv=window.cv instanceof Promise?await window.cv:window.cv,this.isInitialized=!0,console.log("ImageEnhancementService initialized")}catch(s){throw console.error("Failed to initialize ImageEnhancementService:",s),s}}async enhance(s,e){this.isInitialized||await this.initialize();let n=null,r=null;try{if(n=ve(s),r=n.clone(),e.brightness!==0||e.contrast!==0){const t=1+e.contrast/100,a=e.brightness/100*255;r.convertTo(r,-1,t,a)}return e.gamma!==1&&this.applyGamma(r,e.gamma),e.saturation!==0&&this.applySaturation(r,e.saturation),ke(r)}catch(t){return console.error("Enhancement failed:",t),null}finally{we(n,r)}}async applyFilter(s,e){switch(this.isInitialized||await this.initialize(),e){case"original":return s;case"grayscale":return this.applyGrayscale(s);case"document":return this.applyDocumentFilter(s);case"magic":return this.applyMagicFilter(s);case"whiteboard":return this.applyWhiteboardFilter(s);case"book":return this.applyBookFilter(s);case"receipt":return this.applyReceiptFilter(s);case"photo":return this.applyPhotoFilter(s);case"blueprint":return this.applyBlueprintFilter(s);default:return s}}applyGrayscale(s){let e=null,n=null,r=null;try{return e=ve(s),n=new this.cv.Mat,this.cv.cvtColor(e,n,this.cv.COLOR_RGBA2GRAY),r=new this.cv.Mat,this.cv.cvtColor(n,r,this.cv.COLOR_GRAY2RGBA),r.convertTo(r,-1,1.1,5),ke(r)}catch(t){return console.error("Grayscale filter failed:",t),null}finally{we(e,n,r)}}applyDocumentFilter(s){let e=null,n=null,r=null,t=null,a=null;try{return e=ve(s),n=new this.cv.Mat,this.cv.cvtColor(e,n,this.cv.COLOR_RGBA2GRAY),r=new this.cv.Mat,this.cv.fastNlMeansDenoising(n,r,10,7,21),t=new this.cv.Mat,this.cv.adaptiveThreshold(r,t,255,this.cv.ADAPTIVE_THRESH_GAUSSIAN_C,this.cv.THRESH_BINARY,11,2),a=new this.cv.Mat,this.cv.cvtColor(t,a,this.cv.COLOR_GRAY2RGBA),ke(a)}catch(o){return console.error("Document filter failed:",o),null}finally{we(e,n,r,t,a)}}applyMagicFilter(s){let e=null,n=null,r=null,t=null,a=null;try{e=ve(s),n=new this.cv.Mat,this.cv.cvtColor(e,n,this.cv.COLOR_RGBA2RGB),this.cv.cvtColor(n,n,this.cv.COLOR_RGB2Lab),r=new this.cv.MatVector,this.cv.split(n,r),t=r.get(0);const o=new this.cv.CLAHE(2,new this.cv.Size(8,8));return o.apply(t,t),this.cv.merge(r,n),a=new this.cv.Mat,this.cv.cvtColor(n,a,this.cv.COLOR_Lab2RGB),this.cv.cvtColor(a,a,this.cv.COLOR_RGB2RGBA),a.convertTo(a,-1,1.1,0),r.delete(),o.delete(),ke(a)}catch(o){return console.error("Magic filter failed:",o),null}finally{we(e,n,t,a)}}applyWhiteboardFilter(s){let e=null,n=null,r=null,t=null,a=null;try{return e=ve(s),n=new this.cv.Mat,this.cv.cvtColor(e,n,this.cv.COLOR_RGBA2GRAY),r=new this.cv.Mat,this.cv.GaussianBlur(n,r,new this.cv.Size(5,5),0),t=new this.cv.Mat,this.cv.adaptiveThreshold(r,t,255,this.cv.ADAPTIVE_THRESH_GAUSSIAN_C,this.cv.THRESH_BINARY,15,10),a=new this.cv.Mat,this.cv.cvtColor(t,a,this.cv.COLOR_GRAY2RGBA),a.convertTo(a,-1,1,10),ke(a)}catch(o){return console.error("Whiteboard filter failed:",o),null}finally{we(e,n,r,t,a)}}applyBookFilter(s){let e=null,n=null,r=null,t=null,a=null;try{e=ve(s),n=new this.cv.Mat,this.cv.cvtColor(e,n,this.cv.COLOR_RGBA2GRAY),r=new this.cv.Mat,this.cv.fastNlMeansDenoising(n,r,10,7,21),t=new this.cv.Mat;const o=this.cv.matFromArray(3,3,this.cv.CV_32F,[0,-1,0,-1,5,-1,0,-1,0]);return this.cv.filter2D(r,t,this.cv.CV_8U,o),o.delete(),a=new this.cv.Mat,this.cv.cvtColor(t,a,this.cv.COLOR_GRAY2RGBA),a.convertTo(a,-1,1.2,0),ke(a)}catch(o){return console.error("Book filter failed:",o),null}finally{we(e,n,r,t,a)}}applyReceiptFilter(s){let e=null,n=null,r=null,t=null;try{return e=ve(s),n=new this.cv.Mat,this.cv.cvtColor(e,n,this.cv.COLOR_RGBA2GRAY),r=new this.cv.Mat,this.cv.threshold(n,r,0,255,this.cv.THRESH_BINARY+this.cv.THRESH_OTSU),t=new this.cv.Mat,this.cv.cvtColor(r,t,this.cv.COLOR_GRAY2RGBA),ke(t)}catch(a){return console.error("Receipt filter failed:",a),null}finally{we(e,n,r,t)}}applyPhotoFilter(s){let e=null,n=null;try{return e=ve(s),n=e.clone(),n.convertTo(n,-1,1.1,5),ke(n)}catch(r){return console.error("Photo filter failed:",r),null}finally{we(e,n)}}applyBlueprintFilter(s){let e=null,n=null,r=null,t=null;try{return e=ve(s),n=new this.cv.Mat,this.cv.cvtColor(e,n,this.cv.COLOR_RGBA2GRAY),r=new this.cv.Mat,this.cv.bitwise_not(n,r),t=new this.cv.Mat,this.cv.cvtColor(r,t,this.cv.COLOR_GRAY2RGBA),ke(t)}catch(a){return console.error("Blueprint filter failed:",a),null}finally{we(e,n,r,t)}}applyGamma(s,e){const n=new Uint8Array(256);for(let t=0;t<256;t++)n[t]=Math.pow(t/255,e)*255;const r=s.data;for(let t=0;t<r.length;t+=4)r[t]=n[r[t]],r[t+1]=n[r[t+1]],r[t+2]=n[r[t+2]]}applySaturation(s,e){const n=new this.cv.Mat;this.cv.cvtColor(s,n,this.cv.COLOR_RGBA2RGB),this.cv.cvtColor(n,n,this.cv.COLOR_RGB2HSV);const r=new this.cv.MatVector;this.cv.split(n,r);const t=r.get(1),a=1+e/100;t.convertTo(t,-1,a,0),this.cv.merge(r,n),this.cv.cvtColor(n,s,this.cv.COLOR_HSV2RGB),this.cv.cvtColor(s,s,this.cv.COLOR_RGB2RGBA),n.delete(),r.delete()}isReady(){return this.isInitialized&&tt()}}const Ge=new tr,rr=(w,s)=>s.some(e=>w instanceof e);let lt,dt;function nr(){return lt||(lt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function sr(){return dt||(dt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const pt=new WeakMap,Qe=new WeakMap,gt=new WeakMap,Ve=new WeakMap,rt=new WeakMap;function ir(w){const s=new Promise((e,n)=>{const r=()=>{w.removeEventListener("success",t),w.removeEventListener("error",a)},t=()=>{e(je(w.result)),r()},a=()=>{n(w.error),r()};w.addEventListener("success",t),w.addEventListener("error",a)});return s.then(e=>{e instanceof IDBCursor&&pt.set(e,w)}).catch(()=>{}),rt.set(s,w),s}function ar(w){if(Qe.has(w))return;const s=new Promise((e,n)=>{const r=()=>{w.removeEventListener("complete",t),w.removeEventListener("error",a),w.removeEventListener("abort",a)},t=()=>{e(),r()},a=()=>{n(w.error||new DOMException("AbortError","AbortError")),r()};w.addEventListener("complete",t),w.addEventListener("error",a),w.addEventListener("abort",a)});Qe.set(w,s)}let et={get(w,s,e){if(w instanceof IDBTransaction){if(s==="done")return Qe.get(w);if(s==="objectStoreNames")return w.objectStoreNames||gt.get(w);if(s==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return je(w[s])},set(w,s,e){return w[s]=e,!0},has(w,s){return w instanceof IDBTransaction&&(s==="done"||s==="store")?!0:s in w}};function or(w){et=w(et)}function cr(w){return w===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(s,...e){const n=w.call(He(this),s,...e);return gt.set(n,s.sort?s.sort():[s]),je(n)}:sr().includes(w)?function(...s){return w.apply(He(this),s),je(pt.get(this))}:function(...s){return je(w.apply(He(this),s))}}function lr(w){return typeof w=="function"?cr(w):(w instanceof IDBTransaction&&ar(w),rr(w,nr())?new Proxy(w,et):w)}function je(w){if(w instanceof IDBRequest)return ir(w);if(Ve.has(w))return Ve.get(w);const s=lr(w);return s!==w&&(Ve.set(w,s),rt.set(s,w)),s}const He=w=>rt.get(w);function dr(w,s,{blocked:e,upgrade:n,blocking:r,terminated:t}={}){const a=indexedDB.open(w,s),o=je(a);return n&&a.addEventListener("upgradeneeded",l=>{n(je(a.result),l.oldVersion,l.newVersion,je(a.transaction),l)}),e&&a.addEventListener("blocked",l=>e(l.oldVersion,l.newVersion,l)),o.then(l=>{t&&l.addEventListener("close",()=>t()),r&&l.addEventListener("versionchange",m=>r(m.oldVersion,m.newVersion,m))}).catch(()=>{}),o}const ur=["get","getKey","getAll","getAllKeys","count"],hr=["put","add","delete","clear"],$e=new Map;function ut(w,s){if(!(w instanceof IDBDatabase&&!(s in w)&&typeof s=="string"))return;if($e.get(s))return $e.get(s);const e=s.replace(/FromIndex$/,""),n=s!==e,r=hr.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(r||ur.includes(e)))return;const t=async function(a,...o){const l=this.transaction(a,r?"readwrite":"readonly");let m=l.store;return n&&(m=m.index(o.shift())),(await Promise.all([m[e](...o),r&&l.done]))[0]};return $e.set(s,t),t}or(w=>({...w,get:(s,e,n)=>ut(s,e)||w.get(s,e,n),has:(s,e)=>!!ut(s,e)||w.has(s,e)}));const fr="doc-scanner-db",mr=1,me="documents",xe="pages";class pr{constructor(){pe(this,"db",null)}async initialize(){this.db||(this.db=await dr(fr,mr,{upgrade(s){if(!s.objectStoreNames.contains(me)){const e=s.createObjectStore(me,{keyPath:"id"});e.createIndex("by-created","createdAt"),e.createIndex("by-updated","updatedAt"),e.createIndex("by-name","name")}s.objectStoreNames.contains(xe)||s.createObjectStore(xe,{keyPath:"id"}).createIndex("by-document","documentId")}}))}async createDocument(s){if(!this.db)throw new Error("Database not initialized");const e=this.db.transaction([me,xe],"readwrite");await e.objectStore(me).add(s);const n=e.objectStore(xe);for(const r of s.pages)await n.add({...r,documentId:s.id});return await e.done,s}async getDocument(s){if(!this.db)throw new Error("Database not initialized");const e=await this.db.get(me,s);if(!e)return null;const n=await this.db.getAllFromIndex(xe,"by-document",s);return e.pages=n.sort((r,t)=>r.pageNumber-t.pageNumber),e}async updateDocument(s){if(!this.db)throw new Error("Database not initialized");s.updatedAt=new Date;const e=this.db.transaction([me,xe],"readwrite");await e.objectStore(me).put(s);const n=e.objectStore(xe),r=await n.index("by-document").getAllKeys(s.id);for(const t of r)await n.delete(t);for(const t of s.pages)await n.add({...t,documentId:s.id});return await e.done,s}async deleteDocument(s){if(!this.db)throw new Error("Database not initialized");const e=this.db.transaction([me,xe],"readwrite");await e.objectStore(me).delete(s);const n=e.objectStore(xe),r=await n.index("by-document").getAllKeys(s);for(const t of r)await n.delete(t);await e.done}async listDocuments(s){if(!this.db)throw new Error("Database not initialized");const e=s?.sortBy||"updatedAt",n=s?.sortOrder||"desc",r=s?.limit,t=s?.offset||0;let a;e==="name"?a=await this.db.getAllFromIndex(me,"by-name"):e==="createdAt"?a=await this.db.getAllFromIndex(me,"by-created"):a=await this.db.getAllFromIndex(me,"by-updated"),n==="desc"&&a.reverse();for(const o of a){const l=await this.db.getAllFromIndex(xe,"by-document",o.id);o.pages=l.sort((m,_)=>m.pageNumber-_.pageNumber)}return r!==void 0?a=a.slice(t,t+r):t>0&&(a=a.slice(t)),a}async searchDocuments(s){if(!this.db)throw new Error("Database not initialized");const e=await this.listDocuments(),n=[],r=s.toLowerCase();for(const t of e)for(const a of t.pages)if(a.ocrResult){const o=[],l=a.ocrResult.text.toLowerCase();let m=l.indexOf(r);for(;m!==-1;)o.push({text:a.ocrResult.text.substr(m,s.length),position:m}),m=l.indexOf(r,m+1);o.length>0&&n.push({documentId:t.id,pageId:a.id,matches:o})}return n}async getStorageUsage(){if(!navigator.storage||!navigator.storage.estimate)return{used:0,quota:0,percentage:0};const s=await navigator.storage.estimate(),e=s.usage||0,n=s.quota||0,r=n>0?e/n*100:0;return{used:e,quota:n,percentage:r}}async clearAll(){if(!this.db)throw new Error("Database not initialized");const s=this.db.transaction([me,xe],"readwrite");await s.objectStore(me).clear(),await s.objectStore(xe).clear(),await s.done}async addPage(s,e){if(!this.db)throw new Error("Database not initialized");const n=await this.getDocument(s);if(!n)throw new Error("Document not found");n.pages.push(e),n.metadata.totalPages=n.pages.length,await this.updateDocument(n)}async removePage(s,e){if(!this.db)throw new Error("Database not initialized");const n=await this.getDocument(s);if(!n)throw new Error("Document not found");n.pages=n.pages.filter(r=>r.id!==e),n.pages.forEach((r,t)=>{r.pageNumber=t+1}),n.metadata.totalPages=n.pages.length,await this.updateDocument(n)}async reorderPages(s,e){if(!this.db)throw new Error("Database not initialized");const n=await this.getDocument(s);if(!n)throw new Error("Document not found");const r=new Map(n.pages.map(t=>[t.id,t]));n.pages=e.map(t=>r.get(t)).filter(Boolean),n.pages.forEach((t,a)=>{t.pageNumber=a+1}),await this.updateDocument(n)}async exportDocument(s){if(!this.db)throw new Error("Database not initialized");const e=await this.getDocument(s);if(!e)throw new Error("Document not found");const n=JSON.stringify(e,null,2);return new Blob([n],{type:"application/json"})}async importDocument(s){if(!this.db)throw new Error("Database not initialized");const e=await s.text(),n=JSON.parse(e);return n.createdAt=new Date(n.createdAt),n.updatedAt=new Date(n.updatedAt),await this.createDocument(n),n}}let Pe=null;async function Ue(){return Pe||(Pe=new pr,await Pe.initialize()),Pe}const gr=()=>{const w=te.useRef(null),[s,e]=te.useState(!1),[n,r]=te.useState(null),[t,a]=te.useState(!1),{currentImage:o,processedImage:l,adjustedCorners:m,selectedFilter:_,enhancementOptions:b,setCurrentView:C,setSelectedFilter:u,setEnhancementOptions:x,addDocument:d,resetScanSession:f,addToast:h}=be(I=>({currentImage:I.scanSession.currentImage,processedImage:I.scanSession.processedImage,adjustedCorners:I.scanSession.adjustedCorners,selectedFilter:I.scanSession.selectedFilter,enhancementOptions:I.scanSession.enhancementOptions,setCurrentView:I.setCurrentView,setSelectedFilter:I.setSelectedFilter,setEnhancementOptions:I.setEnhancementOptions,addDocument:I.addDocument,resetScanSession:I.resetScanSession,addToast:I.addToast}));te.useEffect(()=>{l&&!n&&(r(l),v(l))},[l]),te.useEffect(()=>{l&&j(_)},[_]),te.useEffect(()=>{n&&S(b)&&E()},[b]);const v=I=>{if(!w.current)return;const M=w.current,Z=M.getContext("2d");Z&&(M.width=I.width,M.height=I.height,Z.putImageData(I,0,0))},j=async I=>{if(l){e(!0);try{const M=await Ge.applyFilter(l,I);M?(r(M),v(M),x(Le)):h({type:"error",message:"Failed to apply filter"})}catch(M){console.error("Filter application failed:",M),h({type:"error",message:"Filter application failed"})}finally{e(!1)}}},E=async()=>{if(n){e(!0);try{let I=l;if(_!=="original"&&(I=await Ge.applyFilter(l,_)),!I)throw new Error("Failed to get base image");const M=await Ge.enhance(I,b);M?(r(M),v(M)):h({type:"error",message:"Failed to apply adjustments"})}catch(I){console.error("Manual adjustment failed:",I)}finally{e(!1)}}},S=I=>I.brightness!==0||I.contrast!==0||I.saturation!==0||I.gamma!==1,z=I=>{u(I)},R=I=>{x(I)},L=async()=>{if(!n||!o){h({type:"error",message:"No image to save"});return}e(!0);try{const I=document.createElement("canvas"),M=I.getContext("2d");if(!M)throw new Error("Failed to get canvas context");I.width=n.width,I.height=n.height,M.putImageData(n,0,0);const Z=await new Promise(($,ae)=>{I.toBlob(ce=>{ce?$(ce):ae(new Error("Failed to convert canvas to blob"))},"image/png")}),g=document.createElement("canvas"),N=g.getContext("2d");if(!N)throw new Error("Failed to get canvas context");g.width=o.width,g.height=o.height,N.putImageData(o,0,0);const c=await new Promise(($,ae)=>{g.toBlob(ce=>{ce?$(ce):ae(new Error("Failed to convert canvas to blob"))},"image/png")}),F=document.createElement("canvas"),X=F.getContext("2d");if(!X)throw new Error("Failed to get canvas context");const W=300,re=Math.min(W/n.width,W/n.height);F.width=n.width*re,F.height=n.height*re,X.drawImage(I,0,0,F.width,F.height);const V=await new Promise(($,ae)=>{F.toBlob(ce=>{ce?$(ce):ae(new Error("Failed to convert canvas to blob"))},"image/jpeg",.8)}),J={id:ct(),pageNumber:1,originalImage:c,processedImage:Z,thumbnailImage:V,corners:m||[],enhancementSettings:b,filterApplied:_,dimensions:{width:n.width,height:n.height}},A=new Date,T=`Document ${A.toLocaleDateString()} ${A.toLocaleTimeString()}`,Q={id:ct(),name:T,createdAt:A,updatedAt:A,pages:[J],tags:[],metadata:{totalPages:1,hasOCR:!1,fileSize:Z.size,source:"camera"}};await(await Ue()).createDocument(Q),d(Q),f(),h({type:"success",message:"Document saved successfully"}),C("documents")}catch(I){console.error("Failed to save document:",I),h({type:"error",message:"Failed to save document"})}finally{e(!1)}};return l?p.jsxs("div",{className:"flex flex-col h-full bg-gray-900",children:[p.jsxs("div",{className:"flex-1 overflow-hidden flex items-center justify-center p-4 relative",children:[p.jsx("canvas",{ref:w,className:"max-w-full max-h-full object-contain shadow-2xl"}),s&&p.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:p.jsxs("div",{className:"bg-white rounded-lg p-4 flex items-center gap-3",children:[p.jsx(Ie,{size:"sm"}),p.jsx("span",{className:"text-sm text-gray-700",children:"Processing..."})]})})]}),p.jsx(Qt,{selectedFilter:_,onSelect:z,disabled:s}),p.jsx("div",{className:"bg-white border-t border-gray-200 px-4 py-2",children:p.jsxs("button",{onClick:()=>a(!t),className:"w-full flex items-center justify-between text-sm font-medium text-gray-700 hover:text-gray-900",children:[p.jsx("span",{children:"Manual Adjustments"}),p.jsx("span",{className:"text-lg",children:t?"â–¼":"â–¶"})]})}),t&&p.jsx("div",{className:"bg-gray-50 border-t border-gray-200 max-h-80 overflow-y-auto",children:p.jsx(er,{options:b,onChange:R,disabled:s})}),p.jsx("div",{className:"p-4 bg-white border-t border-gray-200",children:p.jsxs("div",{className:"flex gap-3",children:[p.jsx(ue,{onClick:()=>C("crop"),variant:"secondary",fullWidth:!0,disabled:s,children:"Back"}),p.jsx(ue,{onClick:L,variant:"primary",fullWidth:!0,disabled:s,children:"Save Document"})]})})]}):p.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-50 p-6",children:[p.jsx("p",{className:"text-gray-600",children:"No image to enhance"}),p.jsx(ue,{onClick:()=>C("camera"),className:"mt-4",children:"Back to Camera"})]})};var xt={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(w,s){(function(e){w.exports=e()})(function(){return function e(n,r,t){function a(m,_){if(!r[m]){if(!n[m]){var b=typeof Te=="function"&&Te;if(!_&&b)return b(m,!0);if(o)return o(m,!0);var C=new Error("Cannot find module '"+m+"'");throw C.code="MODULE_NOT_FOUND",C}var u=r[m]={exports:{}};n[m][0].call(u.exports,function(x){var d=n[m][1][x];return a(d||x)},u,u.exports,e,n,r,t)}return r[m].exports}for(var o=typeof Te=="function"&&Te,l=0;l<t.length;l++)a(t[l]);return a}({1:[function(e,n,r){var t=e("./utils"),a=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(l){for(var m,_,b,C,u,x,d,f=[],h=0,v=l.length,j=v,E=t.getTypeOf(l)!=="string";h<l.length;)j=v-h,b=E?(m=l[h++],_=h<v?l[h++]:0,h<v?l[h++]:0):(m=l.charCodeAt(h++),_=h<v?l.charCodeAt(h++):0,h<v?l.charCodeAt(h++):0),C=m>>2,u=(3&m)<<4|_>>4,x=1<j?(15&_)<<2|b>>6:64,d=2<j?63&b:64,f.push(o.charAt(C)+o.charAt(u)+o.charAt(x)+o.charAt(d));return f.join("")},r.decode=function(l){var m,_,b,C,u,x,d=0,f=0,h="data:";if(l.substr(0,h.length)===h)throw new Error("Invalid base64 input, it looks like a data url.");var v,j=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&j--,l.charAt(l.length-2)===o.charAt(64)&&j--,j%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=a.uint8array?new Uint8Array(0|j):new Array(0|j);d<l.length;)m=o.indexOf(l.charAt(d++))<<2|(C=o.indexOf(l.charAt(d++)))>>4,_=(15&C)<<4|(u=o.indexOf(l.charAt(d++)))>>2,b=(3&u)<<6|(x=o.indexOf(l.charAt(d++))),v[f++]=m,u!==64&&(v[f++]=_),x!==64&&(v[f++]=b);return v}},{"./support":30,"./utils":32}],2:[function(e,n,r){var t=e("./external"),a=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function m(_,b,C,u,x){this.compressedSize=_,this.uncompressedSize=b,this.crc32=C,this.compression=u,this.compressedContent=x}m.prototype={getContentWorker:function(){var _=new a(t.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),b=this;return _.on("end",function(){if(this.streamInfo.data_length!==b.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),_},getCompressedWorker:function(){return new a(t.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},m.createWorkerFrom=function(_,b,C){return _.pipe(new o).pipe(new l("uncompressedSize")).pipe(b.compressWorker(C)).pipe(new l("compressedSize")).withStreamInfo("compression",b)},n.exports=m},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,n,r){var t=e("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(){return new t("STORE compression")},uncompressWorker:function(){return new t("STORE decompression")}},r.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,n,r){var t=e("./utils"),a=function(){for(var o,l=[],m=0;m<256;m++){o=m;for(var _=0;_<8;_++)o=1&o?3988292384^o>>>1:o>>>1;l[m]=o}return l}();n.exports=function(o,l){return o!==void 0&&o.length?t.getTypeOf(o)!=="string"?function(m,_,b,C){var u=a,x=C+b;m^=-1;for(var d=C;d<x;d++)m=m>>>8^u[255&(m^_[d])];return-1^m}(0|l,o,o.length,0):function(m,_,b,C){var u=a,x=C+b;m^=-1;for(var d=C;d<x;d++)m=m>>>8^u[255&(m^_.charCodeAt(d))];return-1^m}(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(e,n,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(e,n,r){var t=null;t=typeof Promise<"u"?Promise:e("lie"),n.exports={Promise:t}},{lie:37}],7:[function(e,n,r){var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",a=e("pako"),o=e("./utils"),l=e("./stream/GenericWorker"),m=t?"uint8array":"array";function _(b,C){l.call(this,"FlateWorker/"+b),this._pako=null,this._pakoAction=b,this._pakoOptions=C,this.meta={}}r.magic="\b\0",o.inherits(_,l),_.prototype.processChunk=function(b){this.meta=b.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(m,b.data),!1)},_.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},_.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},_.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var b=this;this._pako.onData=function(C){b.push({data:C,meta:b.meta})}},r.compressWorker=function(b){return new _("Deflate",b)},r.uncompressWorker=function(){return new _("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,n,r){function t(u,x){var d,f="";for(d=0;d<x;d++)f+=String.fromCharCode(255&u),u>>>=8;return f}function a(u,x,d,f,h,v){var j,E,S=u.file,z=u.compression,R=v!==m.utf8encode,L=o.transformTo("string",v(S.name)),I=o.transformTo("string",m.utf8encode(S.name)),M=S.comment,Z=o.transformTo("string",v(M)),g=o.transformTo("string",m.utf8encode(M)),N=I.length!==S.name.length,c=g.length!==M.length,F="",X="",W="",re=S.dir,V=S.date,J={crc32:0,compressedSize:0,uncompressedSize:0};x&&!d||(J.crc32=u.crc32,J.compressedSize=u.compressedSize,J.uncompressedSize=u.uncompressedSize);var A=0;x&&(A|=8),R||!N&&!c||(A|=2048);var T=0,Q=0;re&&(T|=16),h==="UNIX"?(Q=798,T|=function($,ae){var ce=$;return $||(ce=ae?16893:33204),(65535&ce)<<16}(S.unixPermissions,re)):(Q=20,T|=function($){return 63&($||0)}(S.dosPermissions)),j=V.getUTCHours(),j<<=6,j|=V.getUTCMinutes(),j<<=5,j|=V.getUTCSeconds()/2,E=V.getUTCFullYear()-1980,E<<=4,E|=V.getUTCMonth()+1,E<<=5,E|=V.getUTCDate(),N&&(X=t(1,1)+t(_(L),4)+I,F+="up"+t(X.length,2)+X),c&&(W=t(1,1)+t(_(Z),4)+g,F+="uc"+t(W.length,2)+W);var K="";return K+=`
\0`,K+=t(A,2),K+=z.magic,K+=t(j,2),K+=t(E,2),K+=t(J.crc32,4),K+=t(J.compressedSize,4),K+=t(J.uncompressedSize,4),K+=t(L.length,2),K+=t(F.length,2),{fileRecord:b.LOCAL_FILE_HEADER+K+L+F,dirRecord:b.CENTRAL_FILE_HEADER+t(Q,2)+K+t(Z.length,2)+"\0\0\0\0"+t(T,4)+t(f,4)+L+F+Z}}var o=e("../utils"),l=e("../stream/GenericWorker"),m=e("../utf8"),_=e("../crc32"),b=e("../signature");function C(u,x,d,f){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=x,this.zipPlatform=d,this.encodeFileName=f,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(C,l),C.prototype.push=function(u){var x=u.meta.percent||0,d=this.entriesCount,f=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,l.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:d?(x+100*(d-f-1))/d:100}}))},C.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var x=this.streamFiles&&!u.file.dir;if(x){var d=a(u,x,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:d.fileRecord,meta:{percent:0}})}else this.accumulate=!0},C.prototype.closedSource=function(u){this.accumulate=!1;var x=this.streamFiles&&!u.file.dir,d=a(u,x,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(d.dirRecord),x)this.push({data:function(f){return b.DATA_DESCRIPTOR+t(f.crc32,4)+t(f.compressedSize,4)+t(f.uncompressedSize,4)}(u),meta:{percent:100}});else for(this.push({data:d.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},C.prototype.flush=function(){for(var u=this.bytesWritten,x=0;x<this.dirRecords.length;x++)this.push({data:this.dirRecords[x],meta:{percent:100}});var d=this.bytesWritten-u,f=function(h,v,j,E,S){var z=o.transformTo("string",S(E));return b.CENTRAL_DIRECTORY_END+"\0\0\0\0"+t(h,2)+t(h,2)+t(v,4)+t(j,4)+t(z.length,2)+z}(this.dirRecords.length,d,u,this.zipComment,this.encodeFileName);this.push({data:f,meta:{percent:100}})},C.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},C.prototype.registerPrevious=function(u){this._sources.push(u);var x=this;return u.on("data",function(d){x.processChunk(d)}),u.on("end",function(){x.closedSource(x.previous.streamInfo),x._sources.length?x.prepareNextSource():x.end()}),u.on("error",function(d){x.error(d)}),this},C.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},C.prototype.error=function(u){var x=this._sources;if(!l.prototype.error.call(this,u))return!1;for(var d=0;d<x.length;d++)try{x[d].error(u)}catch{}return!0},C.prototype.lock=function(){l.prototype.lock.call(this);for(var u=this._sources,x=0;x<u.length;x++)u[x].lock()},n.exports=C},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,n,r){var t=e("../compressions"),a=e("./ZipFileWorker");r.generateWorker=function(o,l,m){var _=new a(l.streamFiles,m,l.platform,l.encodeFileName),b=0;try{o.forEach(function(C,u){b++;var x=function(v,j){var E=v||j,S=t[E];if(!S)throw new Error(E+" is not a valid compression method !");return S}(u.options.compression,l.compression),d=u.options.compressionOptions||l.compressionOptions||{},f=u.dir,h=u.date;u._compressWorker(x,d).withStreamInfo("file",{name:C,dir:f,date:h,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(_)}),_.entriesCount=b}catch(C){_.error(C)}return _}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,n,r){function t(){if(!(this instanceof t))return new t;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new t;for(var o in this)typeof this[o]!="function"&&(a[o]=this[o]);return a}}(t.prototype=e("./object")).loadAsync=e("./load"),t.support=e("./support"),t.defaults=e("./defaults"),t.version="3.10.1",t.loadAsync=function(a,o){return new t().loadAsync(a,o)},t.external=e("./external"),n.exports=t},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,n,r){var t=e("./utils"),a=e("./external"),o=e("./utf8"),l=e("./zipEntries"),m=e("./stream/Crc32Probe"),_=e("./nodejsUtils");function b(C){return new a.Promise(function(u,x){var d=C.decompressed.getContentWorker().pipe(new m);d.on("error",function(f){x(f)}).on("end",function(){d.streamInfo.crc32!==C.decompressed.crc32?x(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}n.exports=function(C,u){var x=this;return u=t.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),_.isNode&&_.isStream(C)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):t.prepareContent("the loaded zip file",C,!0,u.optimizedBinaryString,u.base64).then(function(d){var f=new l(u);return f.load(d),f}).then(function(d){var f=[a.Promise.resolve(d)],h=d.files;if(u.checkCRC32)for(var v=0;v<h.length;v++)f.push(b(h[v]));return a.Promise.all(f)}).then(function(d){for(var f=d.shift(),h=f.files,v=0;v<h.length;v++){var j=h[v],E=j.fileNameStr,S=t.resolve(j.fileNameStr);x.file(S,j.decompressed,{binary:!0,optimizedBinaryString:!0,date:j.date,dir:j.dir,comment:j.fileCommentStr.length?j.fileCommentStr:null,unixPermissions:j.unixPermissions,dosPermissions:j.dosPermissions,createFolders:u.createFolders}),j.dir||(x.file(S).unsafeOriginalName=E)}return f.zipComment.length&&(x.comment=f.zipComment),x})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,n,r){var t=e("../utils"),a=e("../stream/GenericWorker");function o(l,m){a.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(m)}t.inherits(o,a),o.prototype._bindStream=function(l){var m=this;(this._stream=l).pause(),l.on("data",function(_){m.push({data:_,meta:{percent:0}})}).on("error",function(_){m.isPaused?this.generatedError=_:m.error(_)}).on("end",function(){m.isPaused?m._upstreamEnded=!0:m.end()})},o.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,n,r){var t=e("readable-stream").Readable;function a(o,l,m){t.call(this,l),this._helper=o;var _=this;o.on("data",function(b,C){_.push(b)||_._helper.pause(),m&&m(C)}).on("error",function(b){_.emit("error",b)}).on("end",function(){_.push(null)})}e("../utils").inherits(a,t),a.prototype._read=function(){this._helper.resume()},n.exports=a},{"../utils":32,"readable-stream":16}],14:[function(e,n,r){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(t,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(t,a);if(typeof t=="number")throw new Error('The "data" argument must not be a number');return new Buffer(t,a)},allocBuffer:function(t){if(Buffer.alloc)return Buffer.alloc(t);var a=new Buffer(t);return a.fill(0),a},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&typeof t.on=="function"&&typeof t.pause=="function"&&typeof t.resume=="function"}}},{}],15:[function(e,n,r){function t(S,z,R){var L,I=o.getTypeOf(z),M=o.extend(R||{},_);M.date=M.date||new Date,M.compression!==null&&(M.compression=M.compression.toUpperCase()),typeof M.unixPermissions=="string"&&(M.unixPermissions=parseInt(M.unixPermissions,8)),M.unixPermissions&&16384&M.unixPermissions&&(M.dir=!0),M.dosPermissions&&16&M.dosPermissions&&(M.dir=!0),M.dir&&(S=h(S)),M.createFolders&&(L=f(S))&&v.call(this,L,!0);var Z=I==="string"&&M.binary===!1&&M.base64===!1;R&&R.binary!==void 0||(M.binary=!Z),(z instanceof b&&z.uncompressedSize===0||M.dir||!z||z.length===0)&&(M.base64=!1,M.binary=!0,z="",M.compression="STORE",I="string");var g=null;g=z instanceof b||z instanceof l?z:x.isNode&&x.isStream(z)?new d(S,z):o.prepareContent(S,z,M.binary,M.optimizedBinaryString,M.base64);var N=new C(S,g,M);this.files[S]=N}var a=e("./utf8"),o=e("./utils"),l=e("./stream/GenericWorker"),m=e("./stream/StreamHelper"),_=e("./defaults"),b=e("./compressedObject"),C=e("./zipObject"),u=e("./generate"),x=e("./nodejsUtils"),d=e("./nodejs/NodejsStreamInputAdapter"),f=function(S){S.slice(-1)==="/"&&(S=S.substring(0,S.length-1));var z=S.lastIndexOf("/");return 0<z?S.substring(0,z):""},h=function(S){return S.slice(-1)!=="/"&&(S+="/"),S},v=function(S,z){return z=z!==void 0?z:_.createFolders,S=h(S),this.files[S]||t.call(this,S,null,{dir:!0,createFolders:z}),this.files[S]};function j(S){return Object.prototype.toString.call(S)==="[object RegExp]"}var E={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(S){var z,R,L;for(z in this.files)L=this.files[z],(R=z.slice(this.root.length,z.length))&&z.slice(0,this.root.length)===this.root&&S(R,L)},filter:function(S){var z=[];return this.forEach(function(R,L){S(R,L)&&z.push(L)}),z},file:function(S,z,R){if(arguments.length!==1)return S=this.root+S,t.call(this,S,z,R),this;if(j(S)){var L=S;return this.filter(function(M,Z){return!Z.dir&&L.test(M)})}var I=this.files[this.root+S];return I&&!I.dir?I:null},folder:function(S){if(!S)return this;if(j(S))return this.filter(function(I,M){return M.dir&&S.test(I)});var z=this.root+S,R=v.call(this,z),L=this.clone();return L.root=R.name,L},remove:function(S){S=this.root+S;var z=this.files[S];if(z||(S.slice(-1)!=="/"&&(S+="/"),z=this.files[S]),z&&!z.dir)delete this.files[S];else for(var R=this.filter(function(I,M){return M.name.slice(0,S.length)===S}),L=0;L<R.length;L++)delete this.files[R[L].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(S){var z,R={};try{if((R=o.extend(S||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=R.type.toLowerCase(),R.compression=R.compression.toUpperCase(),R.type==="binarystring"&&(R.type="string"),!R.type)throw new Error("No output type specified.");o.checkSupport(R.type),R.platform!=="darwin"&&R.platform!=="freebsd"&&R.platform!=="linux"&&R.platform!=="sunos"||(R.platform="UNIX"),R.platform==="win32"&&(R.platform="DOS");var L=R.comment||this.comment||"";z=u.generateWorker(this,R,L)}catch(I){(z=new l("error")).error(I)}return new m(z,R.type||"string",R.mimeType)},generateAsync:function(S,z){return this.generateInternalStream(S).accumulate(z)},generateNodeStream:function(S,z){return(S=S||{}).type||(S.type="nodebuffer"),this.generateInternalStream(S).toNodejsStream(z)}};n.exports=E},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,n,r){n.exports=e("stream")},{stream:void 0}],17:[function(e,n,r){var t=e("./DataReader");function a(o){t.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}e("../utils").inherits(a,t),a.prototype.byteAt=function(o){return this.data[this.zero+o]},a.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),m=o.charCodeAt(1),_=o.charCodeAt(2),b=o.charCodeAt(3),C=this.length-4;0<=C;--C)if(this.data[C]===l&&this.data[C+1]===m&&this.data[C+2]===_&&this.data[C+3]===b)return C-this.zero;return-1},a.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),m=o.charCodeAt(1),_=o.charCodeAt(2),b=o.charCodeAt(3),C=this.readData(4);return l===C[0]&&m===C[1]&&_===C[2]&&b===C[3]},a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=a},{"../utils":32,"./DataReader":18}],18:[function(e,n,r){var t=e("../utils");function a(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var l,m=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)m=(m<<8)+this.byteAt(l);return this.index+=o,m},readString:function(o){return t.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},n.exports=a},{"../utils":32}],19:[function(e,n,r){var t=e("./Uint8ArrayReader");function a(o){t.call(this,o)}e("../utils").inherits(a,t),a.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,n,r){var t=e("./DataReader");function a(o){t.call(this,o)}e("../utils").inherits(a,t),a.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},a.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},a.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},a.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=a},{"../utils":32,"./DataReader":18}],21:[function(e,n,r){var t=e("./ArrayReader");function a(o){t.call(this,o)}e("../utils").inherits(a,t),a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},n.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(e,n,r){var t=e("../utils"),a=e("../support"),o=e("./ArrayReader"),l=e("./StringReader"),m=e("./NodeBufferReader"),_=e("./Uint8ArrayReader");n.exports=function(b){var C=t.getTypeOf(b);return t.checkSupport(C),C!=="string"||a.uint8array?C==="nodebuffer"?new m(b):a.uint8array?new _(t.transformTo("uint8array",b)):new o(t.transformTo("array",b)):new l(b)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,n,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,n,r){var t=e("./GenericWorker"),a=e("../utils");function o(l){t.call(this,"ConvertWorker to "+l),this.destType=l}a.inherits(o,t),o.prototype.processChunk=function(l){this.push({data:a.transformTo(this.destType,l.data),meta:l.meta})},n.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,n,r){var t=e("./GenericWorker"),a=e("../crc32");function o(){t.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,t),o.prototype.processChunk=function(l){this.streamInfo.crc32=a(l.data,this.streamInfo.crc32||0),this.push(l)},n.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,n,r){var t=e("../utils"),a=e("./GenericWorker");function o(l){a.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}t.inherits(o,a),o.prototype.processChunk=function(l){if(l){var m=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=m+l.data.length}a.prototype.processChunk.call(this,l)},n.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,n,r){var t=e("../utils"),a=e("./GenericWorker");function o(l){a.call(this,"DataWorker");var m=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(_){m.dataIsReady=!0,m.data=_,m.max=_&&_.length||0,m.type=t.getTypeOf(_),m.isPaused||m._tickAndRepeat()},function(_){m.error(_)})}t.inherits(o,a),o.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,t.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(t.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,m=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,m);break;case"uint8array":l=this.data.subarray(this.index,m);break;case"array":case"nodebuffer":l=this.data.slice(this.index,m)}return this.index=m,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,n,r){function t(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}t.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,o){return this._listeners[a].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,o){if(this._listeners[a])for(var l=0;l<this._listeners[a].length;l++)this._listeners[a][l].call(this,o)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var o=this;return a.on("data",function(l){o.processChunk(l)}),a.on("end",function(){o.end()}),a.on("error",function(l){o.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,o){return this.extraStreamInfo[a]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},n.exports=t},{}],29:[function(e,n,r){var t=e("../utils"),a=e("./ConvertWorker"),o=e("./GenericWorker"),l=e("../base64"),m=e("../support"),_=e("../external"),b=null;if(m.nodestream)try{b=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function C(x,d){return new _.Promise(function(f,h){var v=[],j=x._internalType,E=x._outputType,S=x._mimeType;x.on("data",function(z,R){v.push(z),d&&d(R)}).on("error",function(z){v=[],h(z)}).on("end",function(){try{var z=function(R,L,I){switch(R){case"blob":return t.newBlob(t.transformTo("arraybuffer",L),I);case"base64":return l.encode(L);default:return t.transformTo(R,L)}}(E,function(R,L){var I,M=0,Z=null,g=0;for(I=0;I<L.length;I++)g+=L[I].length;switch(R){case"string":return L.join("");case"array":return Array.prototype.concat.apply([],L);case"uint8array":for(Z=new Uint8Array(g),I=0;I<L.length;I++)Z.set(L[I],M),M+=L[I].length;return Z;case"nodebuffer":return Buffer.concat(L);default:throw new Error("concat : unsupported type '"+R+"'")}}(j,v),S);f(z)}catch(R){h(R)}v=[]}).resume()})}function u(x,d,f){var h=d;switch(d){case"blob":case"arraybuffer":h="uint8array";break;case"base64":h="string"}try{this._internalType=h,this._outputType=d,this._mimeType=f,t.checkSupport(h),this._worker=x.pipe(new a(h)),x.lock()}catch(v){this._worker=new o("error"),this._worker.error(v)}}u.prototype={accumulate:function(x){return C(this,x)},on:function(x,d){var f=this;return x==="data"?this._worker.on(x,function(h){d.call(f,h.data,h.meta)}):this._worker.on(x,function(){t.delay(d,arguments,f)}),this},resume:function(){return t.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(x){if(t.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new b(this,{objectMode:this._outputType!=="nodebuffer"},x)}},n.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,n,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",r.nodebuffer=typeof Buffer<"u",r.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")r.blob=!1;else{var t=new ArrayBuffer(0);try{r.blob=new Blob([t],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(t),r.blob=a.getBlob("application/zip").size===0}catch{r.blob=!1}}}try{r.nodestream=!!e("readable-stream").Readable}catch{r.nodestream=!1}},{"readable-stream":16}],31:[function(e,n,r){for(var t=e("./utils"),a=e("./support"),o=e("./nodejsUtils"),l=e("./stream/GenericWorker"),m=new Array(256),_=0;_<256;_++)m[_]=252<=_?6:248<=_?5:240<=_?4:224<=_?3:192<=_?2:1;m[254]=m[254]=1;function b(){l.call(this,"utf-8 decode"),this.leftOver=null}function C(){l.call(this,"utf-8 encode")}r.utf8encode=function(u){return a.nodebuffer?o.newBufferFrom(u,"utf-8"):function(x){var d,f,h,v,j,E=x.length,S=0;for(v=0;v<E;v++)(64512&(f=x.charCodeAt(v)))==55296&&v+1<E&&(64512&(h=x.charCodeAt(v+1)))==56320&&(f=65536+(f-55296<<10)+(h-56320),v++),S+=f<128?1:f<2048?2:f<65536?3:4;for(d=a.uint8array?new Uint8Array(S):new Array(S),v=j=0;j<S;v++)(64512&(f=x.charCodeAt(v)))==55296&&v+1<E&&(64512&(h=x.charCodeAt(v+1)))==56320&&(f=65536+(f-55296<<10)+(h-56320),v++),f<128?d[j++]=f:(f<2048?d[j++]=192|f>>>6:(f<65536?d[j++]=224|f>>>12:(d[j++]=240|f>>>18,d[j++]=128|f>>>12&63),d[j++]=128|f>>>6&63),d[j++]=128|63&f);return d}(u)},r.utf8decode=function(u){return a.nodebuffer?t.transformTo("nodebuffer",u).toString("utf-8"):function(x){var d,f,h,v,j=x.length,E=new Array(2*j);for(d=f=0;d<j;)if((h=x[d++])<128)E[f++]=h;else if(4<(v=m[h]))E[f++]=65533,d+=v-1;else{for(h&=v===2?31:v===3?15:7;1<v&&d<j;)h=h<<6|63&x[d++],v--;1<v?E[f++]=65533:h<65536?E[f++]=h:(h-=65536,E[f++]=55296|h>>10&1023,E[f++]=56320|1023&h)}return E.length!==f&&(E.subarray?E=E.subarray(0,f):E.length=f),t.applyFromCharCode(E)}(u=t.transformTo(a.uint8array?"uint8array":"array",u))},t.inherits(b,l),b.prototype.processChunk=function(u){var x=t.transformTo(a.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var d=x;(x=new Uint8Array(d.length+this.leftOver.length)).set(this.leftOver,0),x.set(d,this.leftOver.length)}else x=this.leftOver.concat(x);this.leftOver=null}var f=function(v,j){var E;for((j=j||v.length)>v.length&&(j=v.length),E=j-1;0<=E&&(192&v[E])==128;)E--;return E<0||E===0?j:E+m[v[E]]>j?E:j}(x),h=x;f!==x.length&&(a.uint8array?(h=x.subarray(0,f),this.leftOver=x.subarray(f,x.length)):(h=x.slice(0,f),this.leftOver=x.slice(f,x.length))),this.push({data:r.utf8decode(h),meta:u.meta})},b.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=b,t.inherits(C,l),C.prototype.processChunk=function(u){this.push({data:r.utf8encode(u.data),meta:u.meta})},r.Utf8EncodeWorker=C},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,n,r){var t=e("./support"),a=e("./base64"),o=e("./nodejsUtils"),l=e("./external");function m(d){return d}function _(d,f){for(var h=0;h<d.length;++h)f[h]=255&d.charCodeAt(h);return f}e("setimmediate"),r.newBlob=function(d,f){r.checkSupport("blob");try{return new Blob([d],{type:f})}catch{try{var h=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return h.append(d),h.getBlob(f)}catch{throw new Error("Bug : can't construct the Blob.")}}};var b={stringifyByChunk:function(d,f,h){var v=[],j=0,E=d.length;if(E<=h)return String.fromCharCode.apply(null,d);for(;j<E;)f==="array"||f==="nodebuffer"?v.push(String.fromCharCode.apply(null,d.slice(j,Math.min(j+h,E)))):v.push(String.fromCharCode.apply(null,d.subarray(j,Math.min(j+h,E)))),j+=h;return v.join("")},stringifyByChar:function(d){for(var f="",h=0;h<d.length;h++)f+=String.fromCharCode(d[h]);return f},applyCanBeUsed:{uint8array:function(){try{return t.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return t.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function C(d){var f=65536,h=r.getTypeOf(d),v=!0;if(h==="uint8array"?v=b.applyCanBeUsed.uint8array:h==="nodebuffer"&&(v=b.applyCanBeUsed.nodebuffer),v)for(;1<f;)try{return b.stringifyByChunk(d,h,f)}catch{f=Math.floor(f/2)}return b.stringifyByChar(d)}function u(d,f){for(var h=0;h<d.length;h++)f[h]=d[h];return f}r.applyFromCharCode=C;var x={};x.string={string:m,array:function(d){return _(d,new Array(d.length))},arraybuffer:function(d){return x.string.uint8array(d).buffer},uint8array:function(d){return _(d,new Uint8Array(d.length))},nodebuffer:function(d){return _(d,o.allocBuffer(d.length))}},x.array={string:C,array:m,arraybuffer:function(d){return new Uint8Array(d).buffer},uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return o.newBufferFrom(d)}},x.arraybuffer={string:function(d){return C(new Uint8Array(d))},array:function(d){return u(new Uint8Array(d),new Array(d.byteLength))},arraybuffer:m,uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return o.newBufferFrom(new Uint8Array(d))}},x.uint8array={string:C,array:function(d){return u(d,new Array(d.length))},arraybuffer:function(d){return d.buffer},uint8array:m,nodebuffer:function(d){return o.newBufferFrom(d)}},x.nodebuffer={string:C,array:function(d){return u(d,new Array(d.length))},arraybuffer:function(d){return x.nodebuffer.uint8array(d).buffer},uint8array:function(d){return u(d,new Uint8Array(d.length))},nodebuffer:m},r.transformTo=function(d,f){if(f=f||"",!d)return f;r.checkSupport(d);var h=r.getTypeOf(f);return x[h][d](f)},r.resolve=function(d){for(var f=d.split("/"),h=[],v=0;v<f.length;v++){var j=f[v];j==="."||j===""&&v!==0&&v!==f.length-1||(j===".."?h.pop():h.push(j))}return h.join("/")},r.getTypeOf=function(d){return typeof d=="string"?"string":Object.prototype.toString.call(d)==="[object Array]"?"array":t.nodebuffer&&o.isBuffer(d)?"nodebuffer":t.uint8array&&d instanceof Uint8Array?"uint8array":t.arraybuffer&&d instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(d){if(!t[d.toLowerCase()])throw new Error(d+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(d){var f,h,v="";for(h=0;h<(d||"").length;h++)v+="\\x"+((f=d.charCodeAt(h))<16?"0":"")+f.toString(16).toUpperCase();return v},r.delay=function(d,f,h){setImmediate(function(){d.apply(h||null,f||[])})},r.inherits=function(d,f){function h(){}h.prototype=f.prototype,d.prototype=new h},r.extend=function(){var d,f,h={};for(d=0;d<arguments.length;d++)for(f in arguments[d])Object.prototype.hasOwnProperty.call(arguments[d],f)&&h[f]===void 0&&(h[f]=arguments[d][f]);return h},r.prepareContent=function(d,f,h,v,j){return l.Promise.resolve(f).then(function(E){return t.blob&&(E instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(E))!==-1)&&typeof FileReader<"u"?new l.Promise(function(S,z){var R=new FileReader;R.onload=function(L){S(L.target.result)},R.onerror=function(L){z(L.target.error)},R.readAsArrayBuffer(E)}):E}).then(function(E){var S=r.getTypeOf(E);return S?(S==="arraybuffer"?E=r.transformTo("uint8array",E):S==="string"&&(j?E=a.decode(E):h&&v!==!0&&(E=function(z){return _(z,t.uint8array?new Uint8Array(z.length):new Array(z.length))}(E))),E):l.Promise.reject(new Error("Can't read the data of '"+d+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,n,r){var t=e("./reader/readerFor"),a=e("./utils"),o=e("./signature"),l=e("./zipEntry"),m=e("./support");function _(b){this.files=[],this.loadOptions=b}_.prototype={checkSignature:function(b){if(!this.reader.readAndCheckSignature(b)){this.reader.index-=4;var C=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(C)+", expected "+a.pretty(b)+")")}},isSignature:function(b,C){var u=this.reader.index;this.reader.setIndex(b);var x=this.reader.readString(4)===C;return this.reader.setIndex(u),x},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var b=this.reader.readData(this.zipCommentLength),C=m.uint8array?"uint8array":"array",u=a.transformTo(C,b);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var b,C,u,x=this.zip64EndOfCentralSize-44;0<x;)b=this.reader.readInt(2),C=this.reader.readInt(4),u=this.reader.readData(C),this.zip64ExtensibleData[b]={id:b,length:C,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var b,C;for(b=0;b<this.files.length;b++)C=this.files[b],this.reader.setIndex(C.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),C.readLocalPart(this.reader),C.handleUTF8(),C.processAttributes()},readCentralDir:function(){var b;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(b=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(b);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var b=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(b<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(b);var C=b;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(b=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(b),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var x=C-u;if(0<x)this.isSignature(C,o.CENTRAL_FILE_HEADER)||(this.reader.zero=x);else if(x<0)throw new Error("Corrupted zip: missing "+Math.abs(x)+" bytes.")},prepareReader:function(b){this.reader=t(b)},load:function(b){this.prepareReader(b),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=_},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,n,r){var t=e("./reader/readerFor"),a=e("./utils"),o=e("./compressedObject"),l=e("./crc32"),m=e("./utf8"),_=e("./compressions"),b=e("./support");function C(u,x){this.options=u,this.loadOptions=x}C.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var x,d;if(u.skip(22),this.fileNameLength=u.readInt(2),d=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(d),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((x=function(f){for(var h in _)if(Object.prototype.hasOwnProperty.call(_,h)&&_[h].magic===f)return _[h];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,x,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var x=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(x),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=t(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var x,d,f,h=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<h;)x=u.readInt(2),d=u.readInt(2),f=u.readData(d),this.extraFields[x]={id:x,length:d,value:f};u.setIndex(h)},handleUTF8:function(){var u=b.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=m.utf8decode(this.fileName),this.fileCommentStr=m.utf8decode(this.fileComment);else{var x=this.findExtraFieldUnicodePath();if(x!==null)this.fileNameStr=x;else{var d=a.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(d)}var f=this.findExtraFieldUnicodeComment();if(f!==null)this.fileCommentStr=f;else{var h=a.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(h)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var x=t(u.value);return x.readInt(1)!==1||l(this.fileName)!==x.readInt(4)?null:m.utf8decode(x.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var x=t(u.value);return x.readInt(1)!==1||l(this.fileComment)!==x.readInt(4)?null:m.utf8decode(x.readData(u.length-5))}return null}},n.exports=C},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,n,r){function t(x,d,f){this.name=x,this.dir=f.dir,this.date=f.date,this.comment=f.comment,this.unixPermissions=f.unixPermissions,this.dosPermissions=f.dosPermissions,this._data=d,this._dataBinary=f.binary,this.options={compression:f.compression,compressionOptions:f.compressionOptions}}var a=e("./stream/StreamHelper"),o=e("./stream/DataWorker"),l=e("./utf8"),m=e("./compressedObject"),_=e("./stream/GenericWorker");t.prototype={internalStream:function(x){var d=null,f="string";try{if(!x)throw new Error("No output type specified.");var h=(f=x.toLowerCase())==="string"||f==="text";f!=="binarystring"&&f!=="text"||(f="string"),d=this._decompressWorker();var v=!this._dataBinary;v&&!h&&(d=d.pipe(new l.Utf8EncodeWorker)),!v&&h&&(d=d.pipe(new l.Utf8DecodeWorker))}catch(j){(d=new _("error")).error(j)}return new a(d,f,"")},async:function(x,d){return this.internalStream(x).accumulate(d)},nodeStream:function(x,d){return this.internalStream(x||"nodebuffer").toNodejsStream(d)},_compressWorker:function(x,d){if(this._data instanceof m&&this._data.compression.magic===x.magic)return this._data.getCompressedWorker();var f=this._decompressWorker();return this._dataBinary||(f=f.pipe(new l.Utf8EncodeWorker)),m.createWorkerFrom(f,x,d)},_decompressWorker:function(){return this._data instanceof m?this._data.getContentWorker():this._data instanceof _?this._data:new o(this._data)}};for(var b=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],C=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<b.length;u++)t.prototype[b[u]]=C;n.exports=t},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,n,r){(function(t){var a,o,l=t.MutationObserver||t.WebKitMutationObserver;if(l){var m=0,_=new l(x),b=t.document.createTextNode("");_.observe(b,{characterData:!0}),a=function(){b.data=m=++m%2}}else if(t.setImmediate||t.MessageChannel===void 0)a="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var d=t.document.createElement("script");d.onreadystatechange=function(){x(),d.onreadystatechange=null,d.parentNode.removeChild(d),d=null},t.document.documentElement.appendChild(d)}:function(){setTimeout(x,0)};else{var C=new t.MessageChannel;C.port1.onmessage=x,a=function(){C.port2.postMessage(0)}}var u=[];function x(){var d,f;o=!0;for(var h=u.length;h;){for(f=u,u=[],d=-1;++d<h;)f[d]();h=u.length}o=!1}n.exports=function(d){u.push(d)!==1||o||a()}}).call(this,typeof Ae<"u"?Ae:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,n,r){var t=e("immediate");function a(){}var o={},l=["REJECTED"],m=["FULFILLED"],_=["PENDING"];function b(h){if(typeof h!="function")throw new TypeError("resolver must be a function");this.state=_,this.queue=[],this.outcome=void 0,h!==a&&d(this,h)}function C(h,v,j){this.promise=h,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof j=="function"&&(this.onRejected=j,this.callRejected=this.otherCallRejected)}function u(h,v,j){t(function(){var E;try{E=v(j)}catch(S){return o.reject(h,S)}E===h?o.reject(h,new TypeError("Cannot resolve promise with itself")):o.resolve(h,E)})}function x(h){var v=h&&h.then;if(h&&(typeof h=="object"||typeof h=="function")&&typeof v=="function")return function(){v.apply(h,arguments)}}function d(h,v){var j=!1;function E(R){j||(j=!0,o.reject(h,R))}function S(R){j||(j=!0,o.resolve(h,R))}var z=f(function(){v(S,E)});z.status==="error"&&E(z.value)}function f(h,v){var j={};try{j.value=h(v),j.status="success"}catch(E){j.status="error",j.value=E}return j}(n.exports=b).prototype.finally=function(h){if(typeof h!="function")return this;var v=this.constructor;return this.then(function(j){return v.resolve(h()).then(function(){return j})},function(j){return v.resolve(h()).then(function(){throw j})})},b.prototype.catch=function(h){return this.then(null,h)},b.prototype.then=function(h,v){if(typeof h!="function"&&this.state===m||typeof v!="function"&&this.state===l)return this;var j=new this.constructor(a);return this.state!==_?u(j,this.state===m?h:v,this.outcome):this.queue.push(new C(j,h,v)),j},C.prototype.callFulfilled=function(h){o.resolve(this.promise,h)},C.prototype.otherCallFulfilled=function(h){u(this.promise,this.onFulfilled,h)},C.prototype.callRejected=function(h){o.reject(this.promise,h)},C.prototype.otherCallRejected=function(h){u(this.promise,this.onRejected,h)},o.resolve=function(h,v){var j=f(x,v);if(j.status==="error")return o.reject(h,j.value);var E=j.value;if(E)d(h,E);else{h.state=m,h.outcome=v;for(var S=-1,z=h.queue.length;++S<z;)h.queue[S].callFulfilled(v)}return h},o.reject=function(h,v){h.state=l,h.outcome=v;for(var j=-1,E=h.queue.length;++j<E;)h.queue[j].callRejected(v);return h},b.resolve=function(h){return h instanceof this?h:o.resolve(new this(a),h)},b.reject=function(h){var v=new this(a);return o.reject(v,h)},b.all=function(h){var v=this;if(Object.prototype.toString.call(h)!=="[object Array]")return this.reject(new TypeError("must be an array"));var j=h.length,E=!1;if(!j)return this.resolve([]);for(var S=new Array(j),z=0,R=-1,L=new this(a);++R<j;)I(h[R],R);return L;function I(M,Z){v.resolve(M).then(function(g){S[Z]=g,++z!==j||E||(E=!0,o.resolve(L,S))},function(g){E||(E=!0,o.reject(L,g))})}},b.race=function(h){var v=this;if(Object.prototype.toString.call(h)!=="[object Array]")return this.reject(new TypeError("must be an array"));var j=h.length,E=!1;if(!j)return this.resolve([]);for(var S=-1,z=new this(a);++S<j;)R=h[S],v.resolve(R).then(function(L){E||(E=!0,o.resolve(z,L))},function(L){E||(E=!0,o.reject(z,L))});var R;return z}},{immediate:36}],38:[function(e,n,r){var t={};(0,e("./lib/utils/common").assign)(t,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),n.exports=t},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,n,r){var t=e("./zlib/deflate"),a=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/messages"),m=e("./zlib/zstream"),_=Object.prototype.toString,b=0,C=-1,u=0,x=8;function d(h){if(!(this instanceof d))return new d(h);this.options=a.assign({level:C,method:x,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},h||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m,this.strm.avail_out=0;var j=t.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(j!==b)throw new Error(l[j]);if(v.header&&t.deflateSetHeader(this.strm,v.header),v.dictionary){var E;if(E=typeof v.dictionary=="string"?o.string2buf(v.dictionary):_.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(j=t.deflateSetDictionary(this.strm,E))!==b)throw new Error(l[j]);this._dict_set=!0}}function f(h,v){var j=new d(v);if(j.push(h,!0),j.err)throw j.msg||l[j.err];return j.result}d.prototype.push=function(h,v){var j,E,S=this.strm,z=this.options.chunkSize;if(this.ended)return!1;E=v===~~v?v:v===!0?4:0,typeof h=="string"?S.input=o.string2buf(h):_.call(h)==="[object ArrayBuffer]"?S.input=new Uint8Array(h):S.input=h,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new a.Buf8(z),S.next_out=0,S.avail_out=z),(j=t.deflate(S,E))!==1&&j!==b)return this.onEnd(j),!(this.ended=!0);S.avail_out!==0&&(S.avail_in!==0||E!==4&&E!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(a.shrinkBuf(S.output,S.next_out))):this.onData(a.shrinkBuf(S.output,S.next_out)))}while((0<S.avail_in||S.avail_out===0)&&j!==1);return E===4?(j=t.deflateEnd(this.strm),this.onEnd(j),this.ended=!0,j===b):E!==2||(this.onEnd(b),!(S.avail_out=0))},d.prototype.onData=function(h){this.chunks.push(h)},d.prototype.onEnd=function(h){h===b&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.msg=this.strm.msg},r.Deflate=d,r.deflate=f,r.deflateRaw=function(h,v){return(v=v||{}).raw=!0,f(h,v)},r.gzip=function(h,v){return(v=v||{}).gzip=!0,f(h,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,n,r){var t=e("./zlib/inflate"),a=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/constants"),m=e("./zlib/messages"),_=e("./zlib/zstream"),b=e("./zlib/gzheader"),C=Object.prototype.toString;function u(d){if(!(this instanceof u))return new u(d);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},d||{});var f=this.options;f.raw&&0<=f.windowBits&&f.windowBits<16&&(f.windowBits=-f.windowBits,f.windowBits===0&&(f.windowBits=-15)),!(0<=f.windowBits&&f.windowBits<16)||d&&d.windowBits||(f.windowBits+=32),15<f.windowBits&&f.windowBits<48&&!(15&f.windowBits)&&(f.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new _,this.strm.avail_out=0;var h=t.inflateInit2(this.strm,f.windowBits);if(h!==l.Z_OK)throw new Error(m[h]);this.header=new b,t.inflateGetHeader(this.strm,this.header)}function x(d,f){var h=new u(f);if(h.push(d,!0),h.err)throw h.msg||m[h.err];return h.result}u.prototype.push=function(d,f){var h,v,j,E,S,z,R=this.strm,L=this.options.chunkSize,I=this.options.dictionary,M=!1;if(this.ended)return!1;v=f===~~f?f:f===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof d=="string"?R.input=o.binstring2buf(d):C.call(d)==="[object ArrayBuffer]"?R.input=new Uint8Array(d):R.input=d,R.next_in=0,R.avail_in=R.input.length;do{if(R.avail_out===0&&(R.output=new a.Buf8(L),R.next_out=0,R.avail_out=L),(h=t.inflate(R,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&I&&(z=typeof I=="string"?o.string2buf(I):C.call(I)==="[object ArrayBuffer]"?new Uint8Array(I):I,h=t.inflateSetDictionary(this.strm,z)),h===l.Z_BUF_ERROR&&M===!0&&(h=l.Z_OK,M=!1),h!==l.Z_STREAM_END&&h!==l.Z_OK)return this.onEnd(h),!(this.ended=!0);R.next_out&&(R.avail_out!==0&&h!==l.Z_STREAM_END&&(R.avail_in!==0||v!==l.Z_FINISH&&v!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(j=o.utf8border(R.output,R.next_out),E=R.next_out-j,S=o.buf2string(R.output,j),R.next_out=E,R.avail_out=L-E,E&&a.arraySet(R.output,R.output,j,E,0),this.onData(S)):this.onData(a.shrinkBuf(R.output,R.next_out)))),R.avail_in===0&&R.avail_out===0&&(M=!0)}while((0<R.avail_in||R.avail_out===0)&&h!==l.Z_STREAM_END);return h===l.Z_STREAM_END&&(v=l.Z_FINISH),v===l.Z_FINISH?(h=t.inflateEnd(this.strm),this.onEnd(h),this.ended=!0,h===l.Z_OK):v!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(R.avail_out=0))},u.prototype.onData=function(d){this.chunks.push(d)},u.prototype.onEnd=function(d){d===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg},r.Inflate=u,r.inflate=x,r.inflateRaw=function(d,f){return(f=f||{}).raw=!0,x(d,f)},r.ungzip=x},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,n,r){var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";r.assign=function(l){for(var m=Array.prototype.slice.call(arguments,1);m.length;){var _=m.shift();if(_){if(typeof _!="object")throw new TypeError(_+"must be non-object");for(var b in _)_.hasOwnProperty(b)&&(l[b]=_[b])}}return l},r.shrinkBuf=function(l,m){return l.length===m?l:l.subarray?l.subarray(0,m):(l.length=m,l)};var a={arraySet:function(l,m,_,b,C){if(m.subarray&&l.subarray)l.set(m.subarray(_,_+b),C);else for(var u=0;u<b;u++)l[C+u]=m[_+u]},flattenChunks:function(l){var m,_,b,C,u,x;for(m=b=0,_=l.length;m<_;m++)b+=l[m].length;for(x=new Uint8Array(b),m=C=0,_=l.length;m<_;m++)u=l[m],x.set(u,C),C+=u.length;return x}},o={arraySet:function(l,m,_,b,C){for(var u=0;u<b;u++)l[C+u]=m[_+u]},flattenChunks:function(l){return[].concat.apply([],l)}};r.setTyped=function(l){l?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,a)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,o))},r.setTyped(t)},{}],42:[function(e,n,r){var t=e("./common"),a=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new t.Buf8(256),m=0;m<256;m++)l[m]=252<=m?6:248<=m?5:240<=m?4:224<=m?3:192<=m?2:1;function _(b,C){if(C<65537&&(b.subarray&&o||!b.subarray&&a))return String.fromCharCode.apply(null,t.shrinkBuf(b,C));for(var u="",x=0;x<C;x++)u+=String.fromCharCode(b[x]);return u}l[254]=l[254]=1,r.string2buf=function(b){var C,u,x,d,f,h=b.length,v=0;for(d=0;d<h;d++)(64512&(u=b.charCodeAt(d)))==55296&&d+1<h&&(64512&(x=b.charCodeAt(d+1)))==56320&&(u=65536+(u-55296<<10)+(x-56320),d++),v+=u<128?1:u<2048?2:u<65536?3:4;for(C=new t.Buf8(v),d=f=0;f<v;d++)(64512&(u=b.charCodeAt(d)))==55296&&d+1<h&&(64512&(x=b.charCodeAt(d+1)))==56320&&(u=65536+(u-55296<<10)+(x-56320),d++),u<128?C[f++]=u:(u<2048?C[f++]=192|u>>>6:(u<65536?C[f++]=224|u>>>12:(C[f++]=240|u>>>18,C[f++]=128|u>>>12&63),C[f++]=128|u>>>6&63),C[f++]=128|63&u);return C},r.buf2binstring=function(b){return _(b,b.length)},r.binstring2buf=function(b){for(var C=new t.Buf8(b.length),u=0,x=C.length;u<x;u++)C[u]=b.charCodeAt(u);return C},r.buf2string=function(b,C){var u,x,d,f,h=C||b.length,v=new Array(2*h);for(u=x=0;u<h;)if((d=b[u++])<128)v[x++]=d;else if(4<(f=l[d]))v[x++]=65533,u+=f-1;else{for(d&=f===2?31:f===3?15:7;1<f&&u<h;)d=d<<6|63&b[u++],f--;1<f?v[x++]=65533:d<65536?v[x++]=d:(d-=65536,v[x++]=55296|d>>10&1023,v[x++]=56320|1023&d)}return _(v,x)},r.utf8border=function(b,C){var u;for((C=C||b.length)>b.length&&(C=b.length),u=C-1;0<=u&&(192&b[u])==128;)u--;return u<0||u===0?C:u+l[b[u]]>C?u:C}},{"./common":41}],43:[function(e,n,r){n.exports=function(t,a,o,l){for(var m=65535&t|0,_=t>>>16&65535|0,b=0;o!==0;){for(o-=b=2e3<o?2e3:o;_=_+(m=m+a[l++]|0)|0,--b;);m%=65521,_%=65521}return m|_<<16|0}},{}],44:[function(e,n,r){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,n,r){var t=function(){for(var a,o=[],l=0;l<256;l++){a=l;for(var m=0;m<8;m++)a=1&a?3988292384^a>>>1:a>>>1;o[l]=a}return o}();n.exports=function(a,o,l,m){var _=t,b=m+l;a^=-1;for(var C=m;C<b;C++)a=a>>>8^_[255&(a^o[C])];return-1^a}},{}],46:[function(e,n,r){var t,a=e("../utils/common"),o=e("./trees"),l=e("./adler32"),m=e("./crc32"),_=e("./messages"),b=0,C=4,u=0,x=-2,d=-1,f=4,h=2,v=8,j=9,E=286,S=30,z=19,R=2*E+1,L=15,I=3,M=258,Z=M+I+1,g=42,N=113,c=1,F=2,X=3,W=4;function re(i,P){return i.msg=_[P],P}function V(i){return(i<<1)-(4<i?9:0)}function J(i){for(var P=i.length;0<=--P;)i[P]=0}function A(i){var P=i.state,B=P.pending;B>i.avail_out&&(B=i.avail_out),B!==0&&(a.arraySet(i.output,P.pending_buf,P.pending_out,B,i.next_out),i.next_out+=B,P.pending_out+=B,i.total_out+=B,i.avail_out-=B,P.pending-=B,P.pending===0&&(P.pending_out=0))}function T(i,P){o._tr_flush_block(i,0<=i.block_start?i.block_start:-1,i.strstart-i.block_start,P),i.block_start=i.strstart,A(i.strm)}function Q(i,P){i.pending_buf[i.pending++]=P}function K(i,P){i.pending_buf[i.pending++]=P>>>8&255,i.pending_buf[i.pending++]=255&P}function $(i,P){var B,k,y=i.max_chain_length,D=i.strstart,U=i.prev_length,G=i.nice_match,O=i.strstart>i.w_size-Z?i.strstart-(i.w_size-Z):0,H=i.window,q=i.w_mask,Y=i.prev,ee=i.strstart+M,oe=H[D+U-1],se=H[D+U];i.prev_length>=i.good_match&&(y>>=2),G>i.lookahead&&(G=i.lookahead);do if(H[(B=P)+U]===se&&H[B+U-1]===oe&&H[B]===H[D]&&H[++B]===H[D+1]){D+=2,B++;do;while(H[++D]===H[++B]&&H[++D]===H[++B]&&H[++D]===H[++B]&&H[++D]===H[++B]&&H[++D]===H[++B]&&H[++D]===H[++B]&&H[++D]===H[++B]&&H[++D]===H[++B]&&D<ee);if(k=M-(ee-D),D=ee-M,U<k){if(i.match_start=P,G<=(U=k))break;oe=H[D+U-1],se=H[D+U]}}while((P=Y[P&q])>O&&--y!=0);return U<=i.lookahead?U:i.lookahead}function ae(i){var P,B,k,y,D,U,G,O,H,q,Y=i.w_size;do{if(y=i.window_size-i.lookahead-i.strstart,i.strstart>=Y+(Y-Z)){for(a.arraySet(i.window,i.window,Y,Y,0),i.match_start-=Y,i.strstart-=Y,i.block_start-=Y,P=B=i.hash_size;k=i.head[--P],i.head[P]=Y<=k?k-Y:0,--B;);for(P=B=Y;k=i.prev[--P],i.prev[P]=Y<=k?k-Y:0,--B;);y+=Y}if(i.strm.avail_in===0)break;if(U=i.strm,G=i.window,O=i.strstart+i.lookahead,H=y,q=void 0,q=U.avail_in,H<q&&(q=H),B=q===0?0:(U.avail_in-=q,a.arraySet(G,U.input,U.next_in,q,O),U.state.wrap===1?U.adler=l(U.adler,G,q,O):U.state.wrap===2&&(U.adler=m(U.adler,G,q,O)),U.next_in+=q,U.total_in+=q,q),i.lookahead+=B,i.lookahead+i.insert>=I)for(D=i.strstart-i.insert,i.ins_h=i.window[D],i.ins_h=(i.ins_h<<i.hash_shift^i.window[D+1])&i.hash_mask;i.insert&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[D+I-1])&i.hash_mask,i.prev[D&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=D,D++,i.insert--,!(i.lookahead+i.insert<I)););}while(i.lookahead<Z&&i.strm.avail_in!==0)}function ce(i,P){for(var B,k;;){if(i.lookahead<Z){if(ae(i),i.lookahead<Z&&P===b)return c;if(i.lookahead===0)break}if(B=0,i.lookahead>=I&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+I-1])&i.hash_mask,B=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),B!==0&&i.strstart-B<=i.w_size-Z&&(i.match_length=$(i,B)),i.match_length>=I)if(k=o._tr_tally(i,i.strstart-i.match_start,i.match_length-I),i.lookahead-=i.match_length,i.match_length<=i.max_lazy_match&&i.lookahead>=I){for(i.match_length--;i.strstart++,i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+I-1])&i.hash_mask,B=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart,--i.match_length!=0;);i.strstart++}else i.strstart+=i.match_length,i.match_length=0,i.ins_h=i.window[i.strstart],i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+1])&i.hash_mask;else k=o._tr_tally(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++;if(k&&(T(i,!1),i.strm.avail_out===0))return c}return i.insert=i.strstart<I-1?i.strstart:I-1,P===C?(T(i,!0),i.strm.avail_out===0?X:W):i.last_lit&&(T(i,!1),i.strm.avail_out===0)?c:F}function ne(i,P){for(var B,k,y;;){if(i.lookahead<Z){if(ae(i),i.lookahead<Z&&P===b)return c;if(i.lookahead===0)break}if(B=0,i.lookahead>=I&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+I-1])&i.hash_mask,B=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),i.prev_length=i.match_length,i.prev_match=i.match_start,i.match_length=I-1,B!==0&&i.prev_length<i.max_lazy_match&&i.strstart-B<=i.w_size-Z&&(i.match_length=$(i,B),i.match_length<=5&&(i.strategy===1||i.match_length===I&&4096<i.strstart-i.match_start)&&(i.match_length=I-1)),i.prev_length>=I&&i.match_length<=i.prev_length){for(y=i.strstart+i.lookahead-I,k=o._tr_tally(i,i.strstart-1-i.prev_match,i.prev_length-I),i.lookahead-=i.prev_length-1,i.prev_length-=2;++i.strstart<=y&&(i.ins_h=(i.ins_h<<i.hash_shift^i.window[i.strstart+I-1])&i.hash_mask,B=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),--i.prev_length!=0;);if(i.match_available=0,i.match_length=I-1,i.strstart++,k&&(T(i,!1),i.strm.avail_out===0))return c}else if(i.match_available){if((k=o._tr_tally(i,0,i.window[i.strstart-1]))&&T(i,!1),i.strstart++,i.lookahead--,i.strm.avail_out===0)return c}else i.match_available=1,i.strstart++,i.lookahead--}return i.match_available&&(k=o._tr_tally(i,0,i.window[i.strstart-1]),i.match_available=0),i.insert=i.strstart<I-1?i.strstart:I-1,P===C?(T(i,!0),i.strm.avail_out===0?X:W):i.last_lit&&(T(i,!1),i.strm.avail_out===0)?c:F}function ie(i,P,B,k,y){this.good_length=i,this.max_lazy=P,this.nice_length=B,this.max_chain=k,this.func=y}function he(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*R),this.dyn_dtree=new a.Buf16(2*(2*S+1)),this.bl_tree=new a.Buf16(2*(2*z+1)),J(this.dyn_ltree),J(this.dyn_dtree),J(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(L+1),this.heap=new a.Buf16(2*E+1),J(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*E+1),J(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function le(i){var P;return i&&i.state?(i.total_in=i.total_out=0,i.data_type=h,(P=i.state).pending=0,P.pending_out=0,P.wrap<0&&(P.wrap=-P.wrap),P.status=P.wrap?g:N,i.adler=P.wrap===2?0:1,P.last_flush=b,o._tr_init(P),u):re(i,x)}function _e(i){var P=le(i);return P===u&&function(B){B.window_size=2*B.w_size,J(B.head),B.max_lazy_match=t[B.level].max_lazy,B.good_match=t[B.level].good_length,B.nice_match=t[B.level].nice_length,B.max_chain_length=t[B.level].max_chain,B.strstart=0,B.block_start=0,B.lookahead=0,B.insert=0,B.match_length=B.prev_length=I-1,B.match_available=0,B.ins_h=0}(i.state),P}function ye(i,P,B,k,y,D){if(!i)return x;var U=1;if(P===d&&(P=6),k<0?(U=0,k=-k):15<k&&(U=2,k-=16),y<1||j<y||B!==v||k<8||15<k||P<0||9<P||D<0||f<D)return re(i,x);k===8&&(k=9);var G=new he;return(i.state=G).strm=i,G.wrap=U,G.gzhead=null,G.w_bits=k,G.w_size=1<<G.w_bits,G.w_mask=G.w_size-1,G.hash_bits=y+7,G.hash_size=1<<G.hash_bits,G.hash_mask=G.hash_size-1,G.hash_shift=~~((G.hash_bits+I-1)/I),G.window=new a.Buf8(2*G.w_size),G.head=new a.Buf16(G.hash_size),G.prev=new a.Buf16(G.w_size),G.lit_bufsize=1<<y+6,G.pending_buf_size=4*G.lit_bufsize,G.pending_buf=new a.Buf8(G.pending_buf_size),G.d_buf=1*G.lit_bufsize,G.l_buf=3*G.lit_bufsize,G.level=P,G.strategy=D,G.method=B,_e(i)}t=[new ie(0,0,0,0,function(i,P){var B=65535;for(B>i.pending_buf_size-5&&(B=i.pending_buf_size-5);;){if(i.lookahead<=1){if(ae(i),i.lookahead===0&&P===b)return c;if(i.lookahead===0)break}i.strstart+=i.lookahead,i.lookahead=0;var k=i.block_start+B;if((i.strstart===0||i.strstart>=k)&&(i.lookahead=i.strstart-k,i.strstart=k,T(i,!1),i.strm.avail_out===0)||i.strstart-i.block_start>=i.w_size-Z&&(T(i,!1),i.strm.avail_out===0))return c}return i.insert=0,P===C?(T(i,!0),i.strm.avail_out===0?X:W):(i.strstart>i.block_start&&(T(i,!1),i.strm.avail_out),c)}),new ie(4,4,8,4,ce),new ie(4,5,16,8,ce),new ie(4,6,32,32,ce),new ie(4,4,16,16,ne),new ie(8,16,32,32,ne),new ie(8,16,128,128,ne),new ie(8,32,128,256,ne),new ie(32,128,258,1024,ne),new ie(32,258,258,4096,ne)],r.deflateInit=function(i,P){return ye(i,P,v,15,8,0)},r.deflateInit2=ye,r.deflateReset=_e,r.deflateResetKeep=le,r.deflateSetHeader=function(i,P){return i&&i.state?i.state.wrap!==2?x:(i.state.gzhead=P,u):x},r.deflate=function(i,P){var B,k,y,D;if(!i||!i.state||5<P||P<0)return i?re(i,x):x;if(k=i.state,!i.output||!i.input&&i.avail_in!==0||k.status===666&&P!==C)return re(i,i.avail_out===0?-5:x);if(k.strm=i,B=k.last_flush,k.last_flush=P,k.status===g)if(k.wrap===2)i.adler=0,Q(k,31),Q(k,139),Q(k,8),k.gzhead?(Q(k,(k.gzhead.text?1:0)+(k.gzhead.hcrc?2:0)+(k.gzhead.extra?4:0)+(k.gzhead.name?8:0)+(k.gzhead.comment?16:0)),Q(k,255&k.gzhead.time),Q(k,k.gzhead.time>>8&255),Q(k,k.gzhead.time>>16&255),Q(k,k.gzhead.time>>24&255),Q(k,k.level===9?2:2<=k.strategy||k.level<2?4:0),Q(k,255&k.gzhead.os),k.gzhead.extra&&k.gzhead.extra.length&&(Q(k,255&k.gzhead.extra.length),Q(k,k.gzhead.extra.length>>8&255)),k.gzhead.hcrc&&(i.adler=m(i.adler,k.pending_buf,k.pending,0)),k.gzindex=0,k.status=69):(Q(k,0),Q(k,0),Q(k,0),Q(k,0),Q(k,0),Q(k,k.level===9?2:2<=k.strategy||k.level<2?4:0),Q(k,3),k.status=N);else{var U=v+(k.w_bits-8<<4)<<8;U|=(2<=k.strategy||k.level<2?0:k.level<6?1:k.level===6?2:3)<<6,k.strstart!==0&&(U|=32),U+=31-U%31,k.status=N,K(k,U),k.strstart!==0&&(K(k,i.adler>>>16),K(k,65535&i.adler)),i.adler=1}if(k.status===69)if(k.gzhead.extra){for(y=k.pending;k.gzindex<(65535&k.gzhead.extra.length)&&(k.pending!==k.pending_buf_size||(k.gzhead.hcrc&&k.pending>y&&(i.adler=m(i.adler,k.pending_buf,k.pending-y,y)),A(i),y=k.pending,k.pending!==k.pending_buf_size));)Q(k,255&k.gzhead.extra[k.gzindex]),k.gzindex++;k.gzhead.hcrc&&k.pending>y&&(i.adler=m(i.adler,k.pending_buf,k.pending-y,y)),k.gzindex===k.gzhead.extra.length&&(k.gzindex=0,k.status=73)}else k.status=73;if(k.status===73)if(k.gzhead.name){y=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>y&&(i.adler=m(i.adler,k.pending_buf,k.pending-y,y)),A(i),y=k.pending,k.pending===k.pending_buf_size)){D=1;break}D=k.gzindex<k.gzhead.name.length?255&k.gzhead.name.charCodeAt(k.gzindex++):0,Q(k,D)}while(D!==0);k.gzhead.hcrc&&k.pending>y&&(i.adler=m(i.adler,k.pending_buf,k.pending-y,y)),D===0&&(k.gzindex=0,k.status=91)}else k.status=91;if(k.status===91)if(k.gzhead.comment){y=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>y&&(i.adler=m(i.adler,k.pending_buf,k.pending-y,y)),A(i),y=k.pending,k.pending===k.pending_buf_size)){D=1;break}D=k.gzindex<k.gzhead.comment.length?255&k.gzhead.comment.charCodeAt(k.gzindex++):0,Q(k,D)}while(D!==0);k.gzhead.hcrc&&k.pending>y&&(i.adler=m(i.adler,k.pending_buf,k.pending-y,y)),D===0&&(k.status=103)}else k.status=103;if(k.status===103&&(k.gzhead.hcrc?(k.pending+2>k.pending_buf_size&&A(i),k.pending+2<=k.pending_buf_size&&(Q(k,255&i.adler),Q(k,i.adler>>8&255),i.adler=0,k.status=N)):k.status=N),k.pending!==0){if(A(i),i.avail_out===0)return k.last_flush=-1,u}else if(i.avail_in===0&&V(P)<=V(B)&&P!==C)return re(i,-5);if(k.status===666&&i.avail_in!==0)return re(i,-5);if(i.avail_in!==0||k.lookahead!==0||P!==b&&k.status!==666){var G=k.strategy===2?function(O,H){for(var q;;){if(O.lookahead===0&&(ae(O),O.lookahead===0)){if(H===b)return c;break}if(O.match_length=0,q=o._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++,q&&(T(O,!1),O.strm.avail_out===0))return c}return O.insert=0,H===C?(T(O,!0),O.strm.avail_out===0?X:W):O.last_lit&&(T(O,!1),O.strm.avail_out===0)?c:F}(k,P):k.strategy===3?function(O,H){for(var q,Y,ee,oe,se=O.window;;){if(O.lookahead<=M){if(ae(O),O.lookahead<=M&&H===b)return c;if(O.lookahead===0)break}if(O.match_length=0,O.lookahead>=I&&0<O.strstart&&(Y=se[ee=O.strstart-1])===se[++ee]&&Y===se[++ee]&&Y===se[++ee]){oe=O.strstart+M;do;while(Y===se[++ee]&&Y===se[++ee]&&Y===se[++ee]&&Y===se[++ee]&&Y===se[++ee]&&Y===se[++ee]&&Y===se[++ee]&&Y===se[++ee]&&ee<oe);O.match_length=M-(oe-ee),O.match_length>O.lookahead&&(O.match_length=O.lookahead)}if(O.match_length>=I?(q=o._tr_tally(O,1,O.match_length-I),O.lookahead-=O.match_length,O.strstart+=O.match_length,O.match_length=0):(q=o._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++),q&&(T(O,!1),O.strm.avail_out===0))return c}return O.insert=0,H===C?(T(O,!0),O.strm.avail_out===0?X:W):O.last_lit&&(T(O,!1),O.strm.avail_out===0)?c:F}(k,P):t[k.level].func(k,P);if(G!==X&&G!==W||(k.status=666),G===c||G===X)return i.avail_out===0&&(k.last_flush=-1),u;if(G===F&&(P===1?o._tr_align(k):P!==5&&(o._tr_stored_block(k,0,0,!1),P===3&&(J(k.head),k.lookahead===0&&(k.strstart=0,k.block_start=0,k.insert=0))),A(i),i.avail_out===0))return k.last_flush=-1,u}return P!==C?u:k.wrap<=0?1:(k.wrap===2?(Q(k,255&i.adler),Q(k,i.adler>>8&255),Q(k,i.adler>>16&255),Q(k,i.adler>>24&255),Q(k,255&i.total_in),Q(k,i.total_in>>8&255),Q(k,i.total_in>>16&255),Q(k,i.total_in>>24&255)):(K(k,i.adler>>>16),K(k,65535&i.adler)),A(i),0<k.wrap&&(k.wrap=-k.wrap),k.pending!==0?u:1)},r.deflateEnd=function(i){var P;return i&&i.state?(P=i.state.status)!==g&&P!==69&&P!==73&&P!==91&&P!==103&&P!==N&&P!==666?re(i,x):(i.state=null,P===N?re(i,-3):u):x},r.deflateSetDictionary=function(i,P){var B,k,y,D,U,G,O,H,q=P.length;if(!i||!i.state||(D=(B=i.state).wrap)===2||D===1&&B.status!==g||B.lookahead)return x;for(D===1&&(i.adler=l(i.adler,P,q,0)),B.wrap=0,q>=B.w_size&&(D===0&&(J(B.head),B.strstart=0,B.block_start=0,B.insert=0),H=new a.Buf8(B.w_size),a.arraySet(H,P,q-B.w_size,B.w_size,0),P=H,q=B.w_size),U=i.avail_in,G=i.next_in,O=i.input,i.avail_in=q,i.next_in=0,i.input=P,ae(B);B.lookahead>=I;){for(k=B.strstart,y=B.lookahead-(I-1);B.ins_h=(B.ins_h<<B.hash_shift^B.window[k+I-1])&B.hash_mask,B.prev[k&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=k,k++,--y;);B.strstart=k,B.lookahead=I-1,ae(B)}return B.strstart+=B.lookahead,B.block_start=B.strstart,B.insert=B.lookahead,B.lookahead=0,B.match_length=B.prev_length=I-1,B.match_available=0,i.next_in=G,i.input=O,i.avail_in=U,B.wrap=D,u},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,n,r){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,n,r){n.exports=function(t,a){var o,l,m,_,b,C,u,x,d,f,h,v,j,E,S,z,R,L,I,M,Z,g,N,c,F;o=t.state,l=t.next_in,c=t.input,m=l+(t.avail_in-5),_=t.next_out,F=t.output,b=_-(a-t.avail_out),C=_+(t.avail_out-257),u=o.dmax,x=o.wsize,d=o.whave,f=o.wnext,h=o.window,v=o.hold,j=o.bits,E=o.lencode,S=o.distcode,z=(1<<o.lenbits)-1,R=(1<<o.distbits)-1;e:do{j<15&&(v+=c[l++]<<j,j+=8,v+=c[l++]<<j,j+=8),L=E[v&z];t:for(;;){if(v>>>=I=L>>>24,j-=I,(I=L>>>16&255)===0)F[_++]=65535&L;else{if(!(16&I)){if(!(64&I)){L=E[(65535&L)+(v&(1<<I)-1)];continue t}if(32&I){o.mode=12;break e}t.msg="invalid literal/length code",o.mode=30;break e}M=65535&L,(I&=15)&&(j<I&&(v+=c[l++]<<j,j+=8),M+=v&(1<<I)-1,v>>>=I,j-=I),j<15&&(v+=c[l++]<<j,j+=8,v+=c[l++]<<j,j+=8),L=S[v&R];r:for(;;){if(v>>>=I=L>>>24,j-=I,!(16&(I=L>>>16&255))){if(!(64&I)){L=S[(65535&L)+(v&(1<<I)-1)];continue r}t.msg="invalid distance code",o.mode=30;break e}if(Z=65535&L,j<(I&=15)&&(v+=c[l++]<<j,(j+=8)<I&&(v+=c[l++]<<j,j+=8)),u<(Z+=v&(1<<I)-1)){t.msg="invalid distance too far back",o.mode=30;break e}if(v>>>=I,j-=I,(I=_-b)<Z){if(d<(I=Z-I)&&o.sane){t.msg="invalid distance too far back",o.mode=30;break e}if(N=h,(g=0)===f){if(g+=x-I,I<M){for(M-=I;F[_++]=h[g++],--I;);g=_-Z,N=F}}else if(f<I){if(g+=x+f-I,(I-=f)<M){for(M-=I;F[_++]=h[g++],--I;);if(g=0,f<M){for(M-=I=f;F[_++]=h[g++],--I;);g=_-Z,N=F}}}else if(g+=f-I,I<M){for(M-=I;F[_++]=h[g++],--I;);g=_-Z,N=F}for(;2<M;)F[_++]=N[g++],F[_++]=N[g++],F[_++]=N[g++],M-=3;M&&(F[_++]=N[g++],1<M&&(F[_++]=N[g++]))}else{for(g=_-Z;F[_++]=F[g++],F[_++]=F[g++],F[_++]=F[g++],2<(M-=3););M&&(F[_++]=F[g++],1<M&&(F[_++]=F[g++]))}break}}break}}while(l<m&&_<C);l-=M=j>>3,v&=(1<<(j-=M<<3))-1,t.next_in=l,t.next_out=_,t.avail_in=l<m?m-l+5:5-(l-m),t.avail_out=_<C?C-_+257:257-(_-C),o.hold=v,o.bits=j}},{}],49:[function(e,n,r){var t=e("../utils/common"),a=e("./adler32"),o=e("./crc32"),l=e("./inffast"),m=e("./inftrees"),_=1,b=2,C=0,u=-2,x=1,d=852,f=592;function h(g){return(g>>>24&255)+(g>>>8&65280)+((65280&g)<<8)+((255&g)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new t.Buf16(320),this.work=new t.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function j(g){var N;return g&&g.state?(N=g.state,g.total_in=g.total_out=N.total=0,g.msg="",N.wrap&&(g.adler=1&N.wrap),N.mode=x,N.last=0,N.havedict=0,N.dmax=32768,N.head=null,N.hold=0,N.bits=0,N.lencode=N.lendyn=new t.Buf32(d),N.distcode=N.distdyn=new t.Buf32(f),N.sane=1,N.back=-1,C):u}function E(g){var N;return g&&g.state?((N=g.state).wsize=0,N.whave=0,N.wnext=0,j(g)):u}function S(g,N){var c,F;return g&&g.state?(F=g.state,N<0?(c=0,N=-N):(c=1+(N>>4),N<48&&(N&=15)),N&&(N<8||15<N)?u:(F.window!==null&&F.wbits!==N&&(F.window=null),F.wrap=c,F.wbits=N,E(g))):u}function z(g,N){var c,F;return g?(F=new v,(g.state=F).window=null,(c=S(g,N))!==C&&(g.state=null),c):u}var R,L,I=!0;function M(g){if(I){var N;for(R=new t.Buf32(512),L=new t.Buf32(32),N=0;N<144;)g.lens[N++]=8;for(;N<256;)g.lens[N++]=9;for(;N<280;)g.lens[N++]=7;for(;N<288;)g.lens[N++]=8;for(m(_,g.lens,0,288,R,0,g.work,{bits:9}),N=0;N<32;)g.lens[N++]=5;m(b,g.lens,0,32,L,0,g.work,{bits:5}),I=!1}g.lencode=R,g.lenbits=9,g.distcode=L,g.distbits=5}function Z(g,N,c,F){var X,W=g.state;return W.window===null&&(W.wsize=1<<W.wbits,W.wnext=0,W.whave=0,W.window=new t.Buf8(W.wsize)),F>=W.wsize?(t.arraySet(W.window,N,c-W.wsize,W.wsize,0),W.wnext=0,W.whave=W.wsize):(F<(X=W.wsize-W.wnext)&&(X=F),t.arraySet(W.window,N,c-F,X,W.wnext),(F-=X)?(t.arraySet(W.window,N,c-F,F,0),W.wnext=F,W.whave=W.wsize):(W.wnext+=X,W.wnext===W.wsize&&(W.wnext=0),W.whave<W.wsize&&(W.whave+=X))),0}r.inflateReset=E,r.inflateReset2=S,r.inflateResetKeep=j,r.inflateInit=function(g){return z(g,15)},r.inflateInit2=z,r.inflate=function(g,N){var c,F,X,W,re,V,J,A,T,Q,K,$,ae,ce,ne,ie,he,le,_e,ye,i,P,B,k,y=0,D=new t.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!g||!g.state||!g.output||!g.input&&g.avail_in!==0)return u;(c=g.state).mode===12&&(c.mode=13),re=g.next_out,X=g.output,J=g.avail_out,W=g.next_in,F=g.input,V=g.avail_in,A=c.hold,T=c.bits,Q=V,K=J,P=C;e:for(;;)switch(c.mode){case x:if(c.wrap===0){c.mode=13;break}for(;T<16;){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}if(2&c.wrap&&A===35615){D[c.check=0]=255&A,D[1]=A>>>8&255,c.check=o(c.check,D,2,0),T=A=0,c.mode=2;break}if(c.flags=0,c.head&&(c.head.done=!1),!(1&c.wrap)||(((255&A)<<8)+(A>>8))%31){g.msg="incorrect header check",c.mode=30;break}if((15&A)!=8){g.msg="unknown compression method",c.mode=30;break}if(T-=4,i=8+(15&(A>>>=4)),c.wbits===0)c.wbits=i;else if(i>c.wbits){g.msg="invalid window size",c.mode=30;break}c.dmax=1<<i,g.adler=c.check=1,c.mode=512&A?10:12,T=A=0;break;case 2:for(;T<16;){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}if(c.flags=A,(255&c.flags)!=8){g.msg="unknown compression method",c.mode=30;break}if(57344&c.flags){g.msg="unknown header flags set",c.mode=30;break}c.head&&(c.head.text=A>>8&1),512&c.flags&&(D[0]=255&A,D[1]=A>>>8&255,c.check=o(c.check,D,2,0)),T=A=0,c.mode=3;case 3:for(;T<32;){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}c.head&&(c.head.time=A),512&c.flags&&(D[0]=255&A,D[1]=A>>>8&255,D[2]=A>>>16&255,D[3]=A>>>24&255,c.check=o(c.check,D,4,0)),T=A=0,c.mode=4;case 4:for(;T<16;){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}c.head&&(c.head.xflags=255&A,c.head.os=A>>8),512&c.flags&&(D[0]=255&A,D[1]=A>>>8&255,c.check=o(c.check,D,2,0)),T=A=0,c.mode=5;case 5:if(1024&c.flags){for(;T<16;){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}c.length=A,c.head&&(c.head.extra_len=A),512&c.flags&&(D[0]=255&A,D[1]=A>>>8&255,c.check=o(c.check,D,2,0)),T=A=0}else c.head&&(c.head.extra=null);c.mode=6;case 6:if(1024&c.flags&&(V<($=c.length)&&($=V),$&&(c.head&&(i=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Array(c.head.extra_len)),t.arraySet(c.head.extra,F,W,$,i)),512&c.flags&&(c.check=o(c.check,F,$,W)),V-=$,W+=$,c.length-=$),c.length))break e;c.length=0,c.mode=7;case 7:if(2048&c.flags){if(V===0)break e;for($=0;i=F[W+$++],c.head&&i&&c.length<65536&&(c.head.name+=String.fromCharCode(i)),i&&$<V;);if(512&c.flags&&(c.check=o(c.check,F,$,W)),V-=$,W+=$,i)break e}else c.head&&(c.head.name=null);c.length=0,c.mode=8;case 8:if(4096&c.flags){if(V===0)break e;for($=0;i=F[W+$++],c.head&&i&&c.length<65536&&(c.head.comment+=String.fromCharCode(i)),i&&$<V;);if(512&c.flags&&(c.check=o(c.check,F,$,W)),V-=$,W+=$,i)break e}else c.head&&(c.head.comment=null);c.mode=9;case 9:if(512&c.flags){for(;T<16;){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}if(A!==(65535&c.check)){g.msg="header crc mismatch",c.mode=30;break}T=A=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),g.adler=c.check=0,c.mode=12;break;case 10:for(;T<32;){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}g.adler=c.check=h(A),T=A=0,c.mode=11;case 11:if(c.havedict===0)return g.next_out=re,g.avail_out=J,g.next_in=W,g.avail_in=V,c.hold=A,c.bits=T,2;g.adler=c.check=1,c.mode=12;case 12:if(N===5||N===6)break e;case 13:if(c.last){A>>>=7&T,T-=7&T,c.mode=27;break}for(;T<3;){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}switch(c.last=1&A,T-=1,3&(A>>>=1)){case 0:c.mode=14;break;case 1:if(M(c),c.mode=20,N!==6)break;A>>>=2,T-=2;break e;case 2:c.mode=17;break;case 3:g.msg="invalid block type",c.mode=30}A>>>=2,T-=2;break;case 14:for(A>>>=7&T,T-=7&T;T<32;){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}if((65535&A)!=(A>>>16^65535)){g.msg="invalid stored block lengths",c.mode=30;break}if(c.length=65535&A,T=A=0,c.mode=15,N===6)break e;case 15:c.mode=16;case 16:if($=c.length){if(V<$&&($=V),J<$&&($=J),$===0)break e;t.arraySet(X,F,W,$,re),V-=$,W+=$,J-=$,re+=$,c.length-=$;break}c.mode=12;break;case 17:for(;T<14;){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}if(c.nlen=257+(31&A),A>>>=5,T-=5,c.ndist=1+(31&A),A>>>=5,T-=5,c.ncode=4+(15&A),A>>>=4,T-=4,286<c.nlen||30<c.ndist){g.msg="too many length or distance symbols",c.mode=30;break}c.have=0,c.mode=18;case 18:for(;c.have<c.ncode;){for(;T<3;){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}c.lens[U[c.have++]]=7&A,A>>>=3,T-=3}for(;c.have<19;)c.lens[U[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,B={bits:c.lenbits},P=m(0,c.lens,0,19,c.lencode,0,c.work,B),c.lenbits=B.bits,P){g.msg="invalid code lengths set",c.mode=30;break}c.have=0,c.mode=19;case 19:for(;c.have<c.nlen+c.ndist;){for(;ie=(y=c.lencode[A&(1<<c.lenbits)-1])>>>16&255,he=65535&y,!((ne=y>>>24)<=T);){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}if(he<16)A>>>=ne,T-=ne,c.lens[c.have++]=he;else{if(he===16){for(k=ne+2;T<k;){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}if(A>>>=ne,T-=ne,c.have===0){g.msg="invalid bit length repeat",c.mode=30;break}i=c.lens[c.have-1],$=3+(3&A),A>>>=2,T-=2}else if(he===17){for(k=ne+3;T<k;){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}T-=ne,i=0,$=3+(7&(A>>>=ne)),A>>>=3,T-=3}else{for(k=ne+7;T<k;){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}T-=ne,i=0,$=11+(127&(A>>>=ne)),A>>>=7,T-=7}if(c.have+$>c.nlen+c.ndist){g.msg="invalid bit length repeat",c.mode=30;break}for(;$--;)c.lens[c.have++]=i}}if(c.mode===30)break;if(c.lens[256]===0){g.msg="invalid code -- missing end-of-block",c.mode=30;break}if(c.lenbits=9,B={bits:c.lenbits},P=m(_,c.lens,0,c.nlen,c.lencode,0,c.work,B),c.lenbits=B.bits,P){g.msg="invalid literal/lengths set",c.mode=30;break}if(c.distbits=6,c.distcode=c.distdyn,B={bits:c.distbits},P=m(b,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,B),c.distbits=B.bits,P){g.msg="invalid distances set",c.mode=30;break}if(c.mode=20,N===6)break e;case 20:c.mode=21;case 21:if(6<=V&&258<=J){g.next_out=re,g.avail_out=J,g.next_in=W,g.avail_in=V,c.hold=A,c.bits=T,l(g,K),re=g.next_out,X=g.output,J=g.avail_out,W=g.next_in,F=g.input,V=g.avail_in,A=c.hold,T=c.bits,c.mode===12&&(c.back=-1);break}for(c.back=0;ie=(y=c.lencode[A&(1<<c.lenbits)-1])>>>16&255,he=65535&y,!((ne=y>>>24)<=T);){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}if(ie&&!(240&ie)){for(le=ne,_e=ie,ye=he;ie=(y=c.lencode[ye+((A&(1<<le+_e)-1)>>le)])>>>16&255,he=65535&y,!(le+(ne=y>>>24)<=T);){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}A>>>=le,T-=le,c.back+=le}if(A>>>=ne,T-=ne,c.back+=ne,c.length=he,ie===0){c.mode=26;break}if(32&ie){c.back=-1,c.mode=12;break}if(64&ie){g.msg="invalid literal/length code",c.mode=30;break}c.extra=15&ie,c.mode=22;case 22:if(c.extra){for(k=c.extra;T<k;){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}c.length+=A&(1<<c.extra)-1,A>>>=c.extra,T-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=23;case 23:for(;ie=(y=c.distcode[A&(1<<c.distbits)-1])>>>16&255,he=65535&y,!((ne=y>>>24)<=T);){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}if(!(240&ie)){for(le=ne,_e=ie,ye=he;ie=(y=c.distcode[ye+((A&(1<<le+_e)-1)>>le)])>>>16&255,he=65535&y,!(le+(ne=y>>>24)<=T);){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}A>>>=le,T-=le,c.back+=le}if(A>>>=ne,T-=ne,c.back+=ne,64&ie){g.msg="invalid distance code",c.mode=30;break}c.offset=he,c.extra=15&ie,c.mode=24;case 24:if(c.extra){for(k=c.extra;T<k;){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}c.offset+=A&(1<<c.extra)-1,A>>>=c.extra,T-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){g.msg="invalid distance too far back",c.mode=30;break}c.mode=25;case 25:if(J===0)break e;if($=K-J,c.offset>$){if(($=c.offset-$)>c.whave&&c.sane){g.msg="invalid distance too far back",c.mode=30;break}ae=$>c.wnext?($-=c.wnext,c.wsize-$):c.wnext-$,$>c.length&&($=c.length),ce=c.window}else ce=X,ae=re-c.offset,$=c.length;for(J<$&&($=J),J-=$,c.length-=$;X[re++]=ce[ae++],--$;);c.length===0&&(c.mode=21);break;case 26:if(J===0)break e;X[re++]=c.length,J--,c.mode=21;break;case 27:if(c.wrap){for(;T<32;){if(V===0)break e;V--,A|=F[W++]<<T,T+=8}if(K-=J,g.total_out+=K,c.total+=K,K&&(g.adler=c.check=c.flags?o(c.check,X,K,re-K):a(c.check,X,K,re-K)),K=J,(c.flags?A:h(A))!==c.check){g.msg="incorrect data check",c.mode=30;break}T=A=0}c.mode=28;case 28:if(c.wrap&&c.flags){for(;T<32;){if(V===0)break e;V--,A+=F[W++]<<T,T+=8}if(A!==(4294967295&c.total)){g.msg="incorrect length check",c.mode=30;break}T=A=0}c.mode=29;case 29:P=1;break e;case 30:P=-3;break e;case 31:return-4;case 32:default:return u}return g.next_out=re,g.avail_out=J,g.next_in=W,g.avail_in=V,c.hold=A,c.bits=T,(c.wsize||K!==g.avail_out&&c.mode<30&&(c.mode<27||N!==4))&&Z(g,g.output,g.next_out,K-g.avail_out)?(c.mode=31,-4):(Q-=g.avail_in,K-=g.avail_out,g.total_in+=Q,g.total_out+=K,c.total+=K,c.wrap&&K&&(g.adler=c.check=c.flags?o(c.check,X,K,g.next_out-K):a(c.check,X,K,g.next_out-K)),g.data_type=c.bits+(c.last?64:0)+(c.mode===12?128:0)+(c.mode===20||c.mode===15?256:0),(Q==0&&K===0||N===4)&&P===C&&(P=-5),P)},r.inflateEnd=function(g){if(!g||!g.state)return u;var N=g.state;return N.window&&(N.window=null),g.state=null,C},r.inflateGetHeader=function(g,N){var c;return g&&g.state&&2&(c=g.state).wrap?((c.head=N).done=!1,C):u},r.inflateSetDictionary=function(g,N){var c,F=N.length;return g&&g.state?(c=g.state).wrap!==0&&c.mode!==11?u:c.mode===11&&a(1,N,F,0)!==c.check?-3:Z(g,N,F,F)?(c.mode=31,-4):(c.havedict=1,C):u},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,n,r){var t=e("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],m=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(_,b,C,u,x,d,f,h){var v,j,E,S,z,R,L,I,M,Z=h.bits,g=0,N=0,c=0,F=0,X=0,W=0,re=0,V=0,J=0,A=0,T=null,Q=0,K=new t.Buf16(16),$=new t.Buf16(16),ae=null,ce=0;for(g=0;g<=15;g++)K[g]=0;for(N=0;N<u;N++)K[b[C+N]]++;for(X=Z,F=15;1<=F&&K[F]===0;F--);if(F<X&&(X=F),F===0)return x[d++]=20971520,x[d++]=20971520,h.bits=1,0;for(c=1;c<F&&K[c]===0;c++);for(X<c&&(X=c),g=V=1;g<=15;g++)if(V<<=1,(V-=K[g])<0)return-1;if(0<V&&(_===0||F!==1))return-1;for($[1]=0,g=1;g<15;g++)$[g+1]=$[g]+K[g];for(N=0;N<u;N++)b[C+N]!==0&&(f[$[b[C+N]]++]=N);if(R=_===0?(T=ae=f,19):_===1?(T=a,Q-=257,ae=o,ce-=257,256):(T=l,ae=m,-1),g=c,z=d,re=N=A=0,E=-1,S=(J=1<<(W=X))-1,_===1&&852<J||_===2&&592<J)return 1;for(;;){for(L=g-re,M=f[N]<R?(I=0,f[N]):f[N]>R?(I=ae[ce+f[N]],T[Q+f[N]]):(I=96,0),v=1<<g-re,c=j=1<<W;x[z+(A>>re)+(j-=v)]=L<<24|I<<16|M|0,j!==0;);for(v=1<<g-1;A&v;)v>>=1;if(v!==0?(A&=v-1,A+=v):A=0,N++,--K[g]==0){if(g===F)break;g=b[C+f[N]]}if(X<g&&(A&S)!==E){for(re===0&&(re=X),z+=c,V=1<<(W=g-re);W+re<F&&!((V-=K[W+re])<=0);)W++,V<<=1;if(J+=1<<W,_===1&&852<J||_===2&&592<J)return 1;x[E=A&S]=X<<24|W<<16|z-d|0}}return A!==0&&(x[z+A]=g-re<<24|64<<16|0),h.bits=X,0}},{"../utils/common":41}],51:[function(e,n,r){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,n,r){var t=e("../utils/common"),a=0,o=1;function l(y){for(var D=y.length;0<=--D;)y[D]=0}var m=0,_=29,b=256,C=b+1+_,u=30,x=19,d=2*C+1,f=15,h=16,v=7,j=256,E=16,S=17,z=18,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],L=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Z=new Array(2*(C+2));l(Z);var g=new Array(2*u);l(g);var N=new Array(512);l(N);var c=new Array(256);l(c);var F=new Array(_);l(F);var X,W,re,V=new Array(u);function J(y,D,U,G,O){this.static_tree=y,this.extra_bits=D,this.extra_base=U,this.elems=G,this.max_length=O,this.has_stree=y&&y.length}function A(y,D){this.dyn_tree=y,this.max_code=0,this.stat_desc=D}function T(y){return y<256?N[y]:N[256+(y>>>7)]}function Q(y,D){y.pending_buf[y.pending++]=255&D,y.pending_buf[y.pending++]=D>>>8&255}function K(y,D,U){y.bi_valid>h-U?(y.bi_buf|=D<<y.bi_valid&65535,Q(y,y.bi_buf),y.bi_buf=D>>h-y.bi_valid,y.bi_valid+=U-h):(y.bi_buf|=D<<y.bi_valid&65535,y.bi_valid+=U)}function $(y,D,U){K(y,U[2*D],U[2*D+1])}function ae(y,D){for(var U=0;U|=1&y,y>>>=1,U<<=1,0<--D;);return U>>>1}function ce(y,D,U){var G,O,H=new Array(f+1),q=0;for(G=1;G<=f;G++)H[G]=q=q+U[G-1]<<1;for(O=0;O<=D;O++){var Y=y[2*O+1];Y!==0&&(y[2*O]=ae(H[Y]++,Y))}}function ne(y){var D;for(D=0;D<C;D++)y.dyn_ltree[2*D]=0;for(D=0;D<u;D++)y.dyn_dtree[2*D]=0;for(D=0;D<x;D++)y.bl_tree[2*D]=0;y.dyn_ltree[2*j]=1,y.opt_len=y.static_len=0,y.last_lit=y.matches=0}function ie(y){8<y.bi_valid?Q(y,y.bi_buf):0<y.bi_valid&&(y.pending_buf[y.pending++]=y.bi_buf),y.bi_buf=0,y.bi_valid=0}function he(y,D,U,G){var O=2*D,H=2*U;return y[O]<y[H]||y[O]===y[H]&&G[D]<=G[U]}function le(y,D,U){for(var G=y.heap[U],O=U<<1;O<=y.heap_len&&(O<y.heap_len&&he(D,y.heap[O+1],y.heap[O],y.depth)&&O++,!he(D,G,y.heap[O],y.depth));)y.heap[U]=y.heap[O],U=O,O<<=1;y.heap[U]=G}function _e(y,D,U){var G,O,H,q,Y=0;if(y.last_lit!==0)for(;G=y.pending_buf[y.d_buf+2*Y]<<8|y.pending_buf[y.d_buf+2*Y+1],O=y.pending_buf[y.l_buf+Y],Y++,G===0?$(y,O,D):($(y,(H=c[O])+b+1,D),(q=R[H])!==0&&K(y,O-=F[H],q),$(y,H=T(--G),U),(q=L[H])!==0&&K(y,G-=V[H],q)),Y<y.last_lit;);$(y,j,D)}function ye(y,D){var U,G,O,H=D.dyn_tree,q=D.stat_desc.static_tree,Y=D.stat_desc.has_stree,ee=D.stat_desc.elems,oe=-1;for(y.heap_len=0,y.heap_max=d,U=0;U<ee;U++)H[2*U]!==0?(y.heap[++y.heap_len]=oe=U,y.depth[U]=0):H[2*U+1]=0;for(;y.heap_len<2;)H[2*(O=y.heap[++y.heap_len]=oe<2?++oe:0)]=1,y.depth[O]=0,y.opt_len--,Y&&(y.static_len-=q[2*O+1]);for(D.max_code=oe,U=y.heap_len>>1;1<=U;U--)le(y,H,U);for(O=ee;U=y.heap[1],y.heap[1]=y.heap[y.heap_len--],le(y,H,1),G=y.heap[1],y.heap[--y.heap_max]=U,y.heap[--y.heap_max]=G,H[2*O]=H[2*U]+H[2*G],y.depth[O]=(y.depth[U]>=y.depth[G]?y.depth[U]:y.depth[G])+1,H[2*U+1]=H[2*G+1]=O,y.heap[1]=O++,le(y,H,1),2<=y.heap_len;);y.heap[--y.heap_max]=y.heap[1],function(se,ge){var De,Ce,ze,de,Ne,Ze,Se=ge.dyn_tree,nt=ge.max_code,yt=ge.stat_desc.static_tree,vt=ge.stat_desc.has_stree,wt=ge.stat_desc.extra_bits,st=ge.stat_desc.extra_base,Re=ge.stat_desc.max_length,Oe=0;for(de=0;de<=f;de++)se.bl_count[de]=0;for(Se[2*se.heap[se.heap_max]+1]=0,De=se.heap_max+1;De<d;De++)Re<(de=Se[2*Se[2*(Ce=se.heap[De])+1]+1]+1)&&(de=Re,Oe++),Se[2*Ce+1]=de,nt<Ce||(se.bl_count[de]++,Ne=0,st<=Ce&&(Ne=wt[Ce-st]),Ze=Se[2*Ce],se.opt_len+=Ze*(de+Ne),vt&&(se.static_len+=Ze*(yt[2*Ce+1]+Ne)));if(Oe!==0){do{for(de=Re-1;se.bl_count[de]===0;)de--;se.bl_count[de]--,se.bl_count[de+1]+=2,se.bl_count[Re]--,Oe-=2}while(0<Oe);for(de=Re;de!==0;de--)for(Ce=se.bl_count[de];Ce!==0;)nt<(ze=se.heap[--De])||(Se[2*ze+1]!==de&&(se.opt_len+=(de-Se[2*ze+1])*Se[2*ze],Se[2*ze+1]=de),Ce--)}}(y,D),ce(H,oe,y.bl_count)}function i(y,D,U){var G,O,H=-1,q=D[1],Y=0,ee=7,oe=4;for(q===0&&(ee=138,oe=3),D[2*(U+1)+1]=65535,G=0;G<=U;G++)O=q,q=D[2*(G+1)+1],++Y<ee&&O===q||(Y<oe?y.bl_tree[2*O]+=Y:O!==0?(O!==H&&y.bl_tree[2*O]++,y.bl_tree[2*E]++):Y<=10?y.bl_tree[2*S]++:y.bl_tree[2*z]++,H=O,oe=(Y=0)===q?(ee=138,3):O===q?(ee=6,3):(ee=7,4))}function P(y,D,U){var G,O,H=-1,q=D[1],Y=0,ee=7,oe=4;for(q===0&&(ee=138,oe=3),G=0;G<=U;G++)if(O=q,q=D[2*(G+1)+1],!(++Y<ee&&O===q)){if(Y<oe)for(;$(y,O,y.bl_tree),--Y!=0;);else O!==0?(O!==H&&($(y,O,y.bl_tree),Y--),$(y,E,y.bl_tree),K(y,Y-3,2)):Y<=10?($(y,S,y.bl_tree),K(y,Y-3,3)):($(y,z,y.bl_tree),K(y,Y-11,7));H=O,oe=(Y=0)===q?(ee=138,3):O===q?(ee=6,3):(ee=7,4)}}l(V);var B=!1;function k(y,D,U,G){K(y,(m<<1)+(G?1:0),3),function(O,H,q,Y){ie(O),Q(O,q),Q(O,~q),t.arraySet(O.pending_buf,O.window,H,q,O.pending),O.pending+=q}(y,D,U)}r._tr_init=function(y){B||(function(){var D,U,G,O,H,q=new Array(f+1);for(O=G=0;O<_-1;O++)for(F[O]=G,D=0;D<1<<R[O];D++)c[G++]=O;for(c[G-1]=O,O=H=0;O<16;O++)for(V[O]=H,D=0;D<1<<L[O];D++)N[H++]=O;for(H>>=7;O<u;O++)for(V[O]=H<<7,D=0;D<1<<L[O]-7;D++)N[256+H++]=O;for(U=0;U<=f;U++)q[U]=0;for(D=0;D<=143;)Z[2*D+1]=8,D++,q[8]++;for(;D<=255;)Z[2*D+1]=9,D++,q[9]++;for(;D<=279;)Z[2*D+1]=7,D++,q[7]++;for(;D<=287;)Z[2*D+1]=8,D++,q[8]++;for(ce(Z,C+1,q),D=0;D<u;D++)g[2*D+1]=5,g[2*D]=ae(D,5);X=new J(Z,R,b+1,C,f),W=new J(g,L,0,u,f),re=new J(new Array(0),I,0,x,v)}(),B=!0),y.l_desc=new A(y.dyn_ltree,X),y.d_desc=new A(y.dyn_dtree,W),y.bl_desc=new A(y.bl_tree,re),y.bi_buf=0,y.bi_valid=0,ne(y)},r._tr_stored_block=k,r._tr_flush_block=function(y,D,U,G){var O,H,q=0;0<y.level?(y.strm.data_type===2&&(y.strm.data_type=function(Y){var ee,oe=4093624447;for(ee=0;ee<=31;ee++,oe>>>=1)if(1&oe&&Y.dyn_ltree[2*ee]!==0)return a;if(Y.dyn_ltree[18]!==0||Y.dyn_ltree[20]!==0||Y.dyn_ltree[26]!==0)return o;for(ee=32;ee<b;ee++)if(Y.dyn_ltree[2*ee]!==0)return o;return a}(y)),ye(y,y.l_desc),ye(y,y.d_desc),q=function(Y){var ee;for(i(Y,Y.dyn_ltree,Y.l_desc.max_code),i(Y,Y.dyn_dtree,Y.d_desc.max_code),ye(Y,Y.bl_desc),ee=x-1;3<=ee&&Y.bl_tree[2*M[ee]+1]===0;ee--);return Y.opt_len+=3*(ee+1)+5+5+4,ee}(y),O=y.opt_len+3+7>>>3,(H=y.static_len+3+7>>>3)<=O&&(O=H)):O=H=U+5,U+4<=O&&D!==-1?k(y,D,U,G):y.strategy===4||H===O?(K(y,2+(G?1:0),3),_e(y,Z,g)):(K(y,4+(G?1:0),3),function(Y,ee,oe,se){var ge;for(K(Y,ee-257,5),K(Y,oe-1,5),K(Y,se-4,4),ge=0;ge<se;ge++)K(Y,Y.bl_tree[2*M[ge]+1],3);P(Y,Y.dyn_ltree,ee-1),P(Y,Y.dyn_dtree,oe-1)}(y,y.l_desc.max_code+1,y.d_desc.max_code+1,q+1),_e(y,y.dyn_ltree,y.dyn_dtree)),ne(y),G&&ie(y)},r._tr_tally=function(y,D,U){return y.pending_buf[y.d_buf+2*y.last_lit]=D>>>8&255,y.pending_buf[y.d_buf+2*y.last_lit+1]=255&D,y.pending_buf[y.l_buf+y.last_lit]=255&U,y.last_lit++,D===0?y.dyn_ltree[2*U]++:(y.matches++,D--,y.dyn_ltree[2*(c[U]+b+1)]++,y.dyn_dtree[2*T(D)]++),y.last_lit===y.lit_bufsize-1},r._tr_align=function(y){K(y,2,3),$(y,j,Z),function(D){D.bi_valid===16?(Q(D,D.bi_buf),D.bi_buf=0,D.bi_valid=0):8<=D.bi_valid&&(D.pending_buf[D.pending++]=255&D.bi_buf,D.bi_buf>>=8,D.bi_valid-=8)}(y)}},{"../utils/common":41}],53:[function(e,n,r){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,n,r){(function(t){(function(a,o){if(!a.setImmediate){var l,m,_,b,C=1,u={},x=!1,d=a.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(a);f=f&&f.setTimeout?f:a,l={}.toString.call(a.process)==="[object process]"?function(E){process.nextTick(function(){v(E)})}:function(){if(a.postMessage&&!a.importScripts){var E=!0,S=a.onmessage;return a.onmessage=function(){E=!1},a.postMessage("","*"),a.onmessage=S,E}}()?(b="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",j,!1):a.attachEvent("onmessage",j),function(E){a.postMessage(b+E,"*")}):a.MessageChannel?((_=new MessageChannel).port1.onmessage=function(E){v(E.data)},function(E){_.port2.postMessage(E)}):d&&"onreadystatechange"in d.createElement("script")?(m=d.documentElement,function(E){var S=d.createElement("script");S.onreadystatechange=function(){v(E),S.onreadystatechange=null,m.removeChild(S),S=null},m.appendChild(S)}):function(E){setTimeout(v,0,E)},f.setImmediate=function(E){typeof E!="function"&&(E=new Function(""+E));for(var S=new Array(arguments.length-1),z=0;z<S.length;z++)S[z]=arguments[z+1];var R={callback:E,args:S};return u[C]=R,l(C),C++},f.clearImmediate=h}function h(E){delete u[E]}function v(E){if(x)setTimeout(v,0,E);else{var S=u[E];if(S){x=!0;try{(function(z){var R=z.callback,L=z.args;switch(L.length){case 0:R();break;case 1:R(L[0]);break;case 2:R(L[0],L[1]);break;case 3:R(L[0],L[1],L[2]);break;default:R.apply(o,L)}})(S)}finally{h(E),x=!1}}}}function j(E){E.source===a&&typeof E.data=="string"&&E.data.indexOf(b)===0&&v(+E.data.slice(b.length))}})(typeof self>"u"?t===void 0?this:t:self)}).call(this,typeof Ae<"u"?Ae:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(xt);var xr=xt.exports;const br=St(xr);class yr{async exportToPDF(s,e){const n=this.getPageSize(e.pageSize),r=this.getOrientation(s,e.orientation),t=new Dt({orientation:r,unit:"mm",format:e.pageSize==="original"?[n.width,n.height]:e.pageSize});e.metadata&&(e.metadata.title&&t.setProperties({title:e.metadata.title}),e.metadata.author&&t.setProperties({author:e.metadata.author}),e.metadata.subject&&t.setProperties({subject:e.metadata.subject}));for(let a=0;a<s.pages.length;a++){const o=s.pages[a];a>0&&t.addPage();const l=await this.blobToDataURL(o.processedImage),m=t.internal.pageSize.getWidth(),_=t.internal.pageSize.getHeight();if(e.pageSize==="original"){const b=o.dimensions.width,C=o.dimensions.height,u=b/C;let x=m,d=m/u;d>_&&(d=_,x=_*u);const f=(m-x)/2,h=(_-d)/2;t.addImage(l,"JPEG",f,h,x,d)}else t.addImage(l,"JPEG",0,0,m,_);e.includeOCR&&o.ocrResult&&this.addTextLayer(t,o,m,_)}return t.output("blob")}async exportToImage(s,e){const n=document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("Failed to get canvas context");const t=await this.blobToImageData(s.processedImage);let a=t.width,o=t.height;if(e.maxDimension){const _=Math.max(a,o);if(_>e.maxDimension){const b=e.maxDimension/_;a=Math.round(a*b),o=Math.round(o*b)}}n.width=a,n.height=o;const l=document.createElement("canvas"),m=l.getContext("2d");if(!m)throw new Error("Failed to get temp canvas context");return l.width=t.width,l.height=t.height,m.putImageData(t,0,0),r.drawImage(l,0,0,a,o),new Promise((_,b)=>{n.toBlob(C=>{C?_(C):b(new Error("Failed to convert canvas to blob"))},e.format==="png"?"image/png":"image/jpeg",e.format==="jpeg"?e.quality/100:void 0)})}async exportMultipleImages(s,e){const n=[];for(const r of s.pages){const t=await this.exportToImage(r,e);n.push(t)}return n}async exportToText(s){const e=[];for(const r of s.pages)r.ocrResult&&e.push(`--- Page ${r.pageNumber} ---

${r.ocrResult.text}

`);if(e.length===0)throw new Error("No OCR text available in this document");const n=e.join(`
`);return new Blob([n],{type:"text/plain"})}downloadBlob(s,e){const n=URL.createObjectURL(s),r=document.createElement("a");r.href=n,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}async share(s,e,n){if(!navigator.share||!navigator.canShare)throw new Error("Web Share API not supported");const r=new File([s],e,{type:s.type});if(!navigator.canShare({files:[r]}))throw new Error("Cannot share this file type");await navigator.share({title:n,files:[r]})}async blobToDataURL(s){return new Promise((e,n)=>{const r=new FileReader;r.onloadend=()=>e(r.result),r.onerror=n,r.readAsDataURL(s)})}async blobToImageData(s){return new Promise((e,n)=>{const r=new Image;r.onload=()=>{const t=document.createElement("canvas"),a=t.getContext("2d");if(!a){n(new Error("Failed to get canvas context"));return}t.width=r.width,t.height=r.height,a.drawImage(r,0,0);const o=a.getImageData(0,0,r.width,r.height);e(o)},r.onerror=n,r.src=URL.createObjectURL(s)})}getPageSize(s){switch(s){case"a4":return{width:210,height:297};case"letter":return{width:216,height:279};case"legal":return{width:216,height:356};default:return{width:210,height:297}}}getOrientation(s,e){if(e!=="auto")return e;const n=s.pages[0];return n&&n.dimensions.width>n.dimensions.height?"landscape":"portrait"}addTextLayer(s,e,n,r){if(!e.ocrResult)return;const t=n/e.dimensions.width,a=r/e.dimensions.height;s.setTextColor(255,255,255),s.setFontSize(8);for(const o of e.ocrResult.words){const l=o.boundingBox.x*t,m=o.boundingBox.y*a;s.text(o.text,l,m,{renderingMode:"invisible"})}}}let Ye=null;function bt(){return Ye||(Ye=new yr),Ye}class vr{constructor(){pe(this,"exportService",bt())}async exportDocumentsAsZip(s,e,n){if(s.length===0)throw new Error("No documents selected for export");const r=new br;for(let t=0;t<s.length;t++){const a=s[t];n&&n({current:t+1,total:s.length,currentDocumentName:a.name});const o=this.sanitizeFilename(a.name);if(e.format==="pdf"){const l=await this.exportService.exportToPDF(a,e.pdfOptions||this.getDefaultPDFOptions());r.file(`${o}.pdf`,l)}else{const l=await this.exportService.exportMultipleImages(a,e.imageOptions||this.getDefaultImageOptions());if(l.length>1){const m=r.folder(o);m&&l.forEach((_,b)=>{const C=e.imageOptions?.format==="jpeg"?"jpg":"png";m.file(`page_${b+1}.${C}`,_)})}else if(l.length===1){const m=e.imageOptions?.format==="jpeg"?"jpg":"png";r.file(`${o}.${m}`,l[0])}}}return await r.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:6}})}async exportSelectedDocuments(s,e,n,r){const t=e.filter(a=>s.includes(a.id));return this.exportDocumentsAsZip(t,n,r)}getDefaultPDFOptions(){return{pageSize:"a4",orientation:"auto",quality:"high",includeOCR:!1,compression:!0}}getDefaultImageOptions(){return{format:"png",quality:90}}sanitizeFilename(s){return s.replace(/[^a-z0-9_\-\s]/gi,"_").replace(/\s+/g,"_").substring(0,100)}generateZipFilename(s,e){const n=new Date().toISOString().split("T")[0];return`documents_${s}_${e==="pdf"?"PDFs":"Images"}_${n}.zip`}}let Ke=null;function wr(){return Ke||(Ke=new vr),Ke}const _r=()=>{const{documents:w,selectedDocumentIds:s,setDocuments:e,setCurrentDocument:n,removeDocument:r,toggleDocumentSelection:t,clearDocumentSelection:a,selectAllDocuments:o,setCurrentView:l,addToast:m}=be(g=>({documents:g.documents.list,selectedDocumentIds:g.documents.selectedDocumentIds,setDocuments:g.setDocuments,setCurrentDocument:g.setCurrentDocument,removeDocument:g.removeDocument,toggleDocumentSelection:g.toggleDocumentSelection,clearDocumentSelection:g.clearDocumentSelection,selectAllDocuments:g.selectAllDocuments,setCurrentView:g.setCurrentView,addToast:g.addToast})),[_,b]=te.useState(!0),[C,u]=te.useState(new Map),[x,d]=te.useState(!1),[f,h]=te.useState(!1),[v,j]=te.useState({current:0,total:0});te.useEffect(()=>{E()},[]),te.useEffect(()=>{w.length>0&&S()},[w]);const E=async()=>{try{const N=await(await Ue()).listDocuments({sortBy:"updatedAt",sortOrder:"desc"});e(N)}catch(g){console.error("Failed to load documents:",g),m({type:"error",message:"Failed to load documents"})}finally{b(!1)}},S=async()=>{const g=new Map;for(const N of w)if(N.pages.length>0){const c=N.pages[0],F=URL.createObjectURL(c.thumbnailImage);g.set(N.id,F)}return u(g),()=>{C.forEach(N=>URL.revokeObjectURL(N))}},z=g=>{x?t(g.id):(n(g),l("export"))},R=()=>{x&&a(),d(!x)},L=()=>{s.length===w.length?a():o()},I=async g=>{if(s.length===0){m({type:"error",message:"No documents selected"});return}try{h(!0),j({current:0,total:s.length});const N=wr(),c=w.filter(A=>s.includes(A.id)),F={pageSize:"a4",orientation:"auto",quality:"high",includeOCR:!1,compression:!0},X={format:"png",quality:90},W=await N.exportDocumentsAsZip(c,{format:g,pdfOptions:F,imageOptions:X},A=>{j({current:A.current,total:A.total})}),re=N.generateZipFilename(s.length,g),V=URL.createObjectURL(W),J=document.createElement("a");J.href=V,J.download=re,document.body.appendChild(J),J.click(),document.body.removeChild(J),URL.revokeObjectURL(V),m({type:"success",message:`Successfully exported ${s.length} document${s.length!==1?"s":""}`}),d(!1),a()}catch(N){console.error("Bulk export failed:",N),m({type:"error",message:"Failed to export documents"})}finally{h(!1),j({current:0,total:0})}},M=async(g,N)=>{if(g.stopPropagation(),!!confirm("Are you sure you want to delete this document?"))try{await(await Ue()).deleteDocument(N),r(N),m({type:"success",message:"Document deleted"})}catch(c){console.error("Failed to delete document:",c),m({type:"error",message:"Failed to delete document"})}},Z=async(g,N)=>{g.stopPropagation(),n(N),l("ocr")};return _?p.jsx("div",{className:"flex items-center justify-center h-full bg-gray-50",children:p.jsxs("div",{className:"text-center",children:[p.jsx(Ie,{size:"lg"}),p.jsx("p",{className:"text-sm text-gray-600 mt-4",children:"Loading documents..."})]})}):w.length===0?p.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-50 p-6",children:[p.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“"}),p.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Documents Yet"}),p.jsx("p",{className:"text-sm text-gray-600 mb-6 text-center max-w-md",children:"Start by scanning your first document using the camera."}),p.jsx(ue,{onClick:()=>l("camera"),variant:"primary",size:"lg",children:"Scan Document"})]}):p.jsxs("div",{className:"h-full bg-gray-50 flex flex-col",children:[p.jsxs("div",{className:"bg-white border-b border-gray-200 p-4",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("h2",{className:"text-lg font-semibold",children:"My Documents"}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx(ue,{onClick:R,variant:x?"secondary":"outline",size:"sm",children:x?"Cancel":"Select"}),!x&&p.jsx(ue,{onClick:()=>l("camera"),variant:"primary",size:"sm",children:"+ New Scan"})]})]}),p.jsxs("div",{className:"flex items-center justify-between mt-1",children:[p.jsx("p",{className:"text-sm text-gray-600",children:x&&s.length>0?`${s.length} selected`:`${w.length} document${w.length!==1?"s":""}`}),x&&p.jsx("button",{onClick:L,className:"text-sm text-blue-600 hover:text-blue-700",children:s.length===w.length?"Deselect All":"Select All"})]})]}),p.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:p.jsx("div",{className:"grid grid-cols-2 gap-4",children:w.map(g=>{const N=s.includes(g.id);return p.jsxs("div",{onClick:()=>z(g),className:`bg-white rounded-lg shadow hover:shadow-lg transition-all cursor-pointer overflow-hidden ${N?"ring-2 ring-blue-500":""}`,children:[p.jsxs("div",{className:"aspect-[3/4] bg-gray-200 relative overflow-hidden",children:[C.has(g.id)?p.jsx("img",{src:C.get(g.id),alt:g.name,className:"w-full h-full object-cover"}):p.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:p.jsx("span",{className:"text-4xl",children:"ðŸ“„"})}),x&&p.jsx("div",{className:"absolute top-2 left-2",children:p.jsx("input",{type:"checkbox",checked:N,onChange:()=>t(g.id),onClick:c=>c.stopPropagation(),className:"w-6 h-6 cursor-pointer"})}),!x&&p.jsx("button",{onClick:c=>M(c,g.id),className:"absolute top-2 right-2 w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center shadow-lg transition-colors",title:"Delete document",children:"Ã—"})]}),p.jsxs("div",{className:"p-3",children:[p.jsx("h3",{className:"text-sm font-medium truncate mb-1",children:g.name}),p.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[p.jsxs("span",{children:[g.pages.length," page",g.pages.length!==1?"s":""]}),p.jsx("span",{children:g.metadata.hasOCR?"âœ“ OCR":""})]}),p.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(g.updatedAt).toLocaleDateString()}),!x&&p.jsxs("div",{className:"flex gap-2 mt-2",children:[!g.metadata.hasOCR&&p.jsx("button",{onClick:c=>Z(c,g),className:"flex-1 px-2 py-1 text-xs bg-blue-50 text-blue-600 rounded hover:bg-blue-100 transition-colors",children:"Extract Text"}),p.jsx("button",{onClick:c=>{c.stopPropagation(),n(g),l("export")},className:"flex-1 px-2 py-1 text-xs bg-green-50 text-green-600 rounded hover:bg-green-100 transition-colors",children:"Export"})]})]})]},g.id)})})}),x&&s.length>0&&p.jsx("div",{className:"bg-white border-t border-gray-200 p-4 shadow-lg",children:f?p.jsxs("div",{className:"text-center",children:[p.jsx(Ie,{size:"sm"}),p.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Exporting ",v.current," of ",v.total,"..."]})]}):p.jsxs("div",{className:"flex gap-2",children:[p.jsx(ue,{onClick:()=>I("pdf"),variant:"primary",size:"md",className:"flex-1",children:"ðŸ“„ Export as PDFs"}),p.jsx(ue,{onClick:()=>I("images"),variant:"secondary",size:"md",className:"flex-1",children:"ðŸ–¼ï¸ Export as Images"})]})})]})};class Cr{constructor(){pe(this,"worker",null);pe(this,"isInitialized",!1);pe(this,"currentLanguages",["eng"])}async initialize(s=["eng"],e){if(!(this.isInitialized&&this.arraysEqual(s,this.currentLanguages))){this.worker&&await this.terminate();try{this.worker=await It.createWorker(s.join("+"),1,{logger:n=>{e&&e({status:n.status,progress:n.progress||0})}}),this.currentLanguages=s,this.isInitialized=!0}catch(n){throw console.error("Failed to initialize OCR worker:",n),new Error("Failed to initialize OCR service")}}}async recognize(s,e){if(!this.worker||!this.isInitialized)throw new Error("OCR service not initialized");const n=performance.now();try{e&&(e.pageSegMode!==void 0&&await this.worker.setParameters({tessedit_pageseg_mode:e.pageSegMode}),e.preserveInterwordSpaces!==void 0&&await this.worker.setParameters({preserve_interword_spaces:e.preserveInterwordSpaces?"1":"0"}),e.characterWhitelist&&await this.worker.setParameters({tessedit_char_whitelist:e.characterWhitelist}),e.characterBlacklist&&await this.worker.setParameters({tessedit_char_blacklist:e.characterBlacklist}));const r=await this.worker.recognize(s),t=performance.now()-n;return this.formatResult(r.data,t)}catch(r){throw console.error("OCR recognition failed:",r),new Error("Failed to perform OCR")}}async detectOrientation(s){if(!this.worker||!this.isInitialized)throw new Error("OCR service not initialized");try{const e=await this.worker.detect(s);return{degrees:e.data.orientation_degrees||0,confidence:e.data.orientation_confidence||0,script:e.data.script||"Latin"}}catch(e){throw console.error("Orientation detection failed:",e),new Error("Failed to detect orientation")}}preprocessForOCR(s){const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("Failed to get canvas context");e.width=s.width,e.height=s.height,n.putImageData(s,0,0);const r=s.data;for(let t=0;t<r.length;t+=4){const a=r[t]*.299+r[t+1]*.587+r[t+2]*.114;r[t]=a,r[t+1]=a,r[t+2]=a}return s}async terminate(){this.worker&&(await this.worker.terminate(),this.worker=null,this.isInitialized=!1)}formatResult(s,e){return{text:s.text,confidence:s.confidence,words:s.words.map(n=>({text:n.text,confidence:n.confidence,boundingBox:{x:n.bbox.x0,y:n.bbox.y0,width:n.bbox.x1-n.bbox.x0,height:n.bbox.y1-n.bbox.y0},baseline:{x0:n.baseline.x0,y0:n.baseline.y0,x1:n.baseline.x1,y1:n.baseline.y1}})),lines:s.lines.map(n=>({text:n.text,confidence:n.confidence,boundingBox:{x:n.bbox.x0,y:n.bbox.y0,width:n.bbox.x1-n.bbox.x0,height:n.bbox.y1-n.bbox.y0},words:n.words.map(r=>({text:r.text,confidence:r.confidence,boundingBox:{x:r.bbox.x0,y:r.bbox.y0,width:r.bbox.x1-r.bbox.x0,height:r.bbox.y1-r.bbox.y0},baseline:{x0:r.baseline.x0,y0:r.baseline.y0,x1:r.baseline.x1,y1:r.baseline.y1}}))})),paragraphs:s.paragraphs.map(n=>({text:n.text,confidence:n.confidence,boundingBox:{x:n.bbox.x0,y:n.bbox.y0,width:n.bbox.x1-n.bbox.x0,height:n.bbox.y1-n.bbox.y0},lines:n.lines.map(r=>({text:r.text,confidence:r.confidence,boundingBox:{x:r.bbox.x0,y:r.bbox.y0,width:r.bbox.x1-r.bbox.x0,height:r.bbox.y1-r.bbox.y0},words:r.words.map(t=>({text:t.text,confidence:t.confidence,boundingBox:{x:t.bbox.x0,y:t.bbox.y0,width:t.bbox.x1-t.bbox.x0,height:t.bbox.y1-t.bbox.y0},baseline:{x0:t.baseline.x0,y0:t.baseline.y0,x1:t.baseline.x1,y1:t.baseline.y1}}))}))})),blocks:(s.blocks||[]).map(n=>({text:n.text,confidence:n.confidence,boundingBox:{x:n.bbox.x0,y:n.bbox.y0,width:n.bbox.x1-n.bbox.x0,height:n.bbox.y1-n.bbox.y0},paragraphs:n.paragraphs.map(r=>({text:r.text,confidence:r.confidence,boundingBox:{x:r.bbox.x0,y:r.bbox.y0,width:r.bbox.x1-r.bbox.x0,height:r.bbox.y1-r.bbox.y0},lines:r.lines.map(t=>({text:t.text,confidence:t.confidence,boundingBox:{x:t.bbox.x0,y:t.bbox.y0,width:t.bbox.x1-t.bbox.x0,height:t.bbox.y1-t.bbox.y0},words:t.words.map(a=>({text:a.text,confidence:a.confidence,boundingBox:{x:a.bbox.x0,y:a.bbox.y0,width:a.bbox.x1-a.bbox.x0,height:a.bbox.y1-a.bbox.y0},baseline:{x0:a.baseline.x0,y0:a.baseline.y0,x1:a.baseline.x1,y1:a.baseline.y1}}))}))}))})),processingTime:e}}arraysEqual(s,e){return s.length!==e.length?!1:s.every((n,r)=>n===e[r])}}let qe=null;function kr(){return qe||(qe=new Cr),qe}const ht=[{code:"eng",name:"English",tier:1},{code:"spa",name:"Spanish",tier:1},{code:"fra",name:"French",tier:1},{code:"deu",name:"German",tier:1},{code:"ita",name:"Italian",tier:1},{code:"por",name:"Portuguese",tier:1},{code:"rus",name:"Russian",tier:1},{code:"jpn",name:"Japanese",tier:1},{code:"chi_sim",name:"Chinese Simplified",tier:1},{code:"kor",name:"Korean",tier:1}],Sr=()=>{const{currentDocument:w,processedImage:s,isProcessing:e,progress:n,result:r,selectedLanguages:t,isInitialized:a,setOCRInitialized:o,setOCRProcessing:l,setOCRProgress:m,setOCRResult:_,setSelectedLanguages:b,setCurrentDocument:C,setDocuments:u,setCurrentView:x,addToast:d}=be(Z=>({currentDocument:Z.documents.currentDocument,processedImage:Z.scanSession.processedImage,isProcessing:Z.ocr.isProcessing,progress:Z.ocr.progress,result:Z.ocr.result,selectedLanguages:Z.ocr.selectedLanguages,isInitialized:Z.ocr.isInitialized,setOCRInitialized:Z.setOCRInitialized,setOCRProcessing:Z.setOCRProcessing,setOCRProgress:Z.setOCRProgress,setOCRResult:Z.setOCRResult,setSelectedLanguages:Z.setSelectedLanguages,setCurrentDocument:Z.setCurrentDocument,setDocuments:Z.setDocuments,setCurrentView:Z.setCurrentView,addToast:Z.addToast})),[f,h]=te.useState(""),[v,j]=te.useState(!1),E=te.useRef(null),S=kr();te.useEffect(()=>{(async()=>{if(!a)try{l(!0),await S.initialize(t,g=>{m(g.progress*100)}),o(!0),l(!1),m(0)}catch(g){console.error("Failed to initialize OCR:",g),d({type:"error",message:"Failed to initialize OCR service"}),l(!1)}})()},[]),te.useEffect(()=>{(async()=>{if(w&&w.pages.length>0&&!s)try{const g=w.pages[0],N=new Image;N.onload=()=>{const c=document.createElement("canvas"),F=c.getContext("2d");if(F){c.width=N.width,c.height=N.height,F.drawImage(N,0,0);const X=F.getImageData(0,0,N.width,N.height);if(E.current){const W=E.current.getContext("2d");W&&(E.current.width=X.width,E.current.height=X.height,W.putImageData(X,0,0))}}},N.src=URL.createObjectURL(g.processedImage),g.ocrResult&&_(g.ocrResult)}catch(g){console.error("Failed to load document image:",g)}})()},[w]),te.useEffect(()=>{if(s&&E.current){const Z=E.current,g=Z.getContext("2d");g&&(Z.width=s.width,Z.height=s.height,g.putImageData(s,0,0))}},[s]),te.useEffect(()=>{r&&h(r.text)},[r]);const z=async()=>{const Z=s||(w&&E.current?E.current.getContext("2d")?.getImageData(0,0,E.current.width,E.current.height):null);if(!Z){d({type:"error",message:"No image to process"});return}try{l(!0),m(0);const g=await S.recognize(Z,{pageSegMode:3,preserveInterwordSpaces:!0});m(100),_(g),l(!1),m(0),w&&await R(g),d({type:"success",message:`Text extracted with ${g.confidence.toFixed(1)}% confidence`})}catch(g){console.error("OCR failed:",g),d({type:"error",message:"Failed to extract text from image"}),l(!1),m(0)}},R=async Z=>{if(!w){d({type:"warning",message:"No document to save OCR results to"});return}const g=Z||r;if(!g){d({type:"error",message:"No OCR results to save"});return}try{const N={...w,pages:w.pages.map((X,W)=>W===0?{...X,ocrResult:g}:X),metadata:{...w.metadata,hasOCR:!0},updatedAt:new Date},c=await Ue();await c.updateDocument(N),C(N);const F=await c.listDocuments({sortBy:"updatedAt",sortOrder:"desc"});u(F),d({type:"success",message:"OCR results saved to document"})}catch(N){console.error("Failed to save OCR results:",N),d({type:"error",message:"Failed to save OCR results"})}},L=Z=>{const g=t.includes(Z)?t.filter(N=>N!==Z):[...t,Z];if(g.length===0){d({type:"warning",message:"At least one language must be selected"});return}b(g),o(!1)},I=()=>{f&&(navigator.clipboard.writeText(f),d({type:"success",message:"Text copied to clipboard"}))},M=async()=>{if(f)if(navigator.share)try{await navigator.share({text:f,title:"Extracted Text"})}catch{}else I()};return s?p.jsxs("div",{className:"flex flex-col h-full bg-white",children:[p.jsx("div",{className:"flex-shrink-0 bg-gray-900 relative overflow-hidden",style:{height:"30%"},children:p.jsx("canvas",{ref:E,className:"absolute inset-0 w-full h-full object-contain"})}),p.jsxs("div",{className:"flex-shrink-0 bg-white border-b border-gray-200 p-3",children:[p.jsxs("div",{className:"flex items-center justify-between gap-2",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(ue,{onClick:z,disabled:e||!a,variant:"primary",size:"md",children:e?"Processing...":r?"Re-scan Text":"Extract Text"}),p.jsx("button",{onClick:()=>j(!v),className:"px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:e,children:t.length===1?ht.find(Z=>Z.code===t[0])?.name:`${t.length} languages`})]}),r&&p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(Je,{icon:"ðŸ“‹",onClick:I,title:"Copy text",size:"md"}),p.jsx(Je,{icon:"ðŸ“¤",onClick:M,title:"Share text",size:"md"})]})]}),e&&p.jsxs("div",{className:"mt-3",children:[p.jsxs("div",{className:"flex items-center justify-between mb-1",children:[p.jsx("span",{className:"text-xs text-gray-600",children:n<100?"Initializing...":"Recognizing text..."}),p.jsxs("span",{className:"text-xs text-gray-600",children:[Math.round(n),"%"]})]}),p.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:p.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${n}%`}})})]}),v&&p.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[p.jsx("h3",{className:"text-sm font-medium mb-2",children:"Select Languages"}),p.jsx("div",{className:"grid grid-cols-2 gap-2",children:ht.map(Z=>p.jsxs("label",{className:"flex items-center gap-2 p-2 rounded hover:bg-gray-100 cursor-pointer",children:[p.jsx("input",{type:"checkbox",checked:t.includes(Z.code),onChange:()=>L(Z.code),className:"rounded border-gray-300",disabled:e}),p.jsx("span",{className:"text-sm",children:Z.name})]},Z.code))})]}),r&&!e&&p.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Confidence: ",r.confidence.toFixed(1),"% â€¢ ",r.words.length," words detected"]})]}),p.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col p-4 bg-gray-50",children:[!r&&!e&&p.jsx("div",{className:"flex-1 flex items-center justify-center text-center",children:p.jsxs("div",{children:[p.jsx("div",{className:"text-4xl mb-2",children:"ðŸ”"}),p.jsx("p",{className:"text-gray-600 text-sm",children:'Click "Extract Text" to start OCR'})]})}),e&&p.jsx("div",{className:"flex-1 flex items-center justify-center",children:p.jsxs("div",{className:"text-center",children:[p.jsx(Ie,{size:"lg"}),p.jsx("p",{className:"text-sm text-gray-600 mt-4",children:"Extracting text from document..."})]})}),r&&!e&&p.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[p.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2",children:"Extracted Text (editable)"}),p.jsx("textarea",{value:f,onChange:Z=>h(Z.target.value),className:"flex-1 w-full p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Extracted text will appear here..."})]})]})]}):p.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-50 p-6",children:[p.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“„"}),p.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Image to Process"}),p.jsx("p",{className:"text-sm text-gray-600 mb-6 text-center max-w-md",children:"Capture and enhance a document first before extracting text."}),p.jsx(ue,{onClick:()=>x("camera"),variant:"primary",size:"lg",children:"Go to Camera"})]})},Er=()=>{const{currentDocument:w,setCurrentView:s,addToast:e}=be(f=>({currentDocument:f.documents.currentDocument,setCurrentView:f.setCurrentView,addToast:f.addToast})),[n,r]=te.useState("pdf"),[t,a]=te.useState(!1),[o,l]=te.useState(0),[m,_]=te.useState({pageSize:"a4",orientation:"auto",quality:"high",includeOCR:!1,compression:!0}),[b,C]=te.useState({format:"png",quality:90}),u=bt(),x=async()=>{if(!w){e({type:"error",message:"No document to export"});return}a(!0),l(0);try{let f=`${w.name}`;switch(n){case"pdf":{l(30);const h=await u.exportToPDF(w,m);l(100),f+=".pdf",u.downloadBlob(h,f),e({type:"success",message:"PDF exported successfully"});break}case"png":case"jpeg":{if(w.pages.length===1){l(50);const h=await u.exportToImage(w.pages[0],{...b,format:n});l(100),f+=`.${n}`,u.downloadBlob(h,f),e({type:"success",message:`${n.toUpperCase()} exported successfully`})}else{const h=await u.exportMultipleImages(w,{...b,format:n});for(let v=0;v<h.length;v++){l((v+1)/h.length*100);const j=`${w.name}_page${v+1}.${n}`;u.downloadBlob(h[v],j)}e({type:"success",message:`${h.length} images exported successfully`})}break}case"txt":{l(50);const h=await u.exportToText(w);l(100),f+=".txt",u.downloadBlob(h,f),e({type:"success",message:"Text exported successfully"});break}}}catch(f){console.error("Export failed:",f),e({type:"error",message:f instanceof Error?f.message:"Export failed"})}finally{a(!1),l(0)}},d=async()=>{if(w){a(!0);try{let f,h;switch(n){case"pdf":f=await u.exportToPDF(w,m),h=`${w.name}.pdf`;break;case"png":case"jpeg":if(w.pages.length===1)f=await u.exportToImage(w.pages[0],{...b,format:n}),h=`${w.name}.${n}`;else{e({type:"warning",message:"Can only share single-page documents. Export multiple pages separately."});return}break;case"txt":f=await u.exportToText(w),h=`${w.name}.txt`;break;default:throw new Error("Invalid format")}await u.share(f,h,w.name),e({type:"success",message:"Shared successfully"})}catch(f){console.error("Share failed:",f),f instanceof Error&&f.message.includes("not supported")?x():e({type:"error",message:"Share failed"})}finally{a(!1)}}};return w?p.jsx("div",{className:"h-full bg-white overflow-y-auto",children:p.jsxs("div",{className:"max-w-2xl mx-auto p-6",children:[p.jsxs("div",{className:"mb-6",children:[p.jsx("h2",{className:"text-2xl font-bold mb-2",children:w.name}),p.jsxs("p",{className:"text-sm text-gray-600",children:[w.pages.length," page",w.pages.length!==1?"s":"",w.metadata.hasOCR&&" â€¢ OCR processed"]})]}),p.jsxs("div",{className:"mb-6",children:[p.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Export Format"}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsxs("button",{onClick:()=>r("pdf"),className:`p-4 rounded-lg border-2 transition-all ${n==="pdf"?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[p.jsx("div",{className:"text-3xl mb-2",children:"ðŸ“„"}),p.jsx("div",{className:"font-medium",children:"PDF"}),p.jsx("div",{className:"text-xs text-gray-600",children:"Multi-page document"})]}),p.jsxs("button",{onClick:()=>r("png"),className:`p-4 rounded-lg border-2 transition-all ${n==="png"?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[p.jsx("div",{className:"text-3xl mb-2",children:"ðŸ–¼ï¸"}),p.jsx("div",{className:"font-medium",children:"PNG"}),p.jsx("div",{className:"text-xs text-gray-600",children:"Lossless image"})]}),p.jsxs("button",{onClick:()=>r("jpeg"),className:`p-4 rounded-lg border-2 transition-all ${n==="jpeg"?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[p.jsx("div",{className:"text-3xl mb-2",children:"ðŸ“·"}),p.jsx("div",{className:"font-medium",children:"JPEG"}),p.jsx("div",{className:"text-xs text-gray-600",children:"Compressed image"})]}),p.jsxs("button",{onClick:()=>r("txt"),className:`p-4 rounded-lg border-2 transition-all ${n==="txt"?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,disabled:!w.metadata.hasOCR,children:[p.jsx("div",{className:"text-3xl mb-2",children:"ðŸ“"}),p.jsx("div",{className:"font-medium",children:"Text"}),p.jsx("div",{className:"text-xs text-gray-600",children:w.metadata.hasOCR?"OCR text only":"OCR required"})]})]})]}),n==="pdf"&&p.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[p.jsx("h3",{className:"font-medium mb-3",children:"PDF Options"}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"Page Size"}),p.jsxs("select",{value:m.pageSize,onChange:f=>_({...m,pageSize:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[p.jsx("option",{value:"a4",children:"A4"}),p.jsx("option",{value:"letter",children:"Letter"}),p.jsx("option",{value:"legal",children:"Legal"}),p.jsx("option",{value:"original",children:"Original Size"})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"Orientation"}),p.jsxs("select",{value:m.orientation,onChange:f=>_({...m,orientation:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[p.jsx("option",{value:"auto",children:"Auto"}),p.jsx("option",{value:"portrait",children:"Portrait"}),p.jsx("option",{value:"landscape",children:"Landscape"})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"Quality"}),p.jsxs("select",{value:m.quality,onChange:f=>_({...m,quality:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[p.jsx("option",{value:"low",children:"Low (smaller file)"}),p.jsx("option",{value:"medium",children:"Medium"}),p.jsx("option",{value:"high",children:"High"}),p.jsx("option",{value:"original",children:"Original"})]})]}),w.metadata.hasOCR&&p.jsxs("label",{className:"flex items-center gap-2",children:[p.jsx("input",{type:"checkbox",checked:m.includeOCR,onChange:f=>_({...m,includeOCR:f.target.checked}),className:"rounded border-gray-300"}),p.jsx("span",{className:"text-sm text-gray-700",children:"Include OCR text layer (searchable PDF)"})]})]})]}),(n==="png"||n==="jpeg")&&p.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[p.jsx("h3",{className:"font-medium mb-3",children:"Image Options"}),p.jsxs("div",{className:"space-y-4",children:[n==="jpeg"&&p.jsxs("div",{children:[p.jsxs("label",{className:"block text-sm text-gray-700 mb-2",children:["Quality: ",b.quality,"%"]}),p.jsx("input",{type:"range",min:"10",max:"100",step:"10",value:b.quality,onChange:f=>C({...b,quality:parseInt(f.target.value)}),className:"w-full"})]}),p.jsxs("div",{children:[p.jsxs("label",{className:"flex items-center gap-2",children:[p.jsx("input",{type:"checkbox",checked:b.maxDimension!==void 0,onChange:f=>C({...b,maxDimension:f.target.checked?2048:void 0}),className:"rounded border-gray-300"}),p.jsx("span",{className:"text-sm text-gray-700",children:"Limit maximum dimension"})]}),b.maxDimension!==void 0&&p.jsx("input",{type:"number",value:b.maxDimension,onChange:f=>C({...b,maxDimension:parseInt(f.target.value)}),className:"w-full mt-2 px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Max dimension (px)"})]})]})]}),t&&p.jsxs("div",{className:"mb-6",children:[p.jsxs("div",{className:"flex items-center justify-between mb-2",children:[p.jsx("span",{className:"text-sm text-gray-600",children:"Exporting..."}),p.jsxs("span",{className:"text-sm text-gray-600",children:[Math.round(o),"%"]})]}),p.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:p.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${o}%`}})})]}),p.jsxs("div",{className:"flex gap-3",children:[p.jsx(ue,{onClick:x,disabled:t,variant:"primary",size:"lg",className:"flex-1",children:t?p.jsxs("span",{className:"flex items-center justify-center gap-2",children:[p.jsx(Ie,{size:"sm"}),"Exporting..."]}):`Export as ${n.toUpperCase()}`}),typeof navigator.share<"u"&&p.jsx(ue,{onClick:d,disabled:t,variant:"secondary",size:"lg",children:"ðŸ“¤ Share"})]})]})}):p.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-50 p-6",children:[p.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“¤"}),p.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Document Selected"}),p.jsx("p",{className:"text-sm text-gray-600 mb-6 text-center max-w-md",children:"Select a document from your library to export it."}),p.jsx(ue,{onClick:()=>s("documents"),variant:"primary",size:"lg",children:"Go to Documents"})]})};function jr(){const w=be(e=>e.ui.currentView),s=()=>{switch(w){case"camera":return p.jsx(at,{});case"crop":return p.jsx(Yt,{});case"enhance":return p.jsx(gr,{});case"documents":return p.jsx(_r,{});case"ocr":return p.jsx(Sr,{});case"export":return p.jsx(Er,{});default:return p.jsx(at,{})}};return p.jsxs("div",{className:"flex flex-col h-screen overflow-hidden bg-white",children:[p.jsx(Ft,{}),p.jsx("main",{className:"flex-1 overflow-hidden mt-14 mb-16",children:s()}),p.jsx(Pt,{}),p.jsx(Mt,{})]})}Xe.createRoot(document.getElementById("root")).render(p.jsx(Et.StrictMode,{children:p.jsx(jr,{})}));
