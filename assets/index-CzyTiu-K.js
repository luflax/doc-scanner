var _t=Object.defineProperty;var Ct=(f,s,e)=>s in f?_t(f,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):f[s]=e;var pe=(f,s,e)=>Ct(f,typeof s!="symbol"?s+"":s,e);import{r as X,a as kt,c as Fe,g as St,R as jt}from"./react-vendor-CVDnmApk.js";import{c as Et}from"./zustand-vendor-D0NwXheU.js";import{c as Be,s as Nt}from"./tesseract-vendor-D34z6xNp.js";import{E as Dt}from"./pdf-vendor-CzmxGYVW.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const t of r)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function e(r){const t={};return r.integrity&&(t.integrity=r.integrity),r.referrerPolicy&&(t.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?t.credentials="include":r.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function n(r){if(r.ep)return;r.ep=!0;const t=e(r);fetch(r.href,t)}})();var ft={exports:{}},Ge={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var It=X,Rt=Symbol.for("react.element"),zt=Symbol.for("react.fragment"),Ot=Object.prototype.hasOwnProperty,At=It.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Tt={key:!0,ref:!0,__self:!0,__source:!0};function mt(f,s,e){var n,r={},t=null,i=null;e!==void 0&&(t=""+e),s.key!==void 0&&(t=""+s.key),s.ref!==void 0&&(i=s.ref);for(n in s)Ot.call(s,n)&&!Tt.hasOwnProperty(n)&&(r[n]=s[n]);if(f&&f.defaultProps)for(n in s=f.defaultProps,s)r[n]===void 0&&(r[n]=s[n]);return{$$typeof:Rt,type:f,key:t,ref:i,props:r,_owner:At.current}}Ge.Fragment=zt;Ge.jsx=mt;Ge.jsxs=mt;ft.exports=Ge;var d=ft.exports,Je={},it=kt;Je.createRoot=it.createRoot,Je.hydrateRoot=it.hydrateRoot;const Ue={brightness:0,contrast:0,saturation:0,sharpness:0,gamma:1,shadows:0,highlights:0,temperature:0},Ft=[{id:"original",name:"Original",description:"No filter applied",icon:"ðŸ“„"},{id:"document",name:"Document",description:"High contrast B&W",icon:"ðŸ“ƒ"},{id:"grayscale",name:"Grayscale",description:"Black and white",icon:"â¬œ"},{id:"magic",name:"Magic",description:"Auto-enhanced",icon:"âœ¨"},{id:"whiteboard",name:"Whiteboard",description:"For whiteboards",icon:"ðŸ–Šï¸"},{id:"book",name:"Book",description:"For book pages",icon:"ðŸ“–"},{id:"receipt",name:"Receipt",description:"High contrast",icon:"ðŸ§¾"},{id:"photo",name:"Photo",description:"Color preserved",icon:"ðŸ–¼ï¸"},{id:"blueprint",name:"Blueprint",description:"Inverted colors",icon:"ðŸ“"}],ge=Et(f=>({camera:{isInitialized:!1,isCapturing:!1,stream:null,capabilities:null,error:null},scanSession:{isActive:!1,currentImage:null,detectedEdges:null,adjustedCorners:null,processedImage:null,selectedFilter:"original",enhancementOptions:Ue},ocr:{isInitialized:!1,isProcessing:!1,progress:0,result:null,selectedLanguages:["eng"]},documents:{list:[],currentDocument:null,isLoading:!1,selectedDocumentIds:[]},ui:{currentView:"camera",isProcessing:!1,toasts:[],modalOpen:null},setCameraInitialized:s=>f(e=>({camera:{...e.camera,isInitialized:s}})),setCameraStream:s=>f(e=>({camera:{...e.camera,stream:s}})),setCameraCapabilities:s=>f(e=>({camera:{...e.camera,capabilities:s}})),setCameraError:s=>f(e=>({camera:{...e.camera,error:s}})),setCapturing:s=>f(e=>({camera:{...e.camera,isCapturing:s}})),startScanSession:s=>f({scanSession:{isActive:!0,currentImage:s,detectedEdges:null,adjustedCorners:null,processedImage:null,selectedFilter:"original",enhancementOptions:Ue}}),setDetectedEdges:s=>f(e=>({scanSession:{...e.scanSession,detectedEdges:s}})),setAdjustedCorners:s=>f(e=>({scanSession:{...e.scanSession,adjustedCorners:s}})),setProcessedImage:s=>f(e=>({scanSession:{...e.scanSession,processedImage:s}})),setSelectedFilter:s=>f(e=>({scanSession:{...e.scanSession,selectedFilter:s}})),setEnhancementOptions:s=>f(e=>({scanSession:{...e.scanSession,enhancementOptions:s}})),resetScanSession:()=>f({scanSession:{isActive:!1,currentImage:null,detectedEdges:null,adjustedCorners:null,processedImage:null,selectedFilter:"original",enhancementOptions:Ue}}),setOCRInitialized:s=>f(e=>({ocr:{...e.ocr,isInitialized:s}})),setOCRProcessing:s=>f(e=>({ocr:{...e.ocr,isProcessing:s}})),setOCRProgress:s=>f(e=>({ocr:{...e.ocr,progress:s}})),setOCRResult:s=>f(e=>({ocr:{...e.ocr,result:s}})),setSelectedLanguages:s=>f(e=>({ocr:{...e.ocr,selectedLanguages:s}})),setDocuments:s=>f(e=>({documents:{...e.documents,list:s}})),setCurrentDocument:s=>f(e=>({documents:{...e.documents,currentDocument:s}})),setDocumentsLoading:s=>f(e=>({documents:{...e.documents,isLoading:s}})),addDocument:s=>f(e=>({documents:{...e.documents,list:[s,...e.documents.list]}})),removeDocument:s=>f(e=>({documents:{...e.documents,list:e.documents.list.filter(n=>n.id!==s),selectedDocumentIds:e.documents.selectedDocumentIds.filter(n=>n!==s)}})),toggleDocumentSelection:s=>f(e=>{const n=e.documents.selectedDocumentIds.includes(s);return{documents:{...e.documents,selectedDocumentIds:n?e.documents.selectedDocumentIds.filter(r=>r!==s):[...e.documents.selectedDocumentIds,s]}}}),clearDocumentSelection:()=>f(s=>({documents:{...s.documents,selectedDocumentIds:[]}})),selectAllDocuments:()=>f(s=>({documents:{...s.documents,selectedDocumentIds:s.documents.list.map(e=>e.id)}})),setCurrentView:s=>f(e=>({ui:{...e.ui,currentView:s}})),setProcessing:s=>f(e=>({ui:{...e.ui,isProcessing:s}})),addToast:s=>f(e=>({ui:{...e.ui,toasts:[...e.ui.toasts,{...s,id:Math.random().toString(36).substr(2,9)}]}})),removeToast:s=>f(e=>({ui:{...e.ui,toasts:e.ui.toasts.filter(n=>n.id!==s)}})),setModalOpen:s=>f(e=>({ui:{...e.ui,modalOpen:s}}))})),Bt=()=>{const f=ge(e=>e.ui.currentView),s=()=>{switch(f){case"camera":return"Document Scanner";case"crop":return"Crop Document";case"enhance":return"Enhance";case"ocr":return"Extract Text";case"documents":return"My Documents";case"export":return"Export";default:return"Document Scanner"}};return d.jsx("header",{className:"fixed top-0 left-0 right-0 z-30 bg-white border-b border-gray-200 pt-safe",children:d.jsxs("div",{className:"flex items-center justify-between px-4 h-14",children:[d.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:s()}),d.jsx("div",{className:"flex items-center gap-2"})]})})},Pt=()=>{const f=ge(n=>n.ui.currentView),s=ge(n=>n.setCurrentView),e=[{view:"camera",label:"Camera",icon:"ðŸ“·"},{view:"documents",label:"Documents",icon:"ðŸ“„"}];return d.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-30 bg-white border-t border-gray-200 pb-safe",children:d.jsx("div",{className:"flex items-center justify-around h-16",children:e.map(n=>d.jsxs("button",{onClick:()=>s(n.view),className:`flex flex-col items-center justify-center flex-1 h-full transition-colors ${f===n.view?"text-primary-600":"text-gray-500 hover:text-gray-700"}`,children:[d.jsx("span",{className:"text-2xl mb-1",children:n.icon}),d.jsx("span",{className:"text-xs font-medium",children:n.label})]},n.view))})})},Lt=({toast:f})=>{const s=ge(n=>n.removeToast);X.useEffect(()=>{const n=f.duration||3e3,r=setTimeout(()=>{s(f.id)},n);return()=>clearTimeout(r)},[f.id,f.duration,s]);const e={success:"toast-success",error:"toast-error",warning:"toast-warning",info:"toast-info"};return d.jsx("div",{className:`toast ${e[f.type]} mb-2`,children:d.jsx("p",{className:"text-sm font-medium",children:f.message})})},Mt=()=>{const f=ge(s=>s.ui.toasts);return f.length===0?null:d.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:f.map(s=>d.jsx(Lt,{toast:s},s.id))})};class Ut{constructor(){pe(this,"stream",null);pe(this,"videoTrack",null);pe(this,"currentFacingMode","environment")}async initialize(s){const n={...{facingMode:"environment",resolution:{ideal:{width:3840,height:2160},min:{width:1920,height:1080}},focusMode:"continuous",torch:!1},...s};this.currentFacingMode=n.facingMode;try{const r={video:{facingMode:{ideal:n.facingMode},width:{ideal:n.resolution.ideal.width},height:{ideal:n.resolution.ideal.height}},audio:!1};return this.stream=await navigator.mediaDevices.getUserMedia(r),this.videoTrack=this.stream.getVideoTracks()[0],this.stream}catch(r){console.warn("Failed with ideal constraints, falling back to basic",r);const t={video:{facingMode:n.facingMode,width:{ideal:1920},height:{ideal:1080}},audio:!1};return this.stream=await navigator.mediaDevices.getUserMedia(t),this.videoTrack=this.stream.getVideoTracks()[0],this.stream}}getCapabilities(){if(!this.videoTrack)return null;try{const s=this.videoTrack.getCapabilities();return{hasFlash:"torch"in s,hasFocus:"focusMode"in s,hasZoom:"zoom"in s,maxZoom:s.zoom?.max||1,supportedResolutions:this.getSupportedResolutions(s)}}catch(s){return console.error("Failed to get camera capabilities",s),{hasFlash:!1,hasFocus:!1,hasZoom:!1,maxZoom:1,supportedResolutions:[]}}}getSupportedResolutions(s){const e=[],n=[{width:3840,height:2160},{width:1920,height:1080},{width:1280,height:720},{width:640,height:480}],r=s.width?.max||1920,t=s.height?.max||1080;for(const i of n)i.width<=r&&i.height<=t&&e.push(i);return e}async switchCamera(){const s=this.currentFacingMode==="environment"?"user":"environment";return this.dispose(),this.initialize({facingMode:s})}async capturePhoto(s){if(!this.stream)throw new Error("Camera not initialized");const e=document.createElement("canvas");e.width=s.videoWidth,e.height=s.videoHeight;const n=e.getContext("2d");if(!n)throw new Error("Failed to get canvas context");return n.drawImage(s,0,0),n.getImageData(0,0,e.width,e.height)}getVideoFrame(s){if(!this.stream)return null;try{const e=document.createElement("canvas"),n=Math.min(640,s.videoWidth),r=Math.min(480,s.videoHeight);e.width=n,e.height=r;const t=e.getContext("2d");return t?(t.drawImage(s,0,0,n,r),t.getImageData(0,0,n,r)):null}catch(e){return console.error("Failed to get video frame",e),null}}async setZoom(s){if(!this.videoTrack)throw new Error("Camera not initialized");if(!("zoom"in this.videoTrack.getCapabilities()))throw new Error("Zoom not supported");const n={advanced:[{zoom:s}]};try{await this.videoTrack.applyConstraints(n)}catch(r){throw console.error("Failed to set zoom",r),r}}async toggleFlash(s){if(!this.videoTrack)throw new Error("Camera not initialized");if(!("torch"in this.videoTrack.getCapabilities()))throw new Error("Flash not supported");const n={advanced:[{torch:s}]};try{await this.videoTrack.applyConstraints(n)}catch(r){throw console.error("Failed to toggle flash",r),r}}async setFocusPoint(s,e){if(!this.videoTrack)throw new Error("Camera not initialized");if(!("focusMode"in this.videoTrack.getCapabilities())){console.warn("Focus control not supported");return}console.log("Focus point requested:",s,e)}getStream(){return this.stream}getCurrentFacingMode(){return this.currentFacingMode}isInitialized(){return this.stream!==null&&this.videoTrack!==null}dispose(){this.stream&&(this.stream.getTracks().forEach(s=>s.stop()),this.stream=null),this.videoTrack=null}}const Ee=new Ut,Wt=(f={})=>{const{autoStart:s=!1,facingMode:e="environment",onError:n,onInitialized:r}=f,[t,i]=X.useState(null),[c,l]=X.useState(!1),[g,w]=X.useState(!1),[y,_]=X.useState(null),[h,b]=X.useState(null),u=X.useRef(null),x=async()=>{w(!0),_(null);try{const R=await Ee.initialize({facingMode:e});i(R),l(!0);const z=Ee.getCapabilities();b(z),r?.(R)}catch(R){const z=R instanceof Error?R:new Error("Failed to initialize camera");_(z),n?.(z)}finally{w(!1)}},m=async()=>{w(!0),_(null);try{const R=await Ee.switchCamera();i(R);const z=Ee.getCapabilities();b(z),r?.(R)}catch(R){const z=R instanceof Error?R:new Error("Failed to switch camera");_(z),n?.(z)}finally{w(!1)}},p=async()=>{if(!u.current||!t)return _(new Error("Camera not ready")),null;try{return await Ee.capturePhoto(u.current)}catch(R){const z=R instanceof Error?R:new Error("Failed to capture photo");return _(z),n?.(z),null}},j=async R=>{try{await Ee.setZoom(R)}catch(z){console.error("Zoom failed:",z)}},E=async R=>{try{await Ee.toggleFlash(R)}catch(z){console.error("Flash toggle failed:",z)}},S=()=>{Ee.dispose(),i(null),l(!1),b(null)};return X.useEffect(()=>{t&&u.current&&(u.current.srcObject=t)},[t]),X.useEffect(()=>(s&&x(),()=>{S()}),[]),{stream:t,isInitialized:c,isLoading:g,error:y,capabilities:h,videoRef:u,initialize:x,switchCamera:m,capturePhoto:p,setZoom:j,toggleFlash:E,dispose:S,facingMode:Ee.getCurrentFacingMode()}},le=({variant:f="primary",size:s="md",fullWidth:e=!1,className:n="",children:r,...t})=>{const i="btn font-medium transition-all duration-200 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",c={primary:"btn-primary",secondary:"btn-secondary",outline:"border-2 border-primary-600 text-primary-600 hover:bg-primary-50 active:bg-primary-100"},l={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"},g=e?"w-full":"";return d.jsx("button",{className:`${i} ${c[f]} ${l[s]} ${g} ${n}`,...t,children:r})},Oe=({icon:f,label:s,size:e="md",className:n="",...r})=>{const t={sm:"p-2",md:"p-3",lg:"p-4"};return d.jsx("button",{className:`btn-icon ${t[e]} ${n}`,"aria-label":s,title:s,...r,children:f})},De=({size:f="md",className:s=""})=>{const e={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"};return d.jsx("div",{className:`flex items-center justify-center ${s}`,children:d.jsx("div",{className:`${e[f]} border-4 border-gray-200 border-t-primary-600 rounded-full animate-spin`})})},at=()=>{const{addToast:f,setCameraCapabilities:s,setCurrentView:e,startScanSession:n}=ge(u=>({addToast:u.addToast,setCameraCapabilities:u.setCameraCapabilities,setCurrentView:u.setCurrentView,startScanSession:u.startScanSession})),{videoRef:r,isInitialized:t,isLoading:i,error:c,capabilities:l,facingMode:g,initialize:w,switchCamera:y,capturePhoto:_}=Wt({onError:u=>{f({type:"error",message:u.message||"Failed to access camera"})},onInitialized:()=>{f({type:"success",message:"Camera initialized successfully"})}});X.useEffect(()=>{l&&s(l)},[l,s]);const h=async()=>{const u=await _();u&&(n(u),e("crop"),f({type:"success",message:"Image captured successfully"}))},b=async()=>{try{await y(),f({type:"success",message:`Switched to ${g==="environment"?"front":"back"} camera`})}catch{f({type:"error",message:"Failed to switch camera"})}};return i?d.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-black",children:[d.jsx(De,{size:"lg",className:"mb-4"}),d.jsx("p",{className:"text-white text-sm",children:"Initializing camera..."})]}):c||!t&&!i?d.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-100 p-6",children:[d.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“·"}),d.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Camera Access Required"}),c&&d.jsx("p",{className:"text-sm text-red-600 mb-4 text-center max-w-md",children:c.message}),d.jsx("p",{className:"text-sm text-gray-600 mb-6 text-center max-w-md",children:"This app needs access to your camera to scan documents. Click the button below to grant permission."}),d.jsx(le,{onClick:w,variant:"primary",size:"lg",children:"Enable Camera"})]}):d.jsxs("div",{className:"relative w-full h-full bg-black",children:[d.jsx("video",{ref:r,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),d.jsx("div",{className:"absolute top-0 left-0 right-0 p-4",children:d.jsx("div",{className:"flex justify-end",children:d.jsx(Oe,{icon:d.jsx("span",{className:"text-xl",children:"ðŸ”„"}),onClick:b,className:"bg-black/50 text-white hover:bg-black/70",label:"Switch camera"})})}),d.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/80 to-transparent",children:d.jsx("div",{className:"flex items-center justify-center",children:d.jsx(le,{onClick:h,variant:"primary",size:"lg",className:"rounded-full w-16 h-16 p-0",children:d.jsx("span",{className:"text-2xl",children:"ðŸ“¸"})})})}),d.jsx("div",{className:"absolute inset-0 pointer-events-none",children:d.jsx("div",{className:"w-full h-full flex items-center justify-center p-8",children:d.jsx("div",{className:"border-2 border-white border-dashed rounded-lg w-full max-w-md aspect-document opacity-50"})})})]})},Gt=({corners:f,imageSize:s,containerSize:e,onChange:n,onCommit:r,className:t=""})=>{const[i,c]=X.useState(null),[l,g]=X.useState(f),w=X.useRef(null);X.useEffect(()=>{g(f)},[f]);const y=()=>{const E=s.width/s.height,S=e.width/e.height;let R,z,L=0,D=0;return E>S?(R=e.width/s.width,z=R,D=(e.height-s.height*z)/2):(z=e.height/s.height,R=z,L=(e.width-s.width*R)/2),{scaleX:R,scaleY:z,offsetX:L,offsetY:D}},_=E=>{const{scaleX:S,scaleY:R,offsetX:z,offsetY:L}=y();return{x:E.x*S+z,y:E.y*R+L}},h=E=>{const{scaleX:S,scaleY:R,offsetX:z,offsetY:L}=y();return{x:(E.x-z)/S,y:(E.y-L)/R}},b=E=>{if(!w.current)return{x:0,y:0};const R=w.current.getBoundingClientRect();let z,L;if("touches"in E){const D=E.touches[0];z=D.clientX,L=D.clientY}else z=E.clientX,L=E.clientY;return{x:z-R.left,y:L-R.top}},u=E=>S=>{S.preventDefault(),S.stopPropagation(),c(E)},x=E=>{if(i===null)return;E.preventDefault();const S=b(E),R=h(S),z={x:Math.max(0,Math.min(s.width,R.x)),y:Math.max(0,Math.min(s.height,R.y))},L=[...l];L[i]=z,g(L),n(L)},m=()=>{i!==null&&(c(null),r?.())},p=l.map(_),j=p.length===4?`M ${p[0].x} ${p[0].y} L ${p[1].x} ${p[1].y} L ${p[2].x} ${p[2].y} L ${p[3].x} ${p[3].y} Z`:"";return d.jsxs("svg",{ref:w,className:`absolute inset-0 w-full h-full ${t}`,style:{touchAction:"none"},onMouseMove:x,onMouseUp:m,onMouseLeave:m,onTouchMove:x,onTouchEnd:m,onTouchCancel:m,children:[j&&d.jsxs(d.Fragment,{children:[d.jsx("path",{d:j,fill:"rgba(59, 130, 246, 0.2)",stroke:"none"}),d.jsx("path",{d:j,fill:"none",stroke:"#3b82f6",strokeWidth:"2"})]}),p.map((E,S)=>d.jsxs("g",{children:[d.jsx("circle",{cx:E.x,cy:E.y,r:"20",fill:"transparent",style:{cursor:"grab"},onMouseDown:u(S),onTouchStart:u(S)}),d.jsx("circle",{cx:E.x,cy:E.y,r:"8",fill:"white",stroke:"#3b82f6",strokeWidth:"3",style:{cursor:"grab",pointerEvents:"none"}}),d.jsx("circle",{cx:E.x,cy:E.y,r:"3",fill:"#3b82f6",style:{pointerEvents:"none"}})]},S)),p.length===4&&p.map((E,S)=>{const R=p[(S+1)%4];return d.jsx("line",{x1:E.x,y1:E.y,x2:R.x,y2:R.y,stroke:"#3b82f6",strokeWidth:"2",strokeDasharray:"5,5",style:{pointerEvents:"none"}},`line-${S}`)})]})};function tt(){return!!window.cv}function We(){if(!window.cv)throw new Error("OpenCV not loaded. Call loadOpenCV() first.");return window.cv}function ve(f){return We().matFromImageData(f)}function ke(f){const s=We(),e=document.createElement("canvas");e.width=f.cols,e.height=f.rows;const n=e.getContext("2d");if(!n)throw new Error("Failed to get canvas context");return s.imshow(e,f),n.getImageData(0,0,e.width,e.height)}function we(...f){for(const s of f)s&&s.delete&&s.delete()}class Vt{constructor(){pe(this,"cv",null);pe(this,"isInitialized",!1)}async initialize(){if(console.log("[EdgeDetectionService] initialize() called, isInitialized:",this.isInitialized),!this.isInitialized)try{console.log("[EdgeDetectionService] Calling loadOpenCV()"),this.cv=window.cv instanceof Promise?await window.cv:window.cv,console.log("[EdgeDetectionService] loadOpenCV() completed, cv:",this.cv),this.isInitialized=!0,console.log("[EdgeDetectionService] EdgeDetectionService initialized")}catch(s){throw console.error("[EdgeDetectionService] Failed to initialize EdgeDetectionService:",s),s}}async detectDocument(s,e){console.log("[EdgeDetectionService] detectDocument() called, image size:",s.width,"x",s.height),this.isInitialized||(console.log("[EdgeDetectionService] Not initialized, calling initialize()"),await this.initialize());const r={...{cannyThreshold1:50,cannyThreshold2:150,blurKernelSize:5,dilationIterations:2,minAreaRatio:.1,maxAreaRatio:.95},...e};let t=null,i=null,c=null,l=null,g=null,w=null,y=null;try{console.log("[EdgeDetectionService] Starting edge detection pipeline"),console.log("[EdgeDetectionService] Converting ImageData to Mat"),t=ve(s),console.log("[EdgeDetectionService] ImageData converted, Mat size:",t.rows,"x",t.cols),console.log("[EdgeDetectionService] Converting to grayscale"),i=new this.cv.Mat,this.cv.cvtColor(t,i,this.cv.COLOR_RGBA2GRAY),console.log("[EdgeDetectionService] Grayscale conversion complete"),console.log("[EdgeDetectionService] Applying Gaussian blur"),c=new this.cv.Mat;const _=new this.cv.Size(r.blurKernelSize,r.blurKernelSize);this.cv.GaussianBlur(i,c,_,0),console.log("[EdgeDetectionService] Gaussian blur complete"),console.log("[EdgeDetectionService] Applying Canny edge detection"),l=new this.cv.Mat,this.cv.Canny(c,l,r.cannyThreshold1,r.cannyThreshold2),console.log("[EdgeDetectionService] Canny edge detection complete"),console.log("[EdgeDetectionService] Dilating edges"),g=new this.cv.Mat;const h=this.cv.Mat.ones(3,3,this.cv.CV_8U);this.cv.dilate(l,g,h,new this.cv.Point(-1,-1),r.dilationIterations),h.delete(),console.log("[EdgeDetectionService] Edge dilation complete"),console.log("[EdgeDetectionService] Finding contours"),w=new this.cv.MatVector,y=new this.cv.Mat,this.cv.findContours(g,w,y,this.cv.RETR_EXTERNAL,this.cv.CHAIN_APPROX_SIMPLE),console.log("[EdgeDetectionService] Found",w.size(),"contours"),console.log("[EdgeDetectionService] Finding best quadrilateral");const b=this.findBestQuadrilateral(w,s.width,s.height,r);return console.log("[EdgeDetectionService] Best quadrilateral result:",b),b}catch(_){return console.error("[EdgeDetectionService] Edge detection failed:",_),null}finally{console.log("[EdgeDetectionService] Cleaning up resources"),we(t,i,c,l,g,y),w&&w.delete(),console.log("[EdgeDetectionService] Cleanup complete")}}findBestQuadrilateral(s,e,n,r){const t=e*n,i=t*r.minAreaRatio,c=t*r.maxAreaRatio;let l=null,g=0;for(let w=0;w<s.size();w++){const y=s.get(w),_=this.cv.contourArea(y);if(_<i||_>c)continue;const h=this.cv.arcLength(y,!0),b=new this.cv.Mat;if(this.cv.approxPolyDP(y,b,.02*h,!0),b.rows===4){const u=this.matToPoints(b),x=this.getBoundingRect(u),m=x.width/x.height,p=this.scoreQuadrilateral(u,_,m,t);p>g&&(g=p,l={contour:this.orderCorners(u),confidence:Math.min(p/100,1),area:_,aspectRatio:m,boundingRect:x})}b.delete()}return l}scoreQuadrilateral(s,e,n,r){let t=0;const i=e/r;t+=i*50;const l=[1,1.29,1.41,1.5].reduce((w,y)=>{const _=Math.abs(n-y),h=Math.max(0,25-_*20);return Math.max(w,h)},0);t+=l;const g=this.isRoughlyConvex(s)?25:0;return t+=g,t}isRoughlyConvex(s){if(s.length!==4)return!1;const e=[];for(let t=0;t<4;t++){const i=s[t],c=s[(t+1)%4],l=s[(t+2)%4],g=(c.x-i.x)*(l.y-c.y)-(c.y-i.y)*(l.x-c.x);e.push(g)}const n=e.every(t=>t>0),r=e.every(t=>t<0);return n||r}matToPoints(s){const e=[];for(let n=0;n<s.rows;n++){const r=s.data32S[n*2],t=s.data32S[n*2+1];e.push({x:r,y:t})}return e}getBoundingRect(s){const e=s.map(l=>l.x),n=s.map(l=>l.y),r=Math.min(...e),t=Math.max(...e),i=Math.min(...n),c=Math.max(...n);return{x:r,y:i,width:t-r,height:c-i}}orderCorners(s){if(s.length!==4)return s;const e=[...s].sort((t,i)=>t.y-i.y),n=e.slice(0,2).sort((t,i)=>t.x-i.x),r=e.slice(2,4).sort((t,i)=>t.x-i.x);return[n[0],n[1],r[1],r[0]]}isReady(){return this.isInitialized&&tt()}}const Zt=new Vt;class $t{async correctPerspective(s,e,n){if(!tt())throw new Error("OpenCV not loaded");if(e.length!==4)throw new Error("Exactly 4 corners required");const t={...{outputWidth:0,outputHeight:0,preserveAspectRatio:!0,interpolation:"linear"},...n};let i=null,c=null,l=null;try{const g=We();i=ve(s);const w=t.outputWidth&&t.outputHeight?{width:t.outputWidth,height:t.outputHeight}:this.calculateOutputDimensions(e),y=this.ensureCornerOrder(e),_=g.matFromArray(4,1,g.CV_32FC2,[y[0].x,y[0].y,y[1].x,y[1].y,y[2].x,y[2].y,y[3].x,y[3].y]),h=g.matFromArray(4,1,g.CV_32FC2,[0,0,w.width,0,w.width,w.height,0,w.height]);l=g.getPerspectiveTransform(_,h),c=new g.Mat;const b=new g.Size(w.width,w.height),u=this.getInterpolationFlag(t.interpolation);g.warpPerspective(i,c,l,b,u,g.BORDER_CONSTANT,new g.Scalar(255,255,255,255));const x=ke(c),m=this.matrixToArray(l);return _.delete(),h.delete(),{correctedImage:x,transformMatrix:m,originalCorners:y,outputDimensions:w}}catch(g){return console.error("Perspective correction failed:",g),null}finally{we(i,c,l)}}calculateOutputDimensions(s){if(s.length!==4)throw new Error("Exactly 4 corners required");const e=this.ensureCornerOrder(s),n=this.distance(e[0],e[1]),r=this.distance(e[3],e[2]),t=this.distance(e[0],e[3]),i=this.distance(e[1],e[2]),c=Math.max(n,r),l=Math.max(t,i);return{width:Math.round(c),height:Math.round(l)}}distance(s,e){const n=e.x-s.x,r=e.y-s.y;return Math.sqrt(n*n+r*r)}ensureCornerOrder(s){if(s.length!==4)return s;const e={x:s.reduce((c,l)=>c+l.x,0)/4,y:s.reduce((c,l)=>c+l.y,0)/4},n=[...s].sort((c,l)=>{const g=Math.atan2(c.y-e.y,c.x-e.x),w=Math.atan2(l.y-e.y,l.x-e.x);return g-w}),r=n.map(c=>c.x+c.y),t=r.indexOf(Math.min(...r));return[n[t],n[(t+1)%4],n[(t+2)%4],n[(t+3)%4]]}getInterpolationFlag(s){const e=We();switch(s){case"nearest":return e.INTER_NEAREST;case"linear":return e.INTER_LINEAR;case"cubic":return e.INTER_CUBIC;case"lanczos":return e.INTER_LANCZOS4;default:return e.INTER_LINEAR}}matrixToArray(s){const e=[];for(let n=0;n<s.rows;n++){const r=[];for(let t=0;t<s.cols;t++)r.push(s.data64F[n*s.cols+t]);e.push(r)}return e}}const Ht=new $t,Yt=()=>{const f=X.useRef(null),s=X.useRef(null),[e,n]=X.useState(!1),[r,t]=X.useState(!1),[i,c]=X.useState({width:0,height:0}),{currentImage:l,detectedEdges:g,adjustedCorners:w,setCurrentView:y,resetScanSession:_,setDetectedEdges:h,setAdjustedCorners:b,setProcessedImage:u,addToast:x}=ge(S=>({currentImage:S.scanSession.currentImage,detectedEdges:S.scanSession.detectedEdges,adjustedCorners:S.scanSession.adjustedCorners,setCurrentView:S.setCurrentView,resetScanSession:S.resetScanSession,setDetectedEdges:S.setDetectedEdges,setAdjustedCorners:S.setAdjustedCorners,setProcessedImage:S.setProcessedImage,addToast:S.addToast}));X.useEffect(()=>{if(l&&f.current){const S=f.current,R=S.getContext("2d");if(!R)return;S.width=l.width,S.height=l.height,R.putImageData(l,0,0)}},[l]),X.useEffect(()=>{l&&!g&&!e&&m()},[l]),X.useEffect(()=>{const S=()=>{if(s.current){const R=s.current.getBoundingClientRect();c({width:R.width,height:R.height})}};return S(),window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)},[]);const m=async()=>{if(console.log("[CropView] detectEdges() called"),!!l){console.log("[CropView] Setting isDetecting to true"),n(!0);try{console.log("[CropView] Calling edgeDetectionService.detectDocument()");const S=await Zt.detectDocument(l);if(console.log("[CropView] detectDocument() returned:",S),S)h(S),b(S.contour),x({type:"success",message:"Document detected!"});else{const R=[{x:0,y:0},{x:l.width,y:0},{x:l.width,y:l.height},{x:0,y:l.height}];b(R),x({type:"warning",message:"Could not detect document. Using full image."})}}catch(S){console.error("[CropView] Edge detection failed:",S),x({type:"error",message:"Edge detection failed"})}finally{console.log("[CropView] Setting isDetecting to false"),n(!1)}}},p=S=>{b(S)},j=()=>{_(),y("camera")},E=async()=>{if(!(!l||!w)){t(!0);try{const S=await Ht.correctPerspective(l,w);if(S)u(S.correctedImage),y("enhance"),x({type:"success",message:"Image cropped successfully!"});else throw new Error("Perspective correction failed")}catch(S){console.error("Perspective correction failed:",S),x({type:"error",message:"Failed to crop image"})}finally{t(!1)}}};return l?e?d.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-900",children:[d.jsx(De,{size:"lg",className:"mb-4"}),d.jsx("p",{className:"text-white text-sm",children:"Detecting document edges..."})]}):d.jsxs("div",{className:"flex flex-col h-full bg-gray-900",children:[d.jsxs("div",{ref:s,className:"flex-1 overflow-hidden flex items-center justify-center p-4 relative",children:[d.jsx("canvas",{ref:f,className:"max-w-full max-h-full object-contain"}),w&&l&&i.width>0&&d.jsx(Gt,{corners:w,imageSize:{width:l.width,height:l.height},containerSize:i,onChange:p})]}),d.jsx("div",{className:"p-4 bg-white border-t border-gray-200",children:d.jsxs("div",{className:"flex gap-3",children:[d.jsx(le,{onClick:j,variant:"secondary",fullWidth:!0,disabled:r,children:"Retake"}),d.jsx(le,{onClick:m,variant:"secondary",fullWidth:!0,disabled:r,children:"Auto-Detect"}),d.jsx(le,{onClick:E,variant:"primary",fullWidth:!0,disabled:r,children:r?"Processing...":"Continue"})]})})]}):d.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-50 p-6",children:[d.jsx("p",{className:"text-gray-600",children:"No image captured"}),d.jsx(le,{onClick:()=>y("camera"),className:"mt-4",children:"Back to Camera"})]})};let Pe;const qt=new Uint8Array(16);function Kt(){if(!Pe&&(Pe=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Pe))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Pe(qt)}const fe=[];for(let f=0;f<256;++f)fe.push((f+256).toString(16).slice(1));function Xt(f,s=0){return fe[f[s+0]]+fe[f[s+1]]+fe[f[s+2]]+fe[f[s+3]]+"-"+fe[f[s+4]]+fe[f[s+5]]+"-"+fe[f[s+6]]+fe[f[s+7]]+"-"+fe[f[s+8]]+fe[f[s+9]]+"-"+fe[f[s+10]]+fe[f[s+11]]+fe[f[s+12]]+fe[f[s+13]]+fe[f[s+14]]+fe[f[s+15]]}const Jt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ot={randomUUID:Jt};function ct(f,s,e){if(ot.randomUUID&&!f)return ot.randomUUID();f=f||{};const n=f.random||(f.rng||Kt)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Xt(n)}const Qt=({selectedFilter:f,onSelect:s,disabled:e=!1})=>{const n=X.useRef(null),r=X.useRef(null);return X.useEffect(()=>{r.current&&n.current&&r.current.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},[f]),d.jsx("div",{className:"w-full bg-white border-b border-gray-200",children:d.jsx("div",{ref:n,className:"flex gap-2 px-4 py-3 overflow-x-auto scrollbar-hide",style:{scrollSnapType:"x mandatory",WebkitOverflowScrolling:"touch"},children:Ft.map(t=>{const i=t.id===f;return d.jsxs("button",{ref:i?r:null,onClick:()=>!e&&s(t.id),disabled:e,className:`
                flex-shrink-0 flex flex-col items-center justify-center
                min-w-[80px] px-3 py-2 rounded-lg
                transition-all duration-200
                ${i?"bg-blue-500 text-white shadow-md scale-105":"bg-gray-100 text-gray-700 hover:bg-gray-200"}
                ${e?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                scroll-snap-align-center
              `,style:{scrollSnapAlign:"center"},children:[d.jsx("span",{className:"text-2xl mb-1",children:t.icon}),d.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:t.name})]},t.id)})})})},Le=({label:f,value:s,min:e,max:n,step:r,onChange:t,disabled:i=!1,unit:c=""})=>{const l=(s-e)/(n-e)*100;return d.jsxs("div",{className:"mb-4",children:[d.jsxs("div",{className:"flex justify-between items-center mb-2",children:[d.jsx("label",{className:"text-sm font-medium text-gray-700",children:f}),d.jsxs("span",{className:"text-sm text-gray-500",children:[s.toFixed(r<1?1:0),c]})]}),d.jsx("div",{className:"relative",children:d.jsx("input",{type:"range",min:e,max:n,step:r,value:s,onChange:g=>t(parseFloat(g.target.value)),disabled:i,className:`
            w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer
            ${i?"opacity-50 cursor-not-allowed":""}
          `,style:{background:`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${l}%, #e5e7eb ${l}%, #e5e7eb 100%)`}})})]})},er=({options:f,onChange:s,disabled:e=!1})=>{const n=(r,t)=>{s({...f,[r]:t})};return d.jsxs("div",{className:"bg-white p-4 rounded-lg",children:[d.jsx("h3",{className:"text-sm font-semibold text-gray-800 mb-4",children:"Manual Adjustments"}),d.jsx(Le,{label:"Brightness",value:f.brightness,min:-100,max:100,step:1,onChange:r=>n("brightness",r),disabled:e}),d.jsx(Le,{label:"Contrast",value:f.contrast,min:-100,max:100,step:1,onChange:r=>n("contrast",r),disabled:e}),d.jsx(Le,{label:"Saturation",value:f.saturation,min:-100,max:100,step:1,onChange:r=>n("saturation",r),disabled:e}),d.jsx(Le,{label:"Gamma",value:f.gamma,min:.1,max:3,step:.1,onChange:r=>n("gamma",r),disabled:e}),d.jsx("button",{onClick:()=>s({brightness:0,contrast:0,saturation:0,sharpness:0,gamma:1,shadows:0,highlights:0,temperature:0}),disabled:e,className:"w-full mt-2 px-4 py-2 text-sm text-blue-600 bg-blue-50 rounded-lg hover:bg-blue-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Reset Adjustments"})]})};class tr{constructor(){pe(this,"cv",null);pe(this,"isInitialized",!1)}async initialize(){if(!this.isInitialized)try{this.cv=window.cv instanceof Promise?await window.cv:window.cv,this.isInitialized=!0,console.log("ImageEnhancementService initialized")}catch(s){throw console.error("Failed to initialize ImageEnhancementService:",s),s}}async enhance(s,e){this.isInitialized||await this.initialize();let n=null,r=null;try{if(n=ve(s),r=n.clone(),e.brightness!==0||e.contrast!==0){const t=1+e.contrast/100,i=e.brightness/100*255;r.convertTo(r,-1,t,i)}return e.gamma!==1&&this.applyGamma(r,e.gamma),e.saturation!==0&&this.applySaturation(r,e.saturation),ke(r)}catch(t){return console.error("Enhancement failed:",t),null}finally{we(n,r)}}async applyFilter(s,e){switch(this.isInitialized||await this.initialize(),e){case"original":return s;case"grayscale":return this.applyGrayscale(s);case"document":return this.applyDocumentFilter(s);case"magic":return this.applyMagicFilter(s);case"whiteboard":return this.applyWhiteboardFilter(s);case"book":return this.applyBookFilter(s);case"receipt":return this.applyReceiptFilter(s);case"photo":return this.applyPhotoFilter(s);case"blueprint":return this.applyBlueprintFilter(s);default:return s}}applyGrayscale(s){let e=null,n=null,r=null;try{return e=ve(s),n=new this.cv.Mat,this.cv.cvtColor(e,n,this.cv.COLOR_RGBA2GRAY),r=new this.cv.Mat,this.cv.cvtColor(n,r,this.cv.COLOR_GRAY2RGBA),r.convertTo(r,-1,1.1,5),ke(r)}catch(t){return console.error("Grayscale filter failed:",t),null}finally{we(e,n,r)}}applyDocumentFilter(s){let e=null,n=null,r=null,t=null,i=null;try{return e=ve(s),n=new this.cv.Mat,this.cv.cvtColor(e,n,this.cv.COLOR_RGBA2GRAY),r=new this.cv.Mat,this.cv.fastNlMeansDenoising(n,r,10,7,21),t=new this.cv.Mat,this.cv.adaptiveThreshold(r,t,255,this.cv.ADAPTIVE_THRESH_GAUSSIAN_C,this.cv.THRESH_BINARY,11,2),i=new this.cv.Mat,this.cv.cvtColor(t,i,this.cv.COLOR_GRAY2RGBA),ke(i)}catch(c){return console.error("Document filter failed:",c),null}finally{we(e,n,r,t,i)}}applyMagicFilter(s){let e=null,n=null,r=null,t=null,i=null;try{e=ve(s),n=new this.cv.Mat,this.cv.cvtColor(e,n,this.cv.COLOR_RGBA2RGB),this.cv.cvtColor(n,n,this.cv.COLOR_RGB2Lab),r=new this.cv.MatVector,this.cv.split(n,r),t=r.get(0);const c=new this.cv.CLAHE(2,new this.cv.Size(8,8));return c.apply(t,t),this.cv.merge(r,n),i=new this.cv.Mat,this.cv.cvtColor(n,i,this.cv.COLOR_Lab2RGB),this.cv.cvtColor(i,i,this.cv.COLOR_RGB2RGBA),i.convertTo(i,-1,1.1,0),r.delete(),c.delete(),ke(i)}catch(c){return console.error("Magic filter failed:",c),null}finally{we(e,n,t,i)}}applyWhiteboardFilter(s){let e=null,n=null,r=null,t=null,i=null;try{return e=ve(s),n=new this.cv.Mat,this.cv.cvtColor(e,n,this.cv.COLOR_RGBA2GRAY),r=new this.cv.Mat,this.cv.GaussianBlur(n,r,new this.cv.Size(5,5),0),t=new this.cv.Mat,this.cv.adaptiveThreshold(r,t,255,this.cv.ADAPTIVE_THRESH_GAUSSIAN_C,this.cv.THRESH_BINARY,15,10),i=new this.cv.Mat,this.cv.cvtColor(t,i,this.cv.COLOR_GRAY2RGBA),i.convertTo(i,-1,1,10),ke(i)}catch(c){return console.error("Whiteboard filter failed:",c),null}finally{we(e,n,r,t,i)}}applyBookFilter(s){let e=null,n=null,r=null,t=null,i=null;try{e=ve(s),n=new this.cv.Mat,this.cv.cvtColor(e,n,this.cv.COLOR_RGBA2GRAY),r=new this.cv.Mat,this.cv.fastNlMeansDenoising(n,r,10,7,21),t=new this.cv.Mat;const c=this.cv.matFromArray(3,3,this.cv.CV_32F,[0,-1,0,-1,5,-1,0,-1,0]);return this.cv.filter2D(r,t,this.cv.CV_8U,c),c.delete(),i=new this.cv.Mat,this.cv.cvtColor(t,i,this.cv.COLOR_GRAY2RGBA),i.convertTo(i,-1,1.2,0),ke(i)}catch(c){return console.error("Book filter failed:",c),null}finally{we(e,n,r,t,i)}}applyReceiptFilter(s){let e=null,n=null,r=null,t=null;try{return e=ve(s),n=new this.cv.Mat,this.cv.cvtColor(e,n,this.cv.COLOR_RGBA2GRAY),r=new this.cv.Mat,this.cv.threshold(n,r,0,255,this.cv.THRESH_BINARY+this.cv.THRESH_OTSU),t=new this.cv.Mat,this.cv.cvtColor(r,t,this.cv.COLOR_GRAY2RGBA),ke(t)}catch(i){return console.error("Receipt filter failed:",i),null}finally{we(e,n,r,t)}}applyPhotoFilter(s){let e=null,n=null;try{return e=ve(s),n=e.clone(),n.convertTo(n,-1,1.1,5),ke(n)}catch(r){return console.error("Photo filter failed:",r),null}finally{we(e,n)}}applyBlueprintFilter(s){let e=null,n=null,r=null,t=null;try{return e=ve(s),n=new this.cv.Mat,this.cv.cvtColor(e,n,this.cv.COLOR_RGBA2GRAY),r=new this.cv.Mat,this.cv.bitwise_not(n,r),t=new this.cv.Mat,this.cv.cvtColor(r,t,this.cv.COLOR_GRAY2RGBA),ke(t)}catch(i){return console.error("Blueprint filter failed:",i),null}finally{we(e,n,r,t)}}applyGamma(s,e){const n=new Uint8Array(256);for(let t=0;t<256;t++)n[t]=Math.pow(t/255,e)*255;const r=s.data;for(let t=0;t<r.length;t+=4)r[t]=n[r[t]],r[t+1]=n[r[t+1]],r[t+2]=n[r[t+2]]}applySaturation(s,e){const n=new this.cv.Mat;this.cv.cvtColor(s,n,this.cv.COLOR_RGBA2RGB),this.cv.cvtColor(n,n,this.cv.COLOR_RGB2HSV);const r=new this.cv.MatVector;this.cv.split(n,r);const t=r.get(1),i=1+e/100;t.convertTo(t,-1,i,0),this.cv.merge(r,n),this.cv.cvtColor(n,s,this.cv.COLOR_HSV2RGB),this.cv.cvtColor(s,s,this.cv.COLOR_RGB2RGBA),n.delete(),r.delete()}isReady(){return this.isInitialized&&tt()}}const Ze=new tr,rr=(f,s)=>s.some(e=>f instanceof e);let lt,dt;function nr(){return lt||(lt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function sr(){return dt||(dt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const pt=new WeakMap,Qe=new WeakMap,gt=new WeakMap,$e=new WeakMap,rt=new WeakMap;function ir(f){const s=new Promise((e,n)=>{const r=()=>{f.removeEventListener("success",t),f.removeEventListener("error",i)},t=()=>{e(Ne(f.result)),r()},i=()=>{n(f.error),r()};f.addEventListener("success",t),f.addEventListener("error",i)});return s.then(e=>{e instanceof IDBCursor&&pt.set(e,f)}).catch(()=>{}),rt.set(s,f),s}function ar(f){if(Qe.has(f))return;const s=new Promise((e,n)=>{const r=()=>{f.removeEventListener("complete",t),f.removeEventListener("error",i),f.removeEventListener("abort",i)},t=()=>{e(),r()},i=()=>{n(f.error||new DOMException("AbortError","AbortError")),r()};f.addEventListener("complete",t),f.addEventListener("error",i),f.addEventListener("abort",i)});Qe.set(f,s)}let et={get(f,s,e){if(f instanceof IDBTransaction){if(s==="done")return Qe.get(f);if(s==="objectStoreNames")return f.objectStoreNames||gt.get(f);if(s==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Ne(f[s])},set(f,s,e){return f[s]=e,!0},has(f,s){return f instanceof IDBTransaction&&(s==="done"||s==="store")?!0:s in f}};function or(f){et=f(et)}function cr(f){return f===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(s,...e){const n=f.call(He(this),s,...e);return gt.set(n,s.sort?s.sort():[s]),Ne(n)}:sr().includes(f)?function(...s){return f.apply(He(this),s),Ne(pt.get(this))}:function(...s){return Ne(f.apply(He(this),s))}}function lr(f){return typeof f=="function"?cr(f):(f instanceof IDBTransaction&&ar(f),rr(f,nr())?new Proxy(f,et):f)}function Ne(f){if(f instanceof IDBRequest)return ir(f);if($e.has(f))return $e.get(f);const s=lr(f);return s!==f&&($e.set(f,s),rt.set(s,f)),s}const He=f=>rt.get(f);function dr(f,s,{blocked:e,upgrade:n,blocking:r,terminated:t}={}){const i=indexedDB.open(f,s),c=Ne(i);return n&&i.addEventListener("upgradeneeded",l=>{n(Ne(i.result),l.oldVersion,l.newVersion,Ne(i.transaction),l)}),e&&i.addEventListener("blocked",l=>e(l.oldVersion,l.newVersion,l)),c.then(l=>{t&&l.addEventListener("close",()=>t()),r&&l.addEventListener("versionchange",g=>r(g.oldVersion,g.newVersion,g))}).catch(()=>{}),c}const ur=["get","getKey","getAll","getAllKeys","count"],hr=["put","add","delete","clear"],Ye=new Map;function ut(f,s){if(!(f instanceof IDBDatabase&&!(s in f)&&typeof s=="string"))return;if(Ye.get(s))return Ye.get(s);const e=s.replace(/FromIndex$/,""),n=s!==e,r=hr.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(r||ur.includes(e)))return;const t=async function(i,...c){const l=this.transaction(i,r?"readwrite":"readonly");let g=l.store;return n&&(g=g.index(c.shift())),(await Promise.all([g[e](...c),r&&l.done]))[0]};return Ye.set(s,t),t}or(f=>({...f,get:(s,e,n)=>ut(s,e)||f.get(s,e,n),has:(s,e)=>!!ut(s,e)||f.has(s,e)}));const fr="doc-scanner-db",mr=1,me="documents",be="pages";class pr{constructor(){pe(this,"db",null)}async initialize(){this.db||(this.db=await dr(fr,mr,{upgrade(s){if(!s.objectStoreNames.contains(me)){const e=s.createObjectStore(me,{keyPath:"id"});e.createIndex("by-created","createdAt"),e.createIndex("by-updated","updatedAt"),e.createIndex("by-name","name")}s.objectStoreNames.contains(be)||s.createObjectStore(be,{keyPath:"id"}).createIndex("by-document","documentId")}}))}async createDocument(s){if(!this.db)throw new Error("Database not initialized");const e=this.db.transaction([me,be],"readwrite");await e.objectStore(me).add(s);const n=e.objectStore(be);for(const r of s.pages)await n.add({...r,documentId:s.id});return await e.done,s}async getDocument(s){if(!this.db)throw new Error("Database not initialized");const e=await this.db.get(me,s);if(!e)return null;const n=await this.db.getAllFromIndex(be,"by-document",s);return e.pages=n.sort((r,t)=>r.pageNumber-t.pageNumber),e}async updateDocument(s){if(!this.db)throw new Error("Database not initialized");s.updatedAt=new Date;const e=this.db.transaction([me,be],"readwrite");await e.objectStore(me).put(s);const n=e.objectStore(be),r=await n.index("by-document").getAllKeys(s.id);for(const t of r)await n.delete(t);for(const t of s.pages)await n.add({...t,documentId:s.id});return await e.done,s}async deleteDocument(s){if(!this.db)throw new Error("Database not initialized");const e=this.db.transaction([me,be],"readwrite");await e.objectStore(me).delete(s);const n=e.objectStore(be),r=await n.index("by-document").getAllKeys(s);for(const t of r)await n.delete(t);await e.done}async listDocuments(s){if(!this.db)throw new Error("Database not initialized");const e=s?.sortBy||"updatedAt",n=s?.sortOrder||"desc",r=s?.limit,t=s?.offset||0;let i;e==="name"?i=await this.db.getAllFromIndex(me,"by-name"):e==="createdAt"?i=await this.db.getAllFromIndex(me,"by-created"):i=await this.db.getAllFromIndex(me,"by-updated"),n==="desc"&&i.reverse();for(const c of i){const l=await this.db.getAllFromIndex(be,"by-document",c.id);c.pages=l.sort((g,w)=>g.pageNumber-w.pageNumber)}return r!==void 0?i=i.slice(t,t+r):t>0&&(i=i.slice(t)),i}async searchDocuments(s){if(!this.db)throw new Error("Database not initialized");const e=await this.listDocuments(),n=[],r=s.toLowerCase();for(const t of e)for(const i of t.pages)if(i.ocrResult){const c=[],l=i.ocrResult.text.toLowerCase();let g=l.indexOf(r);for(;g!==-1;)c.push({text:i.ocrResult.text.substr(g,s.length),position:g}),g=l.indexOf(r,g+1);c.length>0&&n.push({documentId:t.id,pageId:i.id,matches:c})}return n}async getStorageUsage(){if(!navigator.storage||!navigator.storage.estimate)return{used:0,quota:0,percentage:0};const s=await navigator.storage.estimate(),e=s.usage||0,n=s.quota||0,r=n>0?e/n*100:0;return{used:e,quota:n,percentage:r}}async clearAll(){if(!this.db)throw new Error("Database not initialized");const s=this.db.transaction([me,be],"readwrite");await s.objectStore(me).clear(),await s.objectStore(be).clear(),await s.done}async addPage(s,e){if(!this.db)throw new Error("Database not initialized");const n=await this.getDocument(s);if(!n)throw new Error("Document not found");n.pages.push(e),n.metadata.totalPages=n.pages.length,await this.updateDocument(n)}async removePage(s,e){if(!this.db)throw new Error("Database not initialized");const n=await this.getDocument(s);if(!n)throw new Error("Document not found");n.pages=n.pages.filter(r=>r.id!==e),n.pages.forEach((r,t)=>{r.pageNumber=t+1}),n.metadata.totalPages=n.pages.length,await this.updateDocument(n)}async reorderPages(s,e){if(!this.db)throw new Error("Database not initialized");const n=await this.getDocument(s);if(!n)throw new Error("Document not found");const r=new Map(n.pages.map(t=>[t.id,t]));n.pages=e.map(t=>r.get(t)).filter(Boolean),n.pages.forEach((t,i)=>{t.pageNumber=i+1}),await this.updateDocument(n)}async exportDocument(s){if(!this.db)throw new Error("Database not initialized");const e=await this.getDocument(s);if(!e)throw new Error("Document not found");const n=JSON.stringify(e,null,2);return new Blob([n],{type:"application/json"})}async importDocument(s){if(!this.db)throw new Error("Database not initialized");const e=await s.text(),n=JSON.parse(e);return n.createdAt=new Date(n.createdAt),n.updatedAt=new Date(n.updatedAt),await this.createDocument(n),n}}let Me=null;async function Se(){return Me||(Me=new pr,await Me.initialize()),Me}const gr=()=>{const f=X.useRef(null),[s,e]=X.useState(!1),[n,r]=X.useState(null),[t,i]=X.useState(!1),{currentImage:c,processedImage:l,adjustedCorners:g,selectedFilter:w,enhancementOptions:y,setCurrentView:_,setSelectedFilter:h,setEnhancementOptions:b,addDocument:u,resetScanSession:x,addToast:m}=ge(D=>({currentImage:D.scanSession.currentImage,processedImage:D.scanSession.processedImage,adjustedCorners:D.scanSession.adjustedCorners,selectedFilter:D.scanSession.selectedFilter,enhancementOptions:D.scanSession.enhancementOptions,setCurrentView:D.setCurrentView,setSelectedFilter:D.setSelectedFilter,setEnhancementOptions:D.setEnhancementOptions,addDocument:D.addDocument,resetScanSession:D.resetScanSession,addToast:D.addToast}));X.useEffect(()=>{l&&!n&&(r(l),p(l))},[l]),X.useEffect(()=>{l&&j(w)},[w]),X.useEffect(()=>{n&&S(y)&&E()},[y]);const p=D=>{if(!f.current)return;const W=f.current,Z=W.getContext("2d");Z&&(W.width=D.width,W.height=D.height,Z.putImageData(D,0,0))},j=async D=>{if(l){e(!0);try{const W=await Ze.applyFilter(l,D);W?(r(W),p(W),b(Ue)):m({type:"error",message:"Failed to apply filter"})}catch(W){console.error("Filter application failed:",W),m({type:"error",message:"Filter application failed"})}finally{e(!1)}}},E=async()=>{if(n){e(!0);try{let D=l;if(w!=="original"&&(D=await Ze.applyFilter(l,w)),!D)throw new Error("Failed to get base image");const W=await Ze.enhance(D,y);W?(r(W),p(W)):m({type:"error",message:"Failed to apply adjustments"})}catch(D){console.error("Manual adjustment failed:",D)}finally{e(!1)}}},S=D=>D.brightness!==0||D.contrast!==0||D.saturation!==0||D.gamma!==1,R=D=>{h(D)},z=D=>{b(D)},L=async()=>{if(!n||!c){m({type:"error",message:"No image to save"});return}e(!0);try{const D=document.createElement("canvas"),W=D.getContext("2d");if(!W)throw new Error("Failed to get canvas context");D.width=n.width,D.height=n.height,W.putImageData(n,0,0);const Z=await new Promise((H,ae)=>{D.toBlob(ce=>{ce?H(ce):ae(new Error("Failed to convert canvas to blob"))},"image/png")}),k=document.createElement("canvas"),N=k.getContext("2d");if(!N)throw new Error("Failed to get canvas context");k.width=c.width,k.height=c.height,N.putImageData(c,0,0);const o=await new Promise((H,ae)=>{k.toBlob(ce=>{ce?H(ce):ae(new Error("Failed to convert canvas to blob"))},"image/png")}),T=document.createElement("canvas"),U=T.getContext("2d");if(!U)throw new Error("Failed to get canvas context");const P=300,Q=Math.min(P/n.width,P/n.height);T.width=n.width*Q,T.height=n.height*Q,U.drawImage(D,0,0,T.width,T.height);const V=await new Promise((H,ae)=>{T.toBlob(ce=>{ce?H(ce):ae(new Error("Failed to convert canvas to blob"))},"image/jpeg",.8)}),te={id:ct(),pageNumber:1,originalImage:o,processedImage:Z,thumbnailImage:V,corners:g||[],enhancementSettings:y,filterApplied:w,dimensions:{width:n.width,height:n.height}},F=new Date,A=`Document ${F.toLocaleDateString()} ${F.toLocaleTimeString()}`,ee={id:ct(),name:A,createdAt:F,updatedAt:F,pages:[te],tags:[],metadata:{totalPages:1,hasOCR:!1,fileSize:Z.size,source:"camera"}};await(await Se()).createDocument(ee),u(ee),x(),m({type:"success",message:"Document saved successfully"}),_("documents")}catch(D){console.error("Failed to save document:",D),m({type:"error",message:"Failed to save document"})}finally{e(!1)}};return l?d.jsxs("div",{className:"flex flex-col h-full bg-gray-900",children:[d.jsxs("div",{className:"flex-1 overflow-hidden flex items-center justify-center p-4 relative",children:[d.jsx("canvas",{ref:f,className:"max-w-full max-h-full object-contain shadow-2xl"}),s&&d.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:d.jsxs("div",{className:"bg-white rounded-lg p-4 flex items-center gap-3",children:[d.jsx(De,{size:"sm"}),d.jsx("span",{className:"text-sm text-gray-700",children:"Processing..."})]})})]}),d.jsx(Qt,{selectedFilter:w,onSelect:R,disabled:s}),d.jsx("div",{className:"bg-white border-t border-gray-200 px-4 py-2",children:d.jsxs("button",{onClick:()=>i(!t),className:"w-full flex items-center justify-between text-sm font-medium text-gray-700 hover:text-gray-900",children:[d.jsx("span",{children:"Manual Adjustments"}),d.jsx("span",{className:"text-lg",children:t?"â–¼":"â–¶"})]})}),t&&d.jsx("div",{className:"bg-gray-50 border-t border-gray-200 max-h-80 overflow-y-auto",children:d.jsx(er,{options:y,onChange:z,disabled:s})}),d.jsx("div",{className:"p-4 bg-white border-t border-gray-200",children:d.jsxs("div",{className:"flex gap-3",children:[d.jsx(le,{onClick:()=>_("crop"),variant:"secondary",fullWidth:!0,disabled:s,children:"Back"}),d.jsx(le,{onClick:L,variant:"primary",fullWidth:!0,disabled:s,children:"Save Document"})]})})]}):d.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-50 p-6",children:[d.jsx("p",{className:"text-gray-600",children:"No image to enhance"}),d.jsx(le,{onClick:()=>_("camera"),className:"mt-4",children:"Back to Camera"})]})};var xt={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(f,s){(function(e){f.exports=e()})(function(){return function e(n,r,t){function i(g,w){if(!r[g]){if(!n[g]){var y=typeof Be=="function"&&Be;if(!w&&y)return y(g,!0);if(c)return c(g,!0);var _=new Error("Cannot find module '"+g+"'");throw _.code="MODULE_NOT_FOUND",_}var h=r[g]={exports:{}};n[g][0].call(h.exports,function(b){var u=n[g][1][b];return i(u||b)},h,h.exports,e,n,r,t)}return r[g].exports}for(var c=typeof Be=="function"&&Be,l=0;l<t.length;l++)i(t[l]);return i}({1:[function(e,n,r){var t=e("./utils"),i=e("./support"),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(l){for(var g,w,y,_,h,b,u,x=[],m=0,p=l.length,j=p,E=t.getTypeOf(l)!=="string";m<l.length;)j=p-m,y=E?(g=l[m++],w=m<p?l[m++]:0,m<p?l[m++]:0):(g=l.charCodeAt(m++),w=m<p?l.charCodeAt(m++):0,m<p?l.charCodeAt(m++):0),_=g>>2,h=(3&g)<<4|w>>4,b=1<j?(15&w)<<2|y>>6:64,u=2<j?63&y:64,x.push(c.charAt(_)+c.charAt(h)+c.charAt(b)+c.charAt(u));return x.join("")},r.decode=function(l){var g,w,y,_,h,b,u=0,x=0,m="data:";if(l.substr(0,m.length)===m)throw new Error("Invalid base64 input, it looks like a data url.");var p,j=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===c.charAt(64)&&j--,l.charAt(l.length-2)===c.charAt(64)&&j--,j%1!=0)throw new Error("Invalid base64 input, bad content length.");for(p=i.uint8array?new Uint8Array(0|j):new Array(0|j);u<l.length;)g=c.indexOf(l.charAt(u++))<<2|(_=c.indexOf(l.charAt(u++)))>>4,w=(15&_)<<4|(h=c.indexOf(l.charAt(u++)))>>2,y=(3&h)<<6|(b=c.indexOf(l.charAt(u++))),p[x++]=g,h!==64&&(p[x++]=w),b!==64&&(p[x++]=y);return p}},{"./support":30,"./utils":32}],2:[function(e,n,r){var t=e("./external"),i=e("./stream/DataWorker"),c=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function g(w,y,_,h,b){this.compressedSize=w,this.uncompressedSize=y,this.crc32=_,this.compression=h,this.compressedContent=b}g.prototype={getContentWorker:function(){var w=new i(t.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),y=this;return w.on("end",function(){if(this.streamInfo.data_length!==y.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),w},getCompressedWorker:function(){return new i(t.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},g.createWorkerFrom=function(w,y,_){return w.pipe(new c).pipe(new l("uncompressedSize")).pipe(y.compressWorker(_)).pipe(new l("compressedSize")).withStreamInfo("compression",y)},n.exports=g},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,n,r){var t=e("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(){return new t("STORE compression")},uncompressWorker:function(){return new t("STORE decompression")}},r.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,n,r){var t=e("./utils"),i=function(){for(var c,l=[],g=0;g<256;g++){c=g;for(var w=0;w<8;w++)c=1&c?3988292384^c>>>1:c>>>1;l[g]=c}return l}();n.exports=function(c,l){return c!==void 0&&c.length?t.getTypeOf(c)!=="string"?function(g,w,y,_){var h=i,b=_+y;g^=-1;for(var u=_;u<b;u++)g=g>>>8^h[255&(g^w[u])];return-1^g}(0|l,c,c.length,0):function(g,w,y,_){var h=i,b=_+y;g^=-1;for(var u=_;u<b;u++)g=g>>>8^h[255&(g^w.charCodeAt(u))];return-1^g}(0|l,c,c.length,0):0}},{"./utils":32}],5:[function(e,n,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(e,n,r){var t=null;t=typeof Promise<"u"?Promise:e("lie"),n.exports={Promise:t}},{lie:37}],7:[function(e,n,r){var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",i=e("pako"),c=e("./utils"),l=e("./stream/GenericWorker"),g=t?"uint8array":"array";function w(y,_){l.call(this,"FlateWorker/"+y),this._pako=null,this._pakoAction=y,this._pakoOptions=_,this.meta={}}r.magic="\b\0",c.inherits(w,l),w.prototype.processChunk=function(y){this.meta=y.meta,this._pako===null&&this._createPako(),this._pako.push(c.transformTo(g,y.data),!1)},w.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},w.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},w.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var y=this;this._pako.onData=function(_){y.push({data:_,meta:y.meta})}},r.compressWorker=function(y){return new w("Deflate",y)},r.uncompressWorker=function(){return new w("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,n,r){function t(h,b){var u,x="";for(u=0;u<b;u++)x+=String.fromCharCode(255&h),h>>>=8;return x}function i(h,b,u,x,m,p){var j,E,S=h.file,R=h.compression,z=p!==g.utf8encode,L=c.transformTo("string",p(S.name)),D=c.transformTo("string",g.utf8encode(S.name)),W=S.comment,Z=c.transformTo("string",p(W)),k=c.transformTo("string",g.utf8encode(W)),N=D.length!==S.name.length,o=k.length!==W.length,T="",U="",P="",Q=S.dir,V=S.date,te={crc32:0,compressedSize:0,uncompressedSize:0};b&&!u||(te.crc32=h.crc32,te.compressedSize=h.compressedSize,te.uncompressedSize=h.uncompressedSize);var F=0;b&&(F|=8),z||!N&&!o||(F|=2048);var A=0,ee=0;Q&&(A|=16),m==="UNIX"?(ee=798,A|=function(H,ae){var ce=H;return H||(ce=ae?16893:33204),(65535&ce)<<16}(S.unixPermissions,Q)):(ee=20,A|=function(H){return 63&(H||0)}(S.dosPermissions)),j=V.getUTCHours(),j<<=6,j|=V.getUTCMinutes(),j<<=5,j|=V.getUTCSeconds()/2,E=V.getUTCFullYear()-1980,E<<=4,E|=V.getUTCMonth()+1,E<<=5,E|=V.getUTCDate(),N&&(U=t(1,1)+t(w(L),4)+D,T+="up"+t(U.length,2)+U),o&&(P=t(1,1)+t(w(Z),4)+k,T+="uc"+t(P.length,2)+P);var K="";return K+=`
\0`,K+=t(F,2),K+=R.magic,K+=t(j,2),K+=t(E,2),K+=t(te.crc32,4),K+=t(te.compressedSize,4),K+=t(te.uncompressedSize,4),K+=t(L.length,2),K+=t(T.length,2),{fileRecord:y.LOCAL_FILE_HEADER+K+L+T,dirRecord:y.CENTRAL_FILE_HEADER+t(ee,2)+K+t(Z.length,2)+"\0\0\0\0"+t(A,4)+t(x,4)+L+T+Z}}var c=e("../utils"),l=e("../stream/GenericWorker"),g=e("../utf8"),w=e("../crc32"),y=e("../signature");function _(h,b,u,x){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=b,this.zipPlatform=u,this.encodeFileName=x,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}c.inherits(_,l),_.prototype.push=function(h){var b=h.meta.percent||0,u=this.entriesCount,x=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,l.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:u?(b+100*(u-x-1))/u:100}}))},_.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var b=this.streamFiles&&!h.file.dir;if(b){var u=i(h,b,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:u.fileRecord,meta:{percent:0}})}else this.accumulate=!0},_.prototype.closedSource=function(h){this.accumulate=!1;var b=this.streamFiles&&!h.file.dir,u=i(h,b,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(u.dirRecord),b)this.push({data:function(x){return y.DATA_DESCRIPTOR+t(x.crc32,4)+t(x.compressedSize,4)+t(x.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:u.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},_.prototype.flush=function(){for(var h=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});var u=this.bytesWritten-h,x=function(m,p,j,E,S){var R=c.transformTo("string",S(E));return y.CENTRAL_DIRECTORY_END+"\0\0\0\0"+t(m,2)+t(m,2)+t(p,4)+t(j,4)+t(R.length,2)+R}(this.dirRecords.length,u,h,this.zipComment,this.encodeFileName);this.push({data:x,meta:{percent:100}})},_.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},_.prototype.registerPrevious=function(h){this._sources.push(h);var b=this;return h.on("data",function(u){b.processChunk(u)}),h.on("end",function(){b.closedSource(b.previous.streamInfo),b._sources.length?b.prepareNextSource():b.end()}),h.on("error",function(u){b.error(u)}),this},_.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},_.prototype.error=function(h){var b=this._sources;if(!l.prototype.error.call(this,h))return!1;for(var u=0;u<b.length;u++)try{b[u].error(h)}catch{}return!0},_.prototype.lock=function(){l.prototype.lock.call(this);for(var h=this._sources,b=0;b<h.length;b++)h[b].lock()},n.exports=_},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,n,r){var t=e("../compressions"),i=e("./ZipFileWorker");r.generateWorker=function(c,l,g){var w=new i(l.streamFiles,g,l.platform,l.encodeFileName),y=0;try{c.forEach(function(_,h){y++;var b=function(p,j){var E=p||j,S=t[E];if(!S)throw new Error(E+" is not a valid compression method !");return S}(h.options.compression,l.compression),u=h.options.compressionOptions||l.compressionOptions||{},x=h.dir,m=h.date;h._compressWorker(b,u).withStreamInfo("file",{name:_,dir:x,date:m,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(w)}),w.entriesCount=y}catch(_){w.error(_)}return w}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,n,r){function t(){if(!(this instanceof t))return new t;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var i=new t;for(var c in this)typeof this[c]!="function"&&(i[c]=this[c]);return i}}(t.prototype=e("./object")).loadAsync=e("./load"),t.support=e("./support"),t.defaults=e("./defaults"),t.version="3.10.1",t.loadAsync=function(i,c){return new t().loadAsync(i,c)},t.external=e("./external"),n.exports=t},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,n,r){var t=e("./utils"),i=e("./external"),c=e("./utf8"),l=e("./zipEntries"),g=e("./stream/Crc32Probe"),w=e("./nodejsUtils");function y(_){return new i.Promise(function(h,b){var u=_.decompressed.getContentWorker().pipe(new g);u.on("error",function(x){b(x)}).on("end",function(){u.streamInfo.crc32!==_.decompressed.crc32?b(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}n.exports=function(_,h){var b=this;return h=t.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:c.utf8decode}),w.isNode&&w.isStream(_)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):t.prepareContent("the loaded zip file",_,!0,h.optimizedBinaryString,h.base64).then(function(u){var x=new l(h);return x.load(u),x}).then(function(u){var x=[i.Promise.resolve(u)],m=u.files;if(h.checkCRC32)for(var p=0;p<m.length;p++)x.push(y(m[p]));return i.Promise.all(x)}).then(function(u){for(var x=u.shift(),m=x.files,p=0;p<m.length;p++){var j=m[p],E=j.fileNameStr,S=t.resolve(j.fileNameStr);b.file(S,j.decompressed,{binary:!0,optimizedBinaryString:!0,date:j.date,dir:j.dir,comment:j.fileCommentStr.length?j.fileCommentStr:null,unixPermissions:j.unixPermissions,dosPermissions:j.dosPermissions,createFolders:h.createFolders}),j.dir||(b.file(S).unsafeOriginalName=E)}return x.zipComment.length&&(b.comment=x.zipComment),b})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,n,r){var t=e("../utils"),i=e("../stream/GenericWorker");function c(l,g){i.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(g)}t.inherits(c,i),c.prototype._bindStream=function(l){var g=this;(this._stream=l).pause(),l.on("data",function(w){g.push({data:w,meta:{percent:0}})}).on("error",function(w){g.isPaused?this.generatedError=w:g.error(w)}).on("end",function(){g.isPaused?g._upstreamEnded=!0:g.end()})},c.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},c.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=c},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,n,r){var t=e("readable-stream").Readable;function i(c,l,g){t.call(this,l),this._helper=c;var w=this;c.on("data",function(y,_){w.push(y)||w._helper.pause(),g&&g(_)}).on("error",function(y){w.emit("error",y)}).on("end",function(){w.push(null)})}e("../utils").inherits(i,t),i.prototype._read=function(){this._helper.resume()},n.exports=i},{"../utils":32,"readable-stream":16}],14:[function(e,n,r){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(t,i){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(t,i);if(typeof t=="number")throw new Error('The "data" argument must not be a number');return new Buffer(t,i)},allocBuffer:function(t){if(Buffer.alloc)return Buffer.alloc(t);var i=new Buffer(t);return i.fill(0),i},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&typeof t.on=="function"&&typeof t.pause=="function"&&typeof t.resume=="function"}}},{}],15:[function(e,n,r){function t(S,R,z){var L,D=c.getTypeOf(R),W=c.extend(z||{},w);W.date=W.date||new Date,W.compression!==null&&(W.compression=W.compression.toUpperCase()),typeof W.unixPermissions=="string"&&(W.unixPermissions=parseInt(W.unixPermissions,8)),W.unixPermissions&&16384&W.unixPermissions&&(W.dir=!0),W.dosPermissions&&16&W.dosPermissions&&(W.dir=!0),W.dir&&(S=m(S)),W.createFolders&&(L=x(S))&&p.call(this,L,!0);var Z=D==="string"&&W.binary===!1&&W.base64===!1;z&&z.binary!==void 0||(W.binary=!Z),(R instanceof y&&R.uncompressedSize===0||W.dir||!R||R.length===0)&&(W.base64=!1,W.binary=!0,R="",W.compression="STORE",D="string");var k=null;k=R instanceof y||R instanceof l?R:b.isNode&&b.isStream(R)?new u(S,R):c.prepareContent(S,R,W.binary,W.optimizedBinaryString,W.base64);var N=new _(S,k,W);this.files[S]=N}var i=e("./utf8"),c=e("./utils"),l=e("./stream/GenericWorker"),g=e("./stream/StreamHelper"),w=e("./defaults"),y=e("./compressedObject"),_=e("./zipObject"),h=e("./generate"),b=e("./nodejsUtils"),u=e("./nodejs/NodejsStreamInputAdapter"),x=function(S){S.slice(-1)==="/"&&(S=S.substring(0,S.length-1));var R=S.lastIndexOf("/");return 0<R?S.substring(0,R):""},m=function(S){return S.slice(-1)!=="/"&&(S+="/"),S},p=function(S,R){return R=R!==void 0?R:w.createFolders,S=m(S),this.files[S]||t.call(this,S,null,{dir:!0,createFolders:R}),this.files[S]};function j(S){return Object.prototype.toString.call(S)==="[object RegExp]"}var E={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(S){var R,z,L;for(R in this.files)L=this.files[R],(z=R.slice(this.root.length,R.length))&&R.slice(0,this.root.length)===this.root&&S(z,L)},filter:function(S){var R=[];return this.forEach(function(z,L){S(z,L)&&R.push(L)}),R},file:function(S,R,z){if(arguments.length!==1)return S=this.root+S,t.call(this,S,R,z),this;if(j(S)){var L=S;return this.filter(function(W,Z){return!Z.dir&&L.test(W)})}var D=this.files[this.root+S];return D&&!D.dir?D:null},folder:function(S){if(!S)return this;if(j(S))return this.filter(function(D,W){return W.dir&&S.test(D)});var R=this.root+S,z=p.call(this,R),L=this.clone();return L.root=z.name,L},remove:function(S){S=this.root+S;var R=this.files[S];if(R||(S.slice(-1)!=="/"&&(S+="/"),R=this.files[S]),R&&!R.dir)delete this.files[S];else for(var z=this.filter(function(D,W){return W.name.slice(0,S.length)===S}),L=0;L<z.length;L++)delete this.files[z[L].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(S){var R,z={};try{if((z=c.extend(S||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=z.type.toLowerCase(),z.compression=z.compression.toUpperCase(),z.type==="binarystring"&&(z.type="string"),!z.type)throw new Error("No output type specified.");c.checkSupport(z.type),z.platform!=="darwin"&&z.platform!=="freebsd"&&z.platform!=="linux"&&z.platform!=="sunos"||(z.platform="UNIX"),z.platform==="win32"&&(z.platform="DOS");var L=z.comment||this.comment||"";R=h.generateWorker(this,z,L)}catch(D){(R=new l("error")).error(D)}return new g(R,z.type||"string",z.mimeType)},generateAsync:function(S,R){return this.generateInternalStream(S).accumulate(R)},generateNodeStream:function(S,R){return(S=S||{}).type||(S.type="nodebuffer"),this.generateInternalStream(S).toNodejsStream(R)}};n.exports=E},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,n,r){n.exports=e("stream")},{stream:void 0}],17:[function(e,n,r){var t=e("./DataReader");function i(c){t.call(this,c);for(var l=0;l<this.data.length;l++)c[l]=255&c[l]}e("../utils").inherits(i,t),i.prototype.byteAt=function(c){return this.data[this.zero+c]},i.prototype.lastIndexOfSignature=function(c){for(var l=c.charCodeAt(0),g=c.charCodeAt(1),w=c.charCodeAt(2),y=c.charCodeAt(3),_=this.length-4;0<=_;--_)if(this.data[_]===l&&this.data[_+1]===g&&this.data[_+2]===w&&this.data[_+3]===y)return _-this.zero;return-1},i.prototype.readAndCheckSignature=function(c){var l=c.charCodeAt(0),g=c.charCodeAt(1),w=c.charCodeAt(2),y=c.charCodeAt(3),_=this.readData(4);return l===_[0]&&g===_[1]&&w===_[2]&&y===_[3]},i.prototype.readData=function(c){if(this.checkOffset(c),c===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+c);return this.index+=c,l},n.exports=i},{"../utils":32,"./DataReader":18}],18:[function(e,n,r){var t=e("../utils");function i(c){this.data=c,this.length=c.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(c){this.checkIndex(this.index+c)},checkIndex:function(c){if(this.length<this.zero+c||c<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+c+"). Corrupted zip ?")},setIndex:function(c){this.checkIndex(c),this.index=c},skip:function(c){this.setIndex(this.index+c)},byteAt:function(){},readInt:function(c){var l,g=0;for(this.checkOffset(c),l=this.index+c-1;l>=this.index;l--)g=(g<<8)+this.byteAt(l);return this.index+=c,g},readString:function(c){return t.transformTo("string",this.readData(c))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var c=this.readInt(4);return new Date(Date.UTC(1980+(c>>25&127),(c>>21&15)-1,c>>16&31,c>>11&31,c>>5&63,(31&c)<<1))}},n.exports=i},{"../utils":32}],19:[function(e,n,r){var t=e("./Uint8ArrayReader");function i(c){t.call(this,c)}e("../utils").inherits(i,t),i.prototype.readData=function(c){this.checkOffset(c);var l=this.data.slice(this.zero+this.index,this.zero+this.index+c);return this.index+=c,l},n.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,n,r){var t=e("./DataReader");function i(c){t.call(this,c)}e("../utils").inherits(i,t),i.prototype.byteAt=function(c){return this.data.charCodeAt(this.zero+c)},i.prototype.lastIndexOfSignature=function(c){return this.data.lastIndexOf(c)-this.zero},i.prototype.readAndCheckSignature=function(c){return c===this.readData(4)},i.prototype.readData=function(c){this.checkOffset(c);var l=this.data.slice(this.zero+this.index,this.zero+this.index+c);return this.index+=c,l},n.exports=i},{"../utils":32,"./DataReader":18}],21:[function(e,n,r){var t=e("./ArrayReader");function i(c){t.call(this,c)}e("../utils").inherits(i,t),i.prototype.readData=function(c){if(this.checkOffset(c),c===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+c);return this.index+=c,l},n.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(e,n,r){var t=e("../utils"),i=e("../support"),c=e("./ArrayReader"),l=e("./StringReader"),g=e("./NodeBufferReader"),w=e("./Uint8ArrayReader");n.exports=function(y){var _=t.getTypeOf(y);return t.checkSupport(_),_!=="string"||i.uint8array?_==="nodebuffer"?new g(y):i.uint8array?new w(t.transformTo("uint8array",y)):new c(t.transformTo("array",y)):new l(y)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,n,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,n,r){var t=e("./GenericWorker"),i=e("../utils");function c(l){t.call(this,"ConvertWorker to "+l),this.destType=l}i.inherits(c,t),c.prototype.processChunk=function(l){this.push({data:i.transformTo(this.destType,l.data),meta:l.meta})},n.exports=c},{"../utils":32,"./GenericWorker":28}],25:[function(e,n,r){var t=e("./GenericWorker"),i=e("../crc32");function c(){t.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(c,t),c.prototype.processChunk=function(l){this.streamInfo.crc32=i(l.data,this.streamInfo.crc32||0),this.push(l)},n.exports=c},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,n,r){var t=e("../utils"),i=e("./GenericWorker");function c(l){i.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}t.inherits(c,i),c.prototype.processChunk=function(l){if(l){var g=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=g+l.data.length}i.prototype.processChunk.call(this,l)},n.exports=c},{"../utils":32,"./GenericWorker":28}],27:[function(e,n,r){var t=e("../utils"),i=e("./GenericWorker");function c(l){i.call(this,"DataWorker");var g=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(w){g.dataIsReady=!0,g.data=w,g.max=w&&w.length||0,g.type=t.getTypeOf(w),g.isPaused||g._tickAndRepeat()},function(w){g.error(w)})}t.inherits(c,i),c.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},c.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,t.delay(this._tickAndRepeat,[],this)),!0)},c.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(t.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},c.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,g=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,g);break;case"uint8array":l=this.data.subarray(this.index,g);break;case"array":case"nodebuffer":l=this.data.slice(this.index,g)}return this.index=g,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=c},{"../utils":32,"./GenericWorker":28}],28:[function(e,n,r){function t(i){this.name=i||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}t.prototype={push:function(i){this.emit("data",i)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(i){this.emit("error",i)}return!0},error:function(i){return!this.isFinished&&(this.isPaused?this.generatedError=i:(this.isFinished=!0,this.emit("error",i),this.previous&&this.previous.error(i),this.cleanUp()),!0)},on:function(i,c){return this._listeners[i].push(c),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(i,c){if(this._listeners[i])for(var l=0;l<this._listeners[i].length;l++)this._listeners[i][l].call(this,c)},pipe:function(i){return i.registerPrevious(this)},registerPrevious:function(i){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=i.streamInfo,this.mergeStreamInfo(),this.previous=i;var c=this;return i.on("data",function(l){c.processChunk(l)}),i.on("end",function(){c.end()}),i.on("error",function(l){c.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var i=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),i=!0),this.previous&&this.previous.resume(),!i},flush:function(){},processChunk:function(i){this.push(i)},withStreamInfo:function(i,c){return this.extraStreamInfo[i]=c,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var i in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,i)&&(this.streamInfo[i]=this.extraStreamInfo[i])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var i="Worker "+this.name;return this.previous?this.previous+" -> "+i:i}},n.exports=t},{}],29:[function(e,n,r){var t=e("../utils"),i=e("./ConvertWorker"),c=e("./GenericWorker"),l=e("../base64"),g=e("../support"),w=e("../external"),y=null;if(g.nodestream)try{y=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function _(b,u){return new w.Promise(function(x,m){var p=[],j=b._internalType,E=b._outputType,S=b._mimeType;b.on("data",function(R,z){p.push(R),u&&u(z)}).on("error",function(R){p=[],m(R)}).on("end",function(){try{var R=function(z,L,D){switch(z){case"blob":return t.newBlob(t.transformTo("arraybuffer",L),D);case"base64":return l.encode(L);default:return t.transformTo(z,L)}}(E,function(z,L){var D,W=0,Z=null,k=0;for(D=0;D<L.length;D++)k+=L[D].length;switch(z){case"string":return L.join("");case"array":return Array.prototype.concat.apply([],L);case"uint8array":for(Z=new Uint8Array(k),D=0;D<L.length;D++)Z.set(L[D],W),W+=L[D].length;return Z;case"nodebuffer":return Buffer.concat(L);default:throw new Error("concat : unsupported type '"+z+"'")}}(j,p),S);x(R)}catch(z){m(z)}p=[]}).resume()})}function h(b,u,x){var m=u;switch(u){case"blob":case"arraybuffer":m="uint8array";break;case"base64":m="string"}try{this._internalType=m,this._outputType=u,this._mimeType=x,t.checkSupport(m),this._worker=b.pipe(new i(m)),b.lock()}catch(p){this._worker=new c("error"),this._worker.error(p)}}h.prototype={accumulate:function(b){return _(this,b)},on:function(b,u){var x=this;return b==="data"?this._worker.on(b,function(m){u.call(x,m.data,m.meta)}):this._worker.on(b,function(){t.delay(u,arguments,x)}),this},resume:function(){return t.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(b){if(t.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new y(this,{objectMode:this._outputType!=="nodebuffer"},b)}},n.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,n,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",r.nodebuffer=typeof Buffer<"u",r.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")r.blob=!1;else{var t=new ArrayBuffer(0);try{r.blob=new Blob([t],{type:"application/zip"}).size===0}catch{try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(t),r.blob=i.getBlob("application/zip").size===0}catch{r.blob=!1}}}try{r.nodestream=!!e("readable-stream").Readable}catch{r.nodestream=!1}},{"readable-stream":16}],31:[function(e,n,r){for(var t=e("./utils"),i=e("./support"),c=e("./nodejsUtils"),l=e("./stream/GenericWorker"),g=new Array(256),w=0;w<256;w++)g[w]=252<=w?6:248<=w?5:240<=w?4:224<=w?3:192<=w?2:1;g[254]=g[254]=1;function y(){l.call(this,"utf-8 decode"),this.leftOver=null}function _(){l.call(this,"utf-8 encode")}r.utf8encode=function(h){return i.nodebuffer?c.newBufferFrom(h,"utf-8"):function(b){var u,x,m,p,j,E=b.length,S=0;for(p=0;p<E;p++)(64512&(x=b.charCodeAt(p)))==55296&&p+1<E&&(64512&(m=b.charCodeAt(p+1)))==56320&&(x=65536+(x-55296<<10)+(m-56320),p++),S+=x<128?1:x<2048?2:x<65536?3:4;for(u=i.uint8array?new Uint8Array(S):new Array(S),p=j=0;j<S;p++)(64512&(x=b.charCodeAt(p)))==55296&&p+1<E&&(64512&(m=b.charCodeAt(p+1)))==56320&&(x=65536+(x-55296<<10)+(m-56320),p++),x<128?u[j++]=x:(x<2048?u[j++]=192|x>>>6:(x<65536?u[j++]=224|x>>>12:(u[j++]=240|x>>>18,u[j++]=128|x>>>12&63),u[j++]=128|x>>>6&63),u[j++]=128|63&x);return u}(h)},r.utf8decode=function(h){return i.nodebuffer?t.transformTo("nodebuffer",h).toString("utf-8"):function(b){var u,x,m,p,j=b.length,E=new Array(2*j);for(u=x=0;u<j;)if((m=b[u++])<128)E[x++]=m;else if(4<(p=g[m]))E[x++]=65533,u+=p-1;else{for(m&=p===2?31:p===3?15:7;1<p&&u<j;)m=m<<6|63&b[u++],p--;1<p?E[x++]=65533:m<65536?E[x++]=m:(m-=65536,E[x++]=55296|m>>10&1023,E[x++]=56320|1023&m)}return E.length!==x&&(E.subarray?E=E.subarray(0,x):E.length=x),t.applyFromCharCode(E)}(h=t.transformTo(i.uint8array?"uint8array":"array",h))},t.inherits(y,l),y.prototype.processChunk=function(h){var b=t.transformTo(i.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var u=b;(b=new Uint8Array(u.length+this.leftOver.length)).set(this.leftOver,0),b.set(u,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var x=function(p,j){var E;for((j=j||p.length)>p.length&&(j=p.length),E=j-1;0<=E&&(192&p[E])==128;)E--;return E<0||E===0?j:E+g[p[E]]>j?E:j}(b),m=b;x!==b.length&&(i.uint8array?(m=b.subarray(0,x),this.leftOver=b.subarray(x,b.length)):(m=b.slice(0,x),this.leftOver=b.slice(x,b.length))),this.push({data:r.utf8decode(m),meta:h.meta})},y.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=y,t.inherits(_,l),_.prototype.processChunk=function(h){this.push({data:r.utf8encode(h.data),meta:h.meta})},r.Utf8EncodeWorker=_},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,n,r){var t=e("./support"),i=e("./base64"),c=e("./nodejsUtils"),l=e("./external");function g(u){return u}function w(u,x){for(var m=0;m<u.length;++m)x[m]=255&u.charCodeAt(m);return x}e("setimmediate"),r.newBlob=function(u,x){r.checkSupport("blob");try{return new Blob([u],{type:x})}catch{try{var m=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return m.append(u),m.getBlob(x)}catch{throw new Error("Bug : can't construct the Blob.")}}};var y={stringifyByChunk:function(u,x,m){var p=[],j=0,E=u.length;if(E<=m)return String.fromCharCode.apply(null,u);for(;j<E;)x==="array"||x==="nodebuffer"?p.push(String.fromCharCode.apply(null,u.slice(j,Math.min(j+m,E)))):p.push(String.fromCharCode.apply(null,u.subarray(j,Math.min(j+m,E)))),j+=m;return p.join("")},stringifyByChar:function(u){for(var x="",m=0;m<u.length;m++)x+=String.fromCharCode(u[m]);return x},applyCanBeUsed:{uint8array:function(){try{return t.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return t.nodebuffer&&String.fromCharCode.apply(null,c.allocBuffer(1)).length===1}catch{return!1}}()}};function _(u){var x=65536,m=r.getTypeOf(u),p=!0;if(m==="uint8array"?p=y.applyCanBeUsed.uint8array:m==="nodebuffer"&&(p=y.applyCanBeUsed.nodebuffer),p)for(;1<x;)try{return y.stringifyByChunk(u,m,x)}catch{x=Math.floor(x/2)}return y.stringifyByChar(u)}function h(u,x){for(var m=0;m<u.length;m++)x[m]=u[m];return x}r.applyFromCharCode=_;var b={};b.string={string:g,array:function(u){return w(u,new Array(u.length))},arraybuffer:function(u){return b.string.uint8array(u).buffer},uint8array:function(u){return w(u,new Uint8Array(u.length))},nodebuffer:function(u){return w(u,c.allocBuffer(u.length))}},b.array={string:_,array:g,arraybuffer:function(u){return new Uint8Array(u).buffer},uint8array:function(u){return new Uint8Array(u)},nodebuffer:function(u){return c.newBufferFrom(u)}},b.arraybuffer={string:function(u){return _(new Uint8Array(u))},array:function(u){return h(new Uint8Array(u),new Array(u.byteLength))},arraybuffer:g,uint8array:function(u){return new Uint8Array(u)},nodebuffer:function(u){return c.newBufferFrom(new Uint8Array(u))}},b.uint8array={string:_,array:function(u){return h(u,new Array(u.length))},arraybuffer:function(u){return u.buffer},uint8array:g,nodebuffer:function(u){return c.newBufferFrom(u)}},b.nodebuffer={string:_,array:function(u){return h(u,new Array(u.length))},arraybuffer:function(u){return b.nodebuffer.uint8array(u).buffer},uint8array:function(u){return h(u,new Uint8Array(u.length))},nodebuffer:g},r.transformTo=function(u,x){if(x=x||"",!u)return x;r.checkSupport(u);var m=r.getTypeOf(x);return b[m][u](x)},r.resolve=function(u){for(var x=u.split("/"),m=[],p=0;p<x.length;p++){var j=x[p];j==="."||j===""&&p!==0&&p!==x.length-1||(j===".."?m.pop():m.push(j))}return m.join("/")},r.getTypeOf=function(u){return typeof u=="string"?"string":Object.prototype.toString.call(u)==="[object Array]"?"array":t.nodebuffer&&c.isBuffer(u)?"nodebuffer":t.uint8array&&u instanceof Uint8Array?"uint8array":t.arraybuffer&&u instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(u){if(!t[u.toLowerCase()])throw new Error(u+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(u){var x,m,p="";for(m=0;m<(u||"").length;m++)p+="\\x"+((x=u.charCodeAt(m))<16?"0":"")+x.toString(16).toUpperCase();return p},r.delay=function(u,x,m){setImmediate(function(){u.apply(m||null,x||[])})},r.inherits=function(u,x){function m(){}m.prototype=x.prototype,u.prototype=new m},r.extend=function(){var u,x,m={};for(u=0;u<arguments.length;u++)for(x in arguments[u])Object.prototype.hasOwnProperty.call(arguments[u],x)&&m[x]===void 0&&(m[x]=arguments[u][x]);return m},r.prepareContent=function(u,x,m,p,j){return l.Promise.resolve(x).then(function(E){return t.blob&&(E instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(E))!==-1)&&typeof FileReader<"u"?new l.Promise(function(S,R){var z=new FileReader;z.onload=function(L){S(L.target.result)},z.onerror=function(L){R(L.target.error)},z.readAsArrayBuffer(E)}):E}).then(function(E){var S=r.getTypeOf(E);return S?(S==="arraybuffer"?E=r.transformTo("uint8array",E):S==="string"&&(j?E=i.decode(E):m&&p!==!0&&(E=function(R){return w(R,t.uint8array?new Uint8Array(R.length):new Array(R.length))}(E))),E):l.Promise.reject(new Error("Can't read the data of '"+u+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,n,r){var t=e("./reader/readerFor"),i=e("./utils"),c=e("./signature"),l=e("./zipEntry"),g=e("./support");function w(y){this.files=[],this.loadOptions=y}w.prototype={checkSignature:function(y){if(!this.reader.readAndCheckSignature(y)){this.reader.index-=4;var _=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(_)+", expected "+i.pretty(y)+")")}},isSignature:function(y,_){var h=this.reader.index;this.reader.setIndex(y);var b=this.reader.readString(4)===_;return this.reader.setIndex(h),b},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var y=this.reader.readData(this.zipCommentLength),_=g.uint8array?"uint8array":"array",h=i.transformTo(_,y);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var y,_,h,b=this.zip64EndOfCentralSize-44;0<b;)y=this.reader.readInt(2),_=this.reader.readInt(4),h=this.reader.readData(_),this.zip64ExtensibleData[y]={id:y,length:_,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var y,_;for(y=0;y<this.files.length;y++)_=this.files[y],this.reader.setIndex(_.localHeaderOffset),this.checkSignature(c.LOCAL_FILE_HEADER),_.readLocalPart(this.reader),_.handleUTF8(),_.processAttributes()},readCentralDir:function(){var y;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(c.CENTRAL_FILE_HEADER);)(y=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(y);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var y=this.reader.lastIndexOfSignature(c.CENTRAL_DIRECTORY_END);if(y<0)throw this.isSignature(0,c.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(y);var _=y;if(this.checkSignature(c.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(y=this.reader.lastIndexOfSignature(c.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(y),this.checkSignature(c.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,c.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(c.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(c.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var b=_-h;if(0<b)this.isSignature(_,c.CENTRAL_FILE_HEADER)||(this.reader.zero=b);else if(b<0)throw new Error("Corrupted zip: missing "+Math.abs(b)+" bytes.")},prepareReader:function(y){this.reader=t(y)},load:function(y){this.prepareReader(y),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=w},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,n,r){var t=e("./reader/readerFor"),i=e("./utils"),c=e("./compressedObject"),l=e("./crc32"),g=e("./utf8"),w=e("./compressions"),y=e("./support");function _(h,b){this.options=h,this.loadOptions=b}_.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var b,u;if(h.skip(22),this.fileNameLength=h.readInt(2),u=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(u),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((b=function(x){for(var m in w)if(Object.prototype.hasOwnProperty.call(w,m)&&w[m].magic===x)return w[m];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new c(this.compressedSize,this.uncompressedSize,this.crc32,b,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var b=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(b),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=t(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var b,u,x,m=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<m;)b=h.readInt(2),u=h.readInt(2),x=h.readData(u),this.extraFields[b]={id:b,length:u,value:x};h.setIndex(m)},handleUTF8:function(){var h=y.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=g.utf8decode(this.fileName),this.fileCommentStr=g.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();if(b!==null)this.fileNameStr=b;else{var u=i.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(u)}var x=this.findExtraFieldUnicodeComment();if(x!==null)this.fileCommentStr=x;else{var m=i.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(m)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var b=t(h.value);return b.readInt(1)!==1||l(this.fileName)!==b.readInt(4)?null:g.utf8decode(b.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var b=t(h.value);return b.readInt(1)!==1||l(this.fileComment)!==b.readInt(4)?null:g.utf8decode(b.readData(h.length-5))}return null}},n.exports=_},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,n,r){function t(b,u,x){this.name=b,this.dir=x.dir,this.date=x.date,this.comment=x.comment,this.unixPermissions=x.unixPermissions,this.dosPermissions=x.dosPermissions,this._data=u,this._dataBinary=x.binary,this.options={compression:x.compression,compressionOptions:x.compressionOptions}}var i=e("./stream/StreamHelper"),c=e("./stream/DataWorker"),l=e("./utf8"),g=e("./compressedObject"),w=e("./stream/GenericWorker");t.prototype={internalStream:function(b){var u=null,x="string";try{if(!b)throw new Error("No output type specified.");var m=(x=b.toLowerCase())==="string"||x==="text";x!=="binarystring"&&x!=="text"||(x="string"),u=this._decompressWorker();var p=!this._dataBinary;p&&!m&&(u=u.pipe(new l.Utf8EncodeWorker)),!p&&m&&(u=u.pipe(new l.Utf8DecodeWorker))}catch(j){(u=new w("error")).error(j)}return new i(u,x,"")},async:function(b,u){return this.internalStream(b).accumulate(u)},nodeStream:function(b,u){return this.internalStream(b||"nodebuffer").toNodejsStream(u)},_compressWorker:function(b,u){if(this._data instanceof g&&this._data.compression.magic===b.magic)return this._data.getCompressedWorker();var x=this._decompressWorker();return this._dataBinary||(x=x.pipe(new l.Utf8EncodeWorker)),g.createWorkerFrom(x,b,u)},_decompressWorker:function(){return this._data instanceof g?this._data.getContentWorker():this._data instanceof w?this._data:new c(this._data)}};for(var y=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],_=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<y.length;h++)t.prototype[y[h]]=_;n.exports=t},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,n,r){(function(t){var i,c,l=t.MutationObserver||t.WebKitMutationObserver;if(l){var g=0,w=new l(b),y=t.document.createTextNode("");w.observe(y,{characterData:!0}),i=function(){y.data=g=++g%2}}else if(t.setImmediate||t.MessageChannel===void 0)i="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var u=t.document.createElement("script");u.onreadystatechange=function(){b(),u.onreadystatechange=null,u.parentNode.removeChild(u),u=null},t.document.documentElement.appendChild(u)}:function(){setTimeout(b,0)};else{var _=new t.MessageChannel;_.port1.onmessage=b,i=function(){_.port2.postMessage(0)}}var h=[];function b(){var u,x;c=!0;for(var m=h.length;m;){for(x=h,h=[],u=-1;++u<m;)x[u]();m=h.length}c=!1}n.exports=function(u){h.push(u)!==1||c||i()}}).call(this,typeof Fe<"u"?Fe:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,n,r){var t=e("immediate");function i(){}var c={},l=["REJECTED"],g=["FULFILLED"],w=["PENDING"];function y(m){if(typeof m!="function")throw new TypeError("resolver must be a function");this.state=w,this.queue=[],this.outcome=void 0,m!==i&&u(this,m)}function _(m,p,j){this.promise=m,typeof p=="function"&&(this.onFulfilled=p,this.callFulfilled=this.otherCallFulfilled),typeof j=="function"&&(this.onRejected=j,this.callRejected=this.otherCallRejected)}function h(m,p,j){t(function(){var E;try{E=p(j)}catch(S){return c.reject(m,S)}E===m?c.reject(m,new TypeError("Cannot resolve promise with itself")):c.resolve(m,E)})}function b(m){var p=m&&m.then;if(m&&(typeof m=="object"||typeof m=="function")&&typeof p=="function")return function(){p.apply(m,arguments)}}function u(m,p){var j=!1;function E(z){j||(j=!0,c.reject(m,z))}function S(z){j||(j=!0,c.resolve(m,z))}var R=x(function(){p(S,E)});R.status==="error"&&E(R.value)}function x(m,p){var j={};try{j.value=m(p),j.status="success"}catch(E){j.status="error",j.value=E}return j}(n.exports=y).prototype.finally=function(m){if(typeof m!="function")return this;var p=this.constructor;return this.then(function(j){return p.resolve(m()).then(function(){return j})},function(j){return p.resolve(m()).then(function(){throw j})})},y.prototype.catch=function(m){return this.then(null,m)},y.prototype.then=function(m,p){if(typeof m!="function"&&this.state===g||typeof p!="function"&&this.state===l)return this;var j=new this.constructor(i);return this.state!==w?h(j,this.state===g?m:p,this.outcome):this.queue.push(new _(j,m,p)),j},_.prototype.callFulfilled=function(m){c.resolve(this.promise,m)},_.prototype.otherCallFulfilled=function(m){h(this.promise,this.onFulfilled,m)},_.prototype.callRejected=function(m){c.reject(this.promise,m)},_.prototype.otherCallRejected=function(m){h(this.promise,this.onRejected,m)},c.resolve=function(m,p){var j=x(b,p);if(j.status==="error")return c.reject(m,j.value);var E=j.value;if(E)u(m,E);else{m.state=g,m.outcome=p;for(var S=-1,R=m.queue.length;++S<R;)m.queue[S].callFulfilled(p)}return m},c.reject=function(m,p){m.state=l,m.outcome=p;for(var j=-1,E=m.queue.length;++j<E;)m.queue[j].callRejected(p);return m},y.resolve=function(m){return m instanceof this?m:c.resolve(new this(i),m)},y.reject=function(m){var p=new this(i);return c.reject(p,m)},y.all=function(m){var p=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var j=m.length,E=!1;if(!j)return this.resolve([]);for(var S=new Array(j),R=0,z=-1,L=new this(i);++z<j;)D(m[z],z);return L;function D(W,Z){p.resolve(W).then(function(k){S[Z]=k,++R!==j||E||(E=!0,c.resolve(L,S))},function(k){E||(E=!0,c.reject(L,k))})}},y.race=function(m){var p=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var j=m.length,E=!1;if(!j)return this.resolve([]);for(var S=-1,R=new this(i);++S<j;)z=m[S],p.resolve(z).then(function(L){E||(E=!0,c.resolve(R,L))},function(L){E||(E=!0,c.reject(R,L))});var z;return R}},{immediate:36}],38:[function(e,n,r){var t={};(0,e("./lib/utils/common").assign)(t,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),n.exports=t},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,n,r){var t=e("./zlib/deflate"),i=e("./utils/common"),c=e("./utils/strings"),l=e("./zlib/messages"),g=e("./zlib/zstream"),w=Object.prototype.toString,y=0,_=-1,h=0,b=8;function u(m){if(!(this instanceof u))return new u(m);this.options=i.assign({level:_,method:b,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},m||{});var p=this.options;p.raw&&0<p.windowBits?p.windowBits=-p.windowBits:p.gzip&&0<p.windowBits&&p.windowBits<16&&(p.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new g,this.strm.avail_out=0;var j=t.deflateInit2(this.strm,p.level,p.method,p.windowBits,p.memLevel,p.strategy);if(j!==y)throw new Error(l[j]);if(p.header&&t.deflateSetHeader(this.strm,p.header),p.dictionary){var E;if(E=typeof p.dictionary=="string"?c.string2buf(p.dictionary):w.call(p.dictionary)==="[object ArrayBuffer]"?new Uint8Array(p.dictionary):p.dictionary,(j=t.deflateSetDictionary(this.strm,E))!==y)throw new Error(l[j]);this._dict_set=!0}}function x(m,p){var j=new u(p);if(j.push(m,!0),j.err)throw j.msg||l[j.err];return j.result}u.prototype.push=function(m,p){var j,E,S=this.strm,R=this.options.chunkSize;if(this.ended)return!1;E=p===~~p?p:p===!0?4:0,typeof m=="string"?S.input=c.string2buf(m):w.call(m)==="[object ArrayBuffer]"?S.input=new Uint8Array(m):S.input=m,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new i.Buf8(R),S.next_out=0,S.avail_out=R),(j=t.deflate(S,E))!==1&&j!==y)return this.onEnd(j),!(this.ended=!0);S.avail_out!==0&&(S.avail_in!==0||E!==4&&E!==2)||(this.options.to==="string"?this.onData(c.buf2binstring(i.shrinkBuf(S.output,S.next_out))):this.onData(i.shrinkBuf(S.output,S.next_out)))}while((0<S.avail_in||S.avail_out===0)&&j!==1);return E===4?(j=t.deflateEnd(this.strm),this.onEnd(j),this.ended=!0,j===y):E!==2||(this.onEnd(y),!(S.avail_out=0))},u.prototype.onData=function(m){this.chunks.push(m)},u.prototype.onEnd=function(m){m===y&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},r.Deflate=u,r.deflate=x,r.deflateRaw=function(m,p){return(p=p||{}).raw=!0,x(m,p)},r.gzip=function(m,p){return(p=p||{}).gzip=!0,x(m,p)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,n,r){var t=e("./zlib/inflate"),i=e("./utils/common"),c=e("./utils/strings"),l=e("./zlib/constants"),g=e("./zlib/messages"),w=e("./zlib/zstream"),y=e("./zlib/gzheader"),_=Object.prototype.toString;function h(u){if(!(this instanceof h))return new h(u);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},u||{});var x=this.options;x.raw&&0<=x.windowBits&&x.windowBits<16&&(x.windowBits=-x.windowBits,x.windowBits===0&&(x.windowBits=-15)),!(0<=x.windowBits&&x.windowBits<16)||u&&u.windowBits||(x.windowBits+=32),15<x.windowBits&&x.windowBits<48&&!(15&x.windowBits)&&(x.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new w,this.strm.avail_out=0;var m=t.inflateInit2(this.strm,x.windowBits);if(m!==l.Z_OK)throw new Error(g[m]);this.header=new y,t.inflateGetHeader(this.strm,this.header)}function b(u,x){var m=new h(x);if(m.push(u,!0),m.err)throw m.msg||g[m.err];return m.result}h.prototype.push=function(u,x){var m,p,j,E,S,R,z=this.strm,L=this.options.chunkSize,D=this.options.dictionary,W=!1;if(this.ended)return!1;p=x===~~x?x:x===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof u=="string"?z.input=c.binstring2buf(u):_.call(u)==="[object ArrayBuffer]"?z.input=new Uint8Array(u):z.input=u,z.next_in=0,z.avail_in=z.input.length;do{if(z.avail_out===0&&(z.output=new i.Buf8(L),z.next_out=0,z.avail_out=L),(m=t.inflate(z,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&D&&(R=typeof D=="string"?c.string2buf(D):_.call(D)==="[object ArrayBuffer]"?new Uint8Array(D):D,m=t.inflateSetDictionary(this.strm,R)),m===l.Z_BUF_ERROR&&W===!0&&(m=l.Z_OK,W=!1),m!==l.Z_STREAM_END&&m!==l.Z_OK)return this.onEnd(m),!(this.ended=!0);z.next_out&&(z.avail_out!==0&&m!==l.Z_STREAM_END&&(z.avail_in!==0||p!==l.Z_FINISH&&p!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(j=c.utf8border(z.output,z.next_out),E=z.next_out-j,S=c.buf2string(z.output,j),z.next_out=E,z.avail_out=L-E,E&&i.arraySet(z.output,z.output,j,E,0),this.onData(S)):this.onData(i.shrinkBuf(z.output,z.next_out)))),z.avail_in===0&&z.avail_out===0&&(W=!0)}while((0<z.avail_in||z.avail_out===0)&&m!==l.Z_STREAM_END);return m===l.Z_STREAM_END&&(p=l.Z_FINISH),p===l.Z_FINISH?(m=t.inflateEnd(this.strm),this.onEnd(m),this.ended=!0,m===l.Z_OK):p!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(z.avail_out=0))},h.prototype.onData=function(u){this.chunks.push(u)},h.prototype.onEnd=function(u){u===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=u,this.msg=this.strm.msg},r.Inflate=h,r.inflate=b,r.inflateRaw=function(u,x){return(x=x||{}).raw=!0,b(u,x)},r.ungzip=b},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,n,r){var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";r.assign=function(l){for(var g=Array.prototype.slice.call(arguments,1);g.length;){var w=g.shift();if(w){if(typeof w!="object")throw new TypeError(w+"must be non-object");for(var y in w)w.hasOwnProperty(y)&&(l[y]=w[y])}}return l},r.shrinkBuf=function(l,g){return l.length===g?l:l.subarray?l.subarray(0,g):(l.length=g,l)};var i={arraySet:function(l,g,w,y,_){if(g.subarray&&l.subarray)l.set(g.subarray(w,w+y),_);else for(var h=0;h<y;h++)l[_+h]=g[w+h]},flattenChunks:function(l){var g,w,y,_,h,b;for(g=y=0,w=l.length;g<w;g++)y+=l[g].length;for(b=new Uint8Array(y),g=_=0,w=l.length;g<w;g++)h=l[g],b.set(h,_),_+=h.length;return b}},c={arraySet:function(l,g,w,y,_){for(var h=0;h<y;h++)l[_+h]=g[w+h]},flattenChunks:function(l){return[].concat.apply([],l)}};r.setTyped=function(l){l?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,c))},r.setTyped(t)},{}],42:[function(e,n,r){var t=e("./common"),i=!0,c=!0;try{String.fromCharCode.apply(null,[0])}catch{i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{c=!1}for(var l=new t.Buf8(256),g=0;g<256;g++)l[g]=252<=g?6:248<=g?5:240<=g?4:224<=g?3:192<=g?2:1;function w(y,_){if(_<65537&&(y.subarray&&c||!y.subarray&&i))return String.fromCharCode.apply(null,t.shrinkBuf(y,_));for(var h="",b=0;b<_;b++)h+=String.fromCharCode(y[b]);return h}l[254]=l[254]=1,r.string2buf=function(y){var _,h,b,u,x,m=y.length,p=0;for(u=0;u<m;u++)(64512&(h=y.charCodeAt(u)))==55296&&u+1<m&&(64512&(b=y.charCodeAt(u+1)))==56320&&(h=65536+(h-55296<<10)+(b-56320),u++),p+=h<128?1:h<2048?2:h<65536?3:4;for(_=new t.Buf8(p),u=x=0;x<p;u++)(64512&(h=y.charCodeAt(u)))==55296&&u+1<m&&(64512&(b=y.charCodeAt(u+1)))==56320&&(h=65536+(h-55296<<10)+(b-56320),u++),h<128?_[x++]=h:(h<2048?_[x++]=192|h>>>6:(h<65536?_[x++]=224|h>>>12:(_[x++]=240|h>>>18,_[x++]=128|h>>>12&63),_[x++]=128|h>>>6&63),_[x++]=128|63&h);return _},r.buf2binstring=function(y){return w(y,y.length)},r.binstring2buf=function(y){for(var _=new t.Buf8(y.length),h=0,b=_.length;h<b;h++)_[h]=y.charCodeAt(h);return _},r.buf2string=function(y,_){var h,b,u,x,m=_||y.length,p=new Array(2*m);for(h=b=0;h<m;)if((u=y[h++])<128)p[b++]=u;else if(4<(x=l[u]))p[b++]=65533,h+=x-1;else{for(u&=x===2?31:x===3?15:7;1<x&&h<m;)u=u<<6|63&y[h++],x--;1<x?p[b++]=65533:u<65536?p[b++]=u:(u-=65536,p[b++]=55296|u>>10&1023,p[b++]=56320|1023&u)}return w(p,b)},r.utf8border=function(y,_){var h;for((_=_||y.length)>y.length&&(_=y.length),h=_-1;0<=h&&(192&y[h])==128;)h--;return h<0||h===0?_:h+l[y[h]]>_?h:_}},{"./common":41}],43:[function(e,n,r){n.exports=function(t,i,c,l){for(var g=65535&t|0,w=t>>>16&65535|0,y=0;c!==0;){for(c-=y=2e3<c?2e3:c;w=w+(g=g+i[l++]|0)|0,--y;);g%=65521,w%=65521}return g|w<<16|0}},{}],44:[function(e,n,r){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,n,r){var t=function(){for(var i,c=[],l=0;l<256;l++){i=l;for(var g=0;g<8;g++)i=1&i?3988292384^i>>>1:i>>>1;c[l]=i}return c}();n.exports=function(i,c,l,g){var w=t,y=g+l;i^=-1;for(var _=g;_<y;_++)i=i>>>8^w[255&(i^c[_])];return-1^i}},{}],46:[function(e,n,r){var t,i=e("../utils/common"),c=e("./trees"),l=e("./adler32"),g=e("./crc32"),w=e("./messages"),y=0,_=4,h=0,b=-2,u=-1,x=4,m=2,p=8,j=9,E=286,S=30,R=19,z=2*E+1,L=15,D=3,W=258,Z=W+D+1,k=42,N=113,o=1,T=2,U=3,P=4;function Q(a,M){return a.msg=w[M],M}function V(a){return(a<<1)-(4<a?9:0)}function te(a){for(var M=a.length;0<=--M;)a[M]=0}function F(a){var M=a.state,B=M.pending;B>a.avail_out&&(B=a.avail_out),B!==0&&(i.arraySet(a.output,M.pending_buf,M.pending_out,B,a.next_out),a.next_out+=B,M.pending_out+=B,a.total_out+=B,a.avail_out-=B,M.pending-=B,M.pending===0&&(M.pending_out=0))}function A(a,M){c._tr_flush_block(a,0<=a.block_start?a.block_start:-1,a.strstart-a.block_start,M),a.block_start=a.strstart,F(a.strm)}function ee(a,M){a.pending_buf[a.pending++]=M}function K(a,M){a.pending_buf[a.pending++]=M>>>8&255,a.pending_buf[a.pending++]=255&M}function H(a,M){var B,C,v=a.max_chain_length,I=a.strstart,G=a.prev_length,$=a.nice_match,O=a.strstart>a.w_size-Z?a.strstart-(a.w_size-Z):0,Y=a.window,J=a.w_mask,q=a.prev,re=a.strstart+W,oe=Y[I+G-1],se=Y[I+G];a.prev_length>=a.good_match&&(v>>=2),$>a.lookahead&&($=a.lookahead);do if(Y[(B=M)+G]===se&&Y[B+G-1]===oe&&Y[B]===Y[I]&&Y[++B]===Y[I+1]){I+=2,B++;do;while(Y[++I]===Y[++B]&&Y[++I]===Y[++B]&&Y[++I]===Y[++B]&&Y[++I]===Y[++B]&&Y[++I]===Y[++B]&&Y[++I]===Y[++B]&&Y[++I]===Y[++B]&&Y[++I]===Y[++B]&&I<re);if(C=W-(re-I),I=re-W,G<C){if(a.match_start=M,$<=(G=C))break;oe=Y[I+G-1],se=Y[I+G]}}while((M=q[M&J])>O&&--v!=0);return G<=a.lookahead?G:a.lookahead}function ae(a){var M,B,C,v,I,G,$,O,Y,J,q=a.w_size;do{if(v=a.window_size-a.lookahead-a.strstart,a.strstart>=q+(q-Z)){for(i.arraySet(a.window,a.window,q,q,0),a.match_start-=q,a.strstart-=q,a.block_start-=q,M=B=a.hash_size;C=a.head[--M],a.head[M]=q<=C?C-q:0,--B;);for(M=B=q;C=a.prev[--M],a.prev[M]=q<=C?C-q:0,--B;);v+=q}if(a.strm.avail_in===0)break;if(G=a.strm,$=a.window,O=a.strstart+a.lookahead,Y=v,J=void 0,J=G.avail_in,Y<J&&(J=Y),B=J===0?0:(G.avail_in-=J,i.arraySet($,G.input,G.next_in,J,O),G.state.wrap===1?G.adler=l(G.adler,$,J,O):G.state.wrap===2&&(G.adler=g(G.adler,$,J,O)),G.next_in+=J,G.total_in+=J,J),a.lookahead+=B,a.lookahead+a.insert>=D)for(I=a.strstart-a.insert,a.ins_h=a.window[I],a.ins_h=(a.ins_h<<a.hash_shift^a.window[I+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[I+D-1])&a.hash_mask,a.prev[I&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=I,I++,a.insert--,!(a.lookahead+a.insert<D)););}while(a.lookahead<Z&&a.strm.avail_in!==0)}function ce(a,M){for(var B,C;;){if(a.lookahead<Z){if(ae(a),a.lookahead<Z&&M===y)return o;if(a.lookahead===0)break}if(B=0,a.lookahead>=D&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+D-1])&a.hash_mask,B=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),B!==0&&a.strstart-B<=a.w_size-Z&&(a.match_length=H(a,B)),a.match_length>=D)if(C=c._tr_tally(a,a.strstart-a.match_start,a.match_length-D),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=D){for(a.match_length--;a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+D-1])&a.hash_mask,B=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart,--a.match_length!=0;);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else C=c._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(C&&(A(a,!1),a.strm.avail_out===0))return o}return a.insert=a.strstart<D-1?a.strstart:D-1,M===_?(A(a,!0),a.strm.avail_out===0?U:P):a.last_lit&&(A(a,!1),a.strm.avail_out===0)?o:T}function ne(a,M){for(var B,C,v;;){if(a.lookahead<Z){if(ae(a),a.lookahead<Z&&M===y)return o;if(a.lookahead===0)break}if(B=0,a.lookahead>=D&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+D-1])&a.hash_mask,B=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=D-1,B!==0&&a.prev_length<a.max_lazy_match&&a.strstart-B<=a.w_size-Z&&(a.match_length=H(a,B),a.match_length<=5&&(a.strategy===1||a.match_length===D&&4096<a.strstart-a.match_start)&&(a.match_length=D-1)),a.prev_length>=D&&a.match_length<=a.prev_length){for(v=a.strstart+a.lookahead-D,C=c._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-D),a.lookahead-=a.prev_length-1,a.prev_length-=2;++a.strstart<=v&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+D-1])&a.hash_mask,B=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),--a.prev_length!=0;);if(a.match_available=0,a.match_length=D-1,a.strstart++,C&&(A(a,!1),a.strm.avail_out===0))return o}else if(a.match_available){if((C=c._tr_tally(a,0,a.window[a.strstart-1]))&&A(a,!1),a.strstart++,a.lookahead--,a.strm.avail_out===0)return o}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(C=c._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<D-1?a.strstart:D-1,M===_?(A(a,!0),a.strm.avail_out===0?U:P):a.last_lit&&(A(a,!1),a.strm.avail_out===0)?o:T}function ie(a,M,B,C,v){this.good_length=a,this.max_lazy=M,this.nice_length=B,this.max_chain=C,this.func=v}function he(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=p,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*z),this.dyn_dtree=new i.Buf16(2*(2*S+1)),this.bl_tree=new i.Buf16(2*(2*R+1)),te(this.dyn_ltree),te(this.dyn_dtree),te(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(L+1),this.heap=new i.Buf16(2*E+1),te(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*E+1),te(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function de(a){var M;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=m,(M=a.state).pending=0,M.pending_out=0,M.wrap<0&&(M.wrap=-M.wrap),M.status=M.wrap?k:N,a.adler=M.wrap===2?0:1,M.last_flush=y,c._tr_init(M),h):Q(a,b)}function _e(a){var M=de(a);return M===h&&function(B){B.window_size=2*B.w_size,te(B.head),B.max_lazy_match=t[B.level].max_lazy,B.good_match=t[B.level].good_length,B.nice_match=t[B.level].nice_length,B.max_chain_length=t[B.level].max_chain,B.strstart=0,B.block_start=0,B.lookahead=0,B.insert=0,B.match_length=B.prev_length=D-1,B.match_available=0,B.ins_h=0}(a.state),M}function ye(a,M,B,C,v,I){if(!a)return b;var G=1;if(M===u&&(M=6),C<0?(G=0,C=-C):15<C&&(G=2,C-=16),v<1||j<v||B!==p||C<8||15<C||M<0||9<M||I<0||x<I)return Q(a,b);C===8&&(C=9);var $=new he;return(a.state=$).strm=a,$.wrap=G,$.gzhead=null,$.w_bits=C,$.w_size=1<<$.w_bits,$.w_mask=$.w_size-1,$.hash_bits=v+7,$.hash_size=1<<$.hash_bits,$.hash_mask=$.hash_size-1,$.hash_shift=~~(($.hash_bits+D-1)/D),$.window=new i.Buf8(2*$.w_size),$.head=new i.Buf16($.hash_size),$.prev=new i.Buf16($.w_size),$.lit_bufsize=1<<v+6,$.pending_buf_size=4*$.lit_bufsize,$.pending_buf=new i.Buf8($.pending_buf_size),$.d_buf=1*$.lit_bufsize,$.l_buf=3*$.lit_bufsize,$.level=M,$.strategy=I,$.method=B,_e(a)}t=[new ie(0,0,0,0,function(a,M){var B=65535;for(B>a.pending_buf_size-5&&(B=a.pending_buf_size-5);;){if(a.lookahead<=1){if(ae(a),a.lookahead===0&&M===y)return o;if(a.lookahead===0)break}a.strstart+=a.lookahead,a.lookahead=0;var C=a.block_start+B;if((a.strstart===0||a.strstart>=C)&&(a.lookahead=a.strstart-C,a.strstart=C,A(a,!1),a.strm.avail_out===0)||a.strstart-a.block_start>=a.w_size-Z&&(A(a,!1),a.strm.avail_out===0))return o}return a.insert=0,M===_?(A(a,!0),a.strm.avail_out===0?U:P):(a.strstart>a.block_start&&(A(a,!1),a.strm.avail_out),o)}),new ie(4,4,8,4,ce),new ie(4,5,16,8,ce),new ie(4,6,32,32,ce),new ie(4,4,16,16,ne),new ie(8,16,32,32,ne),new ie(8,16,128,128,ne),new ie(8,32,128,256,ne),new ie(32,128,258,1024,ne),new ie(32,258,258,4096,ne)],r.deflateInit=function(a,M){return ye(a,M,p,15,8,0)},r.deflateInit2=ye,r.deflateReset=_e,r.deflateResetKeep=de,r.deflateSetHeader=function(a,M){return a&&a.state?a.state.wrap!==2?b:(a.state.gzhead=M,h):b},r.deflate=function(a,M){var B,C,v,I;if(!a||!a.state||5<M||M<0)return a?Q(a,b):b;if(C=a.state,!a.output||!a.input&&a.avail_in!==0||C.status===666&&M!==_)return Q(a,a.avail_out===0?-5:b);if(C.strm=a,B=C.last_flush,C.last_flush=M,C.status===k)if(C.wrap===2)a.adler=0,ee(C,31),ee(C,139),ee(C,8),C.gzhead?(ee(C,(C.gzhead.text?1:0)+(C.gzhead.hcrc?2:0)+(C.gzhead.extra?4:0)+(C.gzhead.name?8:0)+(C.gzhead.comment?16:0)),ee(C,255&C.gzhead.time),ee(C,C.gzhead.time>>8&255),ee(C,C.gzhead.time>>16&255),ee(C,C.gzhead.time>>24&255),ee(C,C.level===9?2:2<=C.strategy||C.level<2?4:0),ee(C,255&C.gzhead.os),C.gzhead.extra&&C.gzhead.extra.length&&(ee(C,255&C.gzhead.extra.length),ee(C,C.gzhead.extra.length>>8&255)),C.gzhead.hcrc&&(a.adler=g(a.adler,C.pending_buf,C.pending,0)),C.gzindex=0,C.status=69):(ee(C,0),ee(C,0),ee(C,0),ee(C,0),ee(C,0),ee(C,C.level===9?2:2<=C.strategy||C.level<2?4:0),ee(C,3),C.status=N);else{var G=p+(C.w_bits-8<<4)<<8;G|=(2<=C.strategy||C.level<2?0:C.level<6?1:C.level===6?2:3)<<6,C.strstart!==0&&(G|=32),G+=31-G%31,C.status=N,K(C,G),C.strstart!==0&&(K(C,a.adler>>>16),K(C,65535&a.adler)),a.adler=1}if(C.status===69)if(C.gzhead.extra){for(v=C.pending;C.gzindex<(65535&C.gzhead.extra.length)&&(C.pending!==C.pending_buf_size||(C.gzhead.hcrc&&C.pending>v&&(a.adler=g(a.adler,C.pending_buf,C.pending-v,v)),F(a),v=C.pending,C.pending!==C.pending_buf_size));)ee(C,255&C.gzhead.extra[C.gzindex]),C.gzindex++;C.gzhead.hcrc&&C.pending>v&&(a.adler=g(a.adler,C.pending_buf,C.pending-v,v)),C.gzindex===C.gzhead.extra.length&&(C.gzindex=0,C.status=73)}else C.status=73;if(C.status===73)if(C.gzhead.name){v=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>v&&(a.adler=g(a.adler,C.pending_buf,C.pending-v,v)),F(a),v=C.pending,C.pending===C.pending_buf_size)){I=1;break}I=C.gzindex<C.gzhead.name.length?255&C.gzhead.name.charCodeAt(C.gzindex++):0,ee(C,I)}while(I!==0);C.gzhead.hcrc&&C.pending>v&&(a.adler=g(a.adler,C.pending_buf,C.pending-v,v)),I===0&&(C.gzindex=0,C.status=91)}else C.status=91;if(C.status===91)if(C.gzhead.comment){v=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>v&&(a.adler=g(a.adler,C.pending_buf,C.pending-v,v)),F(a),v=C.pending,C.pending===C.pending_buf_size)){I=1;break}I=C.gzindex<C.gzhead.comment.length?255&C.gzhead.comment.charCodeAt(C.gzindex++):0,ee(C,I)}while(I!==0);C.gzhead.hcrc&&C.pending>v&&(a.adler=g(a.adler,C.pending_buf,C.pending-v,v)),I===0&&(C.status=103)}else C.status=103;if(C.status===103&&(C.gzhead.hcrc?(C.pending+2>C.pending_buf_size&&F(a),C.pending+2<=C.pending_buf_size&&(ee(C,255&a.adler),ee(C,a.adler>>8&255),a.adler=0,C.status=N)):C.status=N),C.pending!==0){if(F(a),a.avail_out===0)return C.last_flush=-1,h}else if(a.avail_in===0&&V(M)<=V(B)&&M!==_)return Q(a,-5);if(C.status===666&&a.avail_in!==0)return Q(a,-5);if(a.avail_in!==0||C.lookahead!==0||M!==y&&C.status!==666){var $=C.strategy===2?function(O,Y){for(var J;;){if(O.lookahead===0&&(ae(O),O.lookahead===0)){if(Y===y)return o;break}if(O.match_length=0,J=c._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++,J&&(A(O,!1),O.strm.avail_out===0))return o}return O.insert=0,Y===_?(A(O,!0),O.strm.avail_out===0?U:P):O.last_lit&&(A(O,!1),O.strm.avail_out===0)?o:T}(C,M):C.strategy===3?function(O,Y){for(var J,q,re,oe,se=O.window;;){if(O.lookahead<=W){if(ae(O),O.lookahead<=W&&Y===y)return o;if(O.lookahead===0)break}if(O.match_length=0,O.lookahead>=D&&0<O.strstart&&(q=se[re=O.strstart-1])===se[++re]&&q===se[++re]&&q===se[++re]){oe=O.strstart+W;do;while(q===se[++re]&&q===se[++re]&&q===se[++re]&&q===se[++re]&&q===se[++re]&&q===se[++re]&&q===se[++re]&&q===se[++re]&&re<oe);O.match_length=W-(oe-re),O.match_length>O.lookahead&&(O.match_length=O.lookahead)}if(O.match_length>=D?(J=c._tr_tally(O,1,O.match_length-D),O.lookahead-=O.match_length,O.strstart+=O.match_length,O.match_length=0):(J=c._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++),J&&(A(O,!1),O.strm.avail_out===0))return o}return O.insert=0,Y===_?(A(O,!0),O.strm.avail_out===0?U:P):O.last_lit&&(A(O,!1),O.strm.avail_out===0)?o:T}(C,M):t[C.level].func(C,M);if($!==U&&$!==P||(C.status=666),$===o||$===U)return a.avail_out===0&&(C.last_flush=-1),h;if($===T&&(M===1?c._tr_align(C):M!==5&&(c._tr_stored_block(C,0,0,!1),M===3&&(te(C.head),C.lookahead===0&&(C.strstart=0,C.block_start=0,C.insert=0))),F(a),a.avail_out===0))return C.last_flush=-1,h}return M!==_?h:C.wrap<=0?1:(C.wrap===2?(ee(C,255&a.adler),ee(C,a.adler>>8&255),ee(C,a.adler>>16&255),ee(C,a.adler>>24&255),ee(C,255&a.total_in),ee(C,a.total_in>>8&255),ee(C,a.total_in>>16&255),ee(C,a.total_in>>24&255)):(K(C,a.adler>>>16),K(C,65535&a.adler)),F(a),0<C.wrap&&(C.wrap=-C.wrap),C.pending!==0?h:1)},r.deflateEnd=function(a){var M;return a&&a.state?(M=a.state.status)!==k&&M!==69&&M!==73&&M!==91&&M!==103&&M!==N&&M!==666?Q(a,b):(a.state=null,M===N?Q(a,-3):h):b},r.deflateSetDictionary=function(a,M){var B,C,v,I,G,$,O,Y,J=M.length;if(!a||!a.state||(I=(B=a.state).wrap)===2||I===1&&B.status!==k||B.lookahead)return b;for(I===1&&(a.adler=l(a.adler,M,J,0)),B.wrap=0,J>=B.w_size&&(I===0&&(te(B.head),B.strstart=0,B.block_start=0,B.insert=0),Y=new i.Buf8(B.w_size),i.arraySet(Y,M,J-B.w_size,B.w_size,0),M=Y,J=B.w_size),G=a.avail_in,$=a.next_in,O=a.input,a.avail_in=J,a.next_in=0,a.input=M,ae(B);B.lookahead>=D;){for(C=B.strstart,v=B.lookahead-(D-1);B.ins_h=(B.ins_h<<B.hash_shift^B.window[C+D-1])&B.hash_mask,B.prev[C&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=C,C++,--v;);B.strstart=C,B.lookahead=D-1,ae(B)}return B.strstart+=B.lookahead,B.block_start=B.strstart,B.insert=B.lookahead,B.lookahead=0,B.match_length=B.prev_length=D-1,B.match_available=0,a.next_in=$,a.input=O,a.avail_in=G,B.wrap=I,h},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,n,r){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,n,r){n.exports=function(t,i){var c,l,g,w,y,_,h,b,u,x,m,p,j,E,S,R,z,L,D,W,Z,k,N,o,T;c=t.state,l=t.next_in,o=t.input,g=l+(t.avail_in-5),w=t.next_out,T=t.output,y=w-(i-t.avail_out),_=w+(t.avail_out-257),h=c.dmax,b=c.wsize,u=c.whave,x=c.wnext,m=c.window,p=c.hold,j=c.bits,E=c.lencode,S=c.distcode,R=(1<<c.lenbits)-1,z=(1<<c.distbits)-1;e:do{j<15&&(p+=o[l++]<<j,j+=8,p+=o[l++]<<j,j+=8),L=E[p&R];t:for(;;){if(p>>>=D=L>>>24,j-=D,(D=L>>>16&255)===0)T[w++]=65535&L;else{if(!(16&D)){if(!(64&D)){L=E[(65535&L)+(p&(1<<D)-1)];continue t}if(32&D){c.mode=12;break e}t.msg="invalid literal/length code",c.mode=30;break e}W=65535&L,(D&=15)&&(j<D&&(p+=o[l++]<<j,j+=8),W+=p&(1<<D)-1,p>>>=D,j-=D),j<15&&(p+=o[l++]<<j,j+=8,p+=o[l++]<<j,j+=8),L=S[p&z];r:for(;;){if(p>>>=D=L>>>24,j-=D,!(16&(D=L>>>16&255))){if(!(64&D)){L=S[(65535&L)+(p&(1<<D)-1)];continue r}t.msg="invalid distance code",c.mode=30;break e}if(Z=65535&L,j<(D&=15)&&(p+=o[l++]<<j,(j+=8)<D&&(p+=o[l++]<<j,j+=8)),h<(Z+=p&(1<<D)-1)){t.msg="invalid distance too far back",c.mode=30;break e}if(p>>>=D,j-=D,(D=w-y)<Z){if(u<(D=Z-D)&&c.sane){t.msg="invalid distance too far back",c.mode=30;break e}if(N=m,(k=0)===x){if(k+=b-D,D<W){for(W-=D;T[w++]=m[k++],--D;);k=w-Z,N=T}}else if(x<D){if(k+=b+x-D,(D-=x)<W){for(W-=D;T[w++]=m[k++],--D;);if(k=0,x<W){for(W-=D=x;T[w++]=m[k++],--D;);k=w-Z,N=T}}}else if(k+=x-D,D<W){for(W-=D;T[w++]=m[k++],--D;);k=w-Z,N=T}for(;2<W;)T[w++]=N[k++],T[w++]=N[k++],T[w++]=N[k++],W-=3;W&&(T[w++]=N[k++],1<W&&(T[w++]=N[k++]))}else{for(k=w-Z;T[w++]=T[k++],T[w++]=T[k++],T[w++]=T[k++],2<(W-=3););W&&(T[w++]=T[k++],1<W&&(T[w++]=T[k++]))}break}}break}}while(l<g&&w<_);l-=W=j>>3,p&=(1<<(j-=W<<3))-1,t.next_in=l,t.next_out=w,t.avail_in=l<g?g-l+5:5-(l-g),t.avail_out=w<_?_-w+257:257-(w-_),c.hold=p,c.bits=j}},{}],49:[function(e,n,r){var t=e("../utils/common"),i=e("./adler32"),c=e("./crc32"),l=e("./inffast"),g=e("./inftrees"),w=1,y=2,_=0,h=-2,b=1,u=852,x=592;function m(k){return(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24)}function p(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new t.Buf16(320),this.work=new t.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function j(k){var N;return k&&k.state?(N=k.state,k.total_in=k.total_out=N.total=0,k.msg="",N.wrap&&(k.adler=1&N.wrap),N.mode=b,N.last=0,N.havedict=0,N.dmax=32768,N.head=null,N.hold=0,N.bits=0,N.lencode=N.lendyn=new t.Buf32(u),N.distcode=N.distdyn=new t.Buf32(x),N.sane=1,N.back=-1,_):h}function E(k){var N;return k&&k.state?((N=k.state).wsize=0,N.whave=0,N.wnext=0,j(k)):h}function S(k,N){var o,T;return k&&k.state?(T=k.state,N<0?(o=0,N=-N):(o=1+(N>>4),N<48&&(N&=15)),N&&(N<8||15<N)?h:(T.window!==null&&T.wbits!==N&&(T.window=null),T.wrap=o,T.wbits=N,E(k))):h}function R(k,N){var o,T;return k?(T=new p,(k.state=T).window=null,(o=S(k,N))!==_&&(k.state=null),o):h}var z,L,D=!0;function W(k){if(D){var N;for(z=new t.Buf32(512),L=new t.Buf32(32),N=0;N<144;)k.lens[N++]=8;for(;N<256;)k.lens[N++]=9;for(;N<280;)k.lens[N++]=7;for(;N<288;)k.lens[N++]=8;for(g(w,k.lens,0,288,z,0,k.work,{bits:9}),N=0;N<32;)k.lens[N++]=5;g(y,k.lens,0,32,L,0,k.work,{bits:5}),D=!1}k.lencode=z,k.lenbits=9,k.distcode=L,k.distbits=5}function Z(k,N,o,T){var U,P=k.state;return P.window===null&&(P.wsize=1<<P.wbits,P.wnext=0,P.whave=0,P.window=new t.Buf8(P.wsize)),T>=P.wsize?(t.arraySet(P.window,N,o-P.wsize,P.wsize,0),P.wnext=0,P.whave=P.wsize):(T<(U=P.wsize-P.wnext)&&(U=T),t.arraySet(P.window,N,o-T,U,P.wnext),(T-=U)?(t.arraySet(P.window,N,o-T,T,0),P.wnext=T,P.whave=P.wsize):(P.wnext+=U,P.wnext===P.wsize&&(P.wnext=0),P.whave<P.wsize&&(P.whave+=U))),0}r.inflateReset=E,r.inflateReset2=S,r.inflateResetKeep=j,r.inflateInit=function(k){return R(k,15)},r.inflateInit2=R,r.inflate=function(k,N){var o,T,U,P,Q,V,te,F,A,ee,K,H,ae,ce,ne,ie,he,de,_e,ye,a,M,B,C,v=0,I=new t.Buf8(4),G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return h;(o=k.state).mode===12&&(o.mode=13),Q=k.next_out,U=k.output,te=k.avail_out,P=k.next_in,T=k.input,V=k.avail_in,F=o.hold,A=o.bits,ee=V,K=te,M=_;e:for(;;)switch(o.mode){case b:if(o.wrap===0){o.mode=13;break}for(;A<16;){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}if(2&o.wrap&&F===35615){I[o.check=0]=255&F,I[1]=F>>>8&255,o.check=c(o.check,I,2,0),A=F=0,o.mode=2;break}if(o.flags=0,o.head&&(o.head.done=!1),!(1&o.wrap)||(((255&F)<<8)+(F>>8))%31){k.msg="incorrect header check",o.mode=30;break}if((15&F)!=8){k.msg="unknown compression method",o.mode=30;break}if(A-=4,a=8+(15&(F>>>=4)),o.wbits===0)o.wbits=a;else if(a>o.wbits){k.msg="invalid window size",o.mode=30;break}o.dmax=1<<a,k.adler=o.check=1,o.mode=512&F?10:12,A=F=0;break;case 2:for(;A<16;){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}if(o.flags=F,(255&o.flags)!=8){k.msg="unknown compression method",o.mode=30;break}if(57344&o.flags){k.msg="unknown header flags set",o.mode=30;break}o.head&&(o.head.text=F>>8&1),512&o.flags&&(I[0]=255&F,I[1]=F>>>8&255,o.check=c(o.check,I,2,0)),A=F=0,o.mode=3;case 3:for(;A<32;){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}o.head&&(o.head.time=F),512&o.flags&&(I[0]=255&F,I[1]=F>>>8&255,I[2]=F>>>16&255,I[3]=F>>>24&255,o.check=c(o.check,I,4,0)),A=F=0,o.mode=4;case 4:for(;A<16;){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}o.head&&(o.head.xflags=255&F,o.head.os=F>>8),512&o.flags&&(I[0]=255&F,I[1]=F>>>8&255,o.check=c(o.check,I,2,0)),A=F=0,o.mode=5;case 5:if(1024&o.flags){for(;A<16;){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}o.length=F,o.head&&(o.head.extra_len=F),512&o.flags&&(I[0]=255&F,I[1]=F>>>8&255,o.check=c(o.check,I,2,0)),A=F=0}else o.head&&(o.head.extra=null);o.mode=6;case 6:if(1024&o.flags&&(V<(H=o.length)&&(H=V),H&&(o.head&&(a=o.head.extra_len-o.length,o.head.extra||(o.head.extra=new Array(o.head.extra_len)),t.arraySet(o.head.extra,T,P,H,a)),512&o.flags&&(o.check=c(o.check,T,H,P)),V-=H,P+=H,o.length-=H),o.length))break e;o.length=0,o.mode=7;case 7:if(2048&o.flags){if(V===0)break e;for(H=0;a=T[P+H++],o.head&&a&&o.length<65536&&(o.head.name+=String.fromCharCode(a)),a&&H<V;);if(512&o.flags&&(o.check=c(o.check,T,H,P)),V-=H,P+=H,a)break e}else o.head&&(o.head.name=null);o.length=0,o.mode=8;case 8:if(4096&o.flags){if(V===0)break e;for(H=0;a=T[P+H++],o.head&&a&&o.length<65536&&(o.head.comment+=String.fromCharCode(a)),a&&H<V;);if(512&o.flags&&(o.check=c(o.check,T,H,P)),V-=H,P+=H,a)break e}else o.head&&(o.head.comment=null);o.mode=9;case 9:if(512&o.flags){for(;A<16;){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}if(F!==(65535&o.check)){k.msg="header crc mismatch",o.mode=30;break}A=F=0}o.head&&(o.head.hcrc=o.flags>>9&1,o.head.done=!0),k.adler=o.check=0,o.mode=12;break;case 10:for(;A<32;){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}k.adler=o.check=m(F),A=F=0,o.mode=11;case 11:if(o.havedict===0)return k.next_out=Q,k.avail_out=te,k.next_in=P,k.avail_in=V,o.hold=F,o.bits=A,2;k.adler=o.check=1,o.mode=12;case 12:if(N===5||N===6)break e;case 13:if(o.last){F>>>=7&A,A-=7&A,o.mode=27;break}for(;A<3;){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}switch(o.last=1&F,A-=1,3&(F>>>=1)){case 0:o.mode=14;break;case 1:if(W(o),o.mode=20,N!==6)break;F>>>=2,A-=2;break e;case 2:o.mode=17;break;case 3:k.msg="invalid block type",o.mode=30}F>>>=2,A-=2;break;case 14:for(F>>>=7&A,A-=7&A;A<32;){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}if((65535&F)!=(F>>>16^65535)){k.msg="invalid stored block lengths",o.mode=30;break}if(o.length=65535&F,A=F=0,o.mode=15,N===6)break e;case 15:o.mode=16;case 16:if(H=o.length){if(V<H&&(H=V),te<H&&(H=te),H===0)break e;t.arraySet(U,T,P,H,Q),V-=H,P+=H,te-=H,Q+=H,o.length-=H;break}o.mode=12;break;case 17:for(;A<14;){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}if(o.nlen=257+(31&F),F>>>=5,A-=5,o.ndist=1+(31&F),F>>>=5,A-=5,o.ncode=4+(15&F),F>>>=4,A-=4,286<o.nlen||30<o.ndist){k.msg="too many length or distance symbols",o.mode=30;break}o.have=0,o.mode=18;case 18:for(;o.have<o.ncode;){for(;A<3;){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}o.lens[G[o.have++]]=7&F,F>>>=3,A-=3}for(;o.have<19;)o.lens[G[o.have++]]=0;if(o.lencode=o.lendyn,o.lenbits=7,B={bits:o.lenbits},M=g(0,o.lens,0,19,o.lencode,0,o.work,B),o.lenbits=B.bits,M){k.msg="invalid code lengths set",o.mode=30;break}o.have=0,o.mode=19;case 19:for(;o.have<o.nlen+o.ndist;){for(;ie=(v=o.lencode[F&(1<<o.lenbits)-1])>>>16&255,he=65535&v,!((ne=v>>>24)<=A);){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}if(he<16)F>>>=ne,A-=ne,o.lens[o.have++]=he;else{if(he===16){for(C=ne+2;A<C;){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}if(F>>>=ne,A-=ne,o.have===0){k.msg="invalid bit length repeat",o.mode=30;break}a=o.lens[o.have-1],H=3+(3&F),F>>>=2,A-=2}else if(he===17){for(C=ne+3;A<C;){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}A-=ne,a=0,H=3+(7&(F>>>=ne)),F>>>=3,A-=3}else{for(C=ne+7;A<C;){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}A-=ne,a=0,H=11+(127&(F>>>=ne)),F>>>=7,A-=7}if(o.have+H>o.nlen+o.ndist){k.msg="invalid bit length repeat",o.mode=30;break}for(;H--;)o.lens[o.have++]=a}}if(o.mode===30)break;if(o.lens[256]===0){k.msg="invalid code -- missing end-of-block",o.mode=30;break}if(o.lenbits=9,B={bits:o.lenbits},M=g(w,o.lens,0,o.nlen,o.lencode,0,o.work,B),o.lenbits=B.bits,M){k.msg="invalid literal/lengths set",o.mode=30;break}if(o.distbits=6,o.distcode=o.distdyn,B={bits:o.distbits},M=g(y,o.lens,o.nlen,o.ndist,o.distcode,0,o.work,B),o.distbits=B.bits,M){k.msg="invalid distances set",o.mode=30;break}if(o.mode=20,N===6)break e;case 20:o.mode=21;case 21:if(6<=V&&258<=te){k.next_out=Q,k.avail_out=te,k.next_in=P,k.avail_in=V,o.hold=F,o.bits=A,l(k,K),Q=k.next_out,U=k.output,te=k.avail_out,P=k.next_in,T=k.input,V=k.avail_in,F=o.hold,A=o.bits,o.mode===12&&(o.back=-1);break}for(o.back=0;ie=(v=o.lencode[F&(1<<o.lenbits)-1])>>>16&255,he=65535&v,!((ne=v>>>24)<=A);){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}if(ie&&!(240&ie)){for(de=ne,_e=ie,ye=he;ie=(v=o.lencode[ye+((F&(1<<de+_e)-1)>>de)])>>>16&255,he=65535&v,!(de+(ne=v>>>24)<=A);){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}F>>>=de,A-=de,o.back+=de}if(F>>>=ne,A-=ne,o.back+=ne,o.length=he,ie===0){o.mode=26;break}if(32&ie){o.back=-1,o.mode=12;break}if(64&ie){k.msg="invalid literal/length code",o.mode=30;break}o.extra=15&ie,o.mode=22;case 22:if(o.extra){for(C=o.extra;A<C;){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}o.length+=F&(1<<o.extra)-1,F>>>=o.extra,A-=o.extra,o.back+=o.extra}o.was=o.length,o.mode=23;case 23:for(;ie=(v=o.distcode[F&(1<<o.distbits)-1])>>>16&255,he=65535&v,!((ne=v>>>24)<=A);){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}if(!(240&ie)){for(de=ne,_e=ie,ye=he;ie=(v=o.distcode[ye+((F&(1<<de+_e)-1)>>de)])>>>16&255,he=65535&v,!(de+(ne=v>>>24)<=A);){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}F>>>=de,A-=de,o.back+=de}if(F>>>=ne,A-=ne,o.back+=ne,64&ie){k.msg="invalid distance code",o.mode=30;break}o.offset=he,o.extra=15&ie,o.mode=24;case 24:if(o.extra){for(C=o.extra;A<C;){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}o.offset+=F&(1<<o.extra)-1,F>>>=o.extra,A-=o.extra,o.back+=o.extra}if(o.offset>o.dmax){k.msg="invalid distance too far back",o.mode=30;break}o.mode=25;case 25:if(te===0)break e;if(H=K-te,o.offset>H){if((H=o.offset-H)>o.whave&&o.sane){k.msg="invalid distance too far back",o.mode=30;break}ae=H>o.wnext?(H-=o.wnext,o.wsize-H):o.wnext-H,H>o.length&&(H=o.length),ce=o.window}else ce=U,ae=Q-o.offset,H=o.length;for(te<H&&(H=te),te-=H,o.length-=H;U[Q++]=ce[ae++],--H;);o.length===0&&(o.mode=21);break;case 26:if(te===0)break e;U[Q++]=o.length,te--,o.mode=21;break;case 27:if(o.wrap){for(;A<32;){if(V===0)break e;V--,F|=T[P++]<<A,A+=8}if(K-=te,k.total_out+=K,o.total+=K,K&&(k.adler=o.check=o.flags?c(o.check,U,K,Q-K):i(o.check,U,K,Q-K)),K=te,(o.flags?F:m(F))!==o.check){k.msg="incorrect data check",o.mode=30;break}A=F=0}o.mode=28;case 28:if(o.wrap&&o.flags){for(;A<32;){if(V===0)break e;V--,F+=T[P++]<<A,A+=8}if(F!==(4294967295&o.total)){k.msg="incorrect length check",o.mode=30;break}A=F=0}o.mode=29;case 29:M=1;break e;case 30:M=-3;break e;case 31:return-4;case 32:default:return h}return k.next_out=Q,k.avail_out=te,k.next_in=P,k.avail_in=V,o.hold=F,o.bits=A,(o.wsize||K!==k.avail_out&&o.mode<30&&(o.mode<27||N!==4))&&Z(k,k.output,k.next_out,K-k.avail_out)?(o.mode=31,-4):(ee-=k.avail_in,K-=k.avail_out,k.total_in+=ee,k.total_out+=K,o.total+=K,o.wrap&&K&&(k.adler=o.check=o.flags?c(o.check,U,K,k.next_out-K):i(o.check,U,K,k.next_out-K)),k.data_type=o.bits+(o.last?64:0)+(o.mode===12?128:0)+(o.mode===20||o.mode===15?256:0),(ee==0&&K===0||N===4)&&M===_&&(M=-5),M)},r.inflateEnd=function(k){if(!k||!k.state)return h;var N=k.state;return N.window&&(N.window=null),k.state=null,_},r.inflateGetHeader=function(k,N){var o;return k&&k.state&&2&(o=k.state).wrap?((o.head=N).done=!1,_):h},r.inflateSetDictionary=function(k,N){var o,T=N.length;return k&&k.state?(o=k.state).wrap!==0&&o.mode!==11?h:o.mode===11&&i(1,N,T,0)!==o.check?-3:Z(k,N,T,T)?(o.mode=31,-4):(o.havedict=1,_):h},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,n,r){var t=e("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],c=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],g=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(w,y,_,h,b,u,x,m){var p,j,E,S,R,z,L,D,W,Z=m.bits,k=0,N=0,o=0,T=0,U=0,P=0,Q=0,V=0,te=0,F=0,A=null,ee=0,K=new t.Buf16(16),H=new t.Buf16(16),ae=null,ce=0;for(k=0;k<=15;k++)K[k]=0;for(N=0;N<h;N++)K[y[_+N]]++;for(U=Z,T=15;1<=T&&K[T]===0;T--);if(T<U&&(U=T),T===0)return b[u++]=20971520,b[u++]=20971520,m.bits=1,0;for(o=1;o<T&&K[o]===0;o++);for(U<o&&(U=o),k=V=1;k<=15;k++)if(V<<=1,(V-=K[k])<0)return-1;if(0<V&&(w===0||T!==1))return-1;for(H[1]=0,k=1;k<15;k++)H[k+1]=H[k]+K[k];for(N=0;N<h;N++)y[_+N]!==0&&(x[H[y[_+N]]++]=N);if(z=w===0?(A=ae=x,19):w===1?(A=i,ee-=257,ae=c,ce-=257,256):(A=l,ae=g,-1),k=o,R=u,Q=N=F=0,E=-1,S=(te=1<<(P=U))-1,w===1&&852<te||w===2&&592<te)return 1;for(;;){for(L=k-Q,W=x[N]<z?(D=0,x[N]):x[N]>z?(D=ae[ce+x[N]],A[ee+x[N]]):(D=96,0),p=1<<k-Q,o=j=1<<P;b[R+(F>>Q)+(j-=p)]=L<<24|D<<16|W|0,j!==0;);for(p=1<<k-1;F&p;)p>>=1;if(p!==0?(F&=p-1,F+=p):F=0,N++,--K[k]==0){if(k===T)break;k=y[_+x[N]]}if(U<k&&(F&S)!==E){for(Q===0&&(Q=U),R+=o,V=1<<(P=k-Q);P+Q<T&&!((V-=K[P+Q])<=0);)P++,V<<=1;if(te+=1<<P,w===1&&852<te||w===2&&592<te)return 1;b[E=F&S]=U<<24|P<<16|R-u|0}}return F!==0&&(b[R+F]=k-Q<<24|64<<16|0),m.bits=U,0}},{"../utils/common":41}],51:[function(e,n,r){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,n,r){var t=e("../utils/common"),i=0,c=1;function l(v){for(var I=v.length;0<=--I;)v[I]=0}var g=0,w=29,y=256,_=y+1+w,h=30,b=19,u=2*_+1,x=15,m=16,p=7,j=256,E=16,S=17,R=18,z=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],L=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],D=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Z=new Array(2*(_+2));l(Z);var k=new Array(2*h);l(k);var N=new Array(512);l(N);var o=new Array(256);l(o);var T=new Array(w);l(T);var U,P,Q,V=new Array(h);function te(v,I,G,$,O){this.static_tree=v,this.extra_bits=I,this.extra_base=G,this.elems=$,this.max_length=O,this.has_stree=v&&v.length}function F(v,I){this.dyn_tree=v,this.max_code=0,this.stat_desc=I}function A(v){return v<256?N[v]:N[256+(v>>>7)]}function ee(v,I){v.pending_buf[v.pending++]=255&I,v.pending_buf[v.pending++]=I>>>8&255}function K(v,I,G){v.bi_valid>m-G?(v.bi_buf|=I<<v.bi_valid&65535,ee(v,v.bi_buf),v.bi_buf=I>>m-v.bi_valid,v.bi_valid+=G-m):(v.bi_buf|=I<<v.bi_valid&65535,v.bi_valid+=G)}function H(v,I,G){K(v,G[2*I],G[2*I+1])}function ae(v,I){for(var G=0;G|=1&v,v>>>=1,G<<=1,0<--I;);return G>>>1}function ce(v,I,G){var $,O,Y=new Array(x+1),J=0;for($=1;$<=x;$++)Y[$]=J=J+G[$-1]<<1;for(O=0;O<=I;O++){var q=v[2*O+1];q!==0&&(v[2*O]=ae(Y[q]++,q))}}function ne(v){var I;for(I=0;I<_;I++)v.dyn_ltree[2*I]=0;for(I=0;I<h;I++)v.dyn_dtree[2*I]=0;for(I=0;I<b;I++)v.bl_tree[2*I]=0;v.dyn_ltree[2*j]=1,v.opt_len=v.static_len=0,v.last_lit=v.matches=0}function ie(v){8<v.bi_valid?ee(v,v.bi_buf):0<v.bi_valid&&(v.pending_buf[v.pending++]=v.bi_buf),v.bi_buf=0,v.bi_valid=0}function he(v,I,G,$){var O=2*I,Y=2*G;return v[O]<v[Y]||v[O]===v[Y]&&$[I]<=$[G]}function de(v,I,G){for(var $=v.heap[G],O=G<<1;O<=v.heap_len&&(O<v.heap_len&&he(I,v.heap[O+1],v.heap[O],v.depth)&&O++,!he(I,$,v.heap[O],v.depth));)v.heap[G]=v.heap[O],G=O,O<<=1;v.heap[G]=$}function _e(v,I,G){var $,O,Y,J,q=0;if(v.last_lit!==0)for(;$=v.pending_buf[v.d_buf+2*q]<<8|v.pending_buf[v.d_buf+2*q+1],O=v.pending_buf[v.l_buf+q],q++,$===0?H(v,O,I):(H(v,(Y=o[O])+y+1,I),(J=z[Y])!==0&&K(v,O-=T[Y],J),H(v,Y=A(--$),G),(J=L[Y])!==0&&K(v,$-=V[Y],J)),q<v.last_lit;);H(v,j,I)}function ye(v,I){var G,$,O,Y=I.dyn_tree,J=I.stat_desc.static_tree,q=I.stat_desc.has_stree,re=I.stat_desc.elems,oe=-1;for(v.heap_len=0,v.heap_max=u,G=0;G<re;G++)Y[2*G]!==0?(v.heap[++v.heap_len]=oe=G,v.depth[G]=0):Y[2*G+1]=0;for(;v.heap_len<2;)Y[2*(O=v.heap[++v.heap_len]=oe<2?++oe:0)]=1,v.depth[O]=0,v.opt_len--,q&&(v.static_len-=J[2*O+1]);for(I.max_code=oe,G=v.heap_len>>1;1<=G;G--)de(v,Y,G);for(O=re;G=v.heap[1],v.heap[1]=v.heap[v.heap_len--],de(v,Y,1),$=v.heap[1],v.heap[--v.heap_max]=G,v.heap[--v.heap_max]=$,Y[2*O]=Y[2*G]+Y[2*$],v.depth[O]=(v.depth[G]>=v.depth[$]?v.depth[G]:v.depth[$])+1,Y[2*G+1]=Y[2*$+1]=O,v.heap[1]=O++,de(v,Y,1),2<=v.heap_len;);v.heap[--v.heap_max]=v.heap[1],function(se,xe){var Ie,Ce,Re,ue,Ae,Ve,je=xe.dyn_tree,nt=xe.max_code,yt=xe.stat_desc.static_tree,vt=xe.stat_desc.has_stree,wt=xe.stat_desc.extra_bits,st=xe.stat_desc.extra_base,ze=xe.stat_desc.max_length,Te=0;for(ue=0;ue<=x;ue++)se.bl_count[ue]=0;for(je[2*se.heap[se.heap_max]+1]=0,Ie=se.heap_max+1;Ie<u;Ie++)ze<(ue=je[2*je[2*(Ce=se.heap[Ie])+1]+1]+1)&&(ue=ze,Te++),je[2*Ce+1]=ue,nt<Ce||(se.bl_count[ue]++,Ae=0,st<=Ce&&(Ae=wt[Ce-st]),Ve=je[2*Ce],se.opt_len+=Ve*(ue+Ae),vt&&(se.static_len+=Ve*(yt[2*Ce+1]+Ae)));if(Te!==0){do{for(ue=ze-1;se.bl_count[ue]===0;)ue--;se.bl_count[ue]--,se.bl_count[ue+1]+=2,se.bl_count[ze]--,Te-=2}while(0<Te);for(ue=ze;ue!==0;ue--)for(Ce=se.bl_count[ue];Ce!==0;)nt<(Re=se.heap[--Ie])||(je[2*Re+1]!==ue&&(se.opt_len+=(ue-je[2*Re+1])*je[2*Re],je[2*Re+1]=ue),Ce--)}}(v,I),ce(Y,oe,v.bl_count)}function a(v,I,G){var $,O,Y=-1,J=I[1],q=0,re=7,oe=4;for(J===0&&(re=138,oe=3),I[2*(G+1)+1]=65535,$=0;$<=G;$++)O=J,J=I[2*($+1)+1],++q<re&&O===J||(q<oe?v.bl_tree[2*O]+=q:O!==0?(O!==Y&&v.bl_tree[2*O]++,v.bl_tree[2*E]++):q<=10?v.bl_tree[2*S]++:v.bl_tree[2*R]++,Y=O,oe=(q=0)===J?(re=138,3):O===J?(re=6,3):(re=7,4))}function M(v,I,G){var $,O,Y=-1,J=I[1],q=0,re=7,oe=4;for(J===0&&(re=138,oe=3),$=0;$<=G;$++)if(O=J,J=I[2*($+1)+1],!(++q<re&&O===J)){if(q<oe)for(;H(v,O,v.bl_tree),--q!=0;);else O!==0?(O!==Y&&(H(v,O,v.bl_tree),q--),H(v,E,v.bl_tree),K(v,q-3,2)):q<=10?(H(v,S,v.bl_tree),K(v,q-3,3)):(H(v,R,v.bl_tree),K(v,q-11,7));Y=O,oe=(q=0)===J?(re=138,3):O===J?(re=6,3):(re=7,4)}}l(V);var B=!1;function C(v,I,G,$){K(v,(g<<1)+($?1:0),3),function(O,Y,J,q){ie(O),ee(O,J),ee(O,~J),t.arraySet(O.pending_buf,O.window,Y,J,O.pending),O.pending+=J}(v,I,G)}r._tr_init=function(v){B||(function(){var I,G,$,O,Y,J=new Array(x+1);for(O=$=0;O<w-1;O++)for(T[O]=$,I=0;I<1<<z[O];I++)o[$++]=O;for(o[$-1]=O,O=Y=0;O<16;O++)for(V[O]=Y,I=0;I<1<<L[O];I++)N[Y++]=O;for(Y>>=7;O<h;O++)for(V[O]=Y<<7,I=0;I<1<<L[O]-7;I++)N[256+Y++]=O;for(G=0;G<=x;G++)J[G]=0;for(I=0;I<=143;)Z[2*I+1]=8,I++,J[8]++;for(;I<=255;)Z[2*I+1]=9,I++,J[9]++;for(;I<=279;)Z[2*I+1]=7,I++,J[7]++;for(;I<=287;)Z[2*I+1]=8,I++,J[8]++;for(ce(Z,_+1,J),I=0;I<h;I++)k[2*I+1]=5,k[2*I]=ae(I,5);U=new te(Z,z,y+1,_,x),P=new te(k,L,0,h,x),Q=new te(new Array(0),D,0,b,p)}(),B=!0),v.l_desc=new F(v.dyn_ltree,U),v.d_desc=new F(v.dyn_dtree,P),v.bl_desc=new F(v.bl_tree,Q),v.bi_buf=0,v.bi_valid=0,ne(v)},r._tr_stored_block=C,r._tr_flush_block=function(v,I,G,$){var O,Y,J=0;0<v.level?(v.strm.data_type===2&&(v.strm.data_type=function(q){var re,oe=4093624447;for(re=0;re<=31;re++,oe>>>=1)if(1&oe&&q.dyn_ltree[2*re]!==0)return i;if(q.dyn_ltree[18]!==0||q.dyn_ltree[20]!==0||q.dyn_ltree[26]!==0)return c;for(re=32;re<y;re++)if(q.dyn_ltree[2*re]!==0)return c;return i}(v)),ye(v,v.l_desc),ye(v,v.d_desc),J=function(q){var re;for(a(q,q.dyn_ltree,q.l_desc.max_code),a(q,q.dyn_dtree,q.d_desc.max_code),ye(q,q.bl_desc),re=b-1;3<=re&&q.bl_tree[2*W[re]+1]===0;re--);return q.opt_len+=3*(re+1)+5+5+4,re}(v),O=v.opt_len+3+7>>>3,(Y=v.static_len+3+7>>>3)<=O&&(O=Y)):O=Y=G+5,G+4<=O&&I!==-1?C(v,I,G,$):v.strategy===4||Y===O?(K(v,2+($?1:0),3),_e(v,Z,k)):(K(v,4+($?1:0),3),function(q,re,oe,se){var xe;for(K(q,re-257,5),K(q,oe-1,5),K(q,se-4,4),xe=0;xe<se;xe++)K(q,q.bl_tree[2*W[xe]+1],3);M(q,q.dyn_ltree,re-1),M(q,q.dyn_dtree,oe-1)}(v,v.l_desc.max_code+1,v.d_desc.max_code+1,J+1),_e(v,v.dyn_ltree,v.dyn_dtree)),ne(v),$&&ie(v)},r._tr_tally=function(v,I,G){return v.pending_buf[v.d_buf+2*v.last_lit]=I>>>8&255,v.pending_buf[v.d_buf+2*v.last_lit+1]=255&I,v.pending_buf[v.l_buf+v.last_lit]=255&G,v.last_lit++,I===0?v.dyn_ltree[2*G]++:(v.matches++,I--,v.dyn_ltree[2*(o[G]+y+1)]++,v.dyn_dtree[2*A(I)]++),v.last_lit===v.lit_bufsize-1},r._tr_align=function(v){K(v,2,3),H(v,j,Z),function(I){I.bi_valid===16?(ee(I,I.bi_buf),I.bi_buf=0,I.bi_valid=0):8<=I.bi_valid&&(I.pending_buf[I.pending++]=255&I.bi_buf,I.bi_buf>>=8,I.bi_valid-=8)}(v)}},{"../utils/common":41}],53:[function(e,n,r){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,n,r){(function(t){(function(i,c){if(!i.setImmediate){var l,g,w,y,_=1,h={},b=!1,u=i.document,x=Object.getPrototypeOf&&Object.getPrototypeOf(i);x=x&&x.setTimeout?x:i,l={}.toString.call(i.process)==="[object process]"?function(E){process.nextTick(function(){p(E)})}:function(){if(i.postMessage&&!i.importScripts){var E=!0,S=i.onmessage;return i.onmessage=function(){E=!1},i.postMessage("","*"),i.onmessage=S,E}}()?(y="setImmediate$"+Math.random()+"$",i.addEventListener?i.addEventListener("message",j,!1):i.attachEvent("onmessage",j),function(E){i.postMessage(y+E,"*")}):i.MessageChannel?((w=new MessageChannel).port1.onmessage=function(E){p(E.data)},function(E){w.port2.postMessage(E)}):u&&"onreadystatechange"in u.createElement("script")?(g=u.documentElement,function(E){var S=u.createElement("script");S.onreadystatechange=function(){p(E),S.onreadystatechange=null,g.removeChild(S),S=null},g.appendChild(S)}):function(E){setTimeout(p,0,E)},x.setImmediate=function(E){typeof E!="function"&&(E=new Function(""+E));for(var S=new Array(arguments.length-1),R=0;R<S.length;R++)S[R]=arguments[R+1];var z={callback:E,args:S};return h[_]=z,l(_),_++},x.clearImmediate=m}function m(E){delete h[E]}function p(E){if(b)setTimeout(p,0,E);else{var S=h[E];if(S){b=!0;try{(function(R){var z=R.callback,L=R.args;switch(L.length){case 0:z();break;case 1:z(L[0]);break;case 2:z(L[0],L[1]);break;case 3:z(L[0],L[1],L[2]);break;default:z.apply(c,L)}})(S)}finally{m(E),b=!1}}}}function j(E){E.source===i&&typeof E.data=="string"&&E.data.indexOf(y)===0&&p(+E.data.slice(y.length))}})(typeof self>"u"?t===void 0?this:t:self)}).call(this,typeof Fe<"u"?Fe:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(xt);var xr=xt.exports;const br=St(xr);class yr{async exportToPDF(s,e){const n=this.getPageSize(e.pageSize),r=this.getOrientation(s,e.orientation),t=new Dt({orientation:r,unit:"mm",format:e.pageSize==="original"?[n.width,n.height]:e.pageSize});e.metadata&&(e.metadata.title&&t.setProperties({title:e.metadata.title}),e.metadata.author&&t.setProperties({author:e.metadata.author}),e.metadata.subject&&t.setProperties({subject:e.metadata.subject}));for(let i=0;i<s.pages.length;i++){const c=s.pages[i];i>0&&t.addPage();const l=await this.blobToDataURL(c.processedImage),g=t.internal.pageSize.getWidth(),w=t.internal.pageSize.getHeight();if(e.pageSize==="original"){const y=c.dimensions.width,_=c.dimensions.height,h=y/_;let b=g,u=g/h;u>w&&(u=w,b=w*h);const x=(g-b)/2,m=(w-u)/2;t.addImage(l,"JPEG",x,m,b,u)}else t.addImage(l,"JPEG",0,0,g,w);e.includeOCR&&c.ocrResult&&this.addTextLayer(t,c,g,w)}return t.output("blob")}async exportToImage(s,e){const n=document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("Failed to get canvas context");const t=await this.blobToImageData(s.processedImage);let i=t.width,c=t.height;if(e.maxDimension){const w=Math.max(i,c);if(w>e.maxDimension){const y=e.maxDimension/w;i=Math.round(i*y),c=Math.round(c*y)}}n.width=i,n.height=c;const l=document.createElement("canvas"),g=l.getContext("2d");if(!g)throw new Error("Failed to get temp canvas context");return l.width=t.width,l.height=t.height,g.putImageData(t,0,0),r.drawImage(l,0,0,i,c),new Promise((w,y)=>{n.toBlob(_=>{_?w(_):y(new Error("Failed to convert canvas to blob"))},e.format==="png"?"image/png":"image/jpeg",e.format==="jpeg"?e.quality/100:void 0)})}async exportMultipleImages(s,e){const n=[];for(const r of s.pages){const t=await this.exportToImage(r,e);n.push(t)}return n}async exportToText(s,e=!1){const n=[];if(e){n.push(`# ${s.name}

`),n.push(`*Created: ${new Date(s.createdAt).toLocaleDateString()}*

`),n.push(`---

`);for(const t of s.pages)t.ocrResult&&(n.push(`## Page ${t.pageNumber}

`),n.push(`${t.ocrResult.text}

`),t.ocrResult.confidence&&n.push(`*Confidence: ${t.ocrResult.confidence.toFixed(1)}%*

`),n.push(`---

`))}else for(const t of s.pages)t.ocrResult&&n.push(`--- Page ${t.pageNumber} ---

${t.ocrResult.text}

`);if(n.length===0)throw new Error("No OCR text available in this document");const r=n.join("");return new Blob([r],{type:e?"text/markdown":"text/plain"})}downloadBlob(s,e){const n=URL.createObjectURL(s),r=document.createElement("a");r.href=n,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}async share(s,e,n){if(!navigator.share||!navigator.canShare)throw new Error("Web Share API not supported");const r=new File([s],e,{type:s.type});if(!navigator.canShare({files:[r]}))throw new Error("Cannot share this file type");await navigator.share({title:n,files:[r]})}async blobToDataURL(s){return new Promise((e,n)=>{const r=new FileReader;r.onloadend=()=>e(r.result),r.onerror=n,r.readAsDataURL(s)})}async blobToImageData(s){return new Promise((e,n)=>{const r=new Image;r.onload=()=>{const t=document.createElement("canvas"),i=t.getContext("2d");if(!i){n(new Error("Failed to get canvas context"));return}t.width=r.width,t.height=r.height,i.drawImage(r,0,0);const c=i.getImageData(0,0,r.width,r.height);e(c)},r.onerror=n,r.src=URL.createObjectURL(s)})}getPageSize(s){switch(s){case"a4":return{width:210,height:297};case"letter":return{width:216,height:279};case"legal":return{width:216,height:356};default:return{width:210,height:297}}}getOrientation(s,e){if(e!=="auto")return e;const n=s.pages[0];return n&&n.dimensions.width>n.dimensions.height?"landscape":"portrait"}addTextLayer(s,e,n,r){if(!e.ocrResult)return;const t=n/e.dimensions.width,i=r/e.dimensions.height;s.setTextColor(255,255,255),s.setFontSize(8);for(const c of e.ocrResult.words){const l=c.boundingBox.x*t,g=c.boundingBox.y*i;s.text(c.text,l,g,{renderingMode:"invisible"})}}}let qe=null;function bt(){return qe||(qe=new yr),qe}class vr{constructor(){pe(this,"exportService",bt())}async exportDocumentsAsZip(s,e,n){if(s.length===0)throw new Error("No documents selected for export");const r=new br;for(let t=0;t<s.length;t++){const i=s[t];n&&n({current:t+1,total:s.length,currentDocumentName:i.name});const c=this.sanitizeFilename(i.name);if(e.format==="pdf"){const l=await this.exportService.exportToPDF(i,e.pdfOptions||this.getDefaultPDFOptions());r.file(`${c}.pdf`,l)}else{const l=await this.exportService.exportMultipleImages(i,e.imageOptions||this.getDefaultImageOptions());if(l.length>1){const g=r.folder(c);g&&l.forEach((w,y)=>{const _=e.imageOptions?.format==="jpeg"?"jpg":"png";g.file(`page_${y+1}.${_}`,w)})}else if(l.length===1){const g=e.imageOptions?.format==="jpeg"?"jpg":"png";r.file(`${c}.${g}`,l[0])}}}return await r.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:6}})}async exportSelectedDocuments(s,e,n,r){const t=e.filter(i=>s.includes(i.id));return this.exportDocumentsAsZip(t,n,r)}getDefaultPDFOptions(){return{pageSize:"a4",orientation:"auto",quality:"high",includeOCR:!1,compression:!0}}getDefaultImageOptions(){return{format:"png",quality:90}}sanitizeFilename(s){return s.replace(/[^a-z0-9_\-\s]/gi,"_").replace(/\s+/g,"_").substring(0,100)}generateZipFilename(s,e){const n=new Date().toISOString().split("T")[0];return`documents_${s}_${e==="pdf"?"PDFs":"Images"}_${n}.zip`}}let Ke=null;function wr(){return Ke||(Ke=new vr),Ke}const _r=({compact:f=!1})=>{const[s,e]=X.useState(null),[n,r]=X.useState(!0);X.useEffect(()=>{t()},[]);const t=async()=>{try{const g=await(await Se()).getStorageUsage();e(g)}catch(l){console.error("Failed to load storage usage:",l)}finally{r(!1)}},i=l=>{if(l===0)return"0 Bytes";const g=1024,w=["Bytes","KB","MB","GB"],y=Math.floor(Math.log(l)/Math.log(g));return Math.round(l/Math.pow(g,y)*100)/100+" "+w[y]};if(n)return f?d.jsx("span",{className:"text-xs text-gray-500",children:"Loading..."}):d.jsx("div",{className:"text-sm text-gray-600",children:"Loading storage info..."});if(!s||s.quota===0)return f?d.jsx("span",{className:"text-xs text-gray-500",children:"Storage: N/A"}):d.jsx("div",{className:"text-sm text-gray-600",children:"Storage information not available"});const c=l=>l<50?"bg-green-500":l<80?"bg-yellow-500":"bg-red-500";return f?d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsxs("span",{className:"text-xs text-gray-600",children:[i(s.used)," / ",i(s.quota)]}),d.jsx("div",{className:"w-16 h-2 bg-gray-200 rounded-full overflow-hidden",children:d.jsx("div",{className:`h-full ${c(s.percentage)} transition-all duration-300`,style:{width:`${Math.min(s.percentage,100)}%`}})})]}):d.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[d.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"Storage Usage"}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex items-center justify-between text-sm",children:[d.jsx("span",{className:"text-gray-600",children:"Used"}),d.jsx("span",{className:"font-medium",children:i(s.used)})]}),d.jsxs("div",{className:"flex items-center justify-between text-sm",children:[d.jsx("span",{className:"text-gray-600",children:"Total"}),d.jsx("span",{className:"font-medium",children:i(s.quota)})]}),d.jsxs("div",{className:"flex items-center justify-between text-sm",children:[d.jsx("span",{className:"text-gray-600",children:"Used"}),d.jsxs("span",{className:"font-medium",children:[s.percentage.toFixed(1),"%"]})]}),d.jsx("div",{className:"w-full h-3 bg-gray-200 rounded-full overflow-hidden mt-2",children:d.jsx("div",{className:`h-full ${c(s.percentage)} transition-all duration-300`,style:{width:`${Math.min(s.percentage,100)}%`}})}),s.percentage>80&&d.jsx("div",{className:"mt-2 text-xs text-orange-600 bg-orange-50 p-2 rounded",children:"âš ï¸ Storage is running low. Consider deleting old documents."})]})]})},Cr=()=>{const{documents:f,selectedDocumentIds:s,setDocuments:e,setCurrentDocument:n,removeDocument:r,toggleDocumentSelection:t,clearDocumentSelection:i,selectAllDocuments:c,setCurrentView:l,addToast:g}=ge(U=>({documents:U.documents.list,selectedDocumentIds:U.documents.selectedDocumentIds,setDocuments:U.setDocuments,setCurrentDocument:U.setCurrentDocument,removeDocument:U.removeDocument,toggleDocumentSelection:U.toggleDocumentSelection,clearDocumentSelection:U.clearDocumentSelection,selectAllDocuments:U.selectAllDocuments,setCurrentView:U.setCurrentView,addToast:U.addToast})),[w,y]=X.useState(!0),[_,h]=X.useState(new Map),[b,u]=X.useState(!1),[x,m]=X.useState(!1),[p,j]=X.useState({current:0,total:0}),[E,S]=X.useState(""),[R,z]=X.useState([]);X.useEffect(()=>{L()},[]),X.useEffect(()=>{f.length>0&&D()},[f]),X.useEffect(()=>{if(!E.trim())z(f);else{const U=E.toLowerCase(),P=f.filter(Q=>{if(Q.name.toLowerCase().includes(U)||Q.tags.some(V=>V.toLowerCase().includes(U)))return!0;if(Q.metadata.hasOCR){for(const V of Q.pages)if(V.ocrResult&&V.ocrResult.text.toLowerCase().includes(U))return!0}return!1});z(P)}},[f,E]);const L=async()=>{try{const P=await(await Se()).listDocuments({sortBy:"updatedAt",sortOrder:"desc"});e(P)}catch(U){console.error("Failed to load documents:",U),g({type:"error",message:"Failed to load documents"})}finally{y(!1)}},D=async()=>{const U=new Map;for(const P of f)if(P.pages.length>0){const Q=P.pages[0],V=URL.createObjectURL(Q.thumbnailImage);U.set(P.id,V)}return h(U),()=>{_.forEach(P=>URL.revokeObjectURL(P))}},W=U=>{b?t(U.id):(n(U),l("detail"))},Z=()=>{b&&i(),u(!b)},k=()=>{s.length===f.length?i():c()},N=async U=>{if(s.length===0){g({type:"error",message:"No documents selected"});return}try{m(!0),j({current:0,total:s.length});const P=wr(),Q=f.filter(H=>s.includes(H.id)),V={pageSize:"a4",orientation:"auto",quality:"high",includeOCR:!1,compression:!0},te={format:"png",quality:90},F=await P.exportDocumentsAsZip(Q,{format:U,pdfOptions:V,imageOptions:te},H=>{j({current:H.current,total:H.total})}),A=P.generateZipFilename(s.length,U),ee=URL.createObjectURL(F),K=document.createElement("a");K.href=ee,K.download=A,document.body.appendChild(K),K.click(),document.body.removeChild(K),URL.revokeObjectURL(ee),g({type:"success",message:`Successfully exported ${s.length} document${s.length!==1?"s":""}`}),u(!1),i()}catch(P){console.error("Bulk export failed:",P),g({type:"error",message:"Failed to export documents"})}finally{m(!1),j({current:0,total:0})}},o=async(U,P)=>{if(U.stopPropagation(),!!confirm("Are you sure you want to delete this document?"))try{await(await Se()).deleteDocument(P),r(P),g({type:"success",message:"Document deleted"})}catch(Q){console.error("Failed to delete document:",Q),g({type:"error",message:"Failed to delete document"})}},T=async(U,P)=>{U.stopPropagation(),n(P),l("ocr")};return w?d.jsx("div",{className:"flex items-center justify-center h-full bg-gray-50",children:d.jsxs("div",{className:"text-center",children:[d.jsx(De,{size:"lg"}),d.jsx("p",{className:"text-sm text-gray-600 mt-4",children:"Loading documents..."})]})}):f.length===0?d.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-50 p-6",children:[d.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“"}),d.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Documents Yet"}),d.jsx("p",{className:"text-sm text-gray-600 mb-6 text-center max-w-md",children:"Start by scanning your first document using the camera."}),d.jsx(le,{onClick:()=>l("camera"),variant:"primary",size:"lg",children:"Scan Document"})]}):d.jsxs("div",{className:"h-full bg-gray-50 flex flex-col",children:[d.jsxs("div",{className:"bg-white border-b border-gray-200 p-4",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("h2",{className:"text-lg font-semibold",children:"My Documents"}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx(le,{onClick:Z,variant:b?"secondary":"outline",size:"sm",children:b?"Cancel":"Select"}),!b&&d.jsx(le,{onClick:()=>l("camera"),variant:"primary",size:"sm",children:"+ New Scan"})]})]}),!b&&f.length>0&&d.jsx("div",{className:"mt-3",children:d.jsx("input",{type:"text",value:E,onChange:U=>S(U.target.value),placeholder:"Search documents, tags, or text...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})}),d.jsxs("div",{className:"flex items-center justify-between mt-2",children:[d.jsx("p",{className:"text-sm text-gray-600",children:b&&s.length>0?`${s.length} selected`:E?`${R.length} of ${f.length} document${f.length!==1?"s":""}`:`${f.length} document${f.length!==1?"s":""}`}),b&&d.jsx("button",{onClick:k,className:"text-sm text-blue-600 hover:text-blue-700",children:s.length===f.length?"Deselect All":"Select All"})]}),!b&&d.jsx("div",{className:"mt-3",children:d.jsx(_r,{compact:!0})})]}),d.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:d.jsx("div",{className:"grid grid-cols-2 gap-4",children:R.map(U=>{const P=s.includes(U.id);return d.jsxs("div",{onClick:()=>W(U),className:`bg-white rounded-lg shadow hover:shadow-lg transition-all cursor-pointer overflow-hidden ${P?"ring-2 ring-blue-500":""}`,children:[d.jsxs("div",{className:"aspect-[3/4] bg-gray-200 relative overflow-hidden",children:[_.has(U.id)?d.jsx("img",{src:_.get(U.id),alt:U.name,className:"w-full h-full object-cover"}):d.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:d.jsx("span",{className:"text-4xl",children:"ðŸ“„"})}),b&&d.jsx("div",{className:"absolute top-2 left-2",children:d.jsx("input",{type:"checkbox",checked:P,onChange:()=>t(U.id),onClick:Q=>Q.stopPropagation(),className:"w-6 h-6 cursor-pointer"})}),!b&&d.jsx("button",{onClick:Q=>o(Q,U.id),className:"absolute top-2 right-2 w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center shadow-lg transition-colors",title:"Delete document",children:"Ã—"})]}),d.jsxs("div",{className:"p-3",children:[d.jsx("h3",{className:"text-sm font-medium truncate mb-1",children:U.name}),d.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[d.jsxs("span",{children:[U.pages.length," page",U.pages.length!==1?"s":""]}),d.jsx("span",{children:U.metadata.hasOCR?"âœ“ OCR":""})]}),d.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(U.updatedAt).toLocaleDateString()}),!b&&d.jsxs("div",{className:"flex gap-2 mt-2",children:[!U.metadata.hasOCR&&d.jsx("button",{onClick:Q=>T(Q,U),className:"flex-1 px-2 py-1 text-xs bg-blue-50 text-blue-600 rounded hover:bg-blue-100 transition-colors",children:"Extract Text"}),d.jsx("button",{onClick:Q=>{Q.stopPropagation(),n(U),l("export")},className:"flex-1 px-2 py-1 text-xs bg-green-50 text-green-600 rounded hover:bg-green-100 transition-colors",children:"Export"})]})]})]},U.id)})})}),b&&s.length>0&&d.jsx("div",{className:"bg-white border-t border-gray-200 p-4 shadow-lg",children:x?d.jsxs("div",{className:"text-center",children:[d.jsx(De,{size:"sm"}),d.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Exporting ",p.current," of ",p.total,"..."]})]}):d.jsxs("div",{className:"flex gap-2",children:[d.jsx(le,{onClick:()=>N("pdf"),variant:"primary",size:"md",className:"flex-1",children:"ðŸ“„ Export as PDFs"}),d.jsx(le,{onClick:()=>N("images"),variant:"secondary",size:"md",className:"flex-1",children:"ðŸ–¼ï¸ Export as Images"})]})})]})},kr=()=>{const{currentDocument:f,setCurrentDocument:s,setDocuments:e,setCurrentView:n,addToast:r}=ge(N=>({currentDocument:N.documents.currentDocument,setCurrentDocument:N.setCurrentDocument,setDocuments:N.setDocuments,setCurrentView:N.setCurrentView,addToast:N.addToast})),[t,i]=X.useState(!1),[c,l]=X.useState(!1),[g,w]=X.useState(""),[y,_]=X.useState(new Map),[h,b]=X.useState(""),[u,x]=X.useState(null),[m,p]=X.useState(null);X.useEffect(()=>{f&&(w(f.name),j())},[f]);const j=async()=>{if(!f)return;const N=new Map;for(const o of f.pages){const T=URL.createObjectURL(o.thumbnailImage);N.set(o.id,T)}return _(N),()=>{y.forEach(o=>URL.revokeObjectURL(o))}},E=async()=>{if(!f||!g.trim()){r({type:"error",message:"Document name cannot be empty"});return}try{const N={...f,name:g.trim(),updatedAt:new Date},o=await Se();await o.updateDocument(N),s(N);const T=await o.listDocuments({sortBy:"updatedAt",sortOrder:"desc"});e(T),l(!1),r({type:"success",message:"Document name updated"})}catch(N){console.error("Failed to update document name:",N),r({type:"error",message:"Failed to update document name"})}},S=async()=>{if(!f||!h.trim())return;const N=h.trim();if(f.tags.includes(N)){r({type:"warning",message:"Tag already exists"});return}try{const o={...f,tags:[...f.tags,N],updatedAt:new Date},T=await Se();await T.updateDocument(o),s(o);const U=await T.listDocuments({sortBy:"updatedAt",sortOrder:"desc"});e(U),b(""),r({type:"success",message:"Tag added"})}catch(o){console.error("Failed to add tag:",o),r({type:"error",message:"Failed to add tag"})}},R=async N=>{if(f)try{const o={...f,tags:f.tags.filter(P=>P!==N),updatedAt:new Date},T=await Se();await T.updateDocument(o),s(o);const U=await T.listDocuments({sortBy:"updatedAt",sortOrder:"desc"});e(U),r({type:"success",message:"Tag removed"})}catch(o){console.error("Failed to remove tag:",o),r({type:"error",message:"Failed to remove tag"})}},z=async N=>{if(f){if(f.pages.length===1){r({type:"error",message:"Cannot delete the last page. Delete the document instead."});return}if(confirm("Are you sure you want to delete this page?"))try{i(!0);const o=await Se();await o.removePage(f.id,N);const T=await o.getDocument(f.id);T&&s(T);const U=await o.listDocuments({sortBy:"updatedAt",sortOrder:"desc"});e(U),r({type:"success",message:"Page deleted"})}catch(o){console.error("Failed to delete page:",o),r({type:"error",message:"Failed to delete page"})}finally{i(!1)}}},L=N=>{x(N)},D=(N,o)=>{N.preventDefault(),p(o)},W=async(N,o)=>{if(N.preventDefault(),!f||u===null||u===o){x(null),p(null);return}try{i(!0);const T=[...f.pages],[U]=T.splice(u,1);T.splice(o,0,U);const P=T.map(F=>F.id),Q=await Se();await Q.reorderPages(f.id,P);const V=await Q.getDocument(f.id);V&&s(V);const te=await Q.listDocuments({sortBy:"updatedAt",sortOrder:"desc"});e(te),r({type:"success",message:"Pages reordered"})}catch(T){console.error("Failed to reorder pages:",T),r({type:"error",message:"Failed to reorder pages"})}finally{i(!1),x(null),p(null)}},Z=()=>{f&&n("export")},k=()=>{f&&n("ocr")};return f?d.jsxs("div",{className:"h-full bg-gray-50 flex flex-col",children:[d.jsxs("div",{className:"bg-white border-b border-gray-200 p-4",children:[d.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[d.jsx(Oe,{icon:"â†",onClick:()=>n("documents"),title:"Back to documents",size:"md"}),d.jsx("div",{className:"flex-1",children:c?d.jsxs("div",{className:"flex gap-2",children:[d.jsx("input",{type:"text",value:g,onChange:N=>w(N.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0,onKeyPress:N=>{N.key==="Enter"&&E()}}),d.jsx(le,{onClick:E,variant:"primary",size:"sm",children:"Save"}),d.jsx(le,{onClick:()=>{w(f.name),l(!1)},variant:"secondary",size:"sm",children:"Cancel"})]}):d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("h2",{className:"text-lg font-semibold",children:f.name}),d.jsx(Oe,{icon:"âœï¸",onClick:()=>l(!0),title:"Edit name",size:"sm"})]})})]}),d.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[d.jsxs("div",{children:[f.pages.length," page",f.pages.length!==1?"s":""]}),d.jsxs("div",{children:["Created: ",new Date(f.createdAt).toLocaleString()]}),d.jsxs("div",{children:["Updated: ",new Date(f.updatedAt).toLocaleString()]}),f.metadata.hasOCR&&d.jsx("div",{className:"text-green-600",children:"âœ“ OCR completed"})]}),d.jsxs("div",{className:"mt-3",children:[d.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Tags"}),d.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:f.tags.map(N=>d.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs",children:[N,d.jsx("button",{onClick:()=>R(N),className:"hover:text-blue-900",children:"Ã—"})]},N))}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("input",{type:"text",value:h,onChange:N=>b(N.target.value),placeholder:"Add tag...",className:"flex-1 px-3 py-1 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyPress:N=>{N.key==="Enter"&&S()}}),d.jsx(le,{onClick:S,variant:"secondary",size:"sm",children:"Add"})]})]}),d.jsxs("div",{className:"flex gap-2 mt-3",children:[!f.metadata.hasOCR&&d.jsx(le,{onClick:k,variant:"secondary",size:"sm",fullWidth:!0,children:"Extract Text"}),d.jsx(le,{onClick:Z,variant:"primary",size:"sm",fullWidth:!0,children:"Export"})]})]}),d.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[d.jsx("div",{className:"mb-3 text-sm text-gray-600",children:"Drag and drop pages to reorder them"}),d.jsx("div",{className:"grid grid-cols-2 gap-4",children:f.pages.map((N,o)=>d.jsxs("div",{draggable:!0,onDragStart:()=>L(o),onDragOver:T=>D(T,o),onDrop:T=>W(T,o),className:`bg-white rounded-lg shadow hover:shadow-lg transition-all cursor-move ${m===o&&u!==o?"ring-2 ring-blue-500":""} ${u===o?"opacity-50":""}`,children:[d.jsxs("div",{className:"aspect-[3/4] bg-gray-200 relative overflow-hidden rounded-t-lg",children:[y.has(N.id)?d.jsx("img",{src:y.get(N.id),alt:`Page ${N.pageNumber}`,className:"w-full h-full object-cover"}):d.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:d.jsx("span",{className:"text-4xl",children:"ðŸ“„"})}),d.jsx("button",{onClick:()=>z(N.id),className:"absolute top-2 right-2 w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center shadow-lg transition-colors",title:"Delete page",children:"Ã—"}),d.jsxs("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-black/70 text-white text-xs rounded",children:["Page ",N.pageNumber]})]}),d.jsxs("div",{className:"p-2 text-xs text-gray-600",children:[d.jsxs("div",{children:["Filter: ",N.filterApplied]}),N.ocrResult&&d.jsx("div",{className:"text-green-600 mt-1",children:"âœ“ OCR available"})]})]},N.id))})]}),t&&d.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:d.jsxs("div",{className:"bg-white rounded-lg p-4 flex items-center gap-3",children:[d.jsx(De,{size:"sm"}),d.jsx("span",{className:"text-sm text-gray-700",children:"Processing..."})]})})]}):d.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-50 p-6",children:[d.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“„"}),d.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Document Selected"}),d.jsx(le,{onClick:()=>n("documents"),variant:"primary",size:"lg",children:"Back to Documents"})]})};class Sr{constructor(){pe(this,"worker",null);pe(this,"isInitialized",!1);pe(this,"currentLanguages",["eng"])}async initialize(s=["eng"],e){if(!(this.isInitialized&&this.arraysEqual(s,this.currentLanguages))){this.worker&&await this.terminate();try{this.worker=await Nt.createWorker(s.join("+"),1,{logger:n=>{e&&e({status:n.status,progress:n.progress||0})}}),this.currentLanguages=s,this.isInitialized=!0}catch(n){throw console.error("Failed to initialize OCR worker:",n),new Error("Failed to initialize OCR service")}}}async recognize(s,e){if(!this.worker||!this.isInitialized)throw new Error("OCR service not initialized");const n=performance.now();try{e&&(e.pageSegMode!==void 0&&await this.worker.setParameters({tessedit_pageseg_mode:e.pageSegMode}),e.preserveInterwordSpaces!==void 0&&await this.worker.setParameters({preserve_interword_spaces:e.preserveInterwordSpaces?"1":"0"}),e.characterWhitelist&&await this.worker.setParameters({tessedit_char_whitelist:e.characterWhitelist}),e.characterBlacklist&&await this.worker.setParameters({tessedit_char_blacklist:e.characterBlacklist}));const r=await this.worker.recognize(s),t=performance.now()-n;return this.formatResult(r.data,t)}catch(r){throw console.error("OCR recognition failed:",r),new Error("Failed to perform OCR")}}async detectOrientation(s){if(!this.worker||!this.isInitialized)throw new Error("OCR service not initialized");try{const e=await this.worker.detect(s);return{degrees:e.data.orientation_degrees||0,confidence:e.data.orientation_confidence||0,script:e.data.script||"Latin"}}catch(e){throw console.error("Orientation detection failed:",e),new Error("Failed to detect orientation")}}preprocessForOCR(s){const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("Failed to get canvas context");e.width=s.width,e.height=s.height,n.putImageData(s,0,0);const r=s.data;for(let t=0;t<r.length;t+=4){const i=r[t]*.299+r[t+1]*.587+r[t+2]*.114;r[t]=i,r[t+1]=i,r[t+2]=i}return s}async terminate(){this.worker&&(await this.worker.terminate(),this.worker=null,this.isInitialized=!1)}formatResult(s,e){return{text:s.text,confidence:s.confidence,words:s.words.map(n=>({text:n.text,confidence:n.confidence,boundingBox:{x:n.bbox.x0,y:n.bbox.y0,width:n.bbox.x1-n.bbox.x0,height:n.bbox.y1-n.bbox.y0},baseline:{x0:n.baseline.x0,y0:n.baseline.y0,x1:n.baseline.x1,y1:n.baseline.y1}})),lines:s.lines.map(n=>({text:n.text,confidence:n.confidence,boundingBox:{x:n.bbox.x0,y:n.bbox.y0,width:n.bbox.x1-n.bbox.x0,height:n.bbox.y1-n.bbox.y0},words:n.words.map(r=>({text:r.text,confidence:r.confidence,boundingBox:{x:r.bbox.x0,y:r.bbox.y0,width:r.bbox.x1-r.bbox.x0,height:r.bbox.y1-r.bbox.y0},baseline:{x0:r.baseline.x0,y0:r.baseline.y0,x1:r.baseline.x1,y1:r.baseline.y1}}))})),paragraphs:s.paragraphs.map(n=>({text:n.text,confidence:n.confidence,boundingBox:{x:n.bbox.x0,y:n.bbox.y0,width:n.bbox.x1-n.bbox.x0,height:n.bbox.y1-n.bbox.y0},lines:n.lines.map(r=>({text:r.text,confidence:r.confidence,boundingBox:{x:r.bbox.x0,y:r.bbox.y0,width:r.bbox.x1-r.bbox.x0,height:r.bbox.y1-r.bbox.y0},words:r.words.map(t=>({text:t.text,confidence:t.confidence,boundingBox:{x:t.bbox.x0,y:t.bbox.y0,width:t.bbox.x1-t.bbox.x0,height:t.bbox.y1-t.bbox.y0},baseline:{x0:t.baseline.x0,y0:t.baseline.y0,x1:t.baseline.x1,y1:t.baseline.y1}}))}))})),blocks:(s.blocks||[]).map(n=>({text:n.text,confidence:n.confidence,boundingBox:{x:n.bbox.x0,y:n.bbox.y0,width:n.bbox.x1-n.bbox.x0,height:n.bbox.y1-n.bbox.y0},paragraphs:n.paragraphs.map(r=>({text:r.text,confidence:r.confidence,boundingBox:{x:r.bbox.x0,y:r.bbox.y0,width:r.bbox.x1-r.bbox.x0,height:r.bbox.y1-r.bbox.y0},lines:r.lines.map(t=>({text:t.text,confidence:t.confidence,boundingBox:{x:t.bbox.x0,y:t.bbox.y0,width:t.bbox.x1-t.bbox.x0,height:t.bbox.y1-t.bbox.y0},words:t.words.map(i=>({text:i.text,confidence:i.confidence,boundingBox:{x:i.bbox.x0,y:i.bbox.y0,width:i.bbox.x1-i.bbox.x0,height:i.bbox.y1-i.bbox.y0},baseline:{x0:i.baseline.x0,y0:i.baseline.y0,x1:i.baseline.x1,y1:i.baseline.y1}}))}))}))})),processingTime:e}}arraysEqual(s,e){return s.length!==e.length?!1:s.every((n,r)=>n===e[r])}}let Xe=null;function jr(){return Xe||(Xe=new Sr),Xe}const ht=[{code:"eng",name:"English",tier:1},{code:"spa",name:"Spanish",tier:1},{code:"fra",name:"French",tier:1},{code:"deu",name:"German",tier:1},{code:"ita",name:"Italian",tier:1},{code:"por",name:"Portuguese",tier:1},{code:"rus",name:"Russian",tier:1},{code:"jpn",name:"Japanese",tier:1},{code:"chi_sim",name:"Chinese Simplified",tier:1},{code:"kor",name:"Korean",tier:1}],Er=()=>{const{currentDocument:f,processedImage:s,isProcessing:e,progress:n,result:r,selectedLanguages:t,isInitialized:i,setOCRInitialized:c,setOCRProcessing:l,setOCRProgress:g,setOCRResult:w,setSelectedLanguages:y,setCurrentDocument:_,setDocuments:h,setCurrentView:b,addToast:u}=ge(Z=>({currentDocument:Z.documents.currentDocument,processedImage:Z.scanSession.processedImage,isProcessing:Z.ocr.isProcessing,progress:Z.ocr.progress,result:Z.ocr.result,selectedLanguages:Z.ocr.selectedLanguages,isInitialized:Z.ocr.isInitialized,setOCRInitialized:Z.setOCRInitialized,setOCRProcessing:Z.setOCRProcessing,setOCRProgress:Z.setOCRProgress,setOCRResult:Z.setOCRResult,setSelectedLanguages:Z.setSelectedLanguages,setCurrentDocument:Z.setCurrentDocument,setDocuments:Z.setDocuments,setCurrentView:Z.setCurrentView,addToast:Z.addToast})),[x,m]=X.useState(""),[p,j]=X.useState(!1),E=X.useRef(null),S=jr();X.useEffect(()=>{(async()=>{if(!i)try{l(!0),await S.initialize(t,k=>{g(k.progress*100)}),c(!0),l(!1),g(0)}catch(k){console.error("Failed to initialize OCR:",k),u({type:"error",message:"Failed to initialize OCR service"}),l(!1)}})()},[]),X.useEffect(()=>{(async()=>{if(f&&f.pages.length>0&&!s)try{const k=f.pages[0],N=new Image;N.onload=()=>{const o=document.createElement("canvas"),T=o.getContext("2d");if(T){o.width=N.width,o.height=N.height,T.drawImage(N,0,0);const U=T.getImageData(0,0,N.width,N.height);if(E.current){const P=E.current.getContext("2d");P&&(E.current.width=U.width,E.current.height=U.height,P.putImageData(U,0,0))}}},N.src=URL.createObjectURL(k.processedImage),k.ocrResult&&w(k.ocrResult)}catch(k){console.error("Failed to load document image:",k)}})()},[f]),X.useEffect(()=>{if(s&&E.current){const Z=E.current,k=Z.getContext("2d");k&&(Z.width=s.width,Z.height=s.height,k.putImageData(s,0,0))}},[s]),X.useEffect(()=>{r&&m(r.text)},[r]);const R=async()=>{const Z=s||(f&&E.current?E.current.getContext("2d")?.getImageData(0,0,E.current.width,E.current.height):null);if(!Z){u({type:"error",message:"No image to process"});return}try{l(!0),g(0);const k=await S.recognize(Z,{pageSegMode:3,preserveInterwordSpaces:!0});g(100),w(k),l(!1),g(0),f&&await z(k),u({type:"success",message:`Text extracted with ${k.confidence.toFixed(1)}% confidence`})}catch(k){console.error("OCR failed:",k),u({type:"error",message:"Failed to extract text from image"}),l(!1),g(0)}},z=async Z=>{if(!f){u({type:"warning",message:"No document to save OCR results to"});return}const k=Z||r;if(!k){u({type:"error",message:"No OCR results to save"});return}try{const N={...f,pages:f.pages.map((U,P)=>P===0?{...U,ocrResult:k}:U),metadata:{...f.metadata,hasOCR:!0},updatedAt:new Date},o=await Se();await o.updateDocument(N),_(N);const T=await o.listDocuments({sortBy:"updatedAt",sortOrder:"desc"});h(T),u({type:"success",message:"OCR results saved to document"})}catch(N){console.error("Failed to save OCR results:",N),u({type:"error",message:"Failed to save OCR results"})}},L=Z=>{const k=t.includes(Z)?t.filter(N=>N!==Z):[...t,Z];if(k.length===0){u({type:"warning",message:"At least one language must be selected"});return}y(k),c(!1)},D=()=>{x&&(navigator.clipboard.writeText(x),u({type:"success",message:"Text copied to clipboard"}))},W=async()=>{if(x)if(navigator.share)try{await navigator.share({text:x,title:"Extracted Text"})}catch{}else D()};return s?d.jsxs("div",{className:"flex flex-col h-full bg-white",children:[d.jsx("div",{className:"flex-shrink-0 bg-gray-900 relative overflow-hidden",style:{height:"30%"},children:d.jsx("canvas",{ref:E,className:"absolute inset-0 w-full h-full object-contain"})}),d.jsxs("div",{className:"flex-shrink-0 bg-white border-b border-gray-200 p-3",children:[d.jsxs("div",{className:"flex items-center justify-between gap-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(le,{onClick:R,disabled:e||!i,variant:"primary",size:"md",children:e?"Processing...":r?"Re-scan Text":"Extract Text"}),d.jsx("button",{onClick:()=>j(!p),className:"px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:e,children:t.length===1?ht.find(Z=>Z.code===t[0])?.name:`${t.length} languages`})]}),r&&d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Oe,{icon:"ðŸ“‹",onClick:D,title:"Copy text",size:"md"}),d.jsx(Oe,{icon:"ðŸ“¤",onClick:W,title:"Share text",size:"md"})]})]}),e&&d.jsxs("div",{className:"mt-3",children:[d.jsxs("div",{className:"flex items-center justify-between mb-1",children:[d.jsx("span",{className:"text-xs text-gray-600",children:n<100?"Initializing...":"Recognizing text..."}),d.jsxs("span",{className:"text-xs text-gray-600",children:[Math.round(n),"%"]})]}),d.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:d.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${n}%`}})})]}),p&&d.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[d.jsx("h3",{className:"text-sm font-medium mb-2",children:"Select Languages"}),d.jsx("div",{className:"grid grid-cols-2 gap-2",children:ht.map(Z=>d.jsxs("label",{className:"flex items-center gap-2 p-2 rounded hover:bg-gray-100 cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:t.includes(Z.code),onChange:()=>L(Z.code),className:"rounded border-gray-300",disabled:e}),d.jsx("span",{className:"text-sm",children:Z.name})]},Z.code))})]}),r&&!e&&d.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Confidence: ",r.confidence.toFixed(1),"% â€¢ ",r.words.length," words detected"]})]}),d.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col p-4 bg-gray-50",children:[!r&&!e&&d.jsx("div",{className:"flex-1 flex items-center justify-center text-center",children:d.jsxs("div",{children:[d.jsx("div",{className:"text-4xl mb-2",children:"ðŸ”"}),d.jsx("p",{className:"text-gray-600 text-sm",children:'Click "Extract Text" to start OCR'})]})}),e&&d.jsx("div",{className:"flex-1 flex items-center justify-center",children:d.jsxs("div",{className:"text-center",children:[d.jsx(De,{size:"lg"}),d.jsx("p",{className:"text-sm text-gray-600 mt-4",children:"Extracting text from document..."})]})}),r&&!e&&d.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[d.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2",children:"Extracted Text (editable)"}),d.jsx("textarea",{value:x,onChange:Z=>m(Z.target.value),className:"flex-1 w-full p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Extracted text will appear here..."})]})]})]}):d.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-50 p-6",children:[d.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“„"}),d.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Image to Process"}),d.jsx("p",{className:"text-sm text-gray-600 mb-6 text-center max-w-md",children:"Capture and enhance a document first before extracting text."}),d.jsx(le,{onClick:()=>b("camera"),variant:"primary",size:"lg",children:"Go to Camera"})]})},Nr=()=>{const{currentDocument:f,setCurrentView:s,addToast:e}=ge(p=>({currentDocument:p.documents.currentDocument,setCurrentView:p.setCurrentView,addToast:p.addToast})),[n,r]=X.useState("pdf"),[t,i]=X.useState(!1),[c,l]=X.useState(0),[g,w]=X.useState(!1),[y,_]=X.useState({pageSize:"a4",orientation:"auto",quality:"high",includeOCR:!1,compression:!0}),[h,b]=X.useState({format:"png",quality:90}),u=bt(),x=async()=>{if(!f){e({type:"error",message:"No document to export"});return}i(!0),l(0);try{let p=`${f.name}`;switch(n){case"pdf":{l(30);const j=await u.exportToPDF(f,y);l(100),p+=".pdf",u.downloadBlob(j,p),e({type:"success",message:"PDF exported successfully"});break}case"png":case"jpeg":{if(f.pages.length===1){l(50);const j=await u.exportToImage(f.pages[0],{...h,format:n});l(100),p+=`.${n}`,u.downloadBlob(j,p),e({type:"success",message:`${n.toUpperCase()} exported successfully`})}else{const j=await u.exportMultipleImages(f,{...h,format:n});for(let E=0;E<j.length;E++){l((E+1)/j.length*100);const S=`${f.name}_page${E+1}.${n}`;u.downloadBlob(j[E],S)}e({type:"success",message:`${j.length} images exported successfully`})}break}case"txt":{l(50);const j=await u.exportToText(f,g);l(100),p+=g?".md":".txt",u.downloadBlob(j,p),e({type:"success",message:g?"Markdown exported successfully":"Text exported successfully"});break}}}catch(p){console.error("Export failed:",p),e({type:"error",message:p instanceof Error?p.message:"Export failed"})}finally{i(!1),l(0)}},m=async()=>{if(f){i(!0);try{let p,j;switch(n){case"pdf":p=await u.exportToPDF(f,y),j=`${f.name}.pdf`;break;case"png":case"jpeg":if(f.pages.length===1)p=await u.exportToImage(f.pages[0],{...h,format:n}),j=`${f.name}.${n}`;else{e({type:"warning",message:"Can only share single-page documents. Export multiple pages separately."});return}break;case"txt":p=await u.exportToText(f,g),j=`${f.name}.${g?"md":"txt"}`;break;default:throw new Error("Invalid format")}await u.share(p,j,f.name),e({type:"success",message:"Shared successfully"})}catch(p){console.error("Share failed:",p),p instanceof Error&&p.message.includes("not supported")?x():e({type:"error",message:"Share failed"})}finally{i(!1)}}};return f?d.jsx("div",{className:"h-full bg-white overflow-y-auto",children:d.jsxs("div",{className:"max-w-2xl mx-auto p-6",children:[d.jsxs("div",{className:"mb-6",children:[d.jsx("h2",{className:"text-2xl font-bold mb-2",children:f.name}),d.jsxs("p",{className:"text-sm text-gray-600",children:[f.pages.length," page",f.pages.length!==1?"s":"",f.metadata.hasOCR&&" â€¢ OCR processed"]})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Export Format"}),d.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[d.jsxs("button",{onClick:()=>r("pdf"),className:`p-4 rounded-lg border-2 transition-all ${n==="pdf"?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[d.jsx("div",{className:"text-3xl mb-2",children:"ðŸ“„"}),d.jsx("div",{className:"font-medium",children:"PDF"}),d.jsx("div",{className:"text-xs text-gray-600",children:"Multi-page document"})]}),d.jsxs("button",{onClick:()=>r("png"),className:`p-4 rounded-lg border-2 transition-all ${n==="png"?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[d.jsx("div",{className:"text-3xl mb-2",children:"ðŸ–¼ï¸"}),d.jsx("div",{className:"font-medium",children:"PNG"}),d.jsx("div",{className:"text-xs text-gray-600",children:"Lossless image"})]}),d.jsxs("button",{onClick:()=>r("jpeg"),className:`p-4 rounded-lg border-2 transition-all ${n==="jpeg"?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[d.jsx("div",{className:"text-3xl mb-2",children:"ðŸ“·"}),d.jsx("div",{className:"font-medium",children:"JPEG"}),d.jsx("div",{className:"text-xs text-gray-600",children:"Compressed image"})]}),d.jsxs("button",{onClick:()=>r("txt"),className:`p-4 rounded-lg border-2 transition-all ${n==="txt"?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,disabled:!f.metadata.hasOCR,children:[d.jsx("div",{className:"text-3xl mb-2",children:"ðŸ“"}),d.jsx("div",{className:"font-medium",children:"Text"}),d.jsx("div",{className:"text-xs text-gray-600",children:f.metadata.hasOCR?"OCR text only":"OCR required"})]})]})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Quick Presets"}),d.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[d.jsxs("button",{onClick:()=>{r("pdf"),_({...y,pageSize:"a4",quality:"high",includeOCR:f?.metadata.hasOCR||!1})},className:"p-3 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:["ðŸ“§ Email",d.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"PDF â€¢ High quality"})]}),d.jsxs("button",{onClick:()=>{r("pdf"),_({...y,pageSize:"a4",quality:"medium",includeOCR:!1})},className:"p-3 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:["ðŸ–¨ï¸ Print",d.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"PDF â€¢ A4 â€¢ Medium"})]}),d.jsxs("button",{onClick:()=>{r("pdf"),_({...y,pageSize:"original",quality:"original",includeOCR:f?.metadata.hasOCR||!1})},className:"p-3 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:["ðŸ’¾ Archive",d.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"PDF â€¢ Original"})]}),d.jsxs("button",{onClick:()=>{r("jpeg"),b({format:"jpeg",quality:80,maxDimension:1920})},className:"p-3 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:["ðŸ“± Mobile",d.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"JPEG â€¢ Optimized"})]}),d.jsxs("button",{onClick:()=>{r("png"),b({format:"png",quality:100})},className:"p-3 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:["ðŸŽ¨ Design",d.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"PNG â€¢ Lossless"})]}),f?.metadata.hasOCR&&d.jsxs("button",{onClick:()=>{r("txt"),w(!0)},className:"p-3 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:["ðŸ“ Notes",d.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Markdown â€¢ Text"})]})]})]}),n==="pdf"&&d.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[d.jsx("h3",{className:"font-medium mb-3",children:"PDF Options"}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"Page Size"}),d.jsxs("select",{value:y.pageSize,onChange:p=>_({...y,pageSize:p.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[d.jsx("option",{value:"a4",children:"A4"}),d.jsx("option",{value:"letter",children:"Letter"}),d.jsx("option",{value:"legal",children:"Legal"}),d.jsx("option",{value:"original",children:"Original Size"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"Orientation"}),d.jsxs("select",{value:y.orientation,onChange:p=>_({...y,orientation:p.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[d.jsx("option",{value:"auto",children:"Auto"}),d.jsx("option",{value:"portrait",children:"Portrait"}),d.jsx("option",{value:"landscape",children:"Landscape"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"Quality"}),d.jsxs("select",{value:y.quality,onChange:p=>_({...y,quality:p.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[d.jsx("option",{value:"low",children:"Low (smaller file)"}),d.jsx("option",{value:"medium",children:"Medium"}),d.jsx("option",{value:"high",children:"High"}),d.jsx("option",{value:"original",children:"Original"})]})]}),f.metadata.hasOCR&&d.jsxs("label",{className:"flex items-center gap-2",children:[d.jsx("input",{type:"checkbox",checked:y.includeOCR,onChange:p=>_({...y,includeOCR:p.target.checked}),className:"rounded border-gray-300"}),d.jsx("span",{className:"text-sm text-gray-700",children:"Include OCR text layer (searchable PDF)"})]})]})]}),(n==="png"||n==="jpeg")&&d.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[d.jsx("h3",{className:"font-medium mb-3",children:"Image Options"}),d.jsxs("div",{className:"space-y-4",children:[n==="jpeg"&&d.jsxs("div",{children:[d.jsxs("label",{className:"block text-sm text-gray-700 mb-2",children:["Quality: ",h.quality,"%"]}),d.jsx("input",{type:"range",min:"10",max:"100",step:"10",value:h.quality,onChange:p=>b({...h,quality:parseInt(p.target.value)}),className:"w-full"})]}),d.jsxs("div",{children:[d.jsxs("label",{className:"flex items-center gap-2",children:[d.jsx("input",{type:"checkbox",checked:h.maxDimension!==void 0,onChange:p=>b({...h,maxDimension:p.target.checked?2048:void 0}),className:"rounded border-gray-300"}),d.jsx("span",{className:"text-sm text-gray-700",children:"Limit maximum dimension"})]}),h.maxDimension!==void 0&&d.jsx("input",{type:"number",value:h.maxDimension,onChange:p=>b({...h,maxDimension:parseInt(p.target.value)}),className:"w-full mt-2 px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Max dimension (px)"})]})]})]}),n==="txt"&&d.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[d.jsx("h3",{className:"font-medium mb-3",children:"Text Options"}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("label",{className:"flex items-center gap-2",children:[d.jsx("input",{type:"checkbox",checked:g,onChange:p=>w(p.target.checked),className:"rounded border-gray-300"}),d.jsx("span",{className:"text-sm text-gray-700",children:"Export as Markdown (formatted with headings and metadata)"})]}),d.jsx("div",{className:"text-xs text-gray-600 bg-white p-3 rounded border border-gray-200",children:g?d.jsxs(d.Fragment,{children:[d.jsx("strong",{children:"Markdown format:"})," Includes document title, creation date, page headings, and confidence scores. Perfect for documentation or note-taking apps."]}):d.jsxs(d.Fragment,{children:[d.jsx("strong",{children:"Plain text format:"})," Simple text output with page separators. Compatible with any text editor."]})})]})]}),!t&&d.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[d.jsx("h3",{className:"font-medium mb-3",children:"Document Preview"}),d.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[f.pages.slice(0,6).map(p=>d.jsxs("div",{className:"aspect-[3/4] bg-gray-200 rounded overflow-hidden relative",children:[d.jsx("img",{src:URL.createObjectURL(p.thumbnailImage),alt:`Page ${p.pageNumber}`,className:"w-full h-full object-cover"}),d.jsx("div",{className:"absolute bottom-1 left-1 px-1.5 py-0.5 bg-black/70 text-white text-xs rounded",children:p.pageNumber})]},p.id)),f.pages.length>6&&d.jsxs("div",{className:"aspect-[3/4] bg-gray-300 rounded flex items-center justify-center text-gray-600 text-sm",children:["+",f.pages.length-6," more"]})]})]}),t&&d.jsxs("div",{className:"mb-6",children:[d.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d.jsx("span",{className:"text-sm text-gray-600",children:"Exporting..."}),d.jsxs("span",{className:"text-sm text-gray-600",children:[Math.round(c),"%"]})]}),d.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:d.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${c}%`}})})]}),d.jsxs("div",{className:"flex gap-3",children:[d.jsx(le,{onClick:x,disabled:t,variant:"primary",size:"lg",className:"flex-1",children:t?d.jsxs("span",{className:"flex items-center justify-center gap-2",children:[d.jsx(De,{size:"sm"}),"Exporting..."]}):`Export as ${n.toUpperCase()}`}),typeof navigator.share<"u"&&d.jsx(le,{onClick:m,disabled:t,variant:"secondary",size:"lg",children:"ðŸ“¤ Share"})]})]})}):d.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-50 p-6",children:[d.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“¤"}),d.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Document Selected"}),d.jsx("p",{className:"text-sm text-gray-600 mb-6 text-center max-w-md",children:"Select a document from your library to export it."}),d.jsx(le,{onClick:()=>s("documents"),variant:"primary",size:"lg",children:"Go to Documents"})]})};function Dr(){const f=ge(e=>e.ui.currentView),s=()=>{switch(f){case"camera":return d.jsx(at,{});case"crop":return d.jsx(Yt,{});case"enhance":return d.jsx(gr,{});case"documents":return d.jsx(Cr,{});case"detail":return d.jsx(kr,{});case"ocr":return d.jsx(Er,{});case"export":return d.jsx(Nr,{});default:return d.jsx(at,{})}};return d.jsxs("div",{className:"flex flex-col h-screen overflow-hidden bg-white",children:[d.jsx(Bt,{}),d.jsx("main",{className:"flex-1 overflow-hidden mt-14 mb-16",children:s()}),d.jsx(Pt,{}),d.jsx(Mt,{})]})}Je.createRoot(document.getElementById("root")).render(d.jsx(jt.StrictMode,{children:d.jsx(Dr,{})}));
