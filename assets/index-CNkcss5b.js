var _t=Object.defineProperty;var Ct=(g,n,e)=>n in g?_t(g,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):g[n]=e;var pe=(g,n,e)=>Ct(g,typeof n!="symbol"?n+"":n,e);import{r as J,a as kt,c as Be,g as St,R as jt}from"./react-vendor-CVDnmApk.js";import{c as Et}from"./zustand-vendor-D0NwXheU.js";import{c as Fe,s as Dt}from"./tesseract-vendor-D34z6xNp.js";import{E as Nt}from"./pdf-vendor-CzmxGYVW.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const t of r)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function e(r){const t={};return r.integrity&&(t.integrity=r.integrity),r.referrerPolicy&&(t.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?t.credentials="include":r.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function s(r){if(r.ep)return;r.ep=!0;const t=e(r);fetch(r.href,t)}})();var ft={exports:{}},Ve={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var It=J,zt=Symbol.for("react.element"),Rt=Symbol.for("react.fragment"),Ot=Object.prototype.hasOwnProperty,At=It.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Tt={key:!0,ref:!0,__self:!0,__source:!0};function mt(g,n,e){var s,r={},t=null,i=null;e!==void 0&&(t=""+e),n.key!==void 0&&(t=""+n.key),n.ref!==void 0&&(i=n.ref);for(s in n)Ot.call(n,s)&&!Tt.hasOwnProperty(s)&&(r[s]=n[s]);if(g&&g.defaultProps)for(s in n=g.defaultProps,n)r[s]===void 0&&(r[s]=n[s]);return{$$typeof:zt,type:g,key:t,ref:i,props:r,_owner:At.current}}Ve.Fragment=Rt;Ve.jsx=mt;Ve.jsxs=mt;ft.exports=Ve;var u=ft.exports,Je={},it=kt;Je.createRoot=it.createRoot,Je.hydrateRoot=it.hydrateRoot;const Ue={brightness:0,contrast:0,saturation:0,sharpness:0,gamma:1,shadows:0,highlights:0,temperature:0},Bt=[{id:"original",name:"Original",description:"No filter applied",icon:"ðŸ“„"},{id:"document",name:"Document",description:"High contrast B&W",icon:"ðŸ“ƒ"},{id:"grayscale",name:"Grayscale",description:"Black and white",icon:"â¬œ"},{id:"magic",name:"Magic",description:"Auto-enhanced",icon:"âœ¨"},{id:"whiteboard",name:"Whiteboard",description:"For whiteboards",icon:"ðŸ–Šï¸"},{id:"book",name:"Book",description:"For book pages",icon:"ðŸ“–"},{id:"receipt",name:"Receipt",description:"High contrast",icon:"ðŸ§¾"},{id:"photo",name:"Photo",description:"Color preserved",icon:"ðŸ–¼ï¸"},{id:"blueprint",name:"Blueprint",description:"Inverted colors",icon:"ðŸ“"}],ge=Et(g=>({camera:{isInitialized:!1,isCapturing:!1,stream:null,capabilities:null,error:null},scanSession:{isActive:!1,currentImage:null,detectedEdges:null,adjustedCorners:null,processedImage:null,selectedFilter:"original",enhancementOptions:Ue},ocr:{isInitialized:!1,isProcessing:!1,progress:0,result:null,selectedLanguages:["eng"]},documents:{list:[],currentDocument:null,isLoading:!1,selectedDocumentIds:[]},ui:{currentView:"camera",isProcessing:!1,toasts:[],modalOpen:null},setCameraInitialized:n=>g(e=>({camera:{...e.camera,isInitialized:n}})),setCameraStream:n=>g(e=>({camera:{...e.camera,stream:n}})),setCameraCapabilities:n=>g(e=>({camera:{...e.camera,capabilities:n}})),setCameraError:n=>g(e=>({camera:{...e.camera,error:n}})),setCapturing:n=>g(e=>({camera:{...e.camera,isCapturing:n}})),startScanSession:n=>g({scanSession:{isActive:!0,currentImage:n,detectedEdges:null,adjustedCorners:null,processedImage:null,selectedFilter:"original",enhancementOptions:Ue}}),setDetectedEdges:n=>g(e=>({scanSession:{...e.scanSession,detectedEdges:n}})),setAdjustedCorners:n=>g(e=>({scanSession:{...e.scanSession,adjustedCorners:n}})),setProcessedImage:n=>g(e=>({scanSession:{...e.scanSession,processedImage:n}})),setSelectedFilter:n=>g(e=>({scanSession:{...e.scanSession,selectedFilter:n}})),setEnhancementOptions:n=>g(e=>({scanSession:{...e.scanSession,enhancementOptions:n}})),resetScanSession:()=>g({scanSession:{isActive:!1,currentImage:null,detectedEdges:null,adjustedCorners:null,processedImage:null,selectedFilter:"original",enhancementOptions:Ue}}),setOCRInitialized:n=>g(e=>({ocr:{...e.ocr,isInitialized:n}})),setOCRProcessing:n=>g(e=>({ocr:{...e.ocr,isProcessing:n}})),setOCRProgress:n=>g(e=>({ocr:{...e.ocr,progress:n}})),setOCRResult:n=>g(e=>({ocr:{...e.ocr,result:n}})),setSelectedLanguages:n=>g(e=>({ocr:{...e.ocr,selectedLanguages:n}})),setDocuments:n=>g(e=>({documents:{...e.documents,list:n}})),setCurrentDocument:n=>g(e=>({documents:{...e.documents,currentDocument:n}})),setDocumentsLoading:n=>g(e=>({documents:{...e.documents,isLoading:n}})),addDocument:n=>g(e=>({documents:{...e.documents,list:[n,...e.documents.list]}})),removeDocument:n=>g(e=>({documents:{...e.documents,list:e.documents.list.filter(s=>s.id!==n),selectedDocumentIds:e.documents.selectedDocumentIds.filter(s=>s!==n)}})),toggleDocumentSelection:n=>g(e=>{const s=e.documents.selectedDocumentIds.includes(n);return{documents:{...e.documents,selectedDocumentIds:s?e.documents.selectedDocumentIds.filter(r=>r!==n):[...e.documents.selectedDocumentIds,n]}}}),clearDocumentSelection:()=>g(n=>({documents:{...n.documents,selectedDocumentIds:[]}})),selectAllDocuments:()=>g(n=>({documents:{...n.documents,selectedDocumentIds:n.documents.list.map(e=>e.id)}})),setCurrentView:n=>g(e=>({ui:{...e.ui,currentView:n}})),setProcessing:n=>g(e=>({ui:{...e.ui,isProcessing:n}})),addToast:n=>g(e=>({ui:{...e.ui,toasts:[...e.ui.toasts,{...n,id:Math.random().toString(36).substr(2,9)}]}})),removeToast:n=>g(e=>({ui:{...e.ui,toasts:e.ui.toasts.filter(s=>s.id!==n)}})),setModalOpen:n=>g(e=>({ui:{...e.ui,modalOpen:n}}))})),Ft=()=>{const g=ge(e=>e.ui.currentView),n=()=>{switch(g){case"camera":return"Document Scanner";case"crop":return"Crop Document";case"enhance":return"Enhance";case"ocr":return"Extract Text";case"documents":return"My Documents";case"export":return"Export";default:return"Document Scanner"}};return u.jsx("header",{className:"fixed top-0 left-0 right-0 z-30 bg-white border-b border-gray-200 pt-safe",children:u.jsxs("div",{className:"flex items-center justify-between px-4 h-14",children:[u.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:n()}),u.jsx("div",{className:"flex items-center gap-2"})]})})},Pt=()=>{const g=ge(s=>s.ui.currentView),n=ge(s=>s.setCurrentView),e=[{view:"camera",label:"Camera",icon:"ðŸ“·"},{view:"documents",label:"Documents",icon:"ðŸ“„"}];return u.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-30 bg-white border-t border-gray-200 pb-safe",children:u.jsx("div",{className:"flex items-center justify-around h-16",children:e.map(s=>u.jsxs("button",{onClick:()=>n(s.view),className:`flex flex-col items-center justify-center flex-1 h-full transition-colors ${g===s.view?"text-primary-600":"text-gray-500 hover:text-gray-700"}`,children:[u.jsx("span",{className:"text-2xl mb-1",children:s.icon}),u.jsx("span",{className:"text-xs font-medium",children:s.label})]},s.view))})})},Lt=({toast:g})=>{const n=ge(s=>s.removeToast);J.useEffect(()=>{const s=g.duration||3e3,r=setTimeout(()=>{n(g.id)},s);return()=>clearTimeout(r)},[g.id,g.duration,n]);const e={success:"toast-success",error:"toast-error",warning:"toast-warning",info:"toast-info"};return u.jsx("div",{className:`toast ${e[g.type]} mb-2`,children:u.jsx("p",{className:"text-sm font-medium",children:g.message})})},Mt=()=>{const g=ge(n=>n.ui.toasts);return g.length===0?null:u.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:g.map(n=>u.jsx(Lt,{toast:n},n.id))})};class Ut{constructor(){pe(this,"stream",null);pe(this,"videoTrack",null);pe(this,"currentFacingMode","environment")}async initialize(n){const s={...{facingMode:"environment",resolution:{ideal:{width:3840,height:2160},min:{width:1920,height:1080}},focusMode:"continuous",torch:!1},...n};this.currentFacingMode=s.facingMode;try{const r={video:{facingMode:{ideal:s.facingMode},width:{ideal:s.resolution.ideal.width},height:{ideal:s.resolution.ideal.height}},audio:!1};return this.stream=await navigator.mediaDevices.getUserMedia(r),this.videoTrack=this.stream.getVideoTracks()[0],this.stream}catch(r){console.warn("Failed with ideal constraints, falling back to basic",r);const t={video:{facingMode:s.facingMode,width:{ideal:1920},height:{ideal:1080}},audio:!1};return this.stream=await navigator.mediaDevices.getUserMedia(t),this.videoTrack=this.stream.getVideoTracks()[0],this.stream}}getCapabilities(){if(!this.videoTrack)return null;try{const n=this.videoTrack.getCapabilities();return{hasFlash:"torch"in n,hasFocus:"focusMode"in n,hasZoom:"zoom"in n,maxZoom:n.zoom?.max||1,supportedResolutions:this.getSupportedResolutions(n)}}catch(n){return console.error("Failed to get camera capabilities",n),{hasFlash:!1,hasFocus:!1,hasZoom:!1,maxZoom:1,supportedResolutions:[]}}}getSupportedResolutions(n){const e=[],s=[{width:3840,height:2160},{width:1920,height:1080},{width:1280,height:720},{width:640,height:480}],r=n.width?.max||1920,t=n.height?.max||1080;for(const i of s)i.width<=r&&i.height<=t&&e.push(i);return e}async switchCamera(){const n=this.currentFacingMode==="environment"?"user":"environment";return this.dispose(),this.initialize({facingMode:n})}async capturePhoto(n){if(!this.stream)throw new Error("Camera not initialized");const e=document.createElement("canvas");e.width=n.videoWidth,e.height=n.videoHeight;const s=e.getContext("2d");if(!s)throw new Error("Failed to get canvas context");return s.drawImage(n,0,0),s.getImageData(0,0,e.width,e.height)}getVideoFrame(n){if(!this.stream)return null;try{const e=document.createElement("canvas"),s=Math.min(640,n.videoWidth),r=Math.min(480,n.videoHeight);e.width=s,e.height=r;const t=e.getContext("2d");return t?(t.drawImage(n,0,0,s,r),t.getImageData(0,0,s,r)):null}catch(e){return console.error("Failed to get video frame",e),null}}async setZoom(n){if(!this.videoTrack)throw new Error("Camera not initialized");if(!("zoom"in this.videoTrack.getCapabilities()))throw new Error("Zoom not supported");const s={advanced:[{zoom:n}]};try{await this.videoTrack.applyConstraints(s)}catch(r){throw console.error("Failed to set zoom",r),r}}async toggleFlash(n){if(!this.videoTrack)throw new Error("Camera not initialized");if(!("torch"in this.videoTrack.getCapabilities()))throw new Error("Flash not supported");const s={advanced:[{torch:n}]};try{await this.videoTrack.applyConstraints(s)}catch(r){throw console.error("Failed to toggle flash",r),r}}async setFocusPoint(n,e){if(!this.videoTrack)throw new Error("Camera not initialized");if(!("focusMode"in this.videoTrack.getCapabilities())){console.warn("Focus control not supported");return}console.log("Focus point requested:",n,e)}getStream(){return this.stream}getCurrentFacingMode(){return this.currentFacingMode}isInitialized(){return this.stream!==null&&this.videoTrack!==null}dispose(){this.stream&&(this.stream.getTracks().forEach(n=>n.stop()),this.stream=null),this.videoTrack=null}}const Ee=new Ut,Wt=(g={})=>{const{autoStart:n=!1,facingMode:e="environment",onError:s,onInitialized:r}=g,[t,i]=J.useState(null),[c,l]=J.useState(!1),[p,w]=J.useState(!1),[b,_]=J.useState(null),[h,x]=J.useState(null),d=J.useRef(null),f=async()=>{w(!0),_(null);try{const z=await Ee.initialize({facingMode:e});i(z),l(!0);const R=Ee.getCapabilities();x(R),r?.(z)}catch(z){const R=z instanceof Error?z:new Error("Failed to initialize camera");_(R),s?.(R)}finally{w(!1)}},m=async()=>{w(!0),_(null);try{const z=await Ee.switchCamera();i(z);const R=Ee.getCapabilities();x(R),r?.(z)}catch(z){const R=z instanceof Error?z:new Error("Failed to switch camera");_(R),s?.(R)}finally{w(!1)}},y=async()=>{if(!d.current||!t)return _(new Error("Camera not ready")),null;try{return await Ee.capturePhoto(d.current)}catch(z){const R=z instanceof Error?z:new Error("Failed to capture photo");return _(R),s?.(R),null}},E=async z=>{try{await Ee.setZoom(z)}catch(R){console.error("Zoom failed:",R)}},j=async z=>{try{await Ee.toggleFlash(z)}catch(R){console.error("Flash toggle failed:",R)}},S=()=>{Ee.dispose(),i(null),l(!1),x(null)};return J.useEffect(()=>{t&&d.current&&(d.current.srcObject=t)},[t]),J.useEffect(()=>(n&&f(),()=>{S()}),[]),{stream:t,isInitialized:c,isLoading:p,error:b,capabilities:h,videoRef:d,initialize:f,switchCamera:m,capturePhoto:y,setZoom:E,toggleFlash:j,dispose:S,facingMode:Ee.getCurrentFacingMode()}},le=({variant:g="primary",size:n="md",fullWidth:e=!1,className:s="",children:r,...t})=>{const i="btn font-medium transition-all duration-200 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",c={primary:"btn-primary",secondary:"btn-secondary",outline:"border-2 border-primary-600 text-primary-600 hover:bg-primary-50 active:bg-primary-100"},l={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"},p=e?"w-full":"";return u.jsx("button",{className:`${i} ${c[g]} ${l[n]} ${p} ${s}`,...t,children:r})},Oe=({icon:g,label:n,size:e="md",className:s="",...r})=>{const t={sm:"p-2",md:"p-3",lg:"p-4"};return u.jsx("button",{className:`btn-icon ${t[e]} ${s}`,"aria-label":n,title:n,...r,children:g})},Ne=({size:g="md",className:n=""})=>{const e={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"};return u.jsx("div",{className:`flex items-center justify-center ${n}`,children:u.jsx("div",{className:`${e[g]} border-4 border-gray-200 border-t-primary-600 rounded-full animate-spin`})})},at=()=>{const{addToast:g,setCameraCapabilities:n,setCurrentView:e,startScanSession:s}=ge(d=>({addToast:d.addToast,setCameraCapabilities:d.setCameraCapabilities,setCurrentView:d.setCurrentView,startScanSession:d.startScanSession})),{videoRef:r,isInitialized:t,isLoading:i,error:c,capabilities:l,facingMode:p,initialize:w,switchCamera:b,capturePhoto:_}=Wt({onError:d=>{g({type:"error",message:d.message||"Failed to access camera"})},onInitialized:()=>{g({type:"success",message:"Camera initialized successfully"})}});J.useEffect(()=>{l&&n(l)},[l,n]);const h=async()=>{const d=await _();d&&(s(d),e("crop"),g({type:"success",message:"Image captured successfully"}))},x=async()=>{try{await b(),g({type:"success",message:`Switched to ${p==="environment"?"front":"back"} camera`})}catch{g({type:"error",message:"Failed to switch camera"})}};return i?u.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-black",children:[u.jsx(Ne,{size:"lg",className:"mb-4"}),u.jsx("p",{className:"text-white text-sm",children:"Initializing camera..."})]}):c||!t&&!i?u.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-100 p-6",children:[u.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“·"}),u.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Camera Access Required"}),c&&u.jsx("p",{className:"text-sm text-red-600 mb-4 text-center max-w-md",children:c.message}),u.jsx("p",{className:"text-sm text-gray-600 mb-6 text-center max-w-md",children:"This app needs access to your camera to scan documents. Click the button below to grant permission."}),u.jsx(le,{onClick:w,variant:"primary",size:"lg",children:"Enable Camera"})]}):u.jsxs("div",{className:"relative w-full h-full bg-black",children:[u.jsx("video",{ref:r,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),u.jsx("div",{className:"absolute top-0 left-0 right-0 p-4",children:u.jsx("div",{className:"flex justify-end",children:u.jsx(Oe,{icon:u.jsx("span",{className:"text-xl",children:"ðŸ”„"}),onClick:x,className:"bg-black/50 text-white hover:bg-black/70",label:"Switch camera"})})}),u.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/80 to-transparent",children:u.jsx("div",{className:"flex items-center justify-center",children:u.jsx(le,{onClick:h,variant:"primary",size:"lg",className:"rounded-full w-16 h-16 p-0",children:u.jsx("span",{className:"text-2xl",children:"ðŸ“¸"})})})}),u.jsx("div",{className:"absolute inset-0 pointer-events-none",children:u.jsx("div",{className:"w-full h-full flex items-center justify-center p-8",children:u.jsx("div",{className:"border-2 border-white border-dashed rounded-lg w-full max-w-md aspect-document opacity-50"})})})]})},Vt=({corners:g,imageSize:n,containerSize:e,onChange:s,onCommit:r,className:t=""})=>{const[i,c]=J.useState(null),[l,p]=J.useState(g),w=J.useRef(null);J.useEffect(()=>{p(g)},[g]);const b=()=>{const j=n.width/n.height,S=e.width/e.height;let z,R,L=0,N=0;return j>S?(z=e.width/n.width,R=z,N=(e.height-n.height*R)/2):(R=e.height/n.height,z=R,L=(e.width-n.width*z)/2),{scaleX:z,scaleY:R,offsetX:L,offsetY:N}},_=j=>{const{scaleX:S,scaleY:z,offsetX:R,offsetY:L}=b();return{x:j.x*S+R,y:j.y*z+L}},h=j=>{const{scaleX:S,scaleY:z,offsetX:R,offsetY:L}=b();return{x:(j.x-R)/S,y:(j.y-L)/z}},x=j=>{if(!w.current)return{x:0,y:0};const z=w.current.getBoundingClientRect();let R,L;if("touches"in j){const N=j.touches[0];R=N.clientX,L=N.clientY}else R=j.clientX,L=j.clientY;return{x:R-z.left,y:L-z.top}},d=j=>S=>{S.preventDefault(),S.stopPropagation(),c(j)},f=j=>{if(i===null)return;j.preventDefault();const S=x(j),z=h(S),R={x:Math.max(0,Math.min(n.width,z.x)),y:Math.max(0,Math.min(n.height,z.y))},L=[...l];L[i]=R,p(L),s(L)},m=()=>{i!==null&&(c(null),r?.())},y=l.map(_),E=y.length===4?`M ${y[0].x} ${y[0].y} L ${y[1].x} ${y[1].y} L ${y[2].x} ${y[2].y} L ${y[3].x} ${y[3].y} Z`:"";return u.jsxs("svg",{ref:w,className:`absolute inset-0 w-full h-full ${t}`,style:{touchAction:"none"},onMouseMove:f,onMouseUp:m,onMouseLeave:m,onTouchMove:f,onTouchEnd:m,onTouchCancel:m,children:[E&&u.jsxs(u.Fragment,{children:[u.jsx("path",{d:E,fill:"rgba(59, 130, 246, 0.2)",stroke:"none"}),u.jsx("path",{d:E,fill:"none",stroke:"#3b82f6",strokeWidth:"2"})]}),y.map((j,S)=>u.jsxs("g",{children:[u.jsx("circle",{cx:j.x,cy:j.y,r:"20",fill:"transparent",style:{cursor:"grab"},onMouseDown:d(S),onTouchStart:d(S)}),u.jsx("circle",{cx:j.x,cy:j.y,r:"8",fill:"white",stroke:"#3b82f6",strokeWidth:"3",style:{cursor:"grab",pointerEvents:"none"}}),u.jsx("circle",{cx:j.x,cy:j.y,r:"3",fill:"#3b82f6",style:{pointerEvents:"none"}})]},S)),y.length===4&&y.map((j,S)=>{const z=y[(S+1)%4];return u.jsx("line",{x1:j.x,y1:j.y,x2:z.x,y2:z.y,stroke:"#3b82f6",strokeWidth:"2",strokeDasharray:"5,5",style:{pointerEvents:"none"}},`line-${S}`)})]})};function tt(){return!!window.cv}function We(){if(!window.cv)throw new Error("OpenCV not loaded. Call loadOpenCV() first.");return window.cv}function ve(g){return We().matFromImageData(g)}function ke(g){const n=We(),e=document.createElement("canvas");e.width=g.cols,e.height=g.rows;const s=e.getContext("2d");if(!s)throw new Error("Failed to get canvas context");return n.imshow(e,g),s.getImageData(0,0,e.width,e.height)}function we(...g){for(const n of g)n&&n.delete&&n.delete()}class Zt{constructor(){pe(this,"cv",null);pe(this,"isInitialized",!1)}async initialize(){if(console.log("[EdgeDetectionService] initialize() called, isInitialized:",this.isInitialized),!this.isInitialized)try{console.log("[EdgeDetectionService] Calling loadOpenCV()"),this.cv=window.cv instanceof Promise?await window.cv:window.cv,console.log("[EdgeDetectionService] loadOpenCV() completed, cv:",this.cv),this.isInitialized=!0,console.log("[EdgeDetectionService] EdgeDetectionService initialized")}catch(n){throw console.error("[EdgeDetectionService] Failed to initialize EdgeDetectionService:",n),n}}async detectDocument(n,e){console.log("[EdgeDetectionService] detectDocument() called, image size:",n.width,"x",n.height),this.isInitialized||(console.log("[EdgeDetectionService] Not initialized, calling initialize()"),await this.initialize());const r={...{cannyThreshold1:50,cannyThreshold2:150,blurKernelSize:5,dilationIterations:2,minAreaRatio:.1,maxAreaRatio:.95},...e};let t=null,i=null,c=null,l=null,p=null,w=null,b=null;try{console.log("[EdgeDetectionService] Starting edge detection pipeline"),console.log("[EdgeDetectionService] Converting ImageData to Mat"),t=ve(n),console.log("[EdgeDetectionService] ImageData converted, Mat size:",t.rows,"x",t.cols),console.log("[EdgeDetectionService] Converting to grayscale"),i=new this.cv.Mat,this.cv.cvtColor(t,i,this.cv.COLOR_RGBA2GRAY),console.log("[EdgeDetectionService] Grayscale conversion complete"),console.log("[EdgeDetectionService] Applying Gaussian blur"),c=new this.cv.Mat;const _=new this.cv.Size(r.blurKernelSize,r.blurKernelSize);this.cv.GaussianBlur(i,c,_,0),console.log("[EdgeDetectionService] Gaussian blur complete"),console.log("[EdgeDetectionService] Applying Canny edge detection"),l=new this.cv.Mat,this.cv.Canny(c,l,r.cannyThreshold1,r.cannyThreshold2),console.log("[EdgeDetectionService] Canny edge detection complete"),console.log("[EdgeDetectionService] Dilating edges"),p=new this.cv.Mat;const h=this.cv.Mat.ones(3,3,this.cv.CV_8U);this.cv.dilate(l,p,h,new this.cv.Point(-1,-1),r.dilationIterations),h.delete(),console.log("[EdgeDetectionService] Edge dilation complete"),console.log("[EdgeDetectionService] Finding contours"),w=new this.cv.MatVector,b=new this.cv.Mat,this.cv.findContours(p,w,b,this.cv.RETR_EXTERNAL,this.cv.CHAIN_APPROX_SIMPLE),console.log("[EdgeDetectionService] Found",w.size(),"contours"),console.log("[EdgeDetectionService] Finding best quadrilateral");const x=this.findBestQuadrilateral(w,n.width,n.height,r);return console.log("[EdgeDetectionService] Best quadrilateral result:",x),x}catch(_){return console.error("[EdgeDetectionService] Edge detection failed:",_),null}finally{console.log("[EdgeDetectionService] Cleaning up resources"),we(t,i,c,l,p,b),w&&w.delete(),console.log("[EdgeDetectionService] Cleanup complete")}}findBestQuadrilateral(n,e,s,r){const t=e*s,i=t*r.minAreaRatio,c=t*r.maxAreaRatio;let l=null,p=0;for(let w=0;w<n.size();w++){const b=n.get(w),_=this.cv.contourArea(b);if(_<i||_>c)continue;const h=this.cv.arcLength(b,!0),x=new this.cv.Mat;if(this.cv.approxPolyDP(b,x,.02*h,!0),x.rows===4){const d=this.matToPoints(x),f=this.getBoundingRect(d),m=f.width/f.height,y=this.scoreQuadrilateral(d,_,m,t);y>p&&(p=y,l={contour:this.orderCorners(d),confidence:Math.min(y/100,1),area:_,aspectRatio:m,boundingRect:f})}x.delete()}return l}scoreQuadrilateral(n,e,s,r){let t=0;const i=e/r;t+=i*50;const l=[1,1.29,1.41,1.5].reduce((w,b)=>{const _=Math.abs(s-b),h=Math.max(0,25-_*20);return Math.max(w,h)},0);t+=l;const p=this.isRoughlyConvex(n)?25:0;return t+=p,t}isRoughlyConvex(n){if(n.length!==4)return!1;const e=[];for(let t=0;t<4;t++){const i=n[t],c=n[(t+1)%4],l=n[(t+2)%4],p=(c.x-i.x)*(l.y-c.y)-(c.y-i.y)*(l.x-c.x);e.push(p)}const s=e.every(t=>t>0),r=e.every(t=>t<0);return s||r}matToPoints(n){const e=[];for(let s=0;s<n.rows;s++){const r=n.data32S[s*2],t=n.data32S[s*2+1];e.push({x:r,y:t})}return e}getBoundingRect(n){const e=n.map(l=>l.x),s=n.map(l=>l.y),r=Math.min(...e),t=Math.max(...e),i=Math.min(...s),c=Math.max(...s);return{x:r,y:i,width:t-r,height:c-i}}orderCorners(n){if(n.length!==4)return n;const e=[...n].sort((t,i)=>t.y-i.y),s=e.slice(0,2).sort((t,i)=>t.x-i.x),r=e.slice(2,4).sort((t,i)=>t.x-i.x);return[s[0],s[1],r[1],r[0]]}isReady(){return this.isInitialized&&tt()}}const Gt=new Zt;class $t{async correctPerspective(n,e,s){if(!tt())throw new Error("OpenCV not loaded");if(e.length!==4)throw new Error("Exactly 4 corners required");const t={...{outputWidth:0,outputHeight:0,preserveAspectRatio:!0,interpolation:"linear"},...s};let i=null,c=null,l=null;try{const p=We();i=ve(n);const w=t.outputWidth&&t.outputHeight?{width:t.outputWidth,height:t.outputHeight}:this.calculateOutputDimensions(e),b=this.ensureCornerOrder(e),_=p.matFromArray(4,1,p.CV_32FC2,[b[0].x,b[0].y,b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y]),h=p.matFromArray(4,1,p.CV_32FC2,[0,0,w.width,0,w.width,w.height,0,w.height]);l=p.getPerspectiveTransform(_,h),c=new p.Mat;const x=new p.Size(w.width,w.height),d=this.getInterpolationFlag(t.interpolation);p.warpPerspective(i,c,l,x,d,p.BORDER_CONSTANT,new p.Scalar(255,255,255,255));const f=ke(c),m=this.matrixToArray(l);return _.delete(),h.delete(),{correctedImage:f,transformMatrix:m,originalCorners:b,outputDimensions:w}}catch(p){return console.error("Perspective correction failed:",p),null}finally{we(i,c,l)}}calculateOutputDimensions(n){if(n.length!==4)throw new Error("Exactly 4 corners required");const e=this.ensureCornerOrder(n),s=this.distance(e[0],e[1]),r=this.distance(e[3],e[2]),t=this.distance(e[0],e[3]),i=this.distance(e[1],e[2]),c=Math.max(s,r),l=Math.max(t,i);return{width:Math.round(c),height:Math.round(l)}}distance(n,e){const s=e.x-n.x,r=e.y-n.y;return Math.sqrt(s*s+r*r)}ensureCornerOrder(n){if(n.length!==4)return n;const e={x:n.reduce((c,l)=>c+l.x,0)/4,y:n.reduce((c,l)=>c+l.y,0)/4},s=[...n].sort((c,l)=>{const p=Math.atan2(c.y-e.y,c.x-e.x),w=Math.atan2(l.y-e.y,l.x-e.x);return p-w}),r=s.map(c=>c.x+c.y),t=r.indexOf(Math.min(...r));return[s[t],s[(t+1)%4],s[(t+2)%4],s[(t+3)%4]]}getInterpolationFlag(n){const e=We();switch(n){case"nearest":return e.INTER_NEAREST;case"linear":return e.INTER_LINEAR;case"cubic":return e.INTER_CUBIC;case"lanczos":return e.INTER_LANCZOS4;default:return e.INTER_LINEAR}}matrixToArray(n){const e=[];for(let s=0;s<n.rows;s++){const r=[];for(let t=0;t<n.cols;t++)r.push(n.data64F[s*n.cols+t]);e.push(r)}return e}}const Ht=new $t,Yt=()=>{const g=J.useRef(null),n=J.useRef(null),[e,s]=J.useState(!1),[r,t]=J.useState(!1),[i,c]=J.useState({width:0,height:0}),{currentImage:l,detectedEdges:p,adjustedCorners:w,setCurrentView:b,resetScanSession:_,setDetectedEdges:h,setAdjustedCorners:x,setProcessedImage:d,addToast:f}=ge(S=>({currentImage:S.scanSession.currentImage,detectedEdges:S.scanSession.detectedEdges,adjustedCorners:S.scanSession.adjustedCorners,setCurrentView:S.setCurrentView,resetScanSession:S.resetScanSession,setDetectedEdges:S.setDetectedEdges,setAdjustedCorners:S.setAdjustedCorners,setProcessedImage:S.setProcessedImage,addToast:S.addToast}));J.useEffect(()=>{if(l&&g.current){const S=g.current,z=S.getContext("2d");if(!z)return;S.width=l.width,S.height=l.height,z.putImageData(l,0,0)}},[l]),J.useEffect(()=>{l&&!p&&!e&&m()},[l]),J.useEffect(()=>{const S=()=>{if(n.current){const z=n.current.getBoundingClientRect();c({width:z.width,height:z.height})}};return S(),window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)},[]);const m=async()=>{if(console.log("[CropView] detectEdges() called"),!!l){console.log("[CropView] Setting isDetecting to true"),s(!0);try{console.log("[CropView] Calling edgeDetectionService.detectDocument()");const S=await Gt.detectDocument(l);if(console.log("[CropView] detectDocument() returned:",S),S)h(S),x(S.contour),f({type:"success",message:"Document detected!"});else{const z=[{x:0,y:0},{x:l.width,y:0},{x:l.width,y:l.height},{x:0,y:l.height}];x(z),f({type:"warning",message:"Could not detect document. Using full image."})}}catch(S){console.error("[CropView] Edge detection failed:",S),f({type:"error",message:"Edge detection failed"})}finally{console.log("[CropView] Setting isDetecting to false"),s(!1)}}},y=S=>{x(S)},E=()=>{_(),b("camera")},j=async()=>{if(!(!l||!w)){t(!0);try{const S=await Ht.correctPerspective(l,w);if(S)d(S.correctedImage),b("enhance"),f({type:"success",message:"Image cropped successfully!"});else throw new Error("Perspective correction failed")}catch(S){console.error("Perspective correction failed:",S),f({type:"error",message:"Failed to crop image"})}finally{t(!1)}}};return l?e?u.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-900",children:[u.jsx(Ne,{size:"lg",className:"mb-4"}),u.jsx("p",{className:"text-white text-sm",children:"Detecting document edges..."})]}):u.jsxs("div",{className:"flex flex-col h-full bg-gray-900",children:[u.jsxs("div",{ref:n,className:"flex-1 overflow-hidden flex items-center justify-center p-4 relative",children:[u.jsx("canvas",{ref:g,className:"max-w-full max-h-full object-contain"}),w&&l&&i.width>0&&u.jsx(Vt,{corners:w,imageSize:{width:l.width,height:l.height},containerSize:i,onChange:y})]}),u.jsx("div",{className:"p-4 bg-white border-t border-gray-200",children:u.jsxs("div",{className:"flex gap-3",children:[u.jsx(le,{onClick:E,variant:"secondary",fullWidth:!0,disabled:r,children:"Retake"}),u.jsx(le,{onClick:m,variant:"secondary",fullWidth:!0,disabled:r,children:"Auto-Detect"}),u.jsx(le,{onClick:j,variant:"primary",fullWidth:!0,disabled:r,children:r?"Processing...":"Continue"})]})})]}):u.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-50 p-6",children:[u.jsx("p",{className:"text-gray-600",children:"No image captured"}),u.jsx(le,{onClick:()=>b("camera"),className:"mt-4",children:"Back to Camera"})]})};let Pe;const Kt=new Uint8Array(16);function qt(){if(!Pe&&(Pe=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Pe))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Pe(Kt)}const fe=[];for(let g=0;g<256;++g)fe.push((g+256).toString(16).slice(1));function Xt(g,n=0){return fe[g[n+0]]+fe[g[n+1]]+fe[g[n+2]]+fe[g[n+3]]+"-"+fe[g[n+4]]+fe[g[n+5]]+"-"+fe[g[n+6]]+fe[g[n+7]]+"-"+fe[g[n+8]]+fe[g[n+9]]+"-"+fe[g[n+10]]+fe[g[n+11]]+fe[g[n+12]]+fe[g[n+13]]+fe[g[n+14]]+fe[g[n+15]]}const Jt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ot={randomUUID:Jt};function ct(g,n,e){if(ot.randomUUID&&!g)return ot.randomUUID();g=g||{};const s=g.random||(g.rng||qt)();return s[6]=s[6]&15|64,s[8]=s[8]&63|128,Xt(s)}const Qt=({selectedFilter:g,onSelect:n,disabled:e=!1})=>{const s=J.useRef(null),r=J.useRef(null);return J.useEffect(()=>{r.current&&s.current&&r.current.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},[g]),u.jsx("div",{className:"w-full bg-white border-b border-gray-200",children:u.jsx("div",{ref:s,className:"flex gap-2 px-4 py-3 overflow-x-auto scrollbar-hide",style:{scrollSnapType:"x mandatory",WebkitOverflowScrolling:"touch"},children:Bt.map(t=>{const i=t.id===g;return u.jsxs("button",{ref:i?r:null,onClick:()=>!e&&n(t.id),disabled:e,className:`
                flex-shrink-0 flex flex-col items-center justify-center
                min-w-[80px] px-3 py-2 rounded-lg
                transition-all duration-200
                ${i?"bg-blue-500 text-white shadow-md scale-105":"bg-gray-100 text-gray-700 hover:bg-gray-200"}
                ${e?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                scroll-snap-align-center
              `,style:{scrollSnapAlign:"center"},children:[u.jsx("span",{className:"text-2xl mb-1",children:t.icon}),u.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:t.name})]},t.id)})})})},Le=({label:g,value:n,min:e,max:s,step:r,onChange:t,disabled:i=!1,unit:c=""})=>{const l=(n-e)/(s-e)*100;return u.jsxs("div",{className:"mb-4",children:[u.jsxs("div",{className:"flex justify-between items-center mb-2",children:[u.jsx("label",{className:"text-sm font-medium text-gray-700",children:g}),u.jsxs("span",{className:"text-sm text-gray-500",children:[n.toFixed(r<1?1:0),c]})]}),u.jsx("div",{className:"relative",children:u.jsx("input",{type:"range",min:e,max:s,step:r,value:n,onChange:p=>t(parseFloat(p.target.value)),disabled:i,className:`
            w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer
            ${i?"opacity-50 cursor-not-allowed":""}
          `,style:{background:`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${l}%, #e5e7eb ${l}%, #e5e7eb 100%)`}})})]})},er=({options:g,onChange:n,disabled:e=!1})=>{const s=(r,t)=>{n({...g,[r]:t})};return u.jsxs("div",{className:"bg-white p-4 rounded-lg",children:[u.jsx("h3",{className:"text-sm font-semibold text-gray-800 mb-4",children:"Manual Adjustments"}),u.jsx(Le,{label:"Brightness",value:g.brightness,min:-100,max:100,step:1,onChange:r=>s("brightness",r),disabled:e}),u.jsx(Le,{label:"Contrast",value:g.contrast,min:-100,max:100,step:1,onChange:r=>s("contrast",r),disabled:e}),u.jsx(Le,{label:"Saturation",value:g.saturation,min:-100,max:100,step:1,onChange:r=>s("saturation",r),disabled:e}),u.jsx(Le,{label:"Gamma",value:g.gamma,min:.1,max:3,step:.1,onChange:r=>s("gamma",r),disabled:e}),u.jsx("button",{onClick:()=>n({brightness:0,contrast:0,saturation:0,sharpness:0,gamma:1,shadows:0,highlights:0,temperature:0}),disabled:e,className:"w-full mt-2 px-4 py-2 text-sm text-blue-600 bg-blue-50 rounded-lg hover:bg-blue-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Reset Adjustments"})]})};class tr{constructor(){pe(this,"cv",null);pe(this,"isInitialized",!1)}async initialize(){if(!this.isInitialized)try{this.cv=window.cv instanceof Promise?await window.cv:window.cv,this.isInitialized=!0,console.log("ImageEnhancementService initialized")}catch(n){throw console.error("Failed to initialize ImageEnhancementService:",n),n}}async enhance(n,e){this.isInitialized||await this.initialize();let s=null,r=null;try{if(s=ve(n),r=s.clone(),e.brightness!==0||e.contrast!==0){const t=1+e.contrast/100,i=e.brightness/100*255;r.convertTo(r,-1,t,i)}return e.gamma!==1&&this.applyGamma(r,e.gamma),e.saturation!==0&&this.applySaturation(r,e.saturation),ke(r)}catch(t){return console.error("Enhancement failed:",t),null}finally{we(s,r)}}async applyFilter(n,e){switch(this.isInitialized||await this.initialize(),e){case"original":return n;case"grayscale":return this.applyGrayscale(n);case"document":return this.applyDocumentFilter(n);case"magic":return this.applyMagicFilter(n);case"whiteboard":return this.applyWhiteboardFilter(n);case"book":return this.applyBookFilter(n);case"receipt":return this.applyReceiptFilter(n);case"photo":return this.applyPhotoFilter(n);case"blueprint":return this.applyBlueprintFilter(n);default:return n}}applyGrayscale(n){let e=null,s=null,r=null;try{return e=ve(n),s=new this.cv.Mat,this.cv.cvtColor(e,s,this.cv.COLOR_RGBA2GRAY),r=new this.cv.Mat,this.cv.cvtColor(s,r,this.cv.COLOR_GRAY2RGBA),r.convertTo(r,-1,1.1,5),ke(r)}catch(t){return console.error("Grayscale filter failed:",t),null}finally{we(e,s,r)}}applyDocumentFilter(n){let e=null,s=null,r=null,t=null,i=null;try{return e=ve(n),s=new this.cv.Mat,this.cv.cvtColor(e,s,this.cv.COLOR_RGBA2GRAY),r=new this.cv.Mat,this.cv.fastNlMeansDenoising(s,r,10,7,21),t=new this.cv.Mat,this.cv.adaptiveThreshold(r,t,255,this.cv.ADAPTIVE_THRESH_GAUSSIAN_C,this.cv.THRESH_BINARY,11,2),i=new this.cv.Mat,this.cv.cvtColor(t,i,this.cv.COLOR_GRAY2RGBA),ke(i)}catch(c){return console.error("Document filter failed:",c),null}finally{we(e,s,r,t,i)}}applyMagicFilter(n){let e=null,s=null,r=null,t=null,i=null;try{e=ve(n),s=new this.cv.Mat,this.cv.cvtColor(e,s,this.cv.COLOR_RGBA2RGB),this.cv.cvtColor(s,s,this.cv.COLOR_RGB2Lab),r=new this.cv.MatVector,this.cv.split(s,r),t=r.get(0);const c=new this.cv.CLAHE(2,new this.cv.Size(8,8));return c.apply(t,t),this.cv.merge(r,s),i=new this.cv.Mat,this.cv.cvtColor(s,i,this.cv.COLOR_Lab2RGB),this.cv.cvtColor(i,i,this.cv.COLOR_RGB2RGBA),i.convertTo(i,-1,1.1,0),r.delete(),c.delete(),ke(i)}catch(c){return console.error("Magic filter failed:",c),null}finally{we(e,s,t,i)}}applyWhiteboardFilter(n){let e=null,s=null,r=null,t=null,i=null;try{return e=ve(n),s=new this.cv.Mat,this.cv.cvtColor(e,s,this.cv.COLOR_RGBA2GRAY),r=new this.cv.Mat,this.cv.GaussianBlur(s,r,new this.cv.Size(5,5),0),t=new this.cv.Mat,this.cv.adaptiveThreshold(r,t,255,this.cv.ADAPTIVE_THRESH_GAUSSIAN_C,this.cv.THRESH_BINARY,15,10),i=new this.cv.Mat,this.cv.cvtColor(t,i,this.cv.COLOR_GRAY2RGBA),i.convertTo(i,-1,1,10),ke(i)}catch(c){return console.error("Whiteboard filter failed:",c),null}finally{we(e,s,r,t,i)}}applyBookFilter(n){let e=null,s=null,r=null,t=null,i=null;try{e=ve(n),s=new this.cv.Mat,this.cv.cvtColor(e,s,this.cv.COLOR_RGBA2GRAY),r=new this.cv.Mat,this.cv.fastNlMeansDenoising(s,r,10,7,21),t=new this.cv.Mat;const c=this.cv.matFromArray(3,3,this.cv.CV_32F,[0,-1,0,-1,5,-1,0,-1,0]);return this.cv.filter2D(r,t,this.cv.CV_8U,c),c.delete(),i=new this.cv.Mat,this.cv.cvtColor(t,i,this.cv.COLOR_GRAY2RGBA),i.convertTo(i,-1,1.2,0),ke(i)}catch(c){return console.error("Book filter failed:",c),null}finally{we(e,s,r,t,i)}}applyReceiptFilter(n){let e=null,s=null,r=null,t=null;try{return e=ve(n),s=new this.cv.Mat,this.cv.cvtColor(e,s,this.cv.COLOR_RGBA2GRAY),r=new this.cv.Mat,this.cv.threshold(s,r,0,255,this.cv.THRESH_BINARY+this.cv.THRESH_OTSU),t=new this.cv.Mat,this.cv.cvtColor(r,t,this.cv.COLOR_GRAY2RGBA),ke(t)}catch(i){return console.error("Receipt filter failed:",i),null}finally{we(e,s,r,t)}}applyPhotoFilter(n){let e=null,s=null;try{return e=ve(n),s=e.clone(),s.convertTo(s,-1,1.1,5),ke(s)}catch(r){return console.error("Photo filter failed:",r),null}finally{we(e,s)}}applyBlueprintFilter(n){let e=null,s=null,r=null,t=null;try{return e=ve(n),s=new this.cv.Mat,this.cv.cvtColor(e,s,this.cv.COLOR_RGBA2GRAY),r=new this.cv.Mat,this.cv.bitwise_not(s,r),t=new this.cv.Mat,this.cv.cvtColor(r,t,this.cv.COLOR_GRAY2RGBA),ke(t)}catch(i){return console.error("Blueprint filter failed:",i),null}finally{we(e,s,r,t)}}applyGamma(n,e){const s=new Uint8Array(256);for(let t=0;t<256;t++)s[t]=Math.pow(t/255,e)*255;const r=n.data;for(let t=0;t<r.length;t+=4)r[t]=s[r[t]],r[t+1]=s[r[t+1]],r[t+2]=s[r[t+2]]}applySaturation(n,e){const s=new this.cv.Mat;this.cv.cvtColor(n,s,this.cv.COLOR_RGBA2RGB),this.cv.cvtColor(s,s,this.cv.COLOR_RGB2HSV);const r=new this.cv.MatVector;this.cv.split(s,r);const t=r.get(1),i=1+e/100;t.convertTo(t,-1,i,0),this.cv.merge(r,s),this.cv.cvtColor(s,n,this.cv.COLOR_HSV2RGB),this.cv.cvtColor(n,n,this.cv.COLOR_RGB2RGBA),s.delete(),r.delete()}isReady(){return this.isInitialized&&tt()}}const Ge=new tr,rr=(g,n)=>n.some(e=>g instanceof e);let lt,dt;function nr(){return lt||(lt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function sr(){return dt||(dt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const pt=new WeakMap,Qe=new WeakMap,gt=new WeakMap,$e=new WeakMap,rt=new WeakMap;function ir(g){const n=new Promise((e,s)=>{const r=()=>{g.removeEventListener("success",t),g.removeEventListener("error",i)},t=()=>{e(De(g.result)),r()},i=()=>{s(g.error),r()};g.addEventListener("success",t),g.addEventListener("error",i)});return n.then(e=>{e instanceof IDBCursor&&pt.set(e,g)}).catch(()=>{}),rt.set(n,g),n}function ar(g){if(Qe.has(g))return;const n=new Promise((e,s)=>{const r=()=>{g.removeEventListener("complete",t),g.removeEventListener("error",i),g.removeEventListener("abort",i)},t=()=>{e(),r()},i=()=>{s(g.error||new DOMException("AbortError","AbortError")),r()};g.addEventListener("complete",t),g.addEventListener("error",i),g.addEventListener("abort",i)});Qe.set(g,n)}let et={get(g,n,e){if(g instanceof IDBTransaction){if(n==="done")return Qe.get(g);if(n==="objectStoreNames")return g.objectStoreNames||gt.get(g);if(n==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return De(g[n])},set(g,n,e){return g[n]=e,!0},has(g,n){return g instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in g}};function or(g){et=g(et)}function cr(g){return g===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(n,...e){const s=g.call(He(this),n,...e);return gt.set(s,n.sort?n.sort():[n]),De(s)}:sr().includes(g)?function(...n){return g.apply(He(this),n),De(pt.get(this))}:function(...n){return De(g.apply(He(this),n))}}function lr(g){return typeof g=="function"?cr(g):(g instanceof IDBTransaction&&ar(g),rr(g,nr())?new Proxy(g,et):g)}function De(g){if(g instanceof IDBRequest)return ir(g);if($e.has(g))return $e.get(g);const n=lr(g);return n!==g&&($e.set(g,n),rt.set(n,g)),n}const He=g=>rt.get(g);function dr(g,n,{blocked:e,upgrade:s,blocking:r,terminated:t}={}){const i=indexedDB.open(g,n),c=De(i);return s&&i.addEventListener("upgradeneeded",l=>{s(De(i.result),l.oldVersion,l.newVersion,De(i.transaction),l)}),e&&i.addEventListener("blocked",l=>e(l.oldVersion,l.newVersion,l)),c.then(l=>{t&&l.addEventListener("close",()=>t()),r&&l.addEventListener("versionchange",p=>r(p.oldVersion,p.newVersion,p))}).catch(()=>{}),c}const ur=["get","getKey","getAll","getAllKeys","count"],hr=["put","add","delete","clear"],Ye=new Map;function ut(g,n){if(!(g instanceof IDBDatabase&&!(n in g)&&typeof n=="string"))return;if(Ye.get(n))return Ye.get(n);const e=n.replace(/FromIndex$/,""),s=n!==e,r=hr.includes(e);if(!(e in(s?IDBIndex:IDBObjectStore).prototype)||!(r||ur.includes(e)))return;const t=async function(i,...c){const l=this.transaction(i,r?"readwrite":"readonly");let p=l.store;return s&&(p=p.index(c.shift())),(await Promise.all([p[e](...c),r&&l.done]))[0]};return Ye.set(n,t),t}or(g=>({...g,get:(n,e,s)=>ut(n,e)||g.get(n,e,s),has:(n,e)=>!!ut(n,e)||g.has(n,e)}));const fr="doc-scanner-db",mr=1,me="documents",be="pages";class pr{constructor(){pe(this,"db",null)}async initialize(){this.db||(this.db=await dr(fr,mr,{upgrade(n){if(!n.objectStoreNames.contains(me)){const e=n.createObjectStore(me,{keyPath:"id"});e.createIndex("by-created","createdAt"),e.createIndex("by-updated","updatedAt"),e.createIndex("by-name","name")}n.objectStoreNames.contains(be)||n.createObjectStore(be,{keyPath:"id"}).createIndex("by-document","documentId")}}))}async createDocument(n){if(!this.db)throw new Error("Database not initialized");const e=this.db.transaction([me,be],"readwrite");await e.objectStore(me).add(n);const s=e.objectStore(be);for(const r of n.pages)await s.add({...r,documentId:n.id});return await e.done,n}async getDocument(n){if(!this.db)throw new Error("Database not initialized");const e=await this.db.get(me,n);if(!e)return null;const s=await this.db.getAllFromIndex(be,"by-document",n);return e.pages=s.sort((r,t)=>r.pageNumber-t.pageNumber),e}async updateDocument(n){if(!this.db)throw new Error("Database not initialized");n.updatedAt=new Date;const e=this.db.transaction([me,be],"readwrite");await e.objectStore(me).put(n);const s=e.objectStore(be),r=await s.index("by-document").getAllKeys(n.id);for(const t of r)await s.delete(t);for(const t of n.pages)await s.add({...t,documentId:n.id});return await e.done,n}async deleteDocument(n){if(!this.db)throw new Error("Database not initialized");const e=this.db.transaction([me,be],"readwrite");await e.objectStore(me).delete(n);const s=e.objectStore(be),r=await s.index("by-document").getAllKeys(n);for(const t of r)await s.delete(t);await e.done}async listDocuments(n){if(!this.db)throw new Error("Database not initialized");const e=n?.sortBy||"updatedAt",s=n?.sortOrder||"desc",r=n?.limit,t=n?.offset||0;let i;e==="name"?i=await this.db.getAllFromIndex(me,"by-name"):e==="createdAt"?i=await this.db.getAllFromIndex(me,"by-created"):i=await this.db.getAllFromIndex(me,"by-updated"),s==="desc"&&i.reverse();for(const c of i){const l=await this.db.getAllFromIndex(be,"by-document",c.id);c.pages=l.sort((p,w)=>p.pageNumber-w.pageNumber)}return r!==void 0?i=i.slice(t,t+r):t>0&&(i=i.slice(t)),i}async searchDocuments(n){if(!this.db)throw new Error("Database not initialized");const e=await this.listDocuments(),s=[],r=n.toLowerCase();for(const t of e)for(const i of t.pages)if(i.ocrResult){const c=[],l=i.ocrResult.text.toLowerCase();let p=l.indexOf(r);for(;p!==-1;)c.push({text:i.ocrResult.text.substr(p,n.length),position:p}),p=l.indexOf(r,p+1);c.length>0&&s.push({documentId:t.id,pageId:i.id,matches:c})}return s}async getStorageUsage(){if(!navigator.storage||!navigator.storage.estimate)return{used:0,quota:0,percentage:0};const n=await navigator.storage.estimate(),e=n.usage||0,s=n.quota||0,r=s>0?e/s*100:0;return{used:e,quota:s,percentage:r}}async clearAll(){if(!this.db)throw new Error("Database not initialized");const n=this.db.transaction([me,be],"readwrite");await n.objectStore(me).clear(),await n.objectStore(be).clear(),await n.done}async addPage(n,e){if(!this.db)throw new Error("Database not initialized");const s=await this.getDocument(n);if(!s)throw new Error("Document not found");s.pages.push(e),s.metadata.totalPages=s.pages.length,await this.updateDocument(s)}async removePage(n,e){if(!this.db)throw new Error("Database not initialized");const s=await this.getDocument(n);if(!s)throw new Error("Document not found");s.pages=s.pages.filter(r=>r.id!==e),s.pages.forEach((r,t)=>{r.pageNumber=t+1}),s.metadata.totalPages=s.pages.length,await this.updateDocument(s)}async reorderPages(n,e){if(!this.db)throw new Error("Database not initialized");const s=await this.getDocument(n);if(!s)throw new Error("Document not found");const r=new Map(s.pages.map(t=>[t.id,t]));s.pages=e.map(t=>r.get(t)).filter(Boolean),s.pages.forEach((t,i)=>{t.pageNumber=i+1}),await this.updateDocument(s)}async exportDocument(n){if(!this.db)throw new Error("Database not initialized");const e=await this.getDocument(n);if(!e)throw new Error("Document not found");const s=JSON.stringify(e,null,2);return new Blob([s],{type:"application/json"})}async importDocument(n){if(!this.db)throw new Error("Database not initialized");const e=await n.text(),s=JSON.parse(e);return s.createdAt=new Date(s.createdAt),s.updatedAt=new Date(s.updatedAt),await this.createDocument(s),s}}let Me=null;async function Se(){return Me||(Me=new pr,await Me.initialize()),Me}const gr=()=>{const g=J.useRef(null),[n,e]=J.useState(!1),[s,r]=J.useState(null),[t,i]=J.useState(!1),{currentImage:c,processedImage:l,adjustedCorners:p,selectedFilter:w,enhancementOptions:b,setCurrentView:_,setSelectedFilter:h,setEnhancementOptions:x,addDocument:d,resetScanSession:f,addToast:m}=ge(N=>({currentImage:N.scanSession.currentImage,processedImage:N.scanSession.processedImage,adjustedCorners:N.scanSession.adjustedCorners,selectedFilter:N.scanSession.selectedFilter,enhancementOptions:N.scanSession.enhancementOptions,setCurrentView:N.setCurrentView,setSelectedFilter:N.setSelectedFilter,setEnhancementOptions:N.setEnhancementOptions,addDocument:N.addDocument,resetScanSession:N.resetScanSession,addToast:N.addToast}));J.useEffect(()=>{l&&!s&&(r(l),y(l))},[l]),J.useEffect(()=>{l&&E(w)},[w]),J.useEffect(()=>{s&&S(b)&&j()},[b]);const y=N=>{if(!g.current)return;const W=g.current,G=W.getContext("2d");G&&(W.width=N.width,W.height=N.height,G.putImageData(N,0,0))},E=async N=>{if(l){e(!0);try{const W=await Ge.applyFilter(l,N);W?(r(W),y(W),x(Ue)):m({type:"error",message:"Failed to apply filter"})}catch(W){console.error("Filter application failed:",W),m({type:"error",message:"Filter application failed"})}finally{e(!1)}}},j=async()=>{if(s){e(!0);try{let N=l;if(w!=="original"&&(N=await Ge.applyFilter(l,w)),!N)throw new Error("Failed to get base image");const W=await Ge.enhance(N,b);W?(r(W),y(W)):m({type:"error",message:"Failed to apply adjustments"})}catch(N){console.error("Manual adjustment failed:",N)}finally{e(!1)}}},S=N=>N.brightness!==0||N.contrast!==0||N.saturation!==0||N.gamma!==1,z=N=>{h(N)},R=N=>{x(N)},L=async()=>{if(!s||!c){m({type:"error",message:"No image to save"});return}e(!0);try{const N=document.createElement("canvas"),W=N.getContext("2d");if(!W)throw new Error("Failed to get canvas context");N.width=s.width,N.height=s.height,W.putImageData(s,0,0);const G=await new Promise((H,ae)=>{N.toBlob(ce=>{ce?H(ce):ae(new Error("Failed to convert canvas to blob"))},"image/png")}),k=document.createElement("canvas"),D=k.getContext("2d");if(!D)throw new Error("Failed to get canvas context");k.width=c.width,k.height=c.height,D.putImageData(c,0,0);const o=await new Promise((H,ae)=>{k.toBlob(ce=>{ce?H(ce):ae(new Error("Failed to convert canvas to blob"))},"image/png")}),T=document.createElement("canvas"),U=T.getContext("2d");if(!U)throw new Error("Failed to get canvas context");const P=300,Q=Math.min(P/s.width,P/s.height);T.width=s.width*Q,T.height=s.height*Q,U.drawImage(N,0,0,T.width,T.height);const Z=await new Promise((H,ae)=>{T.toBlob(ce=>{ce?H(ce):ae(new Error("Failed to convert canvas to blob"))},"image/jpeg",.8)}),te={id:ct(),pageNumber:1,originalImage:o,processedImage:G,thumbnailImage:Z,corners:p||[],enhancementSettings:b,filterApplied:w,dimensions:{width:s.width,height:s.height}},B=new Date,A=`Document ${B.toLocaleDateString()} ${B.toLocaleTimeString()}`,ee={id:ct(),name:A,createdAt:B,updatedAt:B,pages:[te],tags:[],metadata:{totalPages:1,hasOCR:!1,fileSize:G.size,source:"camera"}};await(await Se()).createDocument(ee),d(ee),f(),m({type:"success",message:"Document saved successfully"}),_("documents")}catch(N){console.error("Failed to save document:",N),m({type:"error",message:"Failed to save document"})}finally{e(!1)}};return l?u.jsxs("div",{className:"flex flex-col h-full bg-gray-900",children:[u.jsxs("div",{className:"flex-1 overflow-hidden flex items-center justify-center p-4 relative",children:[u.jsx("canvas",{ref:g,className:"max-w-full max-h-full object-contain shadow-2xl"}),n&&u.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:u.jsxs("div",{className:"bg-white rounded-lg p-4 flex items-center gap-3",children:[u.jsx(Ne,{size:"sm"}),u.jsx("span",{className:"text-sm text-gray-700",children:"Processing..."})]})})]}),u.jsx(Qt,{selectedFilter:w,onSelect:z,disabled:n}),u.jsx("div",{className:"bg-white border-t border-gray-200 px-4 py-2",children:u.jsxs("button",{onClick:()=>i(!t),className:"w-full flex items-center justify-between text-sm font-medium text-gray-700 hover:text-gray-900",children:[u.jsx("span",{children:"Manual Adjustments"}),u.jsx("span",{className:"text-lg",children:t?"â–¼":"â–¶"})]})}),t&&u.jsx("div",{className:"bg-gray-50 border-t border-gray-200 max-h-80 overflow-y-auto",children:u.jsx(er,{options:b,onChange:R,disabled:n})}),u.jsx("div",{className:"p-4 bg-white border-t border-gray-200",children:u.jsxs("div",{className:"flex gap-3",children:[u.jsx(le,{onClick:()=>_("crop"),variant:"secondary",fullWidth:!0,disabled:n,children:"Back"}),u.jsx(le,{onClick:L,variant:"primary",fullWidth:!0,disabled:n,children:"Save Document"})]})})]}):u.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-50 p-6",children:[u.jsx("p",{className:"text-gray-600",children:"No image to enhance"}),u.jsx(le,{onClick:()=>_("camera"),className:"mt-4",children:"Back to Camera"})]})};var xt={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(g,n){(function(e){g.exports=e()})(function(){return function e(s,r,t){function i(p,w){if(!r[p]){if(!s[p]){var b=typeof Fe=="function"&&Fe;if(!w&&b)return b(p,!0);if(c)return c(p,!0);var _=new Error("Cannot find module '"+p+"'");throw _.code="MODULE_NOT_FOUND",_}var h=r[p]={exports:{}};s[p][0].call(h.exports,function(x){var d=s[p][1][x];return i(d||x)},h,h.exports,e,s,r,t)}return r[p].exports}for(var c=typeof Fe=="function"&&Fe,l=0;l<t.length;l++)i(t[l]);return i}({1:[function(e,s,r){var t=e("./utils"),i=e("./support"),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(l){for(var p,w,b,_,h,x,d,f=[],m=0,y=l.length,E=y,j=t.getTypeOf(l)!=="string";m<l.length;)E=y-m,b=j?(p=l[m++],w=m<y?l[m++]:0,m<y?l[m++]:0):(p=l.charCodeAt(m++),w=m<y?l.charCodeAt(m++):0,m<y?l.charCodeAt(m++):0),_=p>>2,h=(3&p)<<4|w>>4,x=1<E?(15&w)<<2|b>>6:64,d=2<E?63&b:64,f.push(c.charAt(_)+c.charAt(h)+c.charAt(x)+c.charAt(d));return f.join("")},r.decode=function(l){var p,w,b,_,h,x,d=0,f=0,m="data:";if(l.substr(0,m.length)===m)throw new Error("Invalid base64 input, it looks like a data url.");var y,E=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===c.charAt(64)&&E--,l.charAt(l.length-2)===c.charAt(64)&&E--,E%1!=0)throw new Error("Invalid base64 input, bad content length.");for(y=i.uint8array?new Uint8Array(0|E):new Array(0|E);d<l.length;)p=c.indexOf(l.charAt(d++))<<2|(_=c.indexOf(l.charAt(d++)))>>4,w=(15&_)<<4|(h=c.indexOf(l.charAt(d++)))>>2,b=(3&h)<<6|(x=c.indexOf(l.charAt(d++))),y[f++]=p,h!==64&&(y[f++]=w),x!==64&&(y[f++]=b);return y}},{"./support":30,"./utils":32}],2:[function(e,s,r){var t=e("./external"),i=e("./stream/DataWorker"),c=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function p(w,b,_,h,x){this.compressedSize=w,this.uncompressedSize=b,this.crc32=_,this.compression=h,this.compressedContent=x}p.prototype={getContentWorker:function(){var w=new i(t.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),b=this;return w.on("end",function(){if(this.streamInfo.data_length!==b.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),w},getCompressedWorker:function(){return new i(t.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},p.createWorkerFrom=function(w,b,_){return w.pipe(new c).pipe(new l("uncompressedSize")).pipe(b.compressWorker(_)).pipe(new l("compressedSize")).withStreamInfo("compression",b)},s.exports=p},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,s,r){var t=e("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(){return new t("STORE compression")},uncompressWorker:function(){return new t("STORE decompression")}},r.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,s,r){var t=e("./utils"),i=function(){for(var c,l=[],p=0;p<256;p++){c=p;for(var w=0;w<8;w++)c=1&c?3988292384^c>>>1:c>>>1;l[p]=c}return l}();s.exports=function(c,l){return c!==void 0&&c.length?t.getTypeOf(c)!=="string"?function(p,w,b,_){var h=i,x=_+b;p^=-1;for(var d=_;d<x;d++)p=p>>>8^h[255&(p^w[d])];return-1^p}(0|l,c,c.length,0):function(p,w,b,_){var h=i,x=_+b;p^=-1;for(var d=_;d<x;d++)p=p>>>8^h[255&(p^w.charCodeAt(d))];return-1^p}(0|l,c,c.length,0):0}},{"./utils":32}],5:[function(e,s,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(e,s,r){var t=null;t=typeof Promise<"u"?Promise:e("lie"),s.exports={Promise:t}},{lie:37}],7:[function(e,s,r){var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",i=e("pako"),c=e("./utils"),l=e("./stream/GenericWorker"),p=t?"uint8array":"array";function w(b,_){l.call(this,"FlateWorker/"+b),this._pako=null,this._pakoAction=b,this._pakoOptions=_,this.meta={}}r.magic="\b\0",c.inherits(w,l),w.prototype.processChunk=function(b){this.meta=b.meta,this._pako===null&&this._createPako(),this._pako.push(c.transformTo(p,b.data),!1)},w.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},w.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},w.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var b=this;this._pako.onData=function(_){b.push({data:_,meta:b.meta})}},r.compressWorker=function(b){return new w("Deflate",b)},r.uncompressWorker=function(){return new w("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,s,r){function t(h,x){var d,f="";for(d=0;d<x;d++)f+=String.fromCharCode(255&h),h>>>=8;return f}function i(h,x,d,f,m,y){var E,j,S=h.file,z=h.compression,R=y!==p.utf8encode,L=c.transformTo("string",y(S.name)),N=c.transformTo("string",p.utf8encode(S.name)),W=S.comment,G=c.transformTo("string",y(W)),k=c.transformTo("string",p.utf8encode(W)),D=N.length!==S.name.length,o=k.length!==W.length,T="",U="",P="",Q=S.dir,Z=S.date,te={crc32:0,compressedSize:0,uncompressedSize:0};x&&!d||(te.crc32=h.crc32,te.compressedSize=h.compressedSize,te.uncompressedSize=h.uncompressedSize);var B=0;x&&(B|=8),R||!D&&!o||(B|=2048);var A=0,ee=0;Q&&(A|=16),m==="UNIX"?(ee=798,A|=function(H,ae){var ce=H;return H||(ce=ae?16893:33204),(65535&ce)<<16}(S.unixPermissions,Q)):(ee=20,A|=function(H){return 63&(H||0)}(S.dosPermissions)),E=Z.getUTCHours(),E<<=6,E|=Z.getUTCMinutes(),E<<=5,E|=Z.getUTCSeconds()/2,j=Z.getUTCFullYear()-1980,j<<=4,j|=Z.getUTCMonth()+1,j<<=5,j|=Z.getUTCDate(),D&&(U=t(1,1)+t(w(L),4)+N,T+="up"+t(U.length,2)+U),o&&(P=t(1,1)+t(w(G),4)+k,T+="uc"+t(P.length,2)+P);var q="";return q+=`
\0`,q+=t(B,2),q+=z.magic,q+=t(E,2),q+=t(j,2),q+=t(te.crc32,4),q+=t(te.compressedSize,4),q+=t(te.uncompressedSize,4),q+=t(L.length,2),q+=t(T.length,2),{fileRecord:b.LOCAL_FILE_HEADER+q+L+T,dirRecord:b.CENTRAL_FILE_HEADER+t(ee,2)+q+t(G.length,2)+"\0\0\0\0"+t(A,4)+t(f,4)+L+T+G}}var c=e("../utils"),l=e("../stream/GenericWorker"),p=e("../utf8"),w=e("../crc32"),b=e("../signature");function _(h,x,d,f){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=x,this.zipPlatform=d,this.encodeFileName=f,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}c.inherits(_,l),_.prototype.push=function(h){var x=h.meta.percent||0,d=this.entriesCount,f=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,l.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:d?(x+100*(d-f-1))/d:100}}))},_.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var x=this.streamFiles&&!h.file.dir;if(x){var d=i(h,x,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:d.fileRecord,meta:{percent:0}})}else this.accumulate=!0},_.prototype.closedSource=function(h){this.accumulate=!1;var x=this.streamFiles&&!h.file.dir,d=i(h,x,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(d.dirRecord),x)this.push({data:function(f){return b.DATA_DESCRIPTOR+t(f.crc32,4)+t(f.compressedSize,4)+t(f.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:d.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},_.prototype.flush=function(){for(var h=this.bytesWritten,x=0;x<this.dirRecords.length;x++)this.push({data:this.dirRecords[x],meta:{percent:100}});var d=this.bytesWritten-h,f=function(m,y,E,j,S){var z=c.transformTo("string",S(j));return b.CENTRAL_DIRECTORY_END+"\0\0\0\0"+t(m,2)+t(m,2)+t(y,4)+t(E,4)+t(z.length,2)+z}(this.dirRecords.length,d,h,this.zipComment,this.encodeFileName);this.push({data:f,meta:{percent:100}})},_.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},_.prototype.registerPrevious=function(h){this._sources.push(h);var x=this;return h.on("data",function(d){x.processChunk(d)}),h.on("end",function(){x.closedSource(x.previous.streamInfo),x._sources.length?x.prepareNextSource():x.end()}),h.on("error",function(d){x.error(d)}),this},_.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},_.prototype.error=function(h){var x=this._sources;if(!l.prototype.error.call(this,h))return!1;for(var d=0;d<x.length;d++)try{x[d].error(h)}catch{}return!0},_.prototype.lock=function(){l.prototype.lock.call(this);for(var h=this._sources,x=0;x<h.length;x++)h[x].lock()},s.exports=_},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,s,r){var t=e("../compressions"),i=e("./ZipFileWorker");r.generateWorker=function(c,l,p){var w=new i(l.streamFiles,p,l.platform,l.encodeFileName),b=0;try{c.forEach(function(_,h){b++;var x=function(y,E){var j=y||E,S=t[j];if(!S)throw new Error(j+" is not a valid compression method !");return S}(h.options.compression,l.compression),d=h.options.compressionOptions||l.compressionOptions||{},f=h.dir,m=h.date;h._compressWorker(x,d).withStreamInfo("file",{name:_,dir:f,date:m,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(w)}),w.entriesCount=b}catch(_){w.error(_)}return w}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,s,r){function t(){if(!(this instanceof t))return new t;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var i=new t;for(var c in this)typeof this[c]!="function"&&(i[c]=this[c]);return i}}(t.prototype=e("./object")).loadAsync=e("./load"),t.support=e("./support"),t.defaults=e("./defaults"),t.version="3.10.1",t.loadAsync=function(i,c){return new t().loadAsync(i,c)},t.external=e("./external"),s.exports=t},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,s,r){var t=e("./utils"),i=e("./external"),c=e("./utf8"),l=e("./zipEntries"),p=e("./stream/Crc32Probe"),w=e("./nodejsUtils");function b(_){return new i.Promise(function(h,x){var d=_.decompressed.getContentWorker().pipe(new p);d.on("error",function(f){x(f)}).on("end",function(){d.streamInfo.crc32!==_.decompressed.crc32?x(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}s.exports=function(_,h){var x=this;return h=t.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:c.utf8decode}),w.isNode&&w.isStream(_)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):t.prepareContent("the loaded zip file",_,!0,h.optimizedBinaryString,h.base64).then(function(d){var f=new l(h);return f.load(d),f}).then(function(d){var f=[i.Promise.resolve(d)],m=d.files;if(h.checkCRC32)for(var y=0;y<m.length;y++)f.push(b(m[y]));return i.Promise.all(f)}).then(function(d){for(var f=d.shift(),m=f.files,y=0;y<m.length;y++){var E=m[y],j=E.fileNameStr,S=t.resolve(E.fileNameStr);x.file(S,E.decompressed,{binary:!0,optimizedBinaryString:!0,date:E.date,dir:E.dir,comment:E.fileCommentStr.length?E.fileCommentStr:null,unixPermissions:E.unixPermissions,dosPermissions:E.dosPermissions,createFolders:h.createFolders}),E.dir||(x.file(S).unsafeOriginalName=j)}return f.zipComment.length&&(x.comment=f.zipComment),x})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,s,r){var t=e("../utils"),i=e("../stream/GenericWorker");function c(l,p){i.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(p)}t.inherits(c,i),c.prototype._bindStream=function(l){var p=this;(this._stream=l).pause(),l.on("data",function(w){p.push({data:w,meta:{percent:0}})}).on("error",function(w){p.isPaused?this.generatedError=w:p.error(w)}).on("end",function(){p.isPaused?p._upstreamEnded=!0:p.end()})},c.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},c.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=c},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,s,r){var t=e("readable-stream").Readable;function i(c,l,p){t.call(this,l),this._helper=c;var w=this;c.on("data",function(b,_){w.push(b)||w._helper.pause(),p&&p(_)}).on("error",function(b){w.emit("error",b)}).on("end",function(){w.push(null)})}e("../utils").inherits(i,t),i.prototype._read=function(){this._helper.resume()},s.exports=i},{"../utils":32,"readable-stream":16}],14:[function(e,s,r){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(t,i){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(t,i);if(typeof t=="number")throw new Error('The "data" argument must not be a number');return new Buffer(t,i)},allocBuffer:function(t){if(Buffer.alloc)return Buffer.alloc(t);var i=new Buffer(t);return i.fill(0),i},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&typeof t.on=="function"&&typeof t.pause=="function"&&typeof t.resume=="function"}}},{}],15:[function(e,s,r){function t(S,z,R){var L,N=c.getTypeOf(z),W=c.extend(R||{},w);W.date=W.date||new Date,W.compression!==null&&(W.compression=W.compression.toUpperCase()),typeof W.unixPermissions=="string"&&(W.unixPermissions=parseInt(W.unixPermissions,8)),W.unixPermissions&&16384&W.unixPermissions&&(W.dir=!0),W.dosPermissions&&16&W.dosPermissions&&(W.dir=!0),W.dir&&(S=m(S)),W.createFolders&&(L=f(S))&&y.call(this,L,!0);var G=N==="string"&&W.binary===!1&&W.base64===!1;R&&R.binary!==void 0||(W.binary=!G),(z instanceof b&&z.uncompressedSize===0||W.dir||!z||z.length===0)&&(W.base64=!1,W.binary=!0,z="",W.compression="STORE",N="string");var k=null;k=z instanceof b||z instanceof l?z:x.isNode&&x.isStream(z)?new d(S,z):c.prepareContent(S,z,W.binary,W.optimizedBinaryString,W.base64);var D=new _(S,k,W);this.files[S]=D}var i=e("./utf8"),c=e("./utils"),l=e("./stream/GenericWorker"),p=e("./stream/StreamHelper"),w=e("./defaults"),b=e("./compressedObject"),_=e("./zipObject"),h=e("./generate"),x=e("./nodejsUtils"),d=e("./nodejs/NodejsStreamInputAdapter"),f=function(S){S.slice(-1)==="/"&&(S=S.substring(0,S.length-1));var z=S.lastIndexOf("/");return 0<z?S.substring(0,z):""},m=function(S){return S.slice(-1)!=="/"&&(S+="/"),S},y=function(S,z){return z=z!==void 0?z:w.createFolders,S=m(S),this.files[S]||t.call(this,S,null,{dir:!0,createFolders:z}),this.files[S]};function E(S){return Object.prototype.toString.call(S)==="[object RegExp]"}var j={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(S){var z,R,L;for(z in this.files)L=this.files[z],(R=z.slice(this.root.length,z.length))&&z.slice(0,this.root.length)===this.root&&S(R,L)},filter:function(S){var z=[];return this.forEach(function(R,L){S(R,L)&&z.push(L)}),z},file:function(S,z,R){if(arguments.length!==1)return S=this.root+S,t.call(this,S,z,R),this;if(E(S)){var L=S;return this.filter(function(W,G){return!G.dir&&L.test(W)})}var N=this.files[this.root+S];return N&&!N.dir?N:null},folder:function(S){if(!S)return this;if(E(S))return this.filter(function(N,W){return W.dir&&S.test(N)});var z=this.root+S,R=y.call(this,z),L=this.clone();return L.root=R.name,L},remove:function(S){S=this.root+S;var z=this.files[S];if(z||(S.slice(-1)!=="/"&&(S+="/"),z=this.files[S]),z&&!z.dir)delete this.files[S];else for(var R=this.filter(function(N,W){return W.name.slice(0,S.length)===S}),L=0;L<R.length;L++)delete this.files[R[L].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(S){var z,R={};try{if((R=c.extend(S||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=R.type.toLowerCase(),R.compression=R.compression.toUpperCase(),R.type==="binarystring"&&(R.type="string"),!R.type)throw new Error("No output type specified.");c.checkSupport(R.type),R.platform!=="darwin"&&R.platform!=="freebsd"&&R.platform!=="linux"&&R.platform!=="sunos"||(R.platform="UNIX"),R.platform==="win32"&&(R.platform="DOS");var L=R.comment||this.comment||"";z=h.generateWorker(this,R,L)}catch(N){(z=new l("error")).error(N)}return new p(z,R.type||"string",R.mimeType)},generateAsync:function(S,z){return this.generateInternalStream(S).accumulate(z)},generateNodeStream:function(S,z){return(S=S||{}).type||(S.type="nodebuffer"),this.generateInternalStream(S).toNodejsStream(z)}};s.exports=j},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,s,r){s.exports=e("stream")},{stream:void 0}],17:[function(e,s,r){var t=e("./DataReader");function i(c){t.call(this,c);for(var l=0;l<this.data.length;l++)c[l]=255&c[l]}e("../utils").inherits(i,t),i.prototype.byteAt=function(c){return this.data[this.zero+c]},i.prototype.lastIndexOfSignature=function(c){for(var l=c.charCodeAt(0),p=c.charCodeAt(1),w=c.charCodeAt(2),b=c.charCodeAt(3),_=this.length-4;0<=_;--_)if(this.data[_]===l&&this.data[_+1]===p&&this.data[_+2]===w&&this.data[_+3]===b)return _-this.zero;return-1},i.prototype.readAndCheckSignature=function(c){var l=c.charCodeAt(0),p=c.charCodeAt(1),w=c.charCodeAt(2),b=c.charCodeAt(3),_=this.readData(4);return l===_[0]&&p===_[1]&&w===_[2]&&b===_[3]},i.prototype.readData=function(c){if(this.checkOffset(c),c===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+c);return this.index+=c,l},s.exports=i},{"../utils":32,"./DataReader":18}],18:[function(e,s,r){var t=e("../utils");function i(c){this.data=c,this.length=c.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(c){this.checkIndex(this.index+c)},checkIndex:function(c){if(this.length<this.zero+c||c<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+c+"). Corrupted zip ?")},setIndex:function(c){this.checkIndex(c),this.index=c},skip:function(c){this.setIndex(this.index+c)},byteAt:function(){},readInt:function(c){var l,p=0;for(this.checkOffset(c),l=this.index+c-1;l>=this.index;l--)p=(p<<8)+this.byteAt(l);return this.index+=c,p},readString:function(c){return t.transformTo("string",this.readData(c))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var c=this.readInt(4);return new Date(Date.UTC(1980+(c>>25&127),(c>>21&15)-1,c>>16&31,c>>11&31,c>>5&63,(31&c)<<1))}},s.exports=i},{"../utils":32}],19:[function(e,s,r){var t=e("./Uint8ArrayReader");function i(c){t.call(this,c)}e("../utils").inherits(i,t),i.prototype.readData=function(c){this.checkOffset(c);var l=this.data.slice(this.zero+this.index,this.zero+this.index+c);return this.index+=c,l},s.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,s,r){var t=e("./DataReader");function i(c){t.call(this,c)}e("../utils").inherits(i,t),i.prototype.byteAt=function(c){return this.data.charCodeAt(this.zero+c)},i.prototype.lastIndexOfSignature=function(c){return this.data.lastIndexOf(c)-this.zero},i.prototype.readAndCheckSignature=function(c){return c===this.readData(4)},i.prototype.readData=function(c){this.checkOffset(c);var l=this.data.slice(this.zero+this.index,this.zero+this.index+c);return this.index+=c,l},s.exports=i},{"../utils":32,"./DataReader":18}],21:[function(e,s,r){var t=e("./ArrayReader");function i(c){t.call(this,c)}e("../utils").inherits(i,t),i.prototype.readData=function(c){if(this.checkOffset(c),c===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+c);return this.index+=c,l},s.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(e,s,r){var t=e("../utils"),i=e("../support"),c=e("./ArrayReader"),l=e("./StringReader"),p=e("./NodeBufferReader"),w=e("./Uint8ArrayReader");s.exports=function(b){var _=t.getTypeOf(b);return t.checkSupport(_),_!=="string"||i.uint8array?_==="nodebuffer"?new p(b):i.uint8array?new w(t.transformTo("uint8array",b)):new c(t.transformTo("array",b)):new l(b)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,s,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,s,r){var t=e("./GenericWorker"),i=e("../utils");function c(l){t.call(this,"ConvertWorker to "+l),this.destType=l}i.inherits(c,t),c.prototype.processChunk=function(l){this.push({data:i.transformTo(this.destType,l.data),meta:l.meta})},s.exports=c},{"../utils":32,"./GenericWorker":28}],25:[function(e,s,r){var t=e("./GenericWorker"),i=e("../crc32");function c(){t.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(c,t),c.prototype.processChunk=function(l){this.streamInfo.crc32=i(l.data,this.streamInfo.crc32||0),this.push(l)},s.exports=c},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,s,r){var t=e("../utils"),i=e("./GenericWorker");function c(l){i.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}t.inherits(c,i),c.prototype.processChunk=function(l){if(l){var p=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=p+l.data.length}i.prototype.processChunk.call(this,l)},s.exports=c},{"../utils":32,"./GenericWorker":28}],27:[function(e,s,r){var t=e("../utils"),i=e("./GenericWorker");function c(l){i.call(this,"DataWorker");var p=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(w){p.dataIsReady=!0,p.data=w,p.max=w&&w.length||0,p.type=t.getTypeOf(w),p.isPaused||p._tickAndRepeat()},function(w){p.error(w)})}t.inherits(c,i),c.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},c.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,t.delay(this._tickAndRepeat,[],this)),!0)},c.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(t.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},c.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,p=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,p);break;case"uint8array":l=this.data.subarray(this.index,p);break;case"array":case"nodebuffer":l=this.data.slice(this.index,p)}return this.index=p,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=c},{"../utils":32,"./GenericWorker":28}],28:[function(e,s,r){function t(i){this.name=i||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}t.prototype={push:function(i){this.emit("data",i)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(i){this.emit("error",i)}return!0},error:function(i){return!this.isFinished&&(this.isPaused?this.generatedError=i:(this.isFinished=!0,this.emit("error",i),this.previous&&this.previous.error(i),this.cleanUp()),!0)},on:function(i,c){return this._listeners[i].push(c),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(i,c){if(this._listeners[i])for(var l=0;l<this._listeners[i].length;l++)this._listeners[i][l].call(this,c)},pipe:function(i){return i.registerPrevious(this)},registerPrevious:function(i){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=i.streamInfo,this.mergeStreamInfo(),this.previous=i;var c=this;return i.on("data",function(l){c.processChunk(l)}),i.on("end",function(){c.end()}),i.on("error",function(l){c.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var i=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),i=!0),this.previous&&this.previous.resume(),!i},flush:function(){},processChunk:function(i){this.push(i)},withStreamInfo:function(i,c){return this.extraStreamInfo[i]=c,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var i in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,i)&&(this.streamInfo[i]=this.extraStreamInfo[i])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var i="Worker "+this.name;return this.previous?this.previous+" -> "+i:i}},s.exports=t},{}],29:[function(e,s,r){var t=e("../utils"),i=e("./ConvertWorker"),c=e("./GenericWorker"),l=e("../base64"),p=e("../support"),w=e("../external"),b=null;if(p.nodestream)try{b=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function _(x,d){return new w.Promise(function(f,m){var y=[],E=x._internalType,j=x._outputType,S=x._mimeType;x.on("data",function(z,R){y.push(z),d&&d(R)}).on("error",function(z){y=[],m(z)}).on("end",function(){try{var z=function(R,L,N){switch(R){case"blob":return t.newBlob(t.transformTo("arraybuffer",L),N);case"base64":return l.encode(L);default:return t.transformTo(R,L)}}(j,function(R,L){var N,W=0,G=null,k=0;for(N=0;N<L.length;N++)k+=L[N].length;switch(R){case"string":return L.join("");case"array":return Array.prototype.concat.apply([],L);case"uint8array":for(G=new Uint8Array(k),N=0;N<L.length;N++)G.set(L[N],W),W+=L[N].length;return G;case"nodebuffer":return Buffer.concat(L);default:throw new Error("concat : unsupported type '"+R+"'")}}(E,y),S);f(z)}catch(R){m(R)}y=[]}).resume()})}function h(x,d,f){var m=d;switch(d){case"blob":case"arraybuffer":m="uint8array";break;case"base64":m="string"}try{this._internalType=m,this._outputType=d,this._mimeType=f,t.checkSupport(m),this._worker=x.pipe(new i(m)),x.lock()}catch(y){this._worker=new c("error"),this._worker.error(y)}}h.prototype={accumulate:function(x){return _(this,x)},on:function(x,d){var f=this;return x==="data"?this._worker.on(x,function(m){d.call(f,m.data,m.meta)}):this._worker.on(x,function(){t.delay(d,arguments,f)}),this},resume:function(){return t.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(x){if(t.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new b(this,{objectMode:this._outputType!=="nodebuffer"},x)}},s.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,s,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",r.nodebuffer=typeof Buffer<"u",r.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")r.blob=!1;else{var t=new ArrayBuffer(0);try{r.blob=new Blob([t],{type:"application/zip"}).size===0}catch{try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(t),r.blob=i.getBlob("application/zip").size===0}catch{r.blob=!1}}}try{r.nodestream=!!e("readable-stream").Readable}catch{r.nodestream=!1}},{"readable-stream":16}],31:[function(e,s,r){for(var t=e("./utils"),i=e("./support"),c=e("./nodejsUtils"),l=e("./stream/GenericWorker"),p=new Array(256),w=0;w<256;w++)p[w]=252<=w?6:248<=w?5:240<=w?4:224<=w?3:192<=w?2:1;p[254]=p[254]=1;function b(){l.call(this,"utf-8 decode"),this.leftOver=null}function _(){l.call(this,"utf-8 encode")}r.utf8encode=function(h){return i.nodebuffer?c.newBufferFrom(h,"utf-8"):function(x){var d,f,m,y,E,j=x.length,S=0;for(y=0;y<j;y++)(64512&(f=x.charCodeAt(y)))==55296&&y+1<j&&(64512&(m=x.charCodeAt(y+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),y++),S+=f<128?1:f<2048?2:f<65536?3:4;for(d=i.uint8array?new Uint8Array(S):new Array(S),y=E=0;E<S;y++)(64512&(f=x.charCodeAt(y)))==55296&&y+1<j&&(64512&(m=x.charCodeAt(y+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),y++),f<128?d[E++]=f:(f<2048?d[E++]=192|f>>>6:(f<65536?d[E++]=224|f>>>12:(d[E++]=240|f>>>18,d[E++]=128|f>>>12&63),d[E++]=128|f>>>6&63),d[E++]=128|63&f);return d}(h)},r.utf8decode=function(h){return i.nodebuffer?t.transformTo("nodebuffer",h).toString("utf-8"):function(x){var d,f,m,y,E=x.length,j=new Array(2*E);for(d=f=0;d<E;)if((m=x[d++])<128)j[f++]=m;else if(4<(y=p[m]))j[f++]=65533,d+=y-1;else{for(m&=y===2?31:y===3?15:7;1<y&&d<E;)m=m<<6|63&x[d++],y--;1<y?j[f++]=65533:m<65536?j[f++]=m:(m-=65536,j[f++]=55296|m>>10&1023,j[f++]=56320|1023&m)}return j.length!==f&&(j.subarray?j=j.subarray(0,f):j.length=f),t.applyFromCharCode(j)}(h=t.transformTo(i.uint8array?"uint8array":"array",h))},t.inherits(b,l),b.prototype.processChunk=function(h){var x=t.transformTo(i.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var d=x;(x=new Uint8Array(d.length+this.leftOver.length)).set(this.leftOver,0),x.set(d,this.leftOver.length)}else x=this.leftOver.concat(x);this.leftOver=null}var f=function(y,E){var j;for((E=E||y.length)>y.length&&(E=y.length),j=E-1;0<=j&&(192&y[j])==128;)j--;return j<0||j===0?E:j+p[y[j]]>E?j:E}(x),m=x;f!==x.length&&(i.uint8array?(m=x.subarray(0,f),this.leftOver=x.subarray(f,x.length)):(m=x.slice(0,f),this.leftOver=x.slice(f,x.length))),this.push({data:r.utf8decode(m),meta:h.meta})},b.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=b,t.inherits(_,l),_.prototype.processChunk=function(h){this.push({data:r.utf8encode(h.data),meta:h.meta})},r.Utf8EncodeWorker=_},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,s,r){var t=e("./support"),i=e("./base64"),c=e("./nodejsUtils"),l=e("./external");function p(d){return d}function w(d,f){for(var m=0;m<d.length;++m)f[m]=255&d.charCodeAt(m);return f}e("setimmediate"),r.newBlob=function(d,f){r.checkSupport("blob");try{return new Blob([d],{type:f})}catch{try{var m=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return m.append(d),m.getBlob(f)}catch{throw new Error("Bug : can't construct the Blob.")}}};var b={stringifyByChunk:function(d,f,m){var y=[],E=0,j=d.length;if(j<=m)return String.fromCharCode.apply(null,d);for(;E<j;)f==="array"||f==="nodebuffer"?y.push(String.fromCharCode.apply(null,d.slice(E,Math.min(E+m,j)))):y.push(String.fromCharCode.apply(null,d.subarray(E,Math.min(E+m,j)))),E+=m;return y.join("")},stringifyByChar:function(d){for(var f="",m=0;m<d.length;m++)f+=String.fromCharCode(d[m]);return f},applyCanBeUsed:{uint8array:function(){try{return t.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return t.nodebuffer&&String.fromCharCode.apply(null,c.allocBuffer(1)).length===1}catch{return!1}}()}};function _(d){var f=65536,m=r.getTypeOf(d),y=!0;if(m==="uint8array"?y=b.applyCanBeUsed.uint8array:m==="nodebuffer"&&(y=b.applyCanBeUsed.nodebuffer),y)for(;1<f;)try{return b.stringifyByChunk(d,m,f)}catch{f=Math.floor(f/2)}return b.stringifyByChar(d)}function h(d,f){for(var m=0;m<d.length;m++)f[m]=d[m];return f}r.applyFromCharCode=_;var x={};x.string={string:p,array:function(d){return w(d,new Array(d.length))},arraybuffer:function(d){return x.string.uint8array(d).buffer},uint8array:function(d){return w(d,new Uint8Array(d.length))},nodebuffer:function(d){return w(d,c.allocBuffer(d.length))}},x.array={string:_,array:p,arraybuffer:function(d){return new Uint8Array(d).buffer},uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return c.newBufferFrom(d)}},x.arraybuffer={string:function(d){return _(new Uint8Array(d))},array:function(d){return h(new Uint8Array(d),new Array(d.byteLength))},arraybuffer:p,uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return c.newBufferFrom(new Uint8Array(d))}},x.uint8array={string:_,array:function(d){return h(d,new Array(d.length))},arraybuffer:function(d){return d.buffer},uint8array:p,nodebuffer:function(d){return c.newBufferFrom(d)}},x.nodebuffer={string:_,array:function(d){return h(d,new Array(d.length))},arraybuffer:function(d){return x.nodebuffer.uint8array(d).buffer},uint8array:function(d){return h(d,new Uint8Array(d.length))},nodebuffer:p},r.transformTo=function(d,f){if(f=f||"",!d)return f;r.checkSupport(d);var m=r.getTypeOf(f);return x[m][d](f)},r.resolve=function(d){for(var f=d.split("/"),m=[],y=0;y<f.length;y++){var E=f[y];E==="."||E===""&&y!==0&&y!==f.length-1||(E===".."?m.pop():m.push(E))}return m.join("/")},r.getTypeOf=function(d){return typeof d=="string"?"string":Object.prototype.toString.call(d)==="[object Array]"?"array":t.nodebuffer&&c.isBuffer(d)?"nodebuffer":t.uint8array&&d instanceof Uint8Array?"uint8array":t.arraybuffer&&d instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(d){if(!t[d.toLowerCase()])throw new Error(d+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(d){var f,m,y="";for(m=0;m<(d||"").length;m++)y+="\\x"+((f=d.charCodeAt(m))<16?"0":"")+f.toString(16).toUpperCase();return y},r.delay=function(d,f,m){setImmediate(function(){d.apply(m||null,f||[])})},r.inherits=function(d,f){function m(){}m.prototype=f.prototype,d.prototype=new m},r.extend=function(){var d,f,m={};for(d=0;d<arguments.length;d++)for(f in arguments[d])Object.prototype.hasOwnProperty.call(arguments[d],f)&&m[f]===void 0&&(m[f]=arguments[d][f]);return m},r.prepareContent=function(d,f,m,y,E){return l.Promise.resolve(f).then(function(j){return t.blob&&(j instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(j))!==-1)&&typeof FileReader<"u"?new l.Promise(function(S,z){var R=new FileReader;R.onload=function(L){S(L.target.result)},R.onerror=function(L){z(L.target.error)},R.readAsArrayBuffer(j)}):j}).then(function(j){var S=r.getTypeOf(j);return S?(S==="arraybuffer"?j=r.transformTo("uint8array",j):S==="string"&&(E?j=i.decode(j):m&&y!==!0&&(j=function(z){return w(z,t.uint8array?new Uint8Array(z.length):new Array(z.length))}(j))),j):l.Promise.reject(new Error("Can't read the data of '"+d+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,s,r){var t=e("./reader/readerFor"),i=e("./utils"),c=e("./signature"),l=e("./zipEntry"),p=e("./support");function w(b){this.files=[],this.loadOptions=b}w.prototype={checkSignature:function(b){if(!this.reader.readAndCheckSignature(b)){this.reader.index-=4;var _=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(_)+", expected "+i.pretty(b)+")")}},isSignature:function(b,_){var h=this.reader.index;this.reader.setIndex(b);var x=this.reader.readString(4)===_;return this.reader.setIndex(h),x},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var b=this.reader.readData(this.zipCommentLength),_=p.uint8array?"uint8array":"array",h=i.transformTo(_,b);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var b,_,h,x=this.zip64EndOfCentralSize-44;0<x;)b=this.reader.readInt(2),_=this.reader.readInt(4),h=this.reader.readData(_),this.zip64ExtensibleData[b]={id:b,length:_,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var b,_;for(b=0;b<this.files.length;b++)_=this.files[b],this.reader.setIndex(_.localHeaderOffset),this.checkSignature(c.LOCAL_FILE_HEADER),_.readLocalPart(this.reader),_.handleUTF8(),_.processAttributes()},readCentralDir:function(){var b;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(c.CENTRAL_FILE_HEADER);)(b=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(b);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var b=this.reader.lastIndexOfSignature(c.CENTRAL_DIRECTORY_END);if(b<0)throw this.isSignature(0,c.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(b);var _=b;if(this.checkSignature(c.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(b=this.reader.lastIndexOfSignature(c.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(b),this.checkSignature(c.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,c.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(c.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(c.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var x=_-h;if(0<x)this.isSignature(_,c.CENTRAL_FILE_HEADER)||(this.reader.zero=x);else if(x<0)throw new Error("Corrupted zip: missing "+Math.abs(x)+" bytes.")},prepareReader:function(b){this.reader=t(b)},load:function(b){this.prepareReader(b),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=w},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,s,r){var t=e("./reader/readerFor"),i=e("./utils"),c=e("./compressedObject"),l=e("./crc32"),p=e("./utf8"),w=e("./compressions"),b=e("./support");function _(h,x){this.options=h,this.loadOptions=x}_.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var x,d;if(h.skip(22),this.fileNameLength=h.readInt(2),d=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(d),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((x=function(f){for(var m in w)if(Object.prototype.hasOwnProperty.call(w,m)&&w[m].magic===f)return w[m];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new c(this.compressedSize,this.uncompressedSize,this.crc32,x,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var x=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(x),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=t(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var x,d,f,m=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<m;)x=h.readInt(2),d=h.readInt(2),f=h.readData(d),this.extraFields[x]={id:x,length:d,value:f};h.setIndex(m)},handleUTF8:function(){var h=b.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=p.utf8decode(this.fileName),this.fileCommentStr=p.utf8decode(this.fileComment);else{var x=this.findExtraFieldUnicodePath();if(x!==null)this.fileNameStr=x;else{var d=i.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(d)}var f=this.findExtraFieldUnicodeComment();if(f!==null)this.fileCommentStr=f;else{var m=i.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(m)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var x=t(h.value);return x.readInt(1)!==1||l(this.fileName)!==x.readInt(4)?null:p.utf8decode(x.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var x=t(h.value);return x.readInt(1)!==1||l(this.fileComment)!==x.readInt(4)?null:p.utf8decode(x.readData(h.length-5))}return null}},s.exports=_},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,s,r){function t(x,d,f){this.name=x,this.dir=f.dir,this.date=f.date,this.comment=f.comment,this.unixPermissions=f.unixPermissions,this.dosPermissions=f.dosPermissions,this._data=d,this._dataBinary=f.binary,this.options={compression:f.compression,compressionOptions:f.compressionOptions}}var i=e("./stream/StreamHelper"),c=e("./stream/DataWorker"),l=e("./utf8"),p=e("./compressedObject"),w=e("./stream/GenericWorker");t.prototype={internalStream:function(x){var d=null,f="string";try{if(!x)throw new Error("No output type specified.");var m=(f=x.toLowerCase())==="string"||f==="text";f!=="binarystring"&&f!=="text"||(f="string"),d=this._decompressWorker();var y=!this._dataBinary;y&&!m&&(d=d.pipe(new l.Utf8EncodeWorker)),!y&&m&&(d=d.pipe(new l.Utf8DecodeWorker))}catch(E){(d=new w("error")).error(E)}return new i(d,f,"")},async:function(x,d){return this.internalStream(x).accumulate(d)},nodeStream:function(x,d){return this.internalStream(x||"nodebuffer").toNodejsStream(d)},_compressWorker:function(x,d){if(this._data instanceof p&&this._data.compression.magic===x.magic)return this._data.getCompressedWorker();var f=this._decompressWorker();return this._dataBinary||(f=f.pipe(new l.Utf8EncodeWorker)),p.createWorkerFrom(f,x,d)},_decompressWorker:function(){return this._data instanceof p?this._data.getContentWorker():this._data instanceof w?this._data:new c(this._data)}};for(var b=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],_=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<b.length;h++)t.prototype[b[h]]=_;s.exports=t},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,s,r){(function(t){var i,c,l=t.MutationObserver||t.WebKitMutationObserver;if(l){var p=0,w=new l(x),b=t.document.createTextNode("");w.observe(b,{characterData:!0}),i=function(){b.data=p=++p%2}}else if(t.setImmediate||t.MessageChannel===void 0)i="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var d=t.document.createElement("script");d.onreadystatechange=function(){x(),d.onreadystatechange=null,d.parentNode.removeChild(d),d=null},t.document.documentElement.appendChild(d)}:function(){setTimeout(x,0)};else{var _=new t.MessageChannel;_.port1.onmessage=x,i=function(){_.port2.postMessage(0)}}var h=[];function x(){var d,f;c=!0;for(var m=h.length;m;){for(f=h,h=[],d=-1;++d<m;)f[d]();m=h.length}c=!1}s.exports=function(d){h.push(d)!==1||c||i()}}).call(this,typeof Be<"u"?Be:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,s,r){var t=e("immediate");function i(){}var c={},l=["REJECTED"],p=["FULFILLED"],w=["PENDING"];function b(m){if(typeof m!="function")throw new TypeError("resolver must be a function");this.state=w,this.queue=[],this.outcome=void 0,m!==i&&d(this,m)}function _(m,y,E){this.promise=m,typeof y=="function"&&(this.onFulfilled=y,this.callFulfilled=this.otherCallFulfilled),typeof E=="function"&&(this.onRejected=E,this.callRejected=this.otherCallRejected)}function h(m,y,E){t(function(){var j;try{j=y(E)}catch(S){return c.reject(m,S)}j===m?c.reject(m,new TypeError("Cannot resolve promise with itself")):c.resolve(m,j)})}function x(m){var y=m&&m.then;if(m&&(typeof m=="object"||typeof m=="function")&&typeof y=="function")return function(){y.apply(m,arguments)}}function d(m,y){var E=!1;function j(R){E||(E=!0,c.reject(m,R))}function S(R){E||(E=!0,c.resolve(m,R))}var z=f(function(){y(S,j)});z.status==="error"&&j(z.value)}function f(m,y){var E={};try{E.value=m(y),E.status="success"}catch(j){E.status="error",E.value=j}return E}(s.exports=b).prototype.finally=function(m){if(typeof m!="function")return this;var y=this.constructor;return this.then(function(E){return y.resolve(m()).then(function(){return E})},function(E){return y.resolve(m()).then(function(){throw E})})},b.prototype.catch=function(m){return this.then(null,m)},b.prototype.then=function(m,y){if(typeof m!="function"&&this.state===p||typeof y!="function"&&this.state===l)return this;var E=new this.constructor(i);return this.state!==w?h(E,this.state===p?m:y,this.outcome):this.queue.push(new _(E,m,y)),E},_.prototype.callFulfilled=function(m){c.resolve(this.promise,m)},_.prototype.otherCallFulfilled=function(m){h(this.promise,this.onFulfilled,m)},_.prototype.callRejected=function(m){c.reject(this.promise,m)},_.prototype.otherCallRejected=function(m){h(this.promise,this.onRejected,m)},c.resolve=function(m,y){var E=f(x,y);if(E.status==="error")return c.reject(m,E.value);var j=E.value;if(j)d(m,j);else{m.state=p,m.outcome=y;for(var S=-1,z=m.queue.length;++S<z;)m.queue[S].callFulfilled(y)}return m},c.reject=function(m,y){m.state=l,m.outcome=y;for(var E=-1,j=m.queue.length;++E<j;)m.queue[E].callRejected(y);return m},b.resolve=function(m){return m instanceof this?m:c.resolve(new this(i),m)},b.reject=function(m){var y=new this(i);return c.reject(y,m)},b.all=function(m){var y=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=m.length,j=!1;if(!E)return this.resolve([]);for(var S=new Array(E),z=0,R=-1,L=new this(i);++R<E;)N(m[R],R);return L;function N(W,G){y.resolve(W).then(function(k){S[G]=k,++z!==E||j||(j=!0,c.resolve(L,S))},function(k){j||(j=!0,c.reject(L,k))})}},b.race=function(m){var y=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=m.length,j=!1;if(!E)return this.resolve([]);for(var S=-1,z=new this(i);++S<E;)R=m[S],y.resolve(R).then(function(L){j||(j=!0,c.resolve(z,L))},function(L){j||(j=!0,c.reject(z,L))});var R;return z}},{immediate:36}],38:[function(e,s,r){var t={};(0,e("./lib/utils/common").assign)(t,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),s.exports=t},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,s,r){var t=e("./zlib/deflate"),i=e("./utils/common"),c=e("./utils/strings"),l=e("./zlib/messages"),p=e("./zlib/zstream"),w=Object.prototype.toString,b=0,_=-1,h=0,x=8;function d(m){if(!(this instanceof d))return new d(m);this.options=i.assign({level:_,method:x,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},m||{});var y=this.options;y.raw&&0<y.windowBits?y.windowBits=-y.windowBits:y.gzip&&0<y.windowBits&&y.windowBits<16&&(y.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var E=t.deflateInit2(this.strm,y.level,y.method,y.windowBits,y.memLevel,y.strategy);if(E!==b)throw new Error(l[E]);if(y.header&&t.deflateSetHeader(this.strm,y.header),y.dictionary){var j;if(j=typeof y.dictionary=="string"?c.string2buf(y.dictionary):w.call(y.dictionary)==="[object ArrayBuffer]"?new Uint8Array(y.dictionary):y.dictionary,(E=t.deflateSetDictionary(this.strm,j))!==b)throw new Error(l[E]);this._dict_set=!0}}function f(m,y){var E=new d(y);if(E.push(m,!0),E.err)throw E.msg||l[E.err];return E.result}d.prototype.push=function(m,y){var E,j,S=this.strm,z=this.options.chunkSize;if(this.ended)return!1;j=y===~~y?y:y===!0?4:0,typeof m=="string"?S.input=c.string2buf(m):w.call(m)==="[object ArrayBuffer]"?S.input=new Uint8Array(m):S.input=m,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new i.Buf8(z),S.next_out=0,S.avail_out=z),(E=t.deflate(S,j))!==1&&E!==b)return this.onEnd(E),!(this.ended=!0);S.avail_out!==0&&(S.avail_in!==0||j!==4&&j!==2)||(this.options.to==="string"?this.onData(c.buf2binstring(i.shrinkBuf(S.output,S.next_out))):this.onData(i.shrinkBuf(S.output,S.next_out)))}while((0<S.avail_in||S.avail_out===0)&&E!==1);return j===4?(E=t.deflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===b):j!==2||(this.onEnd(b),!(S.avail_out=0))},d.prototype.onData=function(m){this.chunks.push(m)},d.prototype.onEnd=function(m){m===b&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},r.Deflate=d,r.deflate=f,r.deflateRaw=function(m,y){return(y=y||{}).raw=!0,f(m,y)},r.gzip=function(m,y){return(y=y||{}).gzip=!0,f(m,y)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,s,r){var t=e("./zlib/inflate"),i=e("./utils/common"),c=e("./utils/strings"),l=e("./zlib/constants"),p=e("./zlib/messages"),w=e("./zlib/zstream"),b=e("./zlib/gzheader"),_=Object.prototype.toString;function h(d){if(!(this instanceof h))return new h(d);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},d||{});var f=this.options;f.raw&&0<=f.windowBits&&f.windowBits<16&&(f.windowBits=-f.windowBits,f.windowBits===0&&(f.windowBits=-15)),!(0<=f.windowBits&&f.windowBits<16)||d&&d.windowBits||(f.windowBits+=32),15<f.windowBits&&f.windowBits<48&&!(15&f.windowBits)&&(f.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new w,this.strm.avail_out=0;var m=t.inflateInit2(this.strm,f.windowBits);if(m!==l.Z_OK)throw new Error(p[m]);this.header=new b,t.inflateGetHeader(this.strm,this.header)}function x(d,f){var m=new h(f);if(m.push(d,!0),m.err)throw m.msg||p[m.err];return m.result}h.prototype.push=function(d,f){var m,y,E,j,S,z,R=this.strm,L=this.options.chunkSize,N=this.options.dictionary,W=!1;if(this.ended)return!1;y=f===~~f?f:f===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof d=="string"?R.input=c.binstring2buf(d):_.call(d)==="[object ArrayBuffer]"?R.input=new Uint8Array(d):R.input=d,R.next_in=0,R.avail_in=R.input.length;do{if(R.avail_out===0&&(R.output=new i.Buf8(L),R.next_out=0,R.avail_out=L),(m=t.inflate(R,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&N&&(z=typeof N=="string"?c.string2buf(N):_.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,m=t.inflateSetDictionary(this.strm,z)),m===l.Z_BUF_ERROR&&W===!0&&(m=l.Z_OK,W=!1),m!==l.Z_STREAM_END&&m!==l.Z_OK)return this.onEnd(m),!(this.ended=!0);R.next_out&&(R.avail_out!==0&&m!==l.Z_STREAM_END&&(R.avail_in!==0||y!==l.Z_FINISH&&y!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(E=c.utf8border(R.output,R.next_out),j=R.next_out-E,S=c.buf2string(R.output,E),R.next_out=j,R.avail_out=L-j,j&&i.arraySet(R.output,R.output,E,j,0),this.onData(S)):this.onData(i.shrinkBuf(R.output,R.next_out)))),R.avail_in===0&&R.avail_out===0&&(W=!0)}while((0<R.avail_in||R.avail_out===0)&&m!==l.Z_STREAM_END);return m===l.Z_STREAM_END&&(y=l.Z_FINISH),y===l.Z_FINISH?(m=t.inflateEnd(this.strm),this.onEnd(m),this.ended=!0,m===l.Z_OK):y!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(R.avail_out=0))},h.prototype.onData=function(d){this.chunks.push(d)},h.prototype.onEnd=function(d){d===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg},r.Inflate=h,r.inflate=x,r.inflateRaw=function(d,f){return(f=f||{}).raw=!0,x(d,f)},r.ungzip=x},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,s,r){var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";r.assign=function(l){for(var p=Array.prototype.slice.call(arguments,1);p.length;){var w=p.shift();if(w){if(typeof w!="object")throw new TypeError(w+"must be non-object");for(var b in w)w.hasOwnProperty(b)&&(l[b]=w[b])}}return l},r.shrinkBuf=function(l,p){return l.length===p?l:l.subarray?l.subarray(0,p):(l.length=p,l)};var i={arraySet:function(l,p,w,b,_){if(p.subarray&&l.subarray)l.set(p.subarray(w,w+b),_);else for(var h=0;h<b;h++)l[_+h]=p[w+h]},flattenChunks:function(l){var p,w,b,_,h,x;for(p=b=0,w=l.length;p<w;p++)b+=l[p].length;for(x=new Uint8Array(b),p=_=0,w=l.length;p<w;p++)h=l[p],x.set(h,_),_+=h.length;return x}},c={arraySet:function(l,p,w,b,_){for(var h=0;h<b;h++)l[_+h]=p[w+h]},flattenChunks:function(l){return[].concat.apply([],l)}};r.setTyped=function(l){l?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,c))},r.setTyped(t)},{}],42:[function(e,s,r){var t=e("./common"),i=!0,c=!0;try{String.fromCharCode.apply(null,[0])}catch{i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{c=!1}for(var l=new t.Buf8(256),p=0;p<256;p++)l[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;function w(b,_){if(_<65537&&(b.subarray&&c||!b.subarray&&i))return String.fromCharCode.apply(null,t.shrinkBuf(b,_));for(var h="",x=0;x<_;x++)h+=String.fromCharCode(b[x]);return h}l[254]=l[254]=1,r.string2buf=function(b){var _,h,x,d,f,m=b.length,y=0;for(d=0;d<m;d++)(64512&(h=b.charCodeAt(d)))==55296&&d+1<m&&(64512&(x=b.charCodeAt(d+1)))==56320&&(h=65536+(h-55296<<10)+(x-56320),d++),y+=h<128?1:h<2048?2:h<65536?3:4;for(_=new t.Buf8(y),d=f=0;f<y;d++)(64512&(h=b.charCodeAt(d)))==55296&&d+1<m&&(64512&(x=b.charCodeAt(d+1)))==56320&&(h=65536+(h-55296<<10)+(x-56320),d++),h<128?_[f++]=h:(h<2048?_[f++]=192|h>>>6:(h<65536?_[f++]=224|h>>>12:(_[f++]=240|h>>>18,_[f++]=128|h>>>12&63),_[f++]=128|h>>>6&63),_[f++]=128|63&h);return _},r.buf2binstring=function(b){return w(b,b.length)},r.binstring2buf=function(b){for(var _=new t.Buf8(b.length),h=0,x=_.length;h<x;h++)_[h]=b.charCodeAt(h);return _},r.buf2string=function(b,_){var h,x,d,f,m=_||b.length,y=new Array(2*m);for(h=x=0;h<m;)if((d=b[h++])<128)y[x++]=d;else if(4<(f=l[d]))y[x++]=65533,h+=f-1;else{for(d&=f===2?31:f===3?15:7;1<f&&h<m;)d=d<<6|63&b[h++],f--;1<f?y[x++]=65533:d<65536?y[x++]=d:(d-=65536,y[x++]=55296|d>>10&1023,y[x++]=56320|1023&d)}return w(y,x)},r.utf8border=function(b,_){var h;for((_=_||b.length)>b.length&&(_=b.length),h=_-1;0<=h&&(192&b[h])==128;)h--;return h<0||h===0?_:h+l[b[h]]>_?h:_}},{"./common":41}],43:[function(e,s,r){s.exports=function(t,i,c,l){for(var p=65535&t|0,w=t>>>16&65535|0,b=0;c!==0;){for(c-=b=2e3<c?2e3:c;w=w+(p=p+i[l++]|0)|0,--b;);p%=65521,w%=65521}return p|w<<16|0}},{}],44:[function(e,s,r){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,s,r){var t=function(){for(var i,c=[],l=0;l<256;l++){i=l;for(var p=0;p<8;p++)i=1&i?3988292384^i>>>1:i>>>1;c[l]=i}return c}();s.exports=function(i,c,l,p){var w=t,b=p+l;i^=-1;for(var _=p;_<b;_++)i=i>>>8^w[255&(i^c[_])];return-1^i}},{}],46:[function(e,s,r){var t,i=e("../utils/common"),c=e("./trees"),l=e("./adler32"),p=e("./crc32"),w=e("./messages"),b=0,_=4,h=0,x=-2,d=-1,f=4,m=2,y=8,E=9,j=286,S=30,z=19,R=2*j+1,L=15,N=3,W=258,G=W+N+1,k=42,D=113,o=1,T=2,U=3,P=4;function Q(a,M){return a.msg=w[M],M}function Z(a){return(a<<1)-(4<a?9:0)}function te(a){for(var M=a.length;0<=--M;)a[M]=0}function B(a){var M=a.state,F=M.pending;F>a.avail_out&&(F=a.avail_out),F!==0&&(i.arraySet(a.output,M.pending_buf,M.pending_out,F,a.next_out),a.next_out+=F,M.pending_out+=F,a.total_out+=F,a.avail_out-=F,M.pending-=F,M.pending===0&&(M.pending_out=0))}function A(a,M){c._tr_flush_block(a,0<=a.block_start?a.block_start:-1,a.strstart-a.block_start,M),a.block_start=a.strstart,B(a.strm)}function ee(a,M){a.pending_buf[a.pending++]=M}function q(a,M){a.pending_buf[a.pending++]=M>>>8&255,a.pending_buf[a.pending++]=255&M}function H(a,M){var F,C,v=a.max_chain_length,I=a.strstart,V=a.prev_length,$=a.nice_match,O=a.strstart>a.w_size-G?a.strstart-(a.w_size-G):0,Y=a.window,X=a.w_mask,K=a.prev,re=a.strstart+W,oe=Y[I+V-1],se=Y[I+V];a.prev_length>=a.good_match&&(v>>=2),$>a.lookahead&&($=a.lookahead);do if(Y[(F=M)+V]===se&&Y[F+V-1]===oe&&Y[F]===Y[I]&&Y[++F]===Y[I+1]){I+=2,F++;do;while(Y[++I]===Y[++F]&&Y[++I]===Y[++F]&&Y[++I]===Y[++F]&&Y[++I]===Y[++F]&&Y[++I]===Y[++F]&&Y[++I]===Y[++F]&&Y[++I]===Y[++F]&&Y[++I]===Y[++F]&&I<re);if(C=W-(re-I),I=re-W,V<C){if(a.match_start=M,$<=(V=C))break;oe=Y[I+V-1],se=Y[I+V]}}while((M=K[M&X])>O&&--v!=0);return V<=a.lookahead?V:a.lookahead}function ae(a){var M,F,C,v,I,V,$,O,Y,X,K=a.w_size;do{if(v=a.window_size-a.lookahead-a.strstart,a.strstart>=K+(K-G)){for(i.arraySet(a.window,a.window,K,K,0),a.match_start-=K,a.strstart-=K,a.block_start-=K,M=F=a.hash_size;C=a.head[--M],a.head[M]=K<=C?C-K:0,--F;);for(M=F=K;C=a.prev[--M],a.prev[M]=K<=C?C-K:0,--F;);v+=K}if(a.strm.avail_in===0)break;if(V=a.strm,$=a.window,O=a.strstart+a.lookahead,Y=v,X=void 0,X=V.avail_in,Y<X&&(X=Y),F=X===0?0:(V.avail_in-=X,i.arraySet($,V.input,V.next_in,X,O),V.state.wrap===1?V.adler=l(V.adler,$,X,O):V.state.wrap===2&&(V.adler=p(V.adler,$,X,O)),V.next_in+=X,V.total_in+=X,X),a.lookahead+=F,a.lookahead+a.insert>=N)for(I=a.strstart-a.insert,a.ins_h=a.window[I],a.ins_h=(a.ins_h<<a.hash_shift^a.window[I+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[I+N-1])&a.hash_mask,a.prev[I&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=I,I++,a.insert--,!(a.lookahead+a.insert<N)););}while(a.lookahead<G&&a.strm.avail_in!==0)}function ce(a,M){for(var F,C;;){if(a.lookahead<G){if(ae(a),a.lookahead<G&&M===b)return o;if(a.lookahead===0)break}if(F=0,a.lookahead>=N&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+N-1])&a.hash_mask,F=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),F!==0&&a.strstart-F<=a.w_size-G&&(a.match_length=H(a,F)),a.match_length>=N)if(C=c._tr_tally(a,a.strstart-a.match_start,a.match_length-N),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=N){for(a.match_length--;a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+N-1])&a.hash_mask,F=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart,--a.match_length!=0;);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else C=c._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(C&&(A(a,!1),a.strm.avail_out===0))return o}return a.insert=a.strstart<N-1?a.strstart:N-1,M===_?(A(a,!0),a.strm.avail_out===0?U:P):a.last_lit&&(A(a,!1),a.strm.avail_out===0)?o:T}function ne(a,M){for(var F,C,v;;){if(a.lookahead<G){if(ae(a),a.lookahead<G&&M===b)return o;if(a.lookahead===0)break}if(F=0,a.lookahead>=N&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+N-1])&a.hash_mask,F=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=N-1,F!==0&&a.prev_length<a.max_lazy_match&&a.strstart-F<=a.w_size-G&&(a.match_length=H(a,F),a.match_length<=5&&(a.strategy===1||a.match_length===N&&4096<a.strstart-a.match_start)&&(a.match_length=N-1)),a.prev_length>=N&&a.match_length<=a.prev_length){for(v=a.strstart+a.lookahead-N,C=c._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-N),a.lookahead-=a.prev_length-1,a.prev_length-=2;++a.strstart<=v&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+N-1])&a.hash_mask,F=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),--a.prev_length!=0;);if(a.match_available=0,a.match_length=N-1,a.strstart++,C&&(A(a,!1),a.strm.avail_out===0))return o}else if(a.match_available){if((C=c._tr_tally(a,0,a.window[a.strstart-1]))&&A(a,!1),a.strstart++,a.lookahead--,a.strm.avail_out===0)return o}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(C=c._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<N-1?a.strstart:N-1,M===_?(A(a,!0),a.strm.avail_out===0?U:P):a.last_lit&&(A(a,!1),a.strm.avail_out===0)?o:T}function ie(a,M,F,C,v){this.good_length=a,this.max_lazy=M,this.nice_length=F,this.max_chain=C,this.func=v}function he(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*R),this.dyn_dtree=new i.Buf16(2*(2*S+1)),this.bl_tree=new i.Buf16(2*(2*z+1)),te(this.dyn_ltree),te(this.dyn_dtree),te(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(L+1),this.heap=new i.Buf16(2*j+1),te(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*j+1),te(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function de(a){var M;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=m,(M=a.state).pending=0,M.pending_out=0,M.wrap<0&&(M.wrap=-M.wrap),M.status=M.wrap?k:D,a.adler=M.wrap===2?0:1,M.last_flush=b,c._tr_init(M),h):Q(a,x)}function _e(a){var M=de(a);return M===h&&function(F){F.window_size=2*F.w_size,te(F.head),F.max_lazy_match=t[F.level].max_lazy,F.good_match=t[F.level].good_length,F.nice_match=t[F.level].nice_length,F.max_chain_length=t[F.level].max_chain,F.strstart=0,F.block_start=0,F.lookahead=0,F.insert=0,F.match_length=F.prev_length=N-1,F.match_available=0,F.ins_h=0}(a.state),M}function ye(a,M,F,C,v,I){if(!a)return x;var V=1;if(M===d&&(M=6),C<0?(V=0,C=-C):15<C&&(V=2,C-=16),v<1||E<v||F!==y||C<8||15<C||M<0||9<M||I<0||f<I)return Q(a,x);C===8&&(C=9);var $=new he;return(a.state=$).strm=a,$.wrap=V,$.gzhead=null,$.w_bits=C,$.w_size=1<<$.w_bits,$.w_mask=$.w_size-1,$.hash_bits=v+7,$.hash_size=1<<$.hash_bits,$.hash_mask=$.hash_size-1,$.hash_shift=~~(($.hash_bits+N-1)/N),$.window=new i.Buf8(2*$.w_size),$.head=new i.Buf16($.hash_size),$.prev=new i.Buf16($.w_size),$.lit_bufsize=1<<v+6,$.pending_buf_size=4*$.lit_bufsize,$.pending_buf=new i.Buf8($.pending_buf_size),$.d_buf=1*$.lit_bufsize,$.l_buf=3*$.lit_bufsize,$.level=M,$.strategy=I,$.method=F,_e(a)}t=[new ie(0,0,0,0,function(a,M){var F=65535;for(F>a.pending_buf_size-5&&(F=a.pending_buf_size-5);;){if(a.lookahead<=1){if(ae(a),a.lookahead===0&&M===b)return o;if(a.lookahead===0)break}a.strstart+=a.lookahead,a.lookahead=0;var C=a.block_start+F;if((a.strstart===0||a.strstart>=C)&&(a.lookahead=a.strstart-C,a.strstart=C,A(a,!1),a.strm.avail_out===0)||a.strstart-a.block_start>=a.w_size-G&&(A(a,!1),a.strm.avail_out===0))return o}return a.insert=0,M===_?(A(a,!0),a.strm.avail_out===0?U:P):(a.strstart>a.block_start&&(A(a,!1),a.strm.avail_out),o)}),new ie(4,4,8,4,ce),new ie(4,5,16,8,ce),new ie(4,6,32,32,ce),new ie(4,4,16,16,ne),new ie(8,16,32,32,ne),new ie(8,16,128,128,ne),new ie(8,32,128,256,ne),new ie(32,128,258,1024,ne),new ie(32,258,258,4096,ne)],r.deflateInit=function(a,M){return ye(a,M,y,15,8,0)},r.deflateInit2=ye,r.deflateReset=_e,r.deflateResetKeep=de,r.deflateSetHeader=function(a,M){return a&&a.state?a.state.wrap!==2?x:(a.state.gzhead=M,h):x},r.deflate=function(a,M){var F,C,v,I;if(!a||!a.state||5<M||M<0)return a?Q(a,x):x;if(C=a.state,!a.output||!a.input&&a.avail_in!==0||C.status===666&&M!==_)return Q(a,a.avail_out===0?-5:x);if(C.strm=a,F=C.last_flush,C.last_flush=M,C.status===k)if(C.wrap===2)a.adler=0,ee(C,31),ee(C,139),ee(C,8),C.gzhead?(ee(C,(C.gzhead.text?1:0)+(C.gzhead.hcrc?2:0)+(C.gzhead.extra?4:0)+(C.gzhead.name?8:0)+(C.gzhead.comment?16:0)),ee(C,255&C.gzhead.time),ee(C,C.gzhead.time>>8&255),ee(C,C.gzhead.time>>16&255),ee(C,C.gzhead.time>>24&255),ee(C,C.level===9?2:2<=C.strategy||C.level<2?4:0),ee(C,255&C.gzhead.os),C.gzhead.extra&&C.gzhead.extra.length&&(ee(C,255&C.gzhead.extra.length),ee(C,C.gzhead.extra.length>>8&255)),C.gzhead.hcrc&&(a.adler=p(a.adler,C.pending_buf,C.pending,0)),C.gzindex=0,C.status=69):(ee(C,0),ee(C,0),ee(C,0),ee(C,0),ee(C,0),ee(C,C.level===9?2:2<=C.strategy||C.level<2?4:0),ee(C,3),C.status=D);else{var V=y+(C.w_bits-8<<4)<<8;V|=(2<=C.strategy||C.level<2?0:C.level<6?1:C.level===6?2:3)<<6,C.strstart!==0&&(V|=32),V+=31-V%31,C.status=D,q(C,V),C.strstart!==0&&(q(C,a.adler>>>16),q(C,65535&a.adler)),a.adler=1}if(C.status===69)if(C.gzhead.extra){for(v=C.pending;C.gzindex<(65535&C.gzhead.extra.length)&&(C.pending!==C.pending_buf_size||(C.gzhead.hcrc&&C.pending>v&&(a.adler=p(a.adler,C.pending_buf,C.pending-v,v)),B(a),v=C.pending,C.pending!==C.pending_buf_size));)ee(C,255&C.gzhead.extra[C.gzindex]),C.gzindex++;C.gzhead.hcrc&&C.pending>v&&(a.adler=p(a.adler,C.pending_buf,C.pending-v,v)),C.gzindex===C.gzhead.extra.length&&(C.gzindex=0,C.status=73)}else C.status=73;if(C.status===73)if(C.gzhead.name){v=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>v&&(a.adler=p(a.adler,C.pending_buf,C.pending-v,v)),B(a),v=C.pending,C.pending===C.pending_buf_size)){I=1;break}I=C.gzindex<C.gzhead.name.length?255&C.gzhead.name.charCodeAt(C.gzindex++):0,ee(C,I)}while(I!==0);C.gzhead.hcrc&&C.pending>v&&(a.adler=p(a.adler,C.pending_buf,C.pending-v,v)),I===0&&(C.gzindex=0,C.status=91)}else C.status=91;if(C.status===91)if(C.gzhead.comment){v=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>v&&(a.adler=p(a.adler,C.pending_buf,C.pending-v,v)),B(a),v=C.pending,C.pending===C.pending_buf_size)){I=1;break}I=C.gzindex<C.gzhead.comment.length?255&C.gzhead.comment.charCodeAt(C.gzindex++):0,ee(C,I)}while(I!==0);C.gzhead.hcrc&&C.pending>v&&(a.adler=p(a.adler,C.pending_buf,C.pending-v,v)),I===0&&(C.status=103)}else C.status=103;if(C.status===103&&(C.gzhead.hcrc?(C.pending+2>C.pending_buf_size&&B(a),C.pending+2<=C.pending_buf_size&&(ee(C,255&a.adler),ee(C,a.adler>>8&255),a.adler=0,C.status=D)):C.status=D),C.pending!==0){if(B(a),a.avail_out===0)return C.last_flush=-1,h}else if(a.avail_in===0&&Z(M)<=Z(F)&&M!==_)return Q(a,-5);if(C.status===666&&a.avail_in!==0)return Q(a,-5);if(a.avail_in!==0||C.lookahead!==0||M!==b&&C.status!==666){var $=C.strategy===2?function(O,Y){for(var X;;){if(O.lookahead===0&&(ae(O),O.lookahead===0)){if(Y===b)return o;break}if(O.match_length=0,X=c._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++,X&&(A(O,!1),O.strm.avail_out===0))return o}return O.insert=0,Y===_?(A(O,!0),O.strm.avail_out===0?U:P):O.last_lit&&(A(O,!1),O.strm.avail_out===0)?o:T}(C,M):C.strategy===3?function(O,Y){for(var X,K,re,oe,se=O.window;;){if(O.lookahead<=W){if(ae(O),O.lookahead<=W&&Y===b)return o;if(O.lookahead===0)break}if(O.match_length=0,O.lookahead>=N&&0<O.strstart&&(K=se[re=O.strstart-1])===se[++re]&&K===se[++re]&&K===se[++re]){oe=O.strstart+W;do;while(K===se[++re]&&K===se[++re]&&K===se[++re]&&K===se[++re]&&K===se[++re]&&K===se[++re]&&K===se[++re]&&K===se[++re]&&re<oe);O.match_length=W-(oe-re),O.match_length>O.lookahead&&(O.match_length=O.lookahead)}if(O.match_length>=N?(X=c._tr_tally(O,1,O.match_length-N),O.lookahead-=O.match_length,O.strstart+=O.match_length,O.match_length=0):(X=c._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++),X&&(A(O,!1),O.strm.avail_out===0))return o}return O.insert=0,Y===_?(A(O,!0),O.strm.avail_out===0?U:P):O.last_lit&&(A(O,!1),O.strm.avail_out===0)?o:T}(C,M):t[C.level].func(C,M);if($!==U&&$!==P||(C.status=666),$===o||$===U)return a.avail_out===0&&(C.last_flush=-1),h;if($===T&&(M===1?c._tr_align(C):M!==5&&(c._tr_stored_block(C,0,0,!1),M===3&&(te(C.head),C.lookahead===0&&(C.strstart=0,C.block_start=0,C.insert=0))),B(a),a.avail_out===0))return C.last_flush=-1,h}return M!==_?h:C.wrap<=0?1:(C.wrap===2?(ee(C,255&a.adler),ee(C,a.adler>>8&255),ee(C,a.adler>>16&255),ee(C,a.adler>>24&255),ee(C,255&a.total_in),ee(C,a.total_in>>8&255),ee(C,a.total_in>>16&255),ee(C,a.total_in>>24&255)):(q(C,a.adler>>>16),q(C,65535&a.adler)),B(a),0<C.wrap&&(C.wrap=-C.wrap),C.pending!==0?h:1)},r.deflateEnd=function(a){var M;return a&&a.state?(M=a.state.status)!==k&&M!==69&&M!==73&&M!==91&&M!==103&&M!==D&&M!==666?Q(a,x):(a.state=null,M===D?Q(a,-3):h):x},r.deflateSetDictionary=function(a,M){var F,C,v,I,V,$,O,Y,X=M.length;if(!a||!a.state||(I=(F=a.state).wrap)===2||I===1&&F.status!==k||F.lookahead)return x;for(I===1&&(a.adler=l(a.adler,M,X,0)),F.wrap=0,X>=F.w_size&&(I===0&&(te(F.head),F.strstart=0,F.block_start=0,F.insert=0),Y=new i.Buf8(F.w_size),i.arraySet(Y,M,X-F.w_size,F.w_size,0),M=Y,X=F.w_size),V=a.avail_in,$=a.next_in,O=a.input,a.avail_in=X,a.next_in=0,a.input=M,ae(F);F.lookahead>=N;){for(C=F.strstart,v=F.lookahead-(N-1);F.ins_h=(F.ins_h<<F.hash_shift^F.window[C+N-1])&F.hash_mask,F.prev[C&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=C,C++,--v;);F.strstart=C,F.lookahead=N-1,ae(F)}return F.strstart+=F.lookahead,F.block_start=F.strstart,F.insert=F.lookahead,F.lookahead=0,F.match_length=F.prev_length=N-1,F.match_available=0,a.next_in=$,a.input=O,a.avail_in=V,F.wrap=I,h},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,s,r){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,s,r){s.exports=function(t,i){var c,l,p,w,b,_,h,x,d,f,m,y,E,j,S,z,R,L,N,W,G,k,D,o,T;c=t.state,l=t.next_in,o=t.input,p=l+(t.avail_in-5),w=t.next_out,T=t.output,b=w-(i-t.avail_out),_=w+(t.avail_out-257),h=c.dmax,x=c.wsize,d=c.whave,f=c.wnext,m=c.window,y=c.hold,E=c.bits,j=c.lencode,S=c.distcode,z=(1<<c.lenbits)-1,R=(1<<c.distbits)-1;e:do{E<15&&(y+=o[l++]<<E,E+=8,y+=o[l++]<<E,E+=8),L=j[y&z];t:for(;;){if(y>>>=N=L>>>24,E-=N,(N=L>>>16&255)===0)T[w++]=65535&L;else{if(!(16&N)){if(!(64&N)){L=j[(65535&L)+(y&(1<<N)-1)];continue t}if(32&N){c.mode=12;break e}t.msg="invalid literal/length code",c.mode=30;break e}W=65535&L,(N&=15)&&(E<N&&(y+=o[l++]<<E,E+=8),W+=y&(1<<N)-1,y>>>=N,E-=N),E<15&&(y+=o[l++]<<E,E+=8,y+=o[l++]<<E,E+=8),L=S[y&R];r:for(;;){if(y>>>=N=L>>>24,E-=N,!(16&(N=L>>>16&255))){if(!(64&N)){L=S[(65535&L)+(y&(1<<N)-1)];continue r}t.msg="invalid distance code",c.mode=30;break e}if(G=65535&L,E<(N&=15)&&(y+=o[l++]<<E,(E+=8)<N&&(y+=o[l++]<<E,E+=8)),h<(G+=y&(1<<N)-1)){t.msg="invalid distance too far back",c.mode=30;break e}if(y>>>=N,E-=N,(N=w-b)<G){if(d<(N=G-N)&&c.sane){t.msg="invalid distance too far back",c.mode=30;break e}if(D=m,(k=0)===f){if(k+=x-N,N<W){for(W-=N;T[w++]=m[k++],--N;);k=w-G,D=T}}else if(f<N){if(k+=x+f-N,(N-=f)<W){for(W-=N;T[w++]=m[k++],--N;);if(k=0,f<W){for(W-=N=f;T[w++]=m[k++],--N;);k=w-G,D=T}}}else if(k+=f-N,N<W){for(W-=N;T[w++]=m[k++],--N;);k=w-G,D=T}for(;2<W;)T[w++]=D[k++],T[w++]=D[k++],T[w++]=D[k++],W-=3;W&&(T[w++]=D[k++],1<W&&(T[w++]=D[k++]))}else{for(k=w-G;T[w++]=T[k++],T[w++]=T[k++],T[w++]=T[k++],2<(W-=3););W&&(T[w++]=T[k++],1<W&&(T[w++]=T[k++]))}break}}break}}while(l<p&&w<_);l-=W=E>>3,y&=(1<<(E-=W<<3))-1,t.next_in=l,t.next_out=w,t.avail_in=l<p?p-l+5:5-(l-p),t.avail_out=w<_?_-w+257:257-(w-_),c.hold=y,c.bits=E}},{}],49:[function(e,s,r){var t=e("../utils/common"),i=e("./adler32"),c=e("./crc32"),l=e("./inffast"),p=e("./inftrees"),w=1,b=2,_=0,h=-2,x=1,d=852,f=592;function m(k){return(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24)}function y(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new t.Buf16(320),this.work=new t.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function E(k){var D;return k&&k.state?(D=k.state,k.total_in=k.total_out=D.total=0,k.msg="",D.wrap&&(k.adler=1&D.wrap),D.mode=x,D.last=0,D.havedict=0,D.dmax=32768,D.head=null,D.hold=0,D.bits=0,D.lencode=D.lendyn=new t.Buf32(d),D.distcode=D.distdyn=new t.Buf32(f),D.sane=1,D.back=-1,_):h}function j(k){var D;return k&&k.state?((D=k.state).wsize=0,D.whave=0,D.wnext=0,E(k)):h}function S(k,D){var o,T;return k&&k.state?(T=k.state,D<0?(o=0,D=-D):(o=1+(D>>4),D<48&&(D&=15)),D&&(D<8||15<D)?h:(T.window!==null&&T.wbits!==D&&(T.window=null),T.wrap=o,T.wbits=D,j(k))):h}function z(k,D){var o,T;return k?(T=new y,(k.state=T).window=null,(o=S(k,D))!==_&&(k.state=null),o):h}var R,L,N=!0;function W(k){if(N){var D;for(R=new t.Buf32(512),L=new t.Buf32(32),D=0;D<144;)k.lens[D++]=8;for(;D<256;)k.lens[D++]=9;for(;D<280;)k.lens[D++]=7;for(;D<288;)k.lens[D++]=8;for(p(w,k.lens,0,288,R,0,k.work,{bits:9}),D=0;D<32;)k.lens[D++]=5;p(b,k.lens,0,32,L,0,k.work,{bits:5}),N=!1}k.lencode=R,k.lenbits=9,k.distcode=L,k.distbits=5}function G(k,D,o,T){var U,P=k.state;return P.window===null&&(P.wsize=1<<P.wbits,P.wnext=0,P.whave=0,P.window=new t.Buf8(P.wsize)),T>=P.wsize?(t.arraySet(P.window,D,o-P.wsize,P.wsize,0),P.wnext=0,P.whave=P.wsize):(T<(U=P.wsize-P.wnext)&&(U=T),t.arraySet(P.window,D,o-T,U,P.wnext),(T-=U)?(t.arraySet(P.window,D,o-T,T,0),P.wnext=T,P.whave=P.wsize):(P.wnext+=U,P.wnext===P.wsize&&(P.wnext=0),P.whave<P.wsize&&(P.whave+=U))),0}r.inflateReset=j,r.inflateReset2=S,r.inflateResetKeep=E,r.inflateInit=function(k){return z(k,15)},r.inflateInit2=z,r.inflate=function(k,D){var o,T,U,P,Q,Z,te,B,A,ee,q,H,ae,ce,ne,ie,he,de,_e,ye,a,M,F,C,v=0,I=new t.Buf8(4),V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return h;(o=k.state).mode===12&&(o.mode=13),Q=k.next_out,U=k.output,te=k.avail_out,P=k.next_in,T=k.input,Z=k.avail_in,B=o.hold,A=o.bits,ee=Z,q=te,M=_;e:for(;;)switch(o.mode){case x:if(o.wrap===0){o.mode=13;break}for(;A<16;){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}if(2&o.wrap&&B===35615){I[o.check=0]=255&B,I[1]=B>>>8&255,o.check=c(o.check,I,2,0),A=B=0,o.mode=2;break}if(o.flags=0,o.head&&(o.head.done=!1),!(1&o.wrap)||(((255&B)<<8)+(B>>8))%31){k.msg="incorrect header check",o.mode=30;break}if((15&B)!=8){k.msg="unknown compression method",o.mode=30;break}if(A-=4,a=8+(15&(B>>>=4)),o.wbits===0)o.wbits=a;else if(a>o.wbits){k.msg="invalid window size",o.mode=30;break}o.dmax=1<<a,k.adler=o.check=1,o.mode=512&B?10:12,A=B=0;break;case 2:for(;A<16;){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}if(o.flags=B,(255&o.flags)!=8){k.msg="unknown compression method",o.mode=30;break}if(57344&o.flags){k.msg="unknown header flags set",o.mode=30;break}o.head&&(o.head.text=B>>8&1),512&o.flags&&(I[0]=255&B,I[1]=B>>>8&255,o.check=c(o.check,I,2,0)),A=B=0,o.mode=3;case 3:for(;A<32;){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}o.head&&(o.head.time=B),512&o.flags&&(I[0]=255&B,I[1]=B>>>8&255,I[2]=B>>>16&255,I[3]=B>>>24&255,o.check=c(o.check,I,4,0)),A=B=0,o.mode=4;case 4:for(;A<16;){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}o.head&&(o.head.xflags=255&B,o.head.os=B>>8),512&o.flags&&(I[0]=255&B,I[1]=B>>>8&255,o.check=c(o.check,I,2,0)),A=B=0,o.mode=5;case 5:if(1024&o.flags){for(;A<16;){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}o.length=B,o.head&&(o.head.extra_len=B),512&o.flags&&(I[0]=255&B,I[1]=B>>>8&255,o.check=c(o.check,I,2,0)),A=B=0}else o.head&&(o.head.extra=null);o.mode=6;case 6:if(1024&o.flags&&(Z<(H=o.length)&&(H=Z),H&&(o.head&&(a=o.head.extra_len-o.length,o.head.extra||(o.head.extra=new Array(o.head.extra_len)),t.arraySet(o.head.extra,T,P,H,a)),512&o.flags&&(o.check=c(o.check,T,H,P)),Z-=H,P+=H,o.length-=H),o.length))break e;o.length=0,o.mode=7;case 7:if(2048&o.flags){if(Z===0)break e;for(H=0;a=T[P+H++],o.head&&a&&o.length<65536&&(o.head.name+=String.fromCharCode(a)),a&&H<Z;);if(512&o.flags&&(o.check=c(o.check,T,H,P)),Z-=H,P+=H,a)break e}else o.head&&(o.head.name=null);o.length=0,o.mode=8;case 8:if(4096&o.flags){if(Z===0)break e;for(H=0;a=T[P+H++],o.head&&a&&o.length<65536&&(o.head.comment+=String.fromCharCode(a)),a&&H<Z;);if(512&o.flags&&(o.check=c(o.check,T,H,P)),Z-=H,P+=H,a)break e}else o.head&&(o.head.comment=null);o.mode=9;case 9:if(512&o.flags){for(;A<16;){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}if(B!==(65535&o.check)){k.msg="header crc mismatch",o.mode=30;break}A=B=0}o.head&&(o.head.hcrc=o.flags>>9&1,o.head.done=!0),k.adler=o.check=0,o.mode=12;break;case 10:for(;A<32;){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}k.adler=o.check=m(B),A=B=0,o.mode=11;case 11:if(o.havedict===0)return k.next_out=Q,k.avail_out=te,k.next_in=P,k.avail_in=Z,o.hold=B,o.bits=A,2;k.adler=o.check=1,o.mode=12;case 12:if(D===5||D===6)break e;case 13:if(o.last){B>>>=7&A,A-=7&A,o.mode=27;break}for(;A<3;){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}switch(o.last=1&B,A-=1,3&(B>>>=1)){case 0:o.mode=14;break;case 1:if(W(o),o.mode=20,D!==6)break;B>>>=2,A-=2;break e;case 2:o.mode=17;break;case 3:k.msg="invalid block type",o.mode=30}B>>>=2,A-=2;break;case 14:for(B>>>=7&A,A-=7&A;A<32;){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}if((65535&B)!=(B>>>16^65535)){k.msg="invalid stored block lengths",o.mode=30;break}if(o.length=65535&B,A=B=0,o.mode=15,D===6)break e;case 15:o.mode=16;case 16:if(H=o.length){if(Z<H&&(H=Z),te<H&&(H=te),H===0)break e;t.arraySet(U,T,P,H,Q),Z-=H,P+=H,te-=H,Q+=H,o.length-=H;break}o.mode=12;break;case 17:for(;A<14;){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}if(o.nlen=257+(31&B),B>>>=5,A-=5,o.ndist=1+(31&B),B>>>=5,A-=5,o.ncode=4+(15&B),B>>>=4,A-=4,286<o.nlen||30<o.ndist){k.msg="too many length or distance symbols",o.mode=30;break}o.have=0,o.mode=18;case 18:for(;o.have<o.ncode;){for(;A<3;){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}o.lens[V[o.have++]]=7&B,B>>>=3,A-=3}for(;o.have<19;)o.lens[V[o.have++]]=0;if(o.lencode=o.lendyn,o.lenbits=7,F={bits:o.lenbits},M=p(0,o.lens,0,19,o.lencode,0,o.work,F),o.lenbits=F.bits,M){k.msg="invalid code lengths set",o.mode=30;break}o.have=0,o.mode=19;case 19:for(;o.have<o.nlen+o.ndist;){for(;ie=(v=o.lencode[B&(1<<o.lenbits)-1])>>>16&255,he=65535&v,!((ne=v>>>24)<=A);){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}if(he<16)B>>>=ne,A-=ne,o.lens[o.have++]=he;else{if(he===16){for(C=ne+2;A<C;){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}if(B>>>=ne,A-=ne,o.have===0){k.msg="invalid bit length repeat",o.mode=30;break}a=o.lens[o.have-1],H=3+(3&B),B>>>=2,A-=2}else if(he===17){for(C=ne+3;A<C;){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}A-=ne,a=0,H=3+(7&(B>>>=ne)),B>>>=3,A-=3}else{for(C=ne+7;A<C;){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}A-=ne,a=0,H=11+(127&(B>>>=ne)),B>>>=7,A-=7}if(o.have+H>o.nlen+o.ndist){k.msg="invalid bit length repeat",o.mode=30;break}for(;H--;)o.lens[o.have++]=a}}if(o.mode===30)break;if(o.lens[256]===0){k.msg="invalid code -- missing end-of-block",o.mode=30;break}if(o.lenbits=9,F={bits:o.lenbits},M=p(w,o.lens,0,o.nlen,o.lencode,0,o.work,F),o.lenbits=F.bits,M){k.msg="invalid literal/lengths set",o.mode=30;break}if(o.distbits=6,o.distcode=o.distdyn,F={bits:o.distbits},M=p(b,o.lens,o.nlen,o.ndist,o.distcode,0,o.work,F),o.distbits=F.bits,M){k.msg="invalid distances set",o.mode=30;break}if(o.mode=20,D===6)break e;case 20:o.mode=21;case 21:if(6<=Z&&258<=te){k.next_out=Q,k.avail_out=te,k.next_in=P,k.avail_in=Z,o.hold=B,o.bits=A,l(k,q),Q=k.next_out,U=k.output,te=k.avail_out,P=k.next_in,T=k.input,Z=k.avail_in,B=o.hold,A=o.bits,o.mode===12&&(o.back=-1);break}for(o.back=0;ie=(v=o.lencode[B&(1<<o.lenbits)-1])>>>16&255,he=65535&v,!((ne=v>>>24)<=A);){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}if(ie&&!(240&ie)){for(de=ne,_e=ie,ye=he;ie=(v=o.lencode[ye+((B&(1<<de+_e)-1)>>de)])>>>16&255,he=65535&v,!(de+(ne=v>>>24)<=A);){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}B>>>=de,A-=de,o.back+=de}if(B>>>=ne,A-=ne,o.back+=ne,o.length=he,ie===0){o.mode=26;break}if(32&ie){o.back=-1,o.mode=12;break}if(64&ie){k.msg="invalid literal/length code",o.mode=30;break}o.extra=15&ie,o.mode=22;case 22:if(o.extra){for(C=o.extra;A<C;){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}o.length+=B&(1<<o.extra)-1,B>>>=o.extra,A-=o.extra,o.back+=o.extra}o.was=o.length,o.mode=23;case 23:for(;ie=(v=o.distcode[B&(1<<o.distbits)-1])>>>16&255,he=65535&v,!((ne=v>>>24)<=A);){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}if(!(240&ie)){for(de=ne,_e=ie,ye=he;ie=(v=o.distcode[ye+((B&(1<<de+_e)-1)>>de)])>>>16&255,he=65535&v,!(de+(ne=v>>>24)<=A);){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}B>>>=de,A-=de,o.back+=de}if(B>>>=ne,A-=ne,o.back+=ne,64&ie){k.msg="invalid distance code",o.mode=30;break}o.offset=he,o.extra=15&ie,o.mode=24;case 24:if(o.extra){for(C=o.extra;A<C;){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}o.offset+=B&(1<<o.extra)-1,B>>>=o.extra,A-=o.extra,o.back+=o.extra}if(o.offset>o.dmax){k.msg="invalid distance too far back",o.mode=30;break}o.mode=25;case 25:if(te===0)break e;if(H=q-te,o.offset>H){if((H=o.offset-H)>o.whave&&o.sane){k.msg="invalid distance too far back",o.mode=30;break}ae=H>o.wnext?(H-=o.wnext,o.wsize-H):o.wnext-H,H>o.length&&(H=o.length),ce=o.window}else ce=U,ae=Q-o.offset,H=o.length;for(te<H&&(H=te),te-=H,o.length-=H;U[Q++]=ce[ae++],--H;);o.length===0&&(o.mode=21);break;case 26:if(te===0)break e;U[Q++]=o.length,te--,o.mode=21;break;case 27:if(o.wrap){for(;A<32;){if(Z===0)break e;Z--,B|=T[P++]<<A,A+=8}if(q-=te,k.total_out+=q,o.total+=q,q&&(k.adler=o.check=o.flags?c(o.check,U,q,Q-q):i(o.check,U,q,Q-q)),q=te,(o.flags?B:m(B))!==o.check){k.msg="incorrect data check",o.mode=30;break}A=B=0}o.mode=28;case 28:if(o.wrap&&o.flags){for(;A<32;){if(Z===0)break e;Z--,B+=T[P++]<<A,A+=8}if(B!==(4294967295&o.total)){k.msg="incorrect length check",o.mode=30;break}A=B=0}o.mode=29;case 29:M=1;break e;case 30:M=-3;break e;case 31:return-4;case 32:default:return h}return k.next_out=Q,k.avail_out=te,k.next_in=P,k.avail_in=Z,o.hold=B,o.bits=A,(o.wsize||q!==k.avail_out&&o.mode<30&&(o.mode<27||D!==4))&&G(k,k.output,k.next_out,q-k.avail_out)?(o.mode=31,-4):(ee-=k.avail_in,q-=k.avail_out,k.total_in+=ee,k.total_out+=q,o.total+=q,o.wrap&&q&&(k.adler=o.check=o.flags?c(o.check,U,q,k.next_out-q):i(o.check,U,q,k.next_out-q)),k.data_type=o.bits+(o.last?64:0)+(o.mode===12?128:0)+(o.mode===20||o.mode===15?256:0),(ee==0&&q===0||D===4)&&M===_&&(M=-5),M)},r.inflateEnd=function(k){if(!k||!k.state)return h;var D=k.state;return D.window&&(D.window=null),k.state=null,_},r.inflateGetHeader=function(k,D){var o;return k&&k.state&&2&(o=k.state).wrap?((o.head=D).done=!1,_):h},r.inflateSetDictionary=function(k,D){var o,T=D.length;return k&&k.state?(o=k.state).wrap!==0&&o.mode!==11?h:o.mode===11&&i(1,D,T,0)!==o.check?-3:G(k,D,T,T)?(o.mode=31,-4):(o.havedict=1,_):h},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,s,r){var t=e("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],c=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],p=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(w,b,_,h,x,d,f,m){var y,E,j,S,z,R,L,N,W,G=m.bits,k=0,D=0,o=0,T=0,U=0,P=0,Q=0,Z=0,te=0,B=0,A=null,ee=0,q=new t.Buf16(16),H=new t.Buf16(16),ae=null,ce=0;for(k=0;k<=15;k++)q[k]=0;for(D=0;D<h;D++)q[b[_+D]]++;for(U=G,T=15;1<=T&&q[T]===0;T--);if(T<U&&(U=T),T===0)return x[d++]=20971520,x[d++]=20971520,m.bits=1,0;for(o=1;o<T&&q[o]===0;o++);for(U<o&&(U=o),k=Z=1;k<=15;k++)if(Z<<=1,(Z-=q[k])<0)return-1;if(0<Z&&(w===0||T!==1))return-1;for(H[1]=0,k=1;k<15;k++)H[k+1]=H[k]+q[k];for(D=0;D<h;D++)b[_+D]!==0&&(f[H[b[_+D]]++]=D);if(R=w===0?(A=ae=f,19):w===1?(A=i,ee-=257,ae=c,ce-=257,256):(A=l,ae=p,-1),k=o,z=d,Q=D=B=0,j=-1,S=(te=1<<(P=U))-1,w===1&&852<te||w===2&&592<te)return 1;for(;;){for(L=k-Q,W=f[D]<R?(N=0,f[D]):f[D]>R?(N=ae[ce+f[D]],A[ee+f[D]]):(N=96,0),y=1<<k-Q,o=E=1<<P;x[z+(B>>Q)+(E-=y)]=L<<24|N<<16|W|0,E!==0;);for(y=1<<k-1;B&y;)y>>=1;if(y!==0?(B&=y-1,B+=y):B=0,D++,--q[k]==0){if(k===T)break;k=b[_+f[D]]}if(U<k&&(B&S)!==j){for(Q===0&&(Q=U),z+=o,Z=1<<(P=k-Q);P+Q<T&&!((Z-=q[P+Q])<=0);)P++,Z<<=1;if(te+=1<<P,w===1&&852<te||w===2&&592<te)return 1;x[j=B&S]=U<<24|P<<16|z-d|0}}return B!==0&&(x[z+B]=k-Q<<24|64<<16|0),m.bits=U,0}},{"../utils/common":41}],51:[function(e,s,r){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,s,r){var t=e("../utils/common"),i=0,c=1;function l(v){for(var I=v.length;0<=--I;)v[I]=0}var p=0,w=29,b=256,_=b+1+w,h=30,x=19,d=2*_+1,f=15,m=16,y=7,E=256,j=16,S=17,z=18,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],L=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],G=new Array(2*(_+2));l(G);var k=new Array(2*h);l(k);var D=new Array(512);l(D);var o=new Array(256);l(o);var T=new Array(w);l(T);var U,P,Q,Z=new Array(h);function te(v,I,V,$,O){this.static_tree=v,this.extra_bits=I,this.extra_base=V,this.elems=$,this.max_length=O,this.has_stree=v&&v.length}function B(v,I){this.dyn_tree=v,this.max_code=0,this.stat_desc=I}function A(v){return v<256?D[v]:D[256+(v>>>7)]}function ee(v,I){v.pending_buf[v.pending++]=255&I,v.pending_buf[v.pending++]=I>>>8&255}function q(v,I,V){v.bi_valid>m-V?(v.bi_buf|=I<<v.bi_valid&65535,ee(v,v.bi_buf),v.bi_buf=I>>m-v.bi_valid,v.bi_valid+=V-m):(v.bi_buf|=I<<v.bi_valid&65535,v.bi_valid+=V)}function H(v,I,V){q(v,V[2*I],V[2*I+1])}function ae(v,I){for(var V=0;V|=1&v,v>>>=1,V<<=1,0<--I;);return V>>>1}function ce(v,I,V){var $,O,Y=new Array(f+1),X=0;for($=1;$<=f;$++)Y[$]=X=X+V[$-1]<<1;for(O=0;O<=I;O++){var K=v[2*O+1];K!==0&&(v[2*O]=ae(Y[K]++,K))}}function ne(v){var I;for(I=0;I<_;I++)v.dyn_ltree[2*I]=0;for(I=0;I<h;I++)v.dyn_dtree[2*I]=0;for(I=0;I<x;I++)v.bl_tree[2*I]=0;v.dyn_ltree[2*E]=1,v.opt_len=v.static_len=0,v.last_lit=v.matches=0}function ie(v){8<v.bi_valid?ee(v,v.bi_buf):0<v.bi_valid&&(v.pending_buf[v.pending++]=v.bi_buf),v.bi_buf=0,v.bi_valid=0}function he(v,I,V,$){var O=2*I,Y=2*V;return v[O]<v[Y]||v[O]===v[Y]&&$[I]<=$[V]}function de(v,I,V){for(var $=v.heap[V],O=V<<1;O<=v.heap_len&&(O<v.heap_len&&he(I,v.heap[O+1],v.heap[O],v.depth)&&O++,!he(I,$,v.heap[O],v.depth));)v.heap[V]=v.heap[O],V=O,O<<=1;v.heap[V]=$}function _e(v,I,V){var $,O,Y,X,K=0;if(v.last_lit!==0)for(;$=v.pending_buf[v.d_buf+2*K]<<8|v.pending_buf[v.d_buf+2*K+1],O=v.pending_buf[v.l_buf+K],K++,$===0?H(v,O,I):(H(v,(Y=o[O])+b+1,I),(X=R[Y])!==0&&q(v,O-=T[Y],X),H(v,Y=A(--$),V),(X=L[Y])!==0&&q(v,$-=Z[Y],X)),K<v.last_lit;);H(v,E,I)}function ye(v,I){var V,$,O,Y=I.dyn_tree,X=I.stat_desc.static_tree,K=I.stat_desc.has_stree,re=I.stat_desc.elems,oe=-1;for(v.heap_len=0,v.heap_max=d,V=0;V<re;V++)Y[2*V]!==0?(v.heap[++v.heap_len]=oe=V,v.depth[V]=0):Y[2*V+1]=0;for(;v.heap_len<2;)Y[2*(O=v.heap[++v.heap_len]=oe<2?++oe:0)]=1,v.depth[O]=0,v.opt_len--,K&&(v.static_len-=X[2*O+1]);for(I.max_code=oe,V=v.heap_len>>1;1<=V;V--)de(v,Y,V);for(O=re;V=v.heap[1],v.heap[1]=v.heap[v.heap_len--],de(v,Y,1),$=v.heap[1],v.heap[--v.heap_max]=V,v.heap[--v.heap_max]=$,Y[2*O]=Y[2*V]+Y[2*$],v.depth[O]=(v.depth[V]>=v.depth[$]?v.depth[V]:v.depth[$])+1,Y[2*V+1]=Y[2*$+1]=O,v.heap[1]=O++,de(v,Y,1),2<=v.heap_len;);v.heap[--v.heap_max]=v.heap[1],function(se,xe){var Ie,Ce,ze,ue,Ae,Ze,je=xe.dyn_tree,nt=xe.max_code,yt=xe.stat_desc.static_tree,vt=xe.stat_desc.has_stree,wt=xe.stat_desc.extra_bits,st=xe.stat_desc.extra_base,Re=xe.stat_desc.max_length,Te=0;for(ue=0;ue<=f;ue++)se.bl_count[ue]=0;for(je[2*se.heap[se.heap_max]+1]=0,Ie=se.heap_max+1;Ie<d;Ie++)Re<(ue=je[2*je[2*(Ce=se.heap[Ie])+1]+1]+1)&&(ue=Re,Te++),je[2*Ce+1]=ue,nt<Ce||(se.bl_count[ue]++,Ae=0,st<=Ce&&(Ae=wt[Ce-st]),Ze=je[2*Ce],se.opt_len+=Ze*(ue+Ae),vt&&(se.static_len+=Ze*(yt[2*Ce+1]+Ae)));if(Te!==0){do{for(ue=Re-1;se.bl_count[ue]===0;)ue--;se.bl_count[ue]--,se.bl_count[ue+1]+=2,se.bl_count[Re]--,Te-=2}while(0<Te);for(ue=Re;ue!==0;ue--)for(Ce=se.bl_count[ue];Ce!==0;)nt<(ze=se.heap[--Ie])||(je[2*ze+1]!==ue&&(se.opt_len+=(ue-je[2*ze+1])*je[2*ze],je[2*ze+1]=ue),Ce--)}}(v,I),ce(Y,oe,v.bl_count)}function a(v,I,V){var $,O,Y=-1,X=I[1],K=0,re=7,oe=4;for(X===0&&(re=138,oe=3),I[2*(V+1)+1]=65535,$=0;$<=V;$++)O=X,X=I[2*($+1)+1],++K<re&&O===X||(K<oe?v.bl_tree[2*O]+=K:O!==0?(O!==Y&&v.bl_tree[2*O]++,v.bl_tree[2*j]++):K<=10?v.bl_tree[2*S]++:v.bl_tree[2*z]++,Y=O,oe=(K=0)===X?(re=138,3):O===X?(re=6,3):(re=7,4))}function M(v,I,V){var $,O,Y=-1,X=I[1],K=0,re=7,oe=4;for(X===0&&(re=138,oe=3),$=0;$<=V;$++)if(O=X,X=I[2*($+1)+1],!(++K<re&&O===X)){if(K<oe)for(;H(v,O,v.bl_tree),--K!=0;);else O!==0?(O!==Y&&(H(v,O,v.bl_tree),K--),H(v,j,v.bl_tree),q(v,K-3,2)):K<=10?(H(v,S,v.bl_tree),q(v,K-3,3)):(H(v,z,v.bl_tree),q(v,K-11,7));Y=O,oe=(K=0)===X?(re=138,3):O===X?(re=6,3):(re=7,4)}}l(Z);var F=!1;function C(v,I,V,$){q(v,(p<<1)+($?1:0),3),function(O,Y,X,K){ie(O),ee(O,X),ee(O,~X),t.arraySet(O.pending_buf,O.window,Y,X,O.pending),O.pending+=X}(v,I,V)}r._tr_init=function(v){F||(function(){var I,V,$,O,Y,X=new Array(f+1);for(O=$=0;O<w-1;O++)for(T[O]=$,I=0;I<1<<R[O];I++)o[$++]=O;for(o[$-1]=O,O=Y=0;O<16;O++)for(Z[O]=Y,I=0;I<1<<L[O];I++)D[Y++]=O;for(Y>>=7;O<h;O++)for(Z[O]=Y<<7,I=0;I<1<<L[O]-7;I++)D[256+Y++]=O;for(V=0;V<=f;V++)X[V]=0;for(I=0;I<=143;)G[2*I+1]=8,I++,X[8]++;for(;I<=255;)G[2*I+1]=9,I++,X[9]++;for(;I<=279;)G[2*I+1]=7,I++,X[7]++;for(;I<=287;)G[2*I+1]=8,I++,X[8]++;for(ce(G,_+1,X),I=0;I<h;I++)k[2*I+1]=5,k[2*I]=ae(I,5);U=new te(G,R,b+1,_,f),P=new te(k,L,0,h,f),Q=new te(new Array(0),N,0,x,y)}(),F=!0),v.l_desc=new B(v.dyn_ltree,U),v.d_desc=new B(v.dyn_dtree,P),v.bl_desc=new B(v.bl_tree,Q),v.bi_buf=0,v.bi_valid=0,ne(v)},r._tr_stored_block=C,r._tr_flush_block=function(v,I,V,$){var O,Y,X=0;0<v.level?(v.strm.data_type===2&&(v.strm.data_type=function(K){var re,oe=4093624447;for(re=0;re<=31;re++,oe>>>=1)if(1&oe&&K.dyn_ltree[2*re]!==0)return i;if(K.dyn_ltree[18]!==0||K.dyn_ltree[20]!==0||K.dyn_ltree[26]!==0)return c;for(re=32;re<b;re++)if(K.dyn_ltree[2*re]!==0)return c;return i}(v)),ye(v,v.l_desc),ye(v,v.d_desc),X=function(K){var re;for(a(K,K.dyn_ltree,K.l_desc.max_code),a(K,K.dyn_dtree,K.d_desc.max_code),ye(K,K.bl_desc),re=x-1;3<=re&&K.bl_tree[2*W[re]+1]===0;re--);return K.opt_len+=3*(re+1)+5+5+4,re}(v),O=v.opt_len+3+7>>>3,(Y=v.static_len+3+7>>>3)<=O&&(O=Y)):O=Y=V+5,V+4<=O&&I!==-1?C(v,I,V,$):v.strategy===4||Y===O?(q(v,2+($?1:0),3),_e(v,G,k)):(q(v,4+($?1:0),3),function(K,re,oe,se){var xe;for(q(K,re-257,5),q(K,oe-1,5),q(K,se-4,4),xe=0;xe<se;xe++)q(K,K.bl_tree[2*W[xe]+1],3);M(K,K.dyn_ltree,re-1),M(K,K.dyn_dtree,oe-1)}(v,v.l_desc.max_code+1,v.d_desc.max_code+1,X+1),_e(v,v.dyn_ltree,v.dyn_dtree)),ne(v),$&&ie(v)},r._tr_tally=function(v,I,V){return v.pending_buf[v.d_buf+2*v.last_lit]=I>>>8&255,v.pending_buf[v.d_buf+2*v.last_lit+1]=255&I,v.pending_buf[v.l_buf+v.last_lit]=255&V,v.last_lit++,I===0?v.dyn_ltree[2*V]++:(v.matches++,I--,v.dyn_ltree[2*(o[V]+b+1)]++,v.dyn_dtree[2*A(I)]++),v.last_lit===v.lit_bufsize-1},r._tr_align=function(v){q(v,2,3),H(v,E,G),function(I){I.bi_valid===16?(ee(I,I.bi_buf),I.bi_buf=0,I.bi_valid=0):8<=I.bi_valid&&(I.pending_buf[I.pending++]=255&I.bi_buf,I.bi_buf>>=8,I.bi_valid-=8)}(v)}},{"../utils/common":41}],53:[function(e,s,r){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,s,r){(function(t){(function(i,c){if(!i.setImmediate){var l,p,w,b,_=1,h={},x=!1,d=i.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(i);f=f&&f.setTimeout?f:i,l={}.toString.call(i.process)==="[object process]"?function(j){process.nextTick(function(){y(j)})}:function(){if(i.postMessage&&!i.importScripts){var j=!0,S=i.onmessage;return i.onmessage=function(){j=!1},i.postMessage("","*"),i.onmessage=S,j}}()?(b="setImmediate$"+Math.random()+"$",i.addEventListener?i.addEventListener("message",E,!1):i.attachEvent("onmessage",E),function(j){i.postMessage(b+j,"*")}):i.MessageChannel?((w=new MessageChannel).port1.onmessage=function(j){y(j.data)},function(j){w.port2.postMessage(j)}):d&&"onreadystatechange"in d.createElement("script")?(p=d.documentElement,function(j){var S=d.createElement("script");S.onreadystatechange=function(){y(j),S.onreadystatechange=null,p.removeChild(S),S=null},p.appendChild(S)}):function(j){setTimeout(y,0,j)},f.setImmediate=function(j){typeof j!="function"&&(j=new Function(""+j));for(var S=new Array(arguments.length-1),z=0;z<S.length;z++)S[z]=arguments[z+1];var R={callback:j,args:S};return h[_]=R,l(_),_++},f.clearImmediate=m}function m(j){delete h[j]}function y(j){if(x)setTimeout(y,0,j);else{var S=h[j];if(S){x=!0;try{(function(z){var R=z.callback,L=z.args;switch(L.length){case 0:R();break;case 1:R(L[0]);break;case 2:R(L[0],L[1]);break;case 3:R(L[0],L[1],L[2]);break;default:R.apply(c,L)}})(S)}finally{m(j),x=!1}}}}function E(j){j.source===i&&typeof j.data=="string"&&j.data.indexOf(b)===0&&y(+j.data.slice(b.length))}})(typeof self>"u"?t===void 0?this:t:self)}).call(this,typeof Be<"u"?Be:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(xt);var xr=xt.exports;const br=St(xr);class yr{async exportToPDF(n,e){const s=this.getPageSize(e.pageSize),r=this.getOrientation(n,e.orientation),t=new Nt({orientation:r,unit:"mm",format:e.pageSize==="original"?[s.width,s.height]:e.pageSize});e.metadata&&(e.metadata.title&&t.setProperties({title:e.metadata.title}),e.metadata.author&&t.setProperties({author:e.metadata.author}),e.metadata.subject&&t.setProperties({subject:e.metadata.subject}));for(let i=0;i<n.pages.length;i++){const c=n.pages[i];i>0&&t.addPage();const l=await this.blobToDataURL(c.processedImage),p=t.internal.pageSize.getWidth(),w=t.internal.pageSize.getHeight();if(e.pageSize==="original"){const b=c.dimensions.width,_=c.dimensions.height,h=b/_;let x=p,d=p/h;d>w&&(d=w,x=w*h);const f=(p-x)/2,m=(w-d)/2;t.addImage(l,"JPEG",f,m,x,d)}else t.addImage(l,"JPEG",0,0,p,w);e.includeOCR&&c.ocrResult&&this.addTextLayer(t,c,p,w)}return t.output("blob")}async exportToImage(n,e){const s=document.createElement("canvas"),r=s.getContext("2d");if(!r)throw new Error("Failed to get canvas context");const t=await this.blobToImageData(n.processedImage);let i=t.width,c=t.height;if(e.maxDimension){const w=Math.max(i,c);if(w>e.maxDimension){const b=e.maxDimension/w;i=Math.round(i*b),c=Math.round(c*b)}}s.width=i,s.height=c;const l=document.createElement("canvas"),p=l.getContext("2d");if(!p)throw new Error("Failed to get temp canvas context");return l.width=t.width,l.height=t.height,p.putImageData(t,0,0),r.drawImage(l,0,0,i,c),new Promise((w,b)=>{s.toBlob(_=>{_?w(_):b(new Error("Failed to convert canvas to blob"))},e.format==="png"?"image/png":"image/jpeg",e.format==="jpeg"?e.quality/100:void 0)})}async exportMultipleImages(n,e){const s=[];for(const r of n.pages){const t=await this.exportToImage(r,e);s.push(t)}return s}async exportToText(n){const e=[];for(const r of n.pages)r.ocrResult&&e.push(`--- Page ${r.pageNumber} ---

${r.ocrResult.text}

`);if(e.length===0)throw new Error("No OCR text available in this document");const s=e.join(`
`);return new Blob([s],{type:"text/plain"})}downloadBlob(n,e){const s=URL.createObjectURL(n),r=document.createElement("a");r.href=s,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}async share(n,e,s){if(!navigator.share||!navigator.canShare)throw new Error("Web Share API not supported");const r=new File([n],e,{type:n.type});if(!navigator.canShare({files:[r]}))throw new Error("Cannot share this file type");await navigator.share({title:s,files:[r]})}async blobToDataURL(n){return new Promise((e,s)=>{const r=new FileReader;r.onloadend=()=>e(r.result),r.onerror=s,r.readAsDataURL(n)})}async blobToImageData(n){return new Promise((e,s)=>{const r=new Image;r.onload=()=>{const t=document.createElement("canvas"),i=t.getContext("2d");if(!i){s(new Error("Failed to get canvas context"));return}t.width=r.width,t.height=r.height,i.drawImage(r,0,0);const c=i.getImageData(0,0,r.width,r.height);e(c)},r.onerror=s,r.src=URL.createObjectURL(n)})}getPageSize(n){switch(n){case"a4":return{width:210,height:297};case"letter":return{width:216,height:279};case"legal":return{width:216,height:356};default:return{width:210,height:297}}}getOrientation(n,e){if(e!=="auto")return e;const s=n.pages[0];return s&&s.dimensions.width>s.dimensions.height?"landscape":"portrait"}addTextLayer(n,e,s,r){if(!e.ocrResult)return;const t=s/e.dimensions.width,i=r/e.dimensions.height;n.setTextColor(255,255,255),n.setFontSize(8);for(const c of e.ocrResult.words){const l=c.boundingBox.x*t,p=c.boundingBox.y*i;n.text(c.text,l,p,{renderingMode:"invisible"})}}}let Ke=null;function bt(){return Ke||(Ke=new yr),Ke}class vr{constructor(){pe(this,"exportService",bt())}async exportDocumentsAsZip(n,e,s){if(n.length===0)throw new Error("No documents selected for export");const r=new br;for(let t=0;t<n.length;t++){const i=n[t];s&&s({current:t+1,total:n.length,currentDocumentName:i.name});const c=this.sanitizeFilename(i.name);if(e.format==="pdf"){const l=await this.exportService.exportToPDF(i,e.pdfOptions||this.getDefaultPDFOptions());r.file(`${c}.pdf`,l)}else{const l=await this.exportService.exportMultipleImages(i,e.imageOptions||this.getDefaultImageOptions());if(l.length>1){const p=r.folder(c);p&&l.forEach((w,b)=>{const _=e.imageOptions?.format==="jpeg"?"jpg":"png";p.file(`page_${b+1}.${_}`,w)})}else if(l.length===1){const p=e.imageOptions?.format==="jpeg"?"jpg":"png";r.file(`${c}.${p}`,l[0])}}}return await r.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:6}})}async exportSelectedDocuments(n,e,s,r){const t=e.filter(i=>n.includes(i.id));return this.exportDocumentsAsZip(t,s,r)}getDefaultPDFOptions(){return{pageSize:"a4",orientation:"auto",quality:"high",includeOCR:!1,compression:!0}}getDefaultImageOptions(){return{format:"png",quality:90}}sanitizeFilename(n){return n.replace(/[^a-z0-9_\-\s]/gi,"_").replace(/\s+/g,"_").substring(0,100)}generateZipFilename(n,e){const s=new Date().toISOString().split("T")[0];return`documents_${n}_${e==="pdf"?"PDFs":"Images"}_${s}.zip`}}let qe=null;function wr(){return qe||(qe=new vr),qe}const _r=({compact:g=!1})=>{const[n,e]=J.useState(null),[s,r]=J.useState(!0);J.useEffect(()=>{t()},[]);const t=async()=>{try{const p=await(await Se()).getStorageUsage();e(p)}catch(l){console.error("Failed to load storage usage:",l)}finally{r(!1)}},i=l=>{if(l===0)return"0 Bytes";const p=1024,w=["Bytes","KB","MB","GB"],b=Math.floor(Math.log(l)/Math.log(p));return Math.round(l/Math.pow(p,b)*100)/100+" "+w[b]};if(s)return g?u.jsx("span",{className:"text-xs text-gray-500",children:"Loading..."}):u.jsx("div",{className:"text-sm text-gray-600",children:"Loading storage info..."});if(!n||n.quota===0)return g?u.jsx("span",{className:"text-xs text-gray-500",children:"Storage: N/A"}):u.jsx("div",{className:"text-sm text-gray-600",children:"Storage information not available"});const c=l=>l<50?"bg-green-500":l<80?"bg-yellow-500":"bg-red-500";return g?u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsxs("span",{className:"text-xs text-gray-600",children:[i(n.used)," / ",i(n.quota)]}),u.jsx("div",{className:"w-16 h-2 bg-gray-200 rounded-full overflow-hidden",children:u.jsx("div",{className:`h-full ${c(n.percentage)} transition-all duration-300`,style:{width:`${Math.min(n.percentage,100)}%`}})})]}):u.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[u.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"Storage Usage"}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("div",{className:"flex items-center justify-between text-sm",children:[u.jsx("span",{className:"text-gray-600",children:"Used"}),u.jsx("span",{className:"font-medium",children:i(n.used)})]}),u.jsxs("div",{className:"flex items-center justify-between text-sm",children:[u.jsx("span",{className:"text-gray-600",children:"Total"}),u.jsx("span",{className:"font-medium",children:i(n.quota)})]}),u.jsxs("div",{className:"flex items-center justify-between text-sm",children:[u.jsx("span",{className:"text-gray-600",children:"Used"}),u.jsxs("span",{className:"font-medium",children:[n.percentage.toFixed(1),"%"]})]}),u.jsx("div",{className:"w-full h-3 bg-gray-200 rounded-full overflow-hidden mt-2",children:u.jsx("div",{className:`h-full ${c(n.percentage)} transition-all duration-300`,style:{width:`${Math.min(n.percentage,100)}%`}})}),n.percentage>80&&u.jsx("div",{className:"mt-2 text-xs text-orange-600 bg-orange-50 p-2 rounded",children:"âš ï¸ Storage is running low. Consider deleting old documents."})]})]})},Cr=()=>{const{documents:g,selectedDocumentIds:n,setDocuments:e,setCurrentDocument:s,removeDocument:r,toggleDocumentSelection:t,clearDocumentSelection:i,selectAllDocuments:c,setCurrentView:l,addToast:p}=ge(U=>({documents:U.documents.list,selectedDocumentIds:U.documents.selectedDocumentIds,setDocuments:U.setDocuments,setCurrentDocument:U.setCurrentDocument,removeDocument:U.removeDocument,toggleDocumentSelection:U.toggleDocumentSelection,clearDocumentSelection:U.clearDocumentSelection,selectAllDocuments:U.selectAllDocuments,setCurrentView:U.setCurrentView,addToast:U.addToast})),[w,b]=J.useState(!0),[_,h]=J.useState(new Map),[x,d]=J.useState(!1),[f,m]=J.useState(!1),[y,E]=J.useState({current:0,total:0}),[j,S]=J.useState(""),[z,R]=J.useState([]);J.useEffect(()=>{L()},[]),J.useEffect(()=>{g.length>0&&N()},[g]),J.useEffect(()=>{if(!j.trim())R(g);else{const U=j.toLowerCase(),P=g.filter(Q=>{if(Q.name.toLowerCase().includes(U)||Q.tags.some(Z=>Z.toLowerCase().includes(U)))return!0;if(Q.metadata.hasOCR){for(const Z of Q.pages)if(Z.ocrResult&&Z.ocrResult.text.toLowerCase().includes(U))return!0}return!1});R(P)}},[g,j]);const L=async()=>{try{const P=await(await Se()).listDocuments({sortBy:"updatedAt",sortOrder:"desc"});e(P)}catch(U){console.error("Failed to load documents:",U),p({type:"error",message:"Failed to load documents"})}finally{b(!1)}},N=async()=>{const U=new Map;for(const P of g)if(P.pages.length>0){const Q=P.pages[0],Z=URL.createObjectURL(Q.thumbnailImage);U.set(P.id,Z)}return h(U),()=>{_.forEach(P=>URL.revokeObjectURL(P))}},W=U=>{x?t(U.id):(s(U),l("detail"))},G=()=>{x&&i(),d(!x)},k=()=>{n.length===g.length?i():c()},D=async U=>{if(n.length===0){p({type:"error",message:"No documents selected"});return}try{m(!0),E({current:0,total:n.length});const P=wr(),Q=g.filter(H=>n.includes(H.id)),Z={pageSize:"a4",orientation:"auto",quality:"high",includeOCR:!1,compression:!0},te={format:"png",quality:90},B=await P.exportDocumentsAsZip(Q,{format:U,pdfOptions:Z,imageOptions:te},H=>{E({current:H.current,total:H.total})}),A=P.generateZipFilename(n.length,U),ee=URL.createObjectURL(B),q=document.createElement("a");q.href=ee,q.download=A,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(ee),p({type:"success",message:`Successfully exported ${n.length} document${n.length!==1?"s":""}`}),d(!1),i()}catch(P){console.error("Bulk export failed:",P),p({type:"error",message:"Failed to export documents"})}finally{m(!1),E({current:0,total:0})}},o=async(U,P)=>{if(U.stopPropagation(),!!confirm("Are you sure you want to delete this document?"))try{await(await Se()).deleteDocument(P),r(P),p({type:"success",message:"Document deleted"})}catch(Q){console.error("Failed to delete document:",Q),p({type:"error",message:"Failed to delete document"})}},T=async(U,P)=>{U.stopPropagation(),s(P),l("ocr")};return w?u.jsx("div",{className:"flex items-center justify-center h-full bg-gray-50",children:u.jsxs("div",{className:"text-center",children:[u.jsx(Ne,{size:"lg"}),u.jsx("p",{className:"text-sm text-gray-600 mt-4",children:"Loading documents..."})]})}):g.length===0?u.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-50 p-6",children:[u.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“"}),u.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Documents Yet"}),u.jsx("p",{className:"text-sm text-gray-600 mb-6 text-center max-w-md",children:"Start by scanning your first document using the camera."}),u.jsx(le,{onClick:()=>l("camera"),variant:"primary",size:"lg",children:"Scan Document"})]}):u.jsxs("div",{className:"h-full bg-gray-50 flex flex-col",children:[u.jsxs("div",{className:"bg-white border-b border-gray-200 p-4",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx("h2",{className:"text-lg font-semibold",children:"My Documents"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx(le,{onClick:G,variant:x?"secondary":"outline",size:"sm",children:x?"Cancel":"Select"}),!x&&u.jsx(le,{onClick:()=>l("camera"),variant:"primary",size:"sm",children:"+ New Scan"})]})]}),!x&&g.length>0&&u.jsx("div",{className:"mt-3",children:u.jsx("input",{type:"text",value:j,onChange:U=>S(U.target.value),placeholder:"Search documents, tags, or text...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})}),u.jsxs("div",{className:"flex items-center justify-between mt-2",children:[u.jsx("p",{className:"text-sm text-gray-600",children:x&&n.length>0?`${n.length} selected`:j?`${z.length} of ${g.length} document${g.length!==1?"s":""}`:`${g.length} document${g.length!==1?"s":""}`}),x&&u.jsx("button",{onClick:k,className:"text-sm text-blue-600 hover:text-blue-700",children:n.length===g.length?"Deselect All":"Select All"})]}),!x&&u.jsx("div",{className:"mt-3",children:u.jsx(_r,{compact:!0})})]}),u.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:u.jsx("div",{className:"grid grid-cols-2 gap-4",children:z.map(U=>{const P=n.includes(U.id);return u.jsxs("div",{onClick:()=>W(U),className:`bg-white rounded-lg shadow hover:shadow-lg transition-all cursor-pointer overflow-hidden ${P?"ring-2 ring-blue-500":""}`,children:[u.jsxs("div",{className:"aspect-[3/4] bg-gray-200 relative overflow-hidden",children:[_.has(U.id)?u.jsx("img",{src:_.get(U.id),alt:U.name,className:"w-full h-full object-cover"}):u.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:u.jsx("span",{className:"text-4xl",children:"ðŸ“„"})}),x&&u.jsx("div",{className:"absolute top-2 left-2",children:u.jsx("input",{type:"checkbox",checked:P,onChange:()=>t(U.id),onClick:Q=>Q.stopPropagation(),className:"w-6 h-6 cursor-pointer"})}),!x&&u.jsx("button",{onClick:Q=>o(Q,U.id),className:"absolute top-2 right-2 w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center shadow-lg transition-colors",title:"Delete document",children:"Ã—"})]}),u.jsxs("div",{className:"p-3",children:[u.jsx("h3",{className:"text-sm font-medium truncate mb-1",children:U.name}),u.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[u.jsxs("span",{children:[U.pages.length," page",U.pages.length!==1?"s":""]}),u.jsx("span",{children:U.metadata.hasOCR?"âœ“ OCR":""})]}),u.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(U.updatedAt).toLocaleDateString()}),!x&&u.jsxs("div",{className:"flex gap-2 mt-2",children:[!U.metadata.hasOCR&&u.jsx("button",{onClick:Q=>T(Q,U),className:"flex-1 px-2 py-1 text-xs bg-blue-50 text-blue-600 rounded hover:bg-blue-100 transition-colors",children:"Extract Text"}),u.jsx("button",{onClick:Q=>{Q.stopPropagation(),s(U),l("export")},className:"flex-1 px-2 py-1 text-xs bg-green-50 text-green-600 rounded hover:bg-green-100 transition-colors",children:"Export"})]})]})]},U.id)})})}),x&&n.length>0&&u.jsx("div",{className:"bg-white border-t border-gray-200 p-4 shadow-lg",children:f?u.jsxs("div",{className:"text-center",children:[u.jsx(Ne,{size:"sm"}),u.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Exporting ",y.current," of ",y.total,"..."]})]}):u.jsxs("div",{className:"flex gap-2",children:[u.jsx(le,{onClick:()=>D("pdf"),variant:"primary",size:"md",className:"flex-1",children:"ðŸ“„ Export as PDFs"}),u.jsx(le,{onClick:()=>D("images"),variant:"secondary",size:"md",className:"flex-1",children:"ðŸ–¼ï¸ Export as Images"})]})})]})},kr=()=>{const{currentDocument:g,setCurrentDocument:n,setDocuments:e,setCurrentView:s,addToast:r}=ge(D=>({currentDocument:D.documents.currentDocument,setCurrentDocument:D.setCurrentDocument,setDocuments:D.setDocuments,setCurrentView:D.setCurrentView,addToast:D.addToast})),[t,i]=J.useState(!1),[c,l]=J.useState(!1),[p,w]=J.useState(""),[b,_]=J.useState(new Map),[h,x]=J.useState(""),[d,f]=J.useState(null),[m,y]=J.useState(null);J.useEffect(()=>{g&&(w(g.name),E())},[g]);const E=async()=>{if(!g)return;const D=new Map;for(const o of g.pages){const T=URL.createObjectURL(o.thumbnailImage);D.set(o.id,T)}return _(D),()=>{b.forEach(o=>URL.revokeObjectURL(o))}},j=async()=>{if(!g||!p.trim()){r({type:"error",message:"Document name cannot be empty"});return}try{const D={...g,name:p.trim(),updatedAt:new Date},o=await Se();await o.updateDocument(D),n(D);const T=await o.listDocuments({sortBy:"updatedAt",sortOrder:"desc"});e(T),l(!1),r({type:"success",message:"Document name updated"})}catch(D){console.error("Failed to update document name:",D),r({type:"error",message:"Failed to update document name"})}},S=async()=>{if(!g||!h.trim())return;const D=h.trim();if(g.tags.includes(D)){r({type:"warning",message:"Tag already exists"});return}try{const o={...g,tags:[...g.tags,D],updatedAt:new Date},T=await Se();await T.updateDocument(o),n(o);const U=await T.listDocuments({sortBy:"updatedAt",sortOrder:"desc"});e(U),x(""),r({type:"success",message:"Tag added"})}catch(o){console.error("Failed to add tag:",o),r({type:"error",message:"Failed to add tag"})}},z=async D=>{if(g)try{const o={...g,tags:g.tags.filter(P=>P!==D),updatedAt:new Date},T=await Se();await T.updateDocument(o),n(o);const U=await T.listDocuments({sortBy:"updatedAt",sortOrder:"desc"});e(U),r({type:"success",message:"Tag removed"})}catch(o){console.error("Failed to remove tag:",o),r({type:"error",message:"Failed to remove tag"})}},R=async D=>{if(g){if(g.pages.length===1){r({type:"error",message:"Cannot delete the last page. Delete the document instead."});return}if(confirm("Are you sure you want to delete this page?"))try{i(!0);const o=await Se();await o.removePage(g.id,D);const T=await o.getDocument(g.id);T&&n(T);const U=await o.listDocuments({sortBy:"updatedAt",sortOrder:"desc"});e(U),r({type:"success",message:"Page deleted"})}catch(o){console.error("Failed to delete page:",o),r({type:"error",message:"Failed to delete page"})}finally{i(!1)}}},L=D=>{f(D)},N=(D,o)=>{D.preventDefault(),y(o)},W=async(D,o)=>{if(D.preventDefault(),!g||d===null||d===o){f(null),y(null);return}try{i(!0);const T=[...g.pages],[U]=T.splice(d,1);T.splice(o,0,U);const P=T.map(B=>B.id),Q=await Se();await Q.reorderPages(g.id,P);const Z=await Q.getDocument(g.id);Z&&n(Z);const te=await Q.listDocuments({sortBy:"updatedAt",sortOrder:"desc"});e(te),r({type:"success",message:"Pages reordered"})}catch(T){console.error("Failed to reorder pages:",T),r({type:"error",message:"Failed to reorder pages"})}finally{i(!1),f(null),y(null)}},G=()=>{g&&s("export")},k=()=>{g&&s("ocr")};return g?u.jsxs("div",{className:"h-full bg-gray-50 flex flex-col",children:[u.jsxs("div",{className:"bg-white border-b border-gray-200 p-4",children:[u.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[u.jsx(Oe,{icon:"â†",onClick:()=>s("documents"),title:"Back to documents",size:"md"}),u.jsx("div",{className:"flex-1",children:c?u.jsxs("div",{className:"flex gap-2",children:[u.jsx("input",{type:"text",value:p,onChange:D=>w(D.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0,onKeyPress:D=>{D.key==="Enter"&&j()}}),u.jsx(le,{onClick:j,variant:"primary",size:"sm",children:"Save"}),u.jsx(le,{onClick:()=>{w(g.name),l(!1)},variant:"secondary",size:"sm",children:"Cancel"})]}):u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("h2",{className:"text-lg font-semibold",children:g.name}),u.jsx(Oe,{icon:"âœï¸",onClick:()=>l(!0),title:"Edit name",size:"sm"})]})})]}),u.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[u.jsxs("div",{children:[g.pages.length," page",g.pages.length!==1?"s":""]}),u.jsxs("div",{children:["Created: ",new Date(g.createdAt).toLocaleString()]}),u.jsxs("div",{children:["Updated: ",new Date(g.updatedAt).toLocaleString()]}),g.metadata.hasOCR&&u.jsx("div",{className:"text-green-600",children:"âœ“ OCR completed"})]}),u.jsxs("div",{className:"mt-3",children:[u.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Tags"}),u.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:g.tags.map(D=>u.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs",children:[D,u.jsx("button",{onClick:()=>z(D),className:"hover:text-blue-900",children:"Ã—"})]},D))}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("input",{type:"text",value:h,onChange:D=>x(D.target.value),placeholder:"Add tag...",className:"flex-1 px-3 py-1 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyPress:D=>{D.key==="Enter"&&S()}}),u.jsx(le,{onClick:S,variant:"secondary",size:"sm",children:"Add"})]})]}),u.jsxs("div",{className:"flex gap-2 mt-3",children:[!g.metadata.hasOCR&&u.jsx(le,{onClick:k,variant:"secondary",size:"sm",fullWidth:!0,children:"Extract Text"}),u.jsx(le,{onClick:G,variant:"primary",size:"sm",fullWidth:!0,children:"Export"})]})]}),u.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[u.jsx("div",{className:"mb-3 text-sm text-gray-600",children:"Drag and drop pages to reorder them"}),u.jsx("div",{className:"grid grid-cols-2 gap-4",children:g.pages.map((D,o)=>u.jsxs("div",{draggable:!0,onDragStart:()=>L(o),onDragOver:T=>N(T,o),onDrop:T=>W(T,o),className:`bg-white rounded-lg shadow hover:shadow-lg transition-all cursor-move ${m===o&&d!==o?"ring-2 ring-blue-500":""} ${d===o?"opacity-50":""}`,children:[u.jsxs("div",{className:"aspect-[3/4] bg-gray-200 relative overflow-hidden rounded-t-lg",children:[b.has(D.id)?u.jsx("img",{src:b.get(D.id),alt:`Page ${D.pageNumber}`,className:"w-full h-full object-cover"}):u.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:u.jsx("span",{className:"text-4xl",children:"ðŸ“„"})}),u.jsx("button",{onClick:()=>R(D.id),className:"absolute top-2 right-2 w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center shadow-lg transition-colors",title:"Delete page",children:"Ã—"}),u.jsxs("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-black/70 text-white text-xs rounded",children:["Page ",D.pageNumber]})]}),u.jsxs("div",{className:"p-2 text-xs text-gray-600",children:[u.jsxs("div",{children:["Filter: ",D.filterApplied]}),D.ocrResult&&u.jsx("div",{className:"text-green-600 mt-1",children:"âœ“ OCR available"})]})]},D.id))})]}),t&&u.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:u.jsxs("div",{className:"bg-white rounded-lg p-4 flex items-center gap-3",children:[u.jsx(Ne,{size:"sm"}),u.jsx("span",{className:"text-sm text-gray-700",children:"Processing..."})]})})]}):u.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-50 p-6",children:[u.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“„"}),u.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Document Selected"}),u.jsx(le,{onClick:()=>s("documents"),variant:"primary",size:"lg",children:"Back to Documents"})]})};class Sr{constructor(){pe(this,"worker",null);pe(this,"isInitialized",!1);pe(this,"currentLanguages",["eng"])}async initialize(n=["eng"],e){if(!(this.isInitialized&&this.arraysEqual(n,this.currentLanguages))){this.worker&&await this.terminate();try{this.worker=await Dt.createWorker(n.join("+"),1,{logger:s=>{e&&e({status:s.status,progress:s.progress||0})}}),this.currentLanguages=n,this.isInitialized=!0}catch(s){throw console.error("Failed to initialize OCR worker:",s),new Error("Failed to initialize OCR service")}}}async recognize(n,e){if(!this.worker||!this.isInitialized)throw new Error("OCR service not initialized");const s=performance.now();try{e&&(e.pageSegMode!==void 0&&await this.worker.setParameters({tessedit_pageseg_mode:e.pageSegMode}),e.preserveInterwordSpaces!==void 0&&await this.worker.setParameters({preserve_interword_spaces:e.preserveInterwordSpaces?"1":"0"}),e.characterWhitelist&&await this.worker.setParameters({tessedit_char_whitelist:e.characterWhitelist}),e.characterBlacklist&&await this.worker.setParameters({tessedit_char_blacklist:e.characterBlacklist}));const r=await this.worker.recognize(n),t=performance.now()-s;return this.formatResult(r.data,t)}catch(r){throw console.error("OCR recognition failed:",r),new Error("Failed to perform OCR")}}async detectOrientation(n){if(!this.worker||!this.isInitialized)throw new Error("OCR service not initialized");try{const e=await this.worker.detect(n);return{degrees:e.data.orientation_degrees||0,confidence:e.data.orientation_confidence||0,script:e.data.script||"Latin"}}catch(e){throw console.error("Orientation detection failed:",e),new Error("Failed to detect orientation")}}preprocessForOCR(n){const e=document.createElement("canvas"),s=e.getContext("2d");if(!s)throw new Error("Failed to get canvas context");e.width=n.width,e.height=n.height,s.putImageData(n,0,0);const r=n.data;for(let t=0;t<r.length;t+=4){const i=r[t]*.299+r[t+1]*.587+r[t+2]*.114;r[t]=i,r[t+1]=i,r[t+2]=i}return n}async terminate(){this.worker&&(await this.worker.terminate(),this.worker=null,this.isInitialized=!1)}formatResult(n,e){return{text:n.text,confidence:n.confidence,words:n.words.map(s=>({text:s.text,confidence:s.confidence,boundingBox:{x:s.bbox.x0,y:s.bbox.y0,width:s.bbox.x1-s.bbox.x0,height:s.bbox.y1-s.bbox.y0},baseline:{x0:s.baseline.x0,y0:s.baseline.y0,x1:s.baseline.x1,y1:s.baseline.y1}})),lines:n.lines.map(s=>({text:s.text,confidence:s.confidence,boundingBox:{x:s.bbox.x0,y:s.bbox.y0,width:s.bbox.x1-s.bbox.x0,height:s.bbox.y1-s.bbox.y0},words:s.words.map(r=>({text:r.text,confidence:r.confidence,boundingBox:{x:r.bbox.x0,y:r.bbox.y0,width:r.bbox.x1-r.bbox.x0,height:r.bbox.y1-r.bbox.y0},baseline:{x0:r.baseline.x0,y0:r.baseline.y0,x1:r.baseline.x1,y1:r.baseline.y1}}))})),paragraphs:n.paragraphs.map(s=>({text:s.text,confidence:s.confidence,boundingBox:{x:s.bbox.x0,y:s.bbox.y0,width:s.bbox.x1-s.bbox.x0,height:s.bbox.y1-s.bbox.y0},lines:s.lines.map(r=>({text:r.text,confidence:r.confidence,boundingBox:{x:r.bbox.x0,y:r.bbox.y0,width:r.bbox.x1-r.bbox.x0,height:r.bbox.y1-r.bbox.y0},words:r.words.map(t=>({text:t.text,confidence:t.confidence,boundingBox:{x:t.bbox.x0,y:t.bbox.y0,width:t.bbox.x1-t.bbox.x0,height:t.bbox.y1-t.bbox.y0},baseline:{x0:t.baseline.x0,y0:t.baseline.y0,x1:t.baseline.x1,y1:t.baseline.y1}}))}))})),blocks:(n.blocks||[]).map(s=>({text:s.text,confidence:s.confidence,boundingBox:{x:s.bbox.x0,y:s.bbox.y0,width:s.bbox.x1-s.bbox.x0,height:s.bbox.y1-s.bbox.y0},paragraphs:s.paragraphs.map(r=>({text:r.text,confidence:r.confidence,boundingBox:{x:r.bbox.x0,y:r.bbox.y0,width:r.bbox.x1-r.bbox.x0,height:r.bbox.y1-r.bbox.y0},lines:r.lines.map(t=>({text:t.text,confidence:t.confidence,boundingBox:{x:t.bbox.x0,y:t.bbox.y0,width:t.bbox.x1-t.bbox.x0,height:t.bbox.y1-t.bbox.y0},words:t.words.map(i=>({text:i.text,confidence:i.confidence,boundingBox:{x:i.bbox.x0,y:i.bbox.y0,width:i.bbox.x1-i.bbox.x0,height:i.bbox.y1-i.bbox.y0},baseline:{x0:i.baseline.x0,y0:i.baseline.y0,x1:i.baseline.x1,y1:i.baseline.y1}}))}))}))})),processingTime:e}}arraysEqual(n,e){return n.length!==e.length?!1:n.every((s,r)=>s===e[r])}}let Xe=null;function jr(){return Xe||(Xe=new Sr),Xe}const ht=[{code:"eng",name:"English",tier:1},{code:"spa",name:"Spanish",tier:1},{code:"fra",name:"French",tier:1},{code:"deu",name:"German",tier:1},{code:"ita",name:"Italian",tier:1},{code:"por",name:"Portuguese",tier:1},{code:"rus",name:"Russian",tier:1},{code:"jpn",name:"Japanese",tier:1},{code:"chi_sim",name:"Chinese Simplified",tier:1},{code:"kor",name:"Korean",tier:1}],Er=()=>{const{currentDocument:g,processedImage:n,isProcessing:e,progress:s,result:r,selectedLanguages:t,isInitialized:i,setOCRInitialized:c,setOCRProcessing:l,setOCRProgress:p,setOCRResult:w,setSelectedLanguages:b,setCurrentDocument:_,setDocuments:h,setCurrentView:x,addToast:d}=ge(G=>({currentDocument:G.documents.currentDocument,processedImage:G.scanSession.processedImage,isProcessing:G.ocr.isProcessing,progress:G.ocr.progress,result:G.ocr.result,selectedLanguages:G.ocr.selectedLanguages,isInitialized:G.ocr.isInitialized,setOCRInitialized:G.setOCRInitialized,setOCRProcessing:G.setOCRProcessing,setOCRProgress:G.setOCRProgress,setOCRResult:G.setOCRResult,setSelectedLanguages:G.setSelectedLanguages,setCurrentDocument:G.setCurrentDocument,setDocuments:G.setDocuments,setCurrentView:G.setCurrentView,addToast:G.addToast})),[f,m]=J.useState(""),[y,E]=J.useState(!1),j=J.useRef(null),S=jr();J.useEffect(()=>{(async()=>{if(!i)try{l(!0),await S.initialize(t,k=>{p(k.progress*100)}),c(!0),l(!1),p(0)}catch(k){console.error("Failed to initialize OCR:",k),d({type:"error",message:"Failed to initialize OCR service"}),l(!1)}})()},[]),J.useEffect(()=>{(async()=>{if(g&&g.pages.length>0&&!n)try{const k=g.pages[0],D=new Image;D.onload=()=>{const o=document.createElement("canvas"),T=o.getContext("2d");if(T){o.width=D.width,o.height=D.height,T.drawImage(D,0,0);const U=T.getImageData(0,0,D.width,D.height);if(j.current){const P=j.current.getContext("2d");P&&(j.current.width=U.width,j.current.height=U.height,P.putImageData(U,0,0))}}},D.src=URL.createObjectURL(k.processedImage),k.ocrResult&&w(k.ocrResult)}catch(k){console.error("Failed to load document image:",k)}})()},[g]),J.useEffect(()=>{if(n&&j.current){const G=j.current,k=G.getContext("2d");k&&(G.width=n.width,G.height=n.height,k.putImageData(n,0,0))}},[n]),J.useEffect(()=>{r&&m(r.text)},[r]);const z=async()=>{const G=n||(g&&j.current?j.current.getContext("2d")?.getImageData(0,0,j.current.width,j.current.height):null);if(!G){d({type:"error",message:"No image to process"});return}try{l(!0),p(0);const k=await S.recognize(G,{pageSegMode:3,preserveInterwordSpaces:!0});p(100),w(k),l(!1),p(0),g&&await R(k),d({type:"success",message:`Text extracted with ${k.confidence.toFixed(1)}% confidence`})}catch(k){console.error("OCR failed:",k),d({type:"error",message:"Failed to extract text from image"}),l(!1),p(0)}},R=async G=>{if(!g){d({type:"warning",message:"No document to save OCR results to"});return}const k=G||r;if(!k){d({type:"error",message:"No OCR results to save"});return}try{const D={...g,pages:g.pages.map((U,P)=>P===0?{...U,ocrResult:k}:U),metadata:{...g.metadata,hasOCR:!0},updatedAt:new Date},o=await Se();await o.updateDocument(D),_(D);const T=await o.listDocuments({sortBy:"updatedAt",sortOrder:"desc"});h(T),d({type:"success",message:"OCR results saved to document"})}catch(D){console.error("Failed to save OCR results:",D),d({type:"error",message:"Failed to save OCR results"})}},L=G=>{const k=t.includes(G)?t.filter(D=>D!==G):[...t,G];if(k.length===0){d({type:"warning",message:"At least one language must be selected"});return}b(k),c(!1)},N=()=>{f&&(navigator.clipboard.writeText(f),d({type:"success",message:"Text copied to clipboard"}))},W=async()=>{if(f)if(navigator.share)try{await navigator.share({text:f,title:"Extracted Text"})}catch{}else N()};return n?u.jsxs("div",{className:"flex flex-col h-full bg-white",children:[u.jsx("div",{className:"flex-shrink-0 bg-gray-900 relative overflow-hidden",style:{height:"30%"},children:u.jsx("canvas",{ref:j,className:"absolute inset-0 w-full h-full object-contain"})}),u.jsxs("div",{className:"flex-shrink-0 bg-white border-b border-gray-200 p-3",children:[u.jsxs("div",{className:"flex items-center justify-between gap-2",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(le,{onClick:z,disabled:e||!i,variant:"primary",size:"md",children:e?"Processing...":r?"Re-scan Text":"Extract Text"}),u.jsx("button",{onClick:()=>E(!y),className:"px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:e,children:t.length===1?ht.find(G=>G.code===t[0])?.name:`${t.length} languages`})]}),r&&u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(Oe,{icon:"ðŸ“‹",onClick:N,title:"Copy text",size:"md"}),u.jsx(Oe,{icon:"ðŸ“¤",onClick:W,title:"Share text",size:"md"})]})]}),e&&u.jsxs("div",{className:"mt-3",children:[u.jsxs("div",{className:"flex items-center justify-between mb-1",children:[u.jsx("span",{className:"text-xs text-gray-600",children:s<100?"Initializing...":"Recognizing text..."}),u.jsxs("span",{className:"text-xs text-gray-600",children:[Math.round(s),"%"]})]}),u.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:u.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${s}%`}})})]}),y&&u.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[u.jsx("h3",{className:"text-sm font-medium mb-2",children:"Select Languages"}),u.jsx("div",{className:"grid grid-cols-2 gap-2",children:ht.map(G=>u.jsxs("label",{className:"flex items-center gap-2 p-2 rounded hover:bg-gray-100 cursor-pointer",children:[u.jsx("input",{type:"checkbox",checked:t.includes(G.code),onChange:()=>L(G.code),className:"rounded border-gray-300",disabled:e}),u.jsx("span",{className:"text-sm",children:G.name})]},G.code))})]}),r&&!e&&u.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Confidence: ",r.confidence.toFixed(1),"% â€¢ ",r.words.length," words detected"]})]}),u.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col p-4 bg-gray-50",children:[!r&&!e&&u.jsx("div",{className:"flex-1 flex items-center justify-center text-center",children:u.jsxs("div",{children:[u.jsx("div",{className:"text-4xl mb-2",children:"ðŸ”"}),u.jsx("p",{className:"text-gray-600 text-sm",children:'Click "Extract Text" to start OCR'})]})}),e&&u.jsx("div",{className:"flex-1 flex items-center justify-center",children:u.jsxs("div",{className:"text-center",children:[u.jsx(Ne,{size:"lg"}),u.jsx("p",{className:"text-sm text-gray-600 mt-4",children:"Extracting text from document..."})]})}),r&&!e&&u.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[u.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2",children:"Extracted Text (editable)"}),u.jsx("textarea",{value:f,onChange:G=>m(G.target.value),className:"flex-1 w-full p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Extracted text will appear here..."})]})]})]}):u.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-50 p-6",children:[u.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“„"}),u.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Image to Process"}),u.jsx("p",{className:"text-sm text-gray-600 mb-6 text-center max-w-md",children:"Capture and enhance a document first before extracting text."}),u.jsx(le,{onClick:()=>x("camera"),variant:"primary",size:"lg",children:"Go to Camera"})]})},Dr=()=>{const{currentDocument:g,setCurrentView:n,addToast:e}=ge(f=>({currentDocument:f.documents.currentDocument,setCurrentView:f.setCurrentView,addToast:f.addToast})),[s,r]=J.useState("pdf"),[t,i]=J.useState(!1),[c,l]=J.useState(0),[p,w]=J.useState({pageSize:"a4",orientation:"auto",quality:"high",includeOCR:!1,compression:!0}),[b,_]=J.useState({format:"png",quality:90}),h=bt(),x=async()=>{if(!g){e({type:"error",message:"No document to export"});return}i(!0),l(0);try{let f=`${g.name}`;switch(s){case"pdf":{l(30);const m=await h.exportToPDF(g,p);l(100),f+=".pdf",h.downloadBlob(m,f),e({type:"success",message:"PDF exported successfully"});break}case"png":case"jpeg":{if(g.pages.length===1){l(50);const m=await h.exportToImage(g.pages[0],{...b,format:s});l(100),f+=`.${s}`,h.downloadBlob(m,f),e({type:"success",message:`${s.toUpperCase()} exported successfully`})}else{const m=await h.exportMultipleImages(g,{...b,format:s});for(let y=0;y<m.length;y++){l((y+1)/m.length*100);const E=`${g.name}_page${y+1}.${s}`;h.downloadBlob(m[y],E)}e({type:"success",message:`${m.length} images exported successfully`})}break}case"txt":{l(50);const m=await h.exportToText(g);l(100),f+=".txt",h.downloadBlob(m,f),e({type:"success",message:"Text exported successfully"});break}}}catch(f){console.error("Export failed:",f),e({type:"error",message:f instanceof Error?f.message:"Export failed"})}finally{i(!1),l(0)}},d=async()=>{if(g){i(!0);try{let f,m;switch(s){case"pdf":f=await h.exportToPDF(g,p),m=`${g.name}.pdf`;break;case"png":case"jpeg":if(g.pages.length===1)f=await h.exportToImage(g.pages[0],{...b,format:s}),m=`${g.name}.${s}`;else{e({type:"warning",message:"Can only share single-page documents. Export multiple pages separately."});return}break;case"txt":f=await h.exportToText(g),m=`${g.name}.txt`;break;default:throw new Error("Invalid format")}await h.share(f,m,g.name),e({type:"success",message:"Shared successfully"})}catch(f){console.error("Share failed:",f),f instanceof Error&&f.message.includes("not supported")?x():e({type:"error",message:"Share failed"})}finally{i(!1)}}};return g?u.jsx("div",{className:"h-full bg-white overflow-y-auto",children:u.jsxs("div",{className:"max-w-2xl mx-auto p-6",children:[u.jsxs("div",{className:"mb-6",children:[u.jsx("h2",{className:"text-2xl font-bold mb-2",children:g.name}),u.jsxs("p",{className:"text-sm text-gray-600",children:[g.pages.length," page",g.pages.length!==1?"s":"",g.metadata.hasOCR&&" â€¢ OCR processed"]})]}),u.jsxs("div",{className:"mb-6",children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Export Format"}),u.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[u.jsxs("button",{onClick:()=>r("pdf"),className:`p-4 rounded-lg border-2 transition-all ${s==="pdf"?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[u.jsx("div",{className:"text-3xl mb-2",children:"ðŸ“„"}),u.jsx("div",{className:"font-medium",children:"PDF"}),u.jsx("div",{className:"text-xs text-gray-600",children:"Multi-page document"})]}),u.jsxs("button",{onClick:()=>r("png"),className:`p-4 rounded-lg border-2 transition-all ${s==="png"?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[u.jsx("div",{className:"text-3xl mb-2",children:"ðŸ–¼ï¸"}),u.jsx("div",{className:"font-medium",children:"PNG"}),u.jsx("div",{className:"text-xs text-gray-600",children:"Lossless image"})]}),u.jsxs("button",{onClick:()=>r("jpeg"),className:`p-4 rounded-lg border-2 transition-all ${s==="jpeg"?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[u.jsx("div",{className:"text-3xl mb-2",children:"ðŸ“·"}),u.jsx("div",{className:"font-medium",children:"JPEG"}),u.jsx("div",{className:"text-xs text-gray-600",children:"Compressed image"})]}),u.jsxs("button",{onClick:()=>r("txt"),className:`p-4 rounded-lg border-2 transition-all ${s==="txt"?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,disabled:!g.metadata.hasOCR,children:[u.jsx("div",{className:"text-3xl mb-2",children:"ðŸ“"}),u.jsx("div",{className:"font-medium",children:"Text"}),u.jsx("div",{className:"text-xs text-gray-600",children:g.metadata.hasOCR?"OCR text only":"OCR required"})]})]})]}),s==="pdf"&&u.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[u.jsx("h3",{className:"font-medium mb-3",children:"PDF Options"}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"Page Size"}),u.jsxs("select",{value:p.pageSize,onChange:f=>w({...p,pageSize:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[u.jsx("option",{value:"a4",children:"A4"}),u.jsx("option",{value:"letter",children:"Letter"}),u.jsx("option",{value:"legal",children:"Legal"}),u.jsx("option",{value:"original",children:"Original Size"})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"Orientation"}),u.jsxs("select",{value:p.orientation,onChange:f=>w({...p,orientation:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[u.jsx("option",{value:"auto",children:"Auto"}),u.jsx("option",{value:"portrait",children:"Portrait"}),u.jsx("option",{value:"landscape",children:"Landscape"})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm text-gray-700 mb-2",children:"Quality"}),u.jsxs("select",{value:p.quality,onChange:f=>w({...p,quality:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[u.jsx("option",{value:"low",children:"Low (smaller file)"}),u.jsx("option",{value:"medium",children:"Medium"}),u.jsx("option",{value:"high",children:"High"}),u.jsx("option",{value:"original",children:"Original"})]})]}),g.metadata.hasOCR&&u.jsxs("label",{className:"flex items-center gap-2",children:[u.jsx("input",{type:"checkbox",checked:p.includeOCR,onChange:f=>w({...p,includeOCR:f.target.checked}),className:"rounded border-gray-300"}),u.jsx("span",{className:"text-sm text-gray-700",children:"Include OCR text layer (searchable PDF)"})]})]})]}),(s==="png"||s==="jpeg")&&u.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[u.jsx("h3",{className:"font-medium mb-3",children:"Image Options"}),u.jsxs("div",{className:"space-y-4",children:[s==="jpeg"&&u.jsxs("div",{children:[u.jsxs("label",{className:"block text-sm text-gray-700 mb-2",children:["Quality: ",b.quality,"%"]}),u.jsx("input",{type:"range",min:"10",max:"100",step:"10",value:b.quality,onChange:f=>_({...b,quality:parseInt(f.target.value)}),className:"w-full"})]}),u.jsxs("div",{children:[u.jsxs("label",{className:"flex items-center gap-2",children:[u.jsx("input",{type:"checkbox",checked:b.maxDimension!==void 0,onChange:f=>_({...b,maxDimension:f.target.checked?2048:void 0}),className:"rounded border-gray-300"}),u.jsx("span",{className:"text-sm text-gray-700",children:"Limit maximum dimension"})]}),b.maxDimension!==void 0&&u.jsx("input",{type:"number",value:b.maxDimension,onChange:f=>_({...b,maxDimension:parseInt(f.target.value)}),className:"w-full mt-2 px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Max dimension (px)"})]})]})]}),t&&u.jsxs("div",{className:"mb-6",children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsx("span",{className:"text-sm text-gray-600",children:"Exporting..."}),u.jsxs("span",{className:"text-sm text-gray-600",children:[Math.round(c),"%"]})]}),u.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:u.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${c}%`}})})]}),u.jsxs("div",{className:"flex gap-3",children:[u.jsx(le,{onClick:x,disabled:t,variant:"primary",size:"lg",className:"flex-1",children:t?u.jsxs("span",{className:"flex items-center justify-center gap-2",children:[u.jsx(Ne,{size:"sm"}),"Exporting..."]}):`Export as ${s.toUpperCase()}`}),typeof navigator.share<"u"&&u.jsx(le,{onClick:d,disabled:t,variant:"secondary",size:"lg",children:"ðŸ“¤ Share"})]})]})}):u.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-50 p-6",children:[u.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“¤"}),u.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Document Selected"}),u.jsx("p",{className:"text-sm text-gray-600 mb-6 text-center max-w-md",children:"Select a document from your library to export it."}),u.jsx(le,{onClick:()=>n("documents"),variant:"primary",size:"lg",children:"Go to Documents"})]})};function Nr(){const g=ge(e=>e.ui.currentView),n=()=>{switch(g){case"camera":return u.jsx(at,{});case"crop":return u.jsx(Yt,{});case"enhance":return u.jsx(gr,{});case"documents":return u.jsx(Cr,{});case"detail":return u.jsx(kr,{});case"ocr":return u.jsx(Er,{});case"export":return u.jsx(Dr,{});default:return u.jsx(at,{})}};return u.jsxs("div",{className:"flex flex-col h-screen overflow-hidden bg-white",children:[u.jsx(Ft,{}),u.jsx("main",{className:"flex-1 overflow-hidden mt-14 mb-16",children:n()}),u.jsx(Pt,{}),u.jsx(Mt,{})]})}Je.createRoot(document.getElementById("root")).render(u.jsx(jt.StrictMode,{children:u.jsx(Nr,{})}));
