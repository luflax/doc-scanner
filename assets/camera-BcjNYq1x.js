import{j as e,r as s}from"./react-vendor-DmQDSmdE.js";import{c as t}from"./zustand-vendor-CAwqQeLl.js";import{c as a}from"./services-B0EPmGK0.js";const i={brightness:0,contrast:0,saturation:0,sharpness:0,gamma:1,shadows:0,highlights:0,temperature:0},n=[{id:"original",name:"Original",description:"No filter applied",icon:"ðŸ“„"},{id:"document",name:"Document",description:"High contrast B&W",icon:"ðŸ“ƒ"},{id:"grayscale",name:"Grayscale",description:"Black and white",icon:"â¬œ"},{id:"magic",name:"Magic",description:"Auto-enhanced",icon:"âœ¨"},{id:"whiteboard",name:"Whiteboard",description:"For whiteboards",icon:"ðŸ–Šï¸"},{id:"book",name:"Book",description:"For book pages",icon:"ðŸ“–"},{id:"receipt",name:"Receipt",description:"High contrast",icon:"ðŸ§¾"},{id:"photo",name:"Photo",description:"Color preserved",icon:"ðŸ–¼ï¸"},{id:"blueprint",name:"Blueprint",description:"Inverted colors",icon:"ðŸ“"}],r=t(e=>({camera:{isInitialized:!1,isCapturing:!1,stream:null,capabilities:null,error:null},scanSession:{isActive:!1,currentImage:null,detectedEdges:null,adjustedCorners:null,processedImage:null,selectedFilter:"original",enhancementOptions:i},ocr:{isInitialized:!1,isProcessing:!1,progress:0,result:null,selectedLanguages:["eng"]},documents:{list:[],currentDocument:null,isLoading:!1,selectedDocumentIds:[]},ui:{currentView:"camera",isProcessing:!1,toasts:[],modalOpen:null},setCameraInitialized:s=>e(e=>({camera:{...e.camera,isInitialized:s}})),setCameraStream:s=>e(e=>({camera:{...e.camera,stream:s}})),setCameraCapabilities:s=>e(e=>({camera:{...e.camera,capabilities:s}})),setCameraError:s=>e(e=>({camera:{...e.camera,error:s}})),setCapturing:s=>e(e=>({camera:{...e.camera,isCapturing:s}})),startScanSession:s=>e({scanSession:{isActive:!0,currentImage:s,detectedEdges:null,adjustedCorners:null,processedImage:null,selectedFilter:"original",enhancementOptions:i}}),setDetectedEdges:s=>e(e=>({scanSession:{...e.scanSession,detectedEdges:s}})),setAdjustedCorners:s=>e(e=>({scanSession:{...e.scanSession,adjustedCorners:s}})),setProcessedImage:s=>e(e=>({scanSession:{...e.scanSession,processedImage:s}})),setSelectedFilter:s=>e(e=>({scanSession:{...e.scanSession,selectedFilter:s}})),setEnhancementOptions:s=>e(e=>({scanSession:{...e.scanSession,enhancementOptions:s}})),resetScanSession:()=>e({scanSession:{isActive:!1,currentImage:null,detectedEdges:null,adjustedCorners:null,processedImage:null,selectedFilter:"original",enhancementOptions:i}}),setOCRInitialized:s=>e(e=>({ocr:{...e.ocr,isInitialized:s}})),setOCRProcessing:s=>e(e=>({ocr:{...e.ocr,isProcessing:s}})),setOCRProgress:s=>e(e=>({ocr:{...e.ocr,progress:s}})),setOCRResult:s=>e(e=>({ocr:{...e.ocr,result:s}})),setSelectedLanguages:s=>e(e=>({ocr:{...e.ocr,selectedLanguages:s}})),setDocuments:s=>e(e=>({documents:{...e.documents,list:s}})),setCurrentDocument:s=>e(e=>({documents:{...e.documents,currentDocument:s}})),setDocumentsLoading:s=>e(e=>({documents:{...e.documents,isLoading:s}})),addDocument:s=>e(e=>({documents:{...e.documents,list:[s,...e.documents.list]}})),removeDocument:s=>e(e=>({documents:{...e.documents,list:e.documents.list.filter(e=>e.id!==s),selectedDocumentIds:e.documents.selectedDocumentIds.filter(e=>e!==s)}})),toggleDocumentSelection:s=>e(e=>{const t=e.documents.selectedDocumentIds.includes(s);return{documents:{...e.documents,selectedDocumentIds:t?e.documents.selectedDocumentIds.filter(e=>e!==s):[...e.documents.selectedDocumentIds,s]}}}),clearDocumentSelection:()=>e(e=>({documents:{...e.documents,selectedDocumentIds:[]}})),selectAllDocuments:()=>e(e=>({documents:{...e.documents,selectedDocumentIds:e.documents.list.map(e=>e.id)}})),setCurrentView:s=>e(e=>({ui:{...e.ui,currentView:s}})),setProcessing:s=>e(e=>({ui:{...e.ui,isProcessing:s}})),addToast:s=>e(e=>({ui:{...e.ui,toasts:[...e.ui.toasts,{...s,id:Math.random().toString(36).substr(2,9)}]}})),removeToast:s=>e(e=>({ui:{...e.ui,toasts:e.ui.toasts.filter(e=>e.id!==s)}})),setModalOpen:s=>e(e=>({ui:{...e.ui,modalOpen:s}}))})),c=({variant:s="primary",size:t="md",fullWidth:a=!1,className:i="",children:n,...r})=>{const c=a?"w-full":"";return e.jsx("button",{className:`btn font-medium transition-all duration-200 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed ${{primary:"btn-primary",secondary:"btn-secondary",outline:"border-2 border-primary-600 text-primary-600 hover:bg-primary-50 active:bg-primary-100"}[s]} ${{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[t]} ${c} ${i}`,...r,children:n})},o=({size:s="md",className:t=""})=>e.jsx("div",{className:`flex items-center justify-center ${t}`,children:e.jsx("div",{className:`${{sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"}[s]} border-4 border-gray-200 border-t-primary-600 rounded-full animate-spin`})}),l=({icon:s,label:t,size:a="md",className:i="",...n})=>e.jsx("button",{className:`btn-icon ${{sm:"p-2",md:"p-3",lg:"p-4"}[a]} ${i}`,"aria-label":t,title:t,...n,children:s}),d=Object.freeze(Object.defineProperty({__proto__:null,CameraView:()=>{const{addToast:t,setCameraCapabilities:i,setCurrentView:n,startScanSession:d}=r(e=>({addToast:e.addToast,setCameraCapabilities:e.setCameraCapabilities,setCurrentView:e.setCurrentView,startScanSession:e.startScanSession})),{videoRef:m,isInitialized:u,isLoading:p,error:g,capabilities:h,facingMode:b,initialize:f,switchCamera:x,capturePhoto:y}=((e={})=>{const{autoStart:t=!1,facingMode:i="environment",onError:n,onInitialized:r}=e,[c,o]=s.useState(null),[l,d]=s.useState(!1),[m,u]=s.useState(!1),[p,g]=s.useState(null),[h,b]=s.useState(null),f=s.useRef(null),x=async()=>{u(!0),g(null);try{const e=await a.initialize({facingMode:i});o(e),d(!0);const s=a.getCapabilities();b(s),r?.(e)}catch(e){const s=e instanceof Error?e:new Error("Failed to initialize camera");g(s),n?.(s)}finally{u(!1)}},y=()=>{a.dispose(),o(null),d(!1),b(null)};return s.useEffect(()=>{c&&f.current&&(f.current.srcObject=c)},[c]),s.useEffect(()=>(t&&x(),()=>{y()}),[]),{stream:c,isInitialized:l,isLoading:m,error:p,capabilities:h,videoRef:f,initialize:x,switchCamera:async()=>{u(!0),g(null);try{const e=await a.switchCamera();o(e);const s=a.getCapabilities();b(s),r?.(e)}catch(e){const s=e instanceof Error?e:new Error("Failed to switch camera");g(s),n?.(s)}finally{u(!1)}},capturePhoto:async()=>{if(!f.current||!c)return g(new Error("Camera not ready")),null;try{return await a.capturePhoto(f.current)}catch(e){const s=e instanceof Error?e:new Error("Failed to capture photo");return g(s),n?.(s),null}},setZoom:async e=>{try{await a.setZoom(e)}catch(s){}},toggleFlash:async e=>{try{await a.toggleFlash(e)}catch(s){}},dispose:y,facingMode:a.getCurrentFacingMode()}})({onError:e=>{t({type:"error",message:e.message||"Failed to access camera"})},onInitialized:()=>{t({type:"success",message:"Camera initialized successfully"})}});s.useEffect(()=>{h&&i(h)},[h,i]);return p?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-black",children:[e.jsx(o,{size:"lg",className:"mb-4"}),e.jsx("p",{className:"text-white text-sm",children:"Initializing camera..."})]}):g||!u&&!p?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-100 p-6",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“·"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Camera Access Required"}),g&&e.jsx("p",{className:"text-sm text-red-600 mb-4 text-center max-w-md",children:g.message}),e.jsx("p",{className:"text-sm text-gray-600 mb-6 text-center max-w-md",children:"This app needs access to your camera to scan documents. Click the button below to grant permission."}),e.jsx(c,{onClick:f,variant:"primary",size:"lg",children:"Enable Camera"})]}):e.jsxs("div",{className:"relative w-full h-full bg-black",children:[e.jsx("video",{ref:m,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4",children:e.jsx("div",{className:"flex justify-end",children:e.jsx(l,{icon:e.jsx("span",{className:"text-xl",children:"ðŸ”„"}),onClick:async()=>{try{await x(),t({type:"success",message:`Switched to ${"environment"===b?"front":"back"} camera`})}catch(e){t({type:"error",message:"Failed to switch camera"})}},className:"bg-black/50 text-white hover:bg-black/70",label:"Switch camera"})})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/80 to-transparent",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(c,{onClick:async()=>{const e=await y();e&&(d(e),n("crop"),t({type:"success",message:"Image captured successfully"}))},variant:"primary",size:"lg",className:"rounded-full w-16 h-16 p-0",children:e.jsx("span",{className:"text-2xl",children:"ðŸ“¸"})})})}),e.jsx("div",{className:"absolute inset-0 pointer-events-none",children:e.jsx("div",{className:"w-full h-full flex items-center justify-center p-8",children:e.jsx("div",{className:"border-2 border-white border-dashed rounded-lg w-full max-w-md aspect-document opacity-50"})})})]})}},Symbol.toStringTag,{value:"Module"}));export{c as B,d as C,i as D,n as F,l as I,o as S,r as u};
