import{i as e}from"./vendor-DsI9Cwdy.js";function a(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var t=(e,a)=>`${e}-${a}-${Math.random().toString(16).slice(3,8)}`;const o=t;let r=0;var n=({id:e,action:a,payload:t={}})=>{let n=e;return void 0===n&&(n=o("Job",r),r+=1),{id:n,action:a,payload:t}},s={};let i=!1;s.logging=i,s.setLogging=e=>{i=e},s.log=(...e)=>i?void 0:null;const l=n,{log:c}=s,d=t;let g=0;const p=e;const h="browser"===(e=>{const a={};return"undefined"!=typeof WorkerGlobalScope?a.type="webworker":p()?a.type="electron":"object"==typeof document?a.type="browser":"object"==typeof process&&(a.type="node"),void 0===e?a:a[e]})("type")?e=>new URL(e,window.location.href).href:e=>e;var u={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};var y={...{workerBlobURL:!0,logger:()=>{}},workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${"5.1.1"}/dist/worker.min.js`};const m=e=>new Promise((a,t)=>{const o=new FileReader;o.onload=()=>{a(o.result)},o.onerror=({target:{error:{code:e}}})=>{t(Error(`File could not be read! Code=${e}`))},o.readAsArrayBuffer(e)}),f=async e=>{let a=e;if(void 0===e)return"undefined";if("string"==typeof e)if(/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(e))a=atob(e.split(",")[1]).split("").map(e=>e.charCodeAt(0));else{const t=await fetch(e);a=await t.arrayBuffer()}else if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)"IMG"===e.tagName&&(a=await f(e.src)),"VIDEO"===e.tagName&&(a=await f(e.poster)),"CANVAS"===e.tagName&&await new Promise(t=>{e.toBlob(async e=>{a=await m(e),t()})});else if("undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas){const t=await e.convertToBlob();a=await m(t)}else(e instanceof File||e instanceof Blob)&&(a=await m(e));return new Uint8Array(a)};var L={defaultOptions:y,spawnWorker:({workerPath:e,workerBlobURL:a})=>{let t;if(Blob&&URL&&a){const a=new Blob([`importScripts("${e}");`],{type:"application/javascript"});t=new Worker(URL.createObjectURL(a))}else t=new Worker(e);return t},terminateWorker:e=>{e.terminate()},onMessage:(e,a)=>{e.onmessage=({data:e})=>{a(e)}},send:async(e,a)=>{e.postMessage(a)},loadImage:f};const w=e=>{const a={...e};return["corePath","workerPath","langPath"].forEach(t=>{e[t]&&(a[t]=h(a[t]))}),a},E=e=>{const a=[],t=[],o=[],r=[],n=[];return e.blocks&&e.blocks.forEach(s=>{s.paragraphs.forEach(a=>{a.lines.forEach(t=>{t.words.forEach(o=>{o.symbols.forEach(r=>{n.push({...r,page:e,block:s,paragraph:a,line:t,word:o})}),r.push({...o,page:e,block:s,paragraph:a,line:t})}),o.push({...t,page:e,block:s,paragraph:a})}),t.push({...a,page:e,block:s})}),a.push({...s,page:e})}),{...e,blocks:a,paragraphs:t,lines:o,words:r,symbols:n}},S=n,{log:A}=s,b=t,k=u,{defaultOptions:T,spawnWorker:R,terminateWorker:O,onMessage:N,loadImage:_,send:I}=L;let P=0;var M=async(e="eng",a=k.LSTM_ONLY,t={},o={})=>{const r=b("Worker",P),{logger:n,errorHandler:s,...i}=w({...T,...t}),l={},c={},d="string"==typeof e?e.split("+"):e;let g=a,p=o;const h=[k.DEFAULT,k.LSTM_ONLY].includes(a)&&!i.legacyCore;let u,y;const m=new Promise((e,a)=>{y=e,u=a});let f=R(i);f.onerror=e=>{u(e.message)},P+=1;const L=(e,a)=>{l[e]=a},M=(e,a)=>{c[e]=a},v=({id:e,action:a,payload:t})=>new Promise((o,n)=>{A(`[${r}]: Start ${e}, action=${a}`);const s=`${a}-${e}`;L(s,o),M(s,n),I(f,{workerId:r,jobId:e,action:a,payload:t})}),C=(e,a)=>v(S({id:a,action:"loadLanguage",payload:{langs:e,options:{langPath:i.langPath,dataPath:i.dataPath,cachePath:i.cachePath,cacheMethod:i.cacheMethod,gzip:i.gzip,lstmOnly:[k.DEFAULT,k.LSTM_ONLY].includes(g)&&!i.legacyLang}}})),U=(e,a,t,o)=>v(S({id:o,action:"initialize",payload:{langs:e,oem:a,config:t}}));N(f,({workerId:e,jobId:a,status:t,action:o,data:r})=>{const i=`${o}-${a}`;if("resolve"===t){A(`[${e}]: Complete ${a}`);let t=r;"recognize"===o?t=E(r):"getPDF"===o&&(t=Array.from({...r,length:Object.keys(r).length})),l[i]({jobId:a,data:t})}else if("reject"===t){if(c[i](r),"load"===o&&u(r),!s)throw Error(r);s(r)}else"progress"===t&&n({...r,userJobId:a})});const D={id:r,worker:f,setResolve:L,setReject:M,load:()=>{},writeText:(e,a,t)=>v(S({id:t,action:"FS",payload:{method:"writeFile",args:[e,a]}})),readText:(e,a)=>v(S({id:a,action:"FS",payload:{method:"readFile",args:[e,{encoding:"utf8"}]}})),removeFile:(e,a)=>v(S({id:a,action:"FS",payload:{method:"unlink",args:[e]}})),FS:(e,a,t)=>v(S({id:t,action:"FS",payload:{method:e,args:a}})),loadLanguage:()=>{},initialize:()=>{},reinitialize:(e="eng",a,t,o)=>{if(h&&[k.TESSERACT_ONLY,k.TESSERACT_LSTM_COMBINED].includes(a))throw Error("Legacy model requested but code missing.");const r=a||g;g=r;const n=t||p;p=n;const s=("string"==typeof e?e.split("+"):e).filter(e=>!d.includes(e));return d.push(...s),s.length>0?C(s,o).then(()=>U(e,r,n,o)):U(e,r,n,o)},setParameters:(e={},a)=>v(S({id:a,action:"setParameters",payload:{params:e}})),recognize:async(e,a={},t={blocks:!0,text:!0,hocr:!0,tsv:!0},o)=>v(S({id:o,action:"recognize",payload:{image:await _(e),options:a,output:t}})),getPDF:(e="Tesseract OCR Result",a=!1,t)=>v(S({id:t,action:"getPDF",payload:{title:e,textonly:a}})),detect:async(e,a)=>{if(h)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return v(S({id:a,action:"detect",payload:{image:await _(e)}}))},terminate:async()=>(null!==f&&(O(f),f=null),Promise.resolve())};var $;return v(S({id:$,action:"load",payload:{options:{lstmOnly:h,corePath:i.corePath,logging:i.logging}}})).then(()=>C(e)).then(()=>U(e,a,o)).then(()=>y(D)).catch(()=>{}),m};const v=M;const C=()=>{const e=d("Scheduler",g),a={},t={};let o=[];g+=1;const r=()=>Object.keys(a).length,n=()=>{if(0!==o.length){const e=Object.keys(a);for(let r=0;r<e.length;r+=1)if(void 0===t[e[r]]){o[0](a[e[r]]);break}}};return{addWorker:t=>(a[t.id]=t,c(`[${e}]: Add ${t.id}`),c(`[${e}]: Number of workers=${r()}`),n(),t.id),addJob:async(a,...s)=>{if(0===r())throw Error(`[${e}]: You need to have at least one worker before adding jobs`);return((a,r)=>new Promise((s,i)=>{const d=l({action:a,payload:r});o.push(async e=>{o.shift(),t[e.id]=d;try{s(await e[a].apply(void 0,[...r,d.id]))}catch(l){i(l)}finally{delete t[e.id],n()}}),c(`[${e}]: Add ${d.id} to JobQueue`),c(`[${e}]: JobQueue length=${o.length}`),n()}))(a,s)},terminate:async()=>{Object.keys(a).forEach(async e=>{await a[e].terminate()}),o=[]},getQueueLen:()=>o.length,getNumWorkers:r}},U=M,D={recognize:async(e,a,t)=>{const o=await v(a,1,t);return o.recognize(e).finally(async()=>{await o.terminate()})},detect:async(e,a)=>{const t=await v("osd",0,a);return t.detect(e).finally(async()=>{await t.terminate()})}},$={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},F=u,j={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"},{setLogging:B}=s;var z={languages:$,OEM:F,PSM:j,createScheduler:C,createWorker:U,setLogging:B,...D};export{a as c,z as s};
