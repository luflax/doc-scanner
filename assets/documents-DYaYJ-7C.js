import{r as e,j as t}from"./react-vendor-DmQDSmdE.js";import{u as s,S as a,B as r,I as n}from"./camera-BcjNYq1x.js";import{g as l,a as c}from"./services-B0EPmGK0.js";const i=({compact:s=!1})=>{const[a,r]=e.useState(null),[n,c]=e.useState(!0);e.useEffect(()=>{i()},[]);const i=async()=>{try{const e=await l(),t=await e.getStorageUsage();r(t)}catch(e){}finally{c(!1)}},o=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]};if(n)return s?t.jsx("span",{className:"text-xs text-gray-500",children:"Loading..."}):t.jsx("div",{className:"text-sm text-gray-600",children:"Loading storage info..."});if(!a||0===a.quota)return s?t.jsx("span",{className:"text-xs text-gray-500",children:"Storage: N/A"}):t.jsx("div",{className:"text-sm text-gray-600",children:"Storage information not available"});const d=e=>e<50?"bg-green-500":e<80?"bg-yellow-500":"bg-red-500";return s?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-xs text-gray-600",children:[o(a.used)," / ",o(a.quota)]}),t.jsx("div",{className:"w-16 h-2 bg-gray-200 rounded-full overflow-hidden",children:t.jsx("div",{className:`h-full ${d(a.percentage)} transition-all duration-300`,style:{width:`${Math.min(a.percentage,100)}%`}})})]}):t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"Storage Usage"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-gray-600",children:"Used"}),t.jsx("span",{className:"font-medium",children:o(a.used)})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-gray-600",children:"Total"}),t.jsx("span",{className:"font-medium",children:o(a.quota)})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-gray-600",children:"Used"}),t.jsxs("span",{className:"font-medium",children:[a.percentage.toFixed(1),"%"]})]}),t.jsx("div",{className:"w-full h-3 bg-gray-200 rounded-full overflow-hidden mt-2",children:t.jsx("div",{className:`h-full ${d(a.percentage)} transition-all duration-300`,style:{width:`${Math.min(a.percentage,100)}%`}})}),a.percentage>80&&t.jsx("div",{className:"mt-2 text-xs text-orange-600 bg-orange-50 p-2 rounded",children:"âš ï¸ Storage is running low. Consider deleting old documents."})]})]})},o=Object.freeze(Object.defineProperty({__proto__:null,DocumentsView:()=>{const{documents:n,selectedDocumentIds:o,setDocuments:d,setCurrentDocument:m,removeDocument:u,toggleDocumentSelection:x,clearDocumentSelection:g,selectAllDocuments:h,setCurrentView:p,addToast:f}=s(e=>({documents:e.documents.list,selectedDocumentIds:e.documents.selectedDocumentIds,setDocuments:e.setDocuments,setCurrentDocument:e.setCurrentDocument,removeDocument:e.removeDocument,toggleDocumentSelection:e.toggleDocumentSelection,clearDocumentSelection:e.clearDocumentSelection,selectAllDocuments:e.selectAllDocuments,setCurrentView:e.setCurrentView,addToast:e.addToast})),[y,j]=e.useState(!0),[v,b]=e.useState(new Map),[N,w]=e.useState(!1),[D,C]=e.useState(!1),[S,k]=e.useState({current:0,total:0}),[O,A]=e.useState(""),[R,L]=e.useState([]);e.useEffect(()=>{z()},[]),e.useEffect(()=>{n.length>0&&E()},[n]),e.useEffect(()=>{if(O.trim()){const e=O.toLowerCase(),t=n.filter(t=>{if(t.name.toLowerCase().includes(e))return!0;if(t.tags.some(t=>t.toLowerCase().includes(e)))return!0;if(t.metadata.hasOCR)for(const s of t.pages)if(s.ocrResult&&s.ocrResult.text.toLowerCase().includes(e))return!0;return!1});L(t)}else L(n)},[n,O]);const z=async()=>{try{const e=await l(),t=await e.listDocuments({sortBy:"updatedAt",sortOrder:"desc"});d(t)}catch(e){f({type:"error",message:"Failed to load documents"})}finally{j(!1)}},E=async()=>{const e=new Map;for(const t of n)if(t.pages.length>0){const s=t.pages[0],a=URL.createObjectURL(s.thumbnailImage);e.set(t.id,a)}return b(e),()=>{v.forEach(e=>URL.revokeObjectURL(e))}},U=async e=>{if(0!==o.length)try{C(!0),k({current:0,total:o.length});const t=c(),s=n.filter(e=>o.includes(e.id)),a={pageSize:"a4",orientation:"auto",quality:"high",includeOCR:!1,compression:!0},r={format:"png",quality:90},l=await t.exportDocumentsAsZip(s,{format:e,pdfOptions:a,imageOptions:r},e=>{k({current:e.current,total:e.total})}),i=t.generateZipFilename(o.length,e),d=URL.createObjectURL(l),m=document.createElement("a");m.href=d,m.download=i,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(d),f({type:"success",message:`Successfully exported ${o.length} document${1!==o.length?"s":""}`}),w(!1),g()}catch(t){f({type:"error",message:"Failed to export documents"})}finally{C(!1),k({current:0,total:0})}else f({type:"error",message:"No documents selected"})};return y?t.jsx("div",{className:"flex items-center justify-center h-full bg-gray-50",children:t.jsxs("div",{className:"text-center",children:[t.jsx(a,{size:"lg"}),t.jsx("p",{className:"text-sm text-gray-600 mt-4",children:"Loading documents..."})]})}):0===n.length?t.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-50 p-6",children:[t.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“"}),t.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Documents Yet"}),t.jsx("p",{className:"text-sm text-gray-600 mb-6 text-center max-w-md",children:"Start by scanning your first document using the camera."}),t.jsx(r,{onClick:()=>p("camera"),variant:"primary",size:"lg",children:"Scan Document"})]}):t.jsxs("div",{className:"h-full bg-gray-50 flex flex-col",children:[t.jsxs("div",{className:"bg-white border-b border-gray-200 p-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-lg font-semibold",children:"My Documents"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(r,{onClick:()=>{N&&g(),w(!N)},variant:N?"secondary":"outline",size:"sm",children:N?"Cancel":"Select"}),!N&&t.jsx(r,{onClick:()=>p("camera"),variant:"primary",size:"sm",children:"+ New Scan"})]})]}),!N&&n.length>0&&t.jsx("div",{className:"mt-3",children:t.jsx("input",{type:"text",value:O,onChange:e=>A(e.target.value),placeholder:"Search documents, tags, or text...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})}),t.jsxs("div",{className:"flex items-center justify-between mt-2",children:[t.jsx("p",{className:"text-sm text-gray-600",children:N&&o.length>0?`${o.length} selected`:O?`${R.length} of ${n.length} document${1!==n.length?"s":""}`:`${n.length} document${1!==n.length?"s":""}`}),N&&t.jsx("button",{onClick:()=>{o.length===n.length?g():h()},className:"text-sm text-blue-600 hover:text-blue-700",children:o.length===n.length?"Deselect All":"Select All"})]}),!N&&t.jsx("div",{className:"mt-3",children:t.jsx(i,{compact:!0})})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:t.jsx("div",{className:"grid grid-cols-2 gap-4",children:R.map(e=>{const s=o.includes(e.id);return t.jsxs("div",{onClick:()=>{return t=e,void(N?x(t.id):(m(t),p("detail")));var t},className:"bg-white rounded-lg shadow hover:shadow-lg transition-all cursor-pointer overflow-hidden "+(s?"ring-2 ring-blue-500":""),children:[t.jsxs("div",{className:"aspect-[3/4] bg-gray-200 relative overflow-hidden",children:[v.has(e.id)?t.jsx("img",{src:v.get(e.id),alt:e.name,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:t.jsx("span",{className:"text-4xl",children:"ðŸ“„"})}),N&&t.jsx("div",{className:"absolute top-2 left-2",children:t.jsx("input",{type:"checkbox",checked:s,onChange:()=>x(e.id),onClick:e=>e.stopPropagation(),className:"w-6 h-6 cursor-pointer"})}),!N&&t.jsx("button",{onClick:t=>(async(e,t)=>{if(e.stopPropagation(),confirm("Are you sure you want to delete this document?"))try{const e=await l();await e.deleteDocument(t),u(t),f({type:"success",message:"Document deleted"})}catch(s){f({type:"error",message:"Failed to delete document"})}})(t,e.id),className:"absolute top-2 right-2 w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center shadow-lg transition-colors",title:"Delete document",children:"Ã—"})]}),t.jsxs("div",{className:"p-3",children:[t.jsx("h3",{className:"text-sm font-medium truncate mb-1",children:e.name}),t.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[t.jsxs("span",{children:[e.pages.length," page",1!==e.pages.length?"s":""]}),t.jsx("span",{children:e.metadata.hasOCR?"âœ“ OCR":""})]}),t.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(e.updatedAt).toLocaleDateString()}),!N&&t.jsxs("div",{className:"flex gap-2 mt-2",children:[!e.metadata.hasOCR&&t.jsx("button",{onClick:t=>(async(e,t)=>{e.stopPropagation(),m(t),p("ocr")})(t,e),className:"flex-1 px-2 py-1 text-xs bg-blue-50 text-blue-600 rounded hover:bg-blue-100 transition-colors",children:"Extract Text"}),t.jsx("button",{onClick:t=>{t.stopPropagation(),m(e),p("export")},className:"flex-1 px-2 py-1 text-xs bg-green-50 text-green-600 rounded hover:bg-green-100 transition-colors",children:"Export"})]})]})]},e.id)})})}),N&&o.length>0&&t.jsx("div",{className:"bg-white border-t border-gray-200 p-4 shadow-lg",children:D?t.jsxs("div",{className:"text-center",children:[t.jsx(a,{size:"sm"}),t.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Exporting ",S.current," of ",S.total,"..."]})]}):t.jsxs("div",{className:"flex gap-2",children:[t.jsx(r,{onClick:()=>U("pdf"),variant:"primary",size:"md",className:"flex-1",children:"ðŸ“„ Export as PDFs"}),t.jsx(r,{onClick:()=>U("images"),variant:"secondary",size:"md",className:"flex-1",children:"ðŸ–¼ï¸ Export as Images"})]})})]})}},Symbol.toStringTag,{value:"Module"})),d=Object.freeze(Object.defineProperty({__proto__:null,DocumentDetailView:()=>{const{currentDocument:c,setCurrentDocument:i,setDocuments:o,setCurrentView:d,addToast:m}=s(e=>({currentDocument:e.documents.currentDocument,setCurrentDocument:e.setCurrentDocument,setDocuments:e.setDocuments,setCurrentView:e.setCurrentView,addToast:e.addToast})),[u,x]=e.useState(!1),[g,h]=e.useState(!1),[p,f]=e.useState(""),[y,j]=e.useState(new Map),[v,b]=e.useState(""),[N,w]=e.useState(null),[D,C]=e.useState(null);e.useEffect(()=>{c&&(f(c.name),S())},[c]);const S=async()=>{if(!c)return;const e=new Map;for(const t of c.pages){const s=URL.createObjectURL(t.thumbnailImage);e.set(t.id,s)}return j(e),()=>{y.forEach(e=>URL.revokeObjectURL(e))}},k=async()=>{if(c&&p.trim())try{const e={...c,name:p.trim(),updatedAt:new Date},t=await l();await t.updateDocument(e),i(e);const s=await t.listDocuments({sortBy:"updatedAt",sortOrder:"desc"});o(s),h(!1),m({type:"success",message:"Document name updated"})}catch(e){m({type:"error",message:"Failed to update document name"})}else m({type:"error",message:"Document name cannot be empty"})},O=async()=>{if(!c||!v.trim())return;const e=v.trim();if(c.tags.includes(e))m({type:"warning",message:"Tag already exists"});else try{const t={...c,tags:[...c.tags,e],updatedAt:new Date},s=await l();await s.updateDocument(t),i(t);const a=await s.listDocuments({sortBy:"updatedAt",sortOrder:"desc"});o(a),b(""),m({type:"success",message:"Tag added"})}catch(t){m({type:"error",message:"Failed to add tag"})}};return c?t.jsxs("div",{className:"h-full bg-gray-50 flex flex-col",children:[t.jsxs("div",{className:"bg-white border-b border-gray-200 p-4",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[t.jsx(n,{icon:"â†",onClick:()=>d("documents"),title:"Back to documents",size:"md"}),t.jsx("div",{className:"flex-1",children:g?t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:p,onChange:e=>f(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0,onKeyPress:e=>{"Enter"===e.key&&k()}}),t.jsx(r,{onClick:k,variant:"primary",size:"sm",children:"Save"}),t.jsx(r,{onClick:()=>{f(c.name),h(!1)},variant:"secondary",size:"sm",children:"Cancel"})]}):t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h2",{className:"text-lg font-semibold",children:c.name}),t.jsx(n,{icon:"âœï¸",onClick:()=>h(!0),title:"Edit name",size:"sm"})]})})]}),t.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[t.jsxs("div",{children:[c.pages.length," page",1!==c.pages.length?"s":""]}),t.jsxs("div",{children:["Created: ",new Date(c.createdAt).toLocaleString()]}),t.jsxs("div",{children:["Updated: ",new Date(c.updatedAt).toLocaleString()]}),c.metadata.hasOCR&&t.jsx("div",{className:"text-green-600",children:"âœ“ OCR completed"})]}),t.jsxs("div",{className:"mt-3",children:[t.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Tags"}),t.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:c.tags.map(e=>t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs",children:[e,t.jsx("button",{onClick:()=>(async e=>{if(c)try{const t={...c,tags:c.tags.filter(t=>t!==e),updatedAt:new Date},s=await l();await s.updateDocument(t),i(t);const a=await s.listDocuments({sortBy:"updatedAt",sortOrder:"desc"});o(a),m({type:"success",message:"Tag removed"})}catch(t){m({type:"error",message:"Failed to remove tag"})}})(e),className:"hover:text-blue-900",children:"Ã—"})]},e))}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:v,onChange:e=>b(e.target.value),placeholder:"Add tag...",className:"flex-1 px-3 py-1 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyPress:e=>{"Enter"===e.key&&O()}}),t.jsx(r,{onClick:O,variant:"secondary",size:"sm",children:"Add"})]})]}),t.jsxs("div",{className:"flex gap-2 mt-3",children:[!c.metadata.hasOCR&&t.jsx(r,{onClick:()=>{c&&d("ocr")},variant:"secondary",size:"sm",fullWidth:!0,children:"Extract Text"}),t.jsx(r,{onClick:()=>{c&&d("export")},variant:"primary",size:"sm",fullWidth:!0,children:"Export"})]})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[t.jsx("div",{className:"mb-3 text-sm text-gray-600",children:"Drag and drop pages to reorder them"}),t.jsx("div",{className:"grid grid-cols-2 gap-4",children:c.pages.map((e,s)=>t.jsxs("div",{draggable:!0,onDragStart:()=>(e=>{w(e)})(s),onDragOver:e=>((e,t)=>{e.preventDefault(),C(t)})(e,s),onDrop:e=>(async(e,t)=>{if(e.preventDefault(),!c||null===N||N===t)return w(null),void C(null);try{x(!0);const e=[...c.pages],[s]=e.splice(N,1);e.splice(t,0,s);const a=e.map(e=>e.id),r=await l();await r.reorderPages(c.id,a);const n=await r.getDocument(c.id);n&&i(n);const d=await r.listDocuments({sortBy:"updatedAt",sortOrder:"desc"});o(d),m({type:"success",message:"Pages reordered"})}catch(s){m({type:"error",message:"Failed to reorder pages"})}finally{x(!1),w(null),C(null)}})(e,s),className:`bg-white rounded-lg shadow hover:shadow-lg transition-all cursor-move ${D===s&&N!==s?"ring-2 ring-blue-500":""} ${N===s?"opacity-50":""}`,children:[t.jsxs("div",{className:"aspect-[3/4] bg-gray-200 relative overflow-hidden rounded-t-lg",children:[y.has(e.id)?t.jsx("img",{src:y.get(e.id),alt:`Page ${e.pageNumber}`,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:t.jsx("span",{className:"text-4xl",children:"ðŸ“„"})}),t.jsx("button",{onClick:()=>(async e=>{if(c)if(1!==c.pages.length){if(confirm("Are you sure you want to delete this page?"))try{x(!0);const t=await l();await t.removePage(c.id,e);const s=await t.getDocument(c.id);s&&i(s);const a=await t.listDocuments({sortBy:"updatedAt",sortOrder:"desc"});o(a),m({type:"success",message:"Page deleted"})}catch(t){m({type:"error",message:"Failed to delete page"})}finally{x(!1)}}else m({type:"error",message:"Cannot delete the last page. Delete the document instead."})})(e.id),className:"absolute top-2 right-2 w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center shadow-lg transition-colors",title:"Delete page",children:"Ã—"}),t.jsxs("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-black/70 text-white text-xs rounded",children:["Page ",e.pageNumber]})]}),t.jsxs("div",{className:"p-2 text-xs text-gray-600",children:[t.jsxs("div",{children:["Filter: ",e.filterApplied]}),e.ocrResult&&t.jsx("div",{className:"text-green-600 mt-1",children:"âœ“ OCR available"})]})]},e.id))})]}),u&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg p-4 flex items-center gap-3",children:[t.jsx(a,{size:"sm"}),t.jsx("span",{className:"text-sm text-gray-700",children:"Processing..."})]})})]}):t.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-gray-50 p-6",children:[t.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“„"}),t.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Document Selected"}),t.jsx(r,{onClick:()=>d("documents"),variant:"primary",size:"lg",children:"Back to Documents"})]})}},Symbol.toStringTag,{value:"Module"}));export{o as D,d as a};
